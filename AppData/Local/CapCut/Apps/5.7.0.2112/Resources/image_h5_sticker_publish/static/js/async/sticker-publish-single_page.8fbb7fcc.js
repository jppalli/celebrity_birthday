"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[948],{42983:(e,t,i)=>{i.d(t,{Ab:()=>r});let r=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({})},69836:(e,t,i)=>{i.d(t,{ir:()=>k});var r=i(50959),s=i(84875),a=i.n(s),o=i(45599),n=i(96426),l=i(85083),c=i(88623),u=i(82346),p=i(84997),m=i(40699),d=i(96305),g=i(11527);const S=e=>{const{className:t,loadingText:i}=e,{t:r}=(0,o.$)(),{handleMouseEnter:s}=(0,p.S)();return(0,g.jsxs)("div",{className:a()(d.Z.root,t),children:[(0,g.jsx)(u.a,{className:d.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,g.jsx)("div",{className:d.Z.text,onMouseEnter:s,children:i||r("pc_stickers_release_in_web")})]})},_=e=>{const{className:t,tooltip:i}=e,{t:s}=(0,o.$)(),{handleMouseEnter:l}=(0,p.w)({content:i,className:d.Z.tooltip}),c=(0,r.useRef)(null),{setIsMarqueeLoopRunning:u,reactNode:S}=(0,m.J)({text:s("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>c.current});return(0,g.jsxs)("div",{className:a()(d.Z.root,t,d.Z.error),onMouseEnter:e=>{u(!0),l(e)},onMouseLeave:()=>u(!1),children:[(0,g.jsx)(n.r,{className:d.Z.icon}),(0,g.jsx)("div",{ref:c,className:d.Z.text,children:S})]})},f=e=>{const{className:t,text:i}=e,{handleMouseEnter:r}=(0,p.S)();return(0,g.jsxs)("div",{className:a()(d.Z.root,t,d.Z.checked),children:[(0,g.jsx)(c.r,{className:d.Z.icon}),(0,g.jsx)("div",{className:d.Z.text,onMouseEnter:r,children:i})]})},h=e=>{const{className:t}=e,{t:i}=(0,o.$)(),{handleMouseEnter:r}=(0,p.S)();return(0,g.jsxs)("div",{className:a()(d.Z.root,t),children:[(0,g.jsx)("div",{className:a()(d.Z.icon,d.Z.yellowIcon),children:(0,g.jsx)("div",{className:d.Z.yellowPoint})}),(0,g.jsx)("div",{className:d.Z.text,onMouseEnter:r,children:i("pc_stickers_release_editing_web")}),(0,g.jsx)(l.r,{className:d.Z.icon})]})},k=e=>{const{className:t,loading:i,invalid:r,errorToolip:s,isInfoComplete:a,title:o,loadingText:n}=e;return i?(0,g.jsx)(S,{className:t,loadingText:n}):r?(0,g.jsx)(_,{className:t,tooltip:s}):a?(0,g.jsx)(f,{className:t,text:o}):(0,g.jsx)(h,{className:t})}},67078:(e,t,i)=>{i.d(t,{$X:()=>a,pn:()=>s});var r=i(94435);function s({isVip:e,isBusiness:t,authFiles:i}){var s;const a=null!==(s=null==i?void 0:i.map((({uri:e})=>({uri:e}))))&&void 0!==s?s:[];return{root:{is_vip:!1,copyright:{copyright_info:[{scene:r.$x.Vip,auth_status:e?r.U9.Authorized:r.U9.Unauthorized,third_party_agreements:[]},{scene:r.$x.Business,auth_status:t?r.U9.Authorized:r.U9.Unauthorized,third_party_agreements:t?a:[]}]}},commonData:{is_business:!1,is_original:Boolean(e||t)}}}function a(e,t){return Boolean(null==e?void 0:e.copyright_info.some((e=>e.scene===t&&e.auth_status===r.U9.Authorized)))}},9679:(e,t,i)=>{i.d(t,{$v:()=>u,Ad:()=>m,DV:()=>l,Sj:()=>c,_4:()=>d,ce:()=>p,iL:()=>o,j2:()=>n});var r=i(17095);function s(e){return void 0===e?e:String(Math.round(e/1024))}function a(e){const{material_category:t,material_type:i,collection_detail:r}=e;return{material_category:t,material_type:i,...r&&"collection"===i&&{collection_detail:r}}}function o(e){const{action:t,extra:i={},material_cnt:s}=e;(0,r.g)({eventName:"personal_page_material_publish_page_action",params:{action:t,material_cnt:s,...a(e),...i}})}function n(e){const{error_report:t,upload_status:i,time:o,isCompressed:n,sizeBeforeCompress:l,sizeAfterCompress:c,resolutionBeforeCompress:u,resolutionAfterCompress:p,extra:m={}}=e;(0,r.g)({eventName:"personal_page_material_upload_status",params:{...a(e),error_report:t,upload_status:i,time:o,is_compressed:n?1:0,...n&&{material_size_before_compress:s(l),material_size_after_compress:s(c),material_resolution_before_compress:u,material_resolution_after_compress:p},...m}})}function l(e){const{error_report:t}=e;(0,r.g)({eventName:"personal_page_material_import_error_report",params:{...a(e),error_report:t}})}function c(e){if(0===e.length)return;const t=function(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,i])=>{const r=i||"";t[e]=t[e]?`${t[e]},${r}`:r}))})),t}(e),i=new Set(t.material_type.split(","));1===i.size&&(t.material_type=i.values().next().value),(0,r.g)({eventName:"personal_page_material_publish_error_report",params:t})}function u(e){const{status:t,material_type:i,material_category:a,title:o,description:n,isOriginal:l,tags:c,material_format:u,material_size:p,resolution:m,error_type:d,cover_type:g,time:S,extra:_={},authorize_range:f,isVipAuthorized:h,isBusinessAuthorized:k,is_official_task:v,task_id:b,material_id:y,material_subcategory:F,effect_type_title:I,effect_type_id:w}=e;return(0,r.g)({eventName:"personal_page_material_publish_status",params:{status:t,material_type:i,material_category:a,material_title:o,material_introduction:n,is_original:l?"1":"0",hashtag:c.join(","),material_format:u,material_size:s(p),resolution:m,authorize_range:f,is_official_task:v,task_id:b,material_id:y,material_subcategory:F,effect_type_title:I,effect_type_id:w,..."fail"===t&&{error_type:d},cover_type:g,time:S,is_subscription_authorized:h?1:0,is_commercial_authorized:k?1:0,..._}})}function p(e){const{action:t,material_category:i,material_type:s,entry_from:a}=e;return(0,r.g)({eventName:"ugc_material_subscription_original_statment",params:{action:t,material_category:i,material_type:s,entry_from:a}})}function m(e){const{action:t,material_category:i,material_type:s,entry_from:a,hasCopyrightAuthorization:o}=e;return(0,r.g)({eventName:"ugc_material_commercial_original_statment",params:{action:t,material_category:i,material_type:s,entry_from:a,..."boolean"==typeof o&&{has_copyright_authorization:o?"1":"0"}}})}function d(e){const{action:t,page_type:i,material_category:s,material_type:a,button_name:o}=e;return(0,r.g)({eventName:"ugc_material_creator_sign_agreement",params:{action:t,page_type:i,material_category:s,material_type:a,...o&&{button_name:o}}})}},5014:(e,t,i)=>{i.d(t,{BI:()=>p,DefaultImportStickerFileRequest:()=>l,N7:()=>o,Q0:()=>n,R8:()=>s,S8:()=>u,fD:()=>a,mr:()=>c});var r=i(73224);let s=function(e){return e.Static="static",e.GIF="gif",e.Sequence="sequence",e}({}),a=function(e){return e.Format="format",e.MinImageSize="minImageSize",e.RecommendFileSize="RecommendFileSize",e.SequenceNumber="SequenceNumber",e}({});const o={fps:16,loop:!0},n={maxCount:49,minCount:2,minImageSize:360,maxImageSize:1080,maxFileSize:20971520},l={accept:".png,.jpg,.jpeg,.gif",multiple:!0,enableImportSequence:!0,thumbnailSize:200,minImageSize:360,maxImageSize:800,maxFileSize:20971520},c={fps:16,loop:!0,gen_size:0,gif_gen_opts:[{bg_color:"#242424",width:200,height:200,padding:0},{bg_color:"",width:0,height:0,padding:0}]},u=40,p={[s.Static]:{[a.Format]:r.I18n.t("pc_stickers_release_format_web"),[a.MinImageSize]:r.I18n.t("pc_stickers_release_size_min_web"),[a.RecommendFileSize]:r.I18n.t("pc_stickers_release_recommend_web")},[s.GIF]:{[a.Format]:r.I18n.t("pc_stickers_release_format_gif_web"),[a.MinImageSize]:r.I18n.t("pc_stickers_release_size_min_web"),[a.RecommendFileSize]:r.I18n.t("pc_stickers_release_recommend_web")},[s.Sequence]:{[a.Format]:r.I18n.t("pc_stickers_release_png_groups_web_web"),[a.MinImageSize]:r.I18n.t("pc_stickers_release_reccomend_size_web"),[a.SequenceNumber]:r.I18n.t("pc_stickers_release_amount_web"),[a.RecommendFileSize]:r.I18n.t("pc_stickers_release_recommend_web")}}},76252:(e,t,i)=>{i.d(t,{B3:()=>g,Nf:()=>S,WQ:()=>f,w3:()=>_});var r=i(23073),s=i(50959),a=i(61022),o=i(42983),n=i(25807),l=i(5014),c=i(86439),u=i(97311),p=i(67078),m=i(94435),d=i(11304);function g(e){return e.coverSrc||e.firstFrameCoverSrc}function S(e){return e.isSequence&&Boolean(e.isSequenceSettingsUpdating||e.firstFrameCoverSrc&&!e.coverSrc&&!e.isUploadFailed)}function _(e){return e.isSequence||"gif"===(0,u.lm)(e.path)}function f(e){const t=(0,a.fv)((()=>({stickers:[],scrollAreaRef:(0,s.createRef)(),materialPostConfig:new d.E(o.Ab.Sticker),get hasStickers(){return this.stickers.length>0},selectedId:null,get selectedSticker(){return t.selectedId?t.getSticker(t.selectedId):null},setScrollAreaRef(e){t.scrollAreaRef=e},addStickers(e){t.stickers.push(...e)},getSticker:e=>{var i;return null!==(i=t.stickers.find((t=>t.id===e)))&&void 0!==i?i:null},selectSticker(e){t.selectedId=e,t.selectedSticker&&(t.selectedSticker.hasEverSelected=!0)},updateThumbnailSrc(e,t){e.isSequence?e.firstFrameCoverSrc=t:e.coverSrc=t},updateUploadedData(e,t,i){if(e.uri=t,!e.isSequence)return e.coverUri=t,void(e.largeImageUri=t);if(i){const{gifCover:t,gifLargeImage:r,stickerPackage:s}=i;e.coverUri=t.uri,e.coverSrc=t.blobUrl,e.largeImageUri=r.uri,e.stickerPackage=s,e.isSequenceSettingsUpdating=!1}},updateUnmetRequirements(e,t){e.unmetRequirements=t,e.hasCheckedRequirements=!0},setUploadFailed(e){e.isUploadFailed=!0,e.isSequenceSettingsUpdating=!1},get isAllStickersThumbnailReady(){return t.stickers.length>0&&t.stickers.every((e=>g(e)))},applyForTags:e=>{t.stickers.forEach((t=>{t.formState.tags=e}))},applyAuthSettingsToAll:({isOriginal:e,isBusiness:i,isVip:r})=>{t.stickers.forEach((t=>{t.formState.isOriginal=Boolean(e),t.formState.isBusiness=Boolean(i),t.formState.isVip=Boolean(r)}))},applyPublishDirectionToAll:({postChannel:e,targetedActivityId:i})=>{t.stickers.forEach((t=>{t.formState.postChannel=e,t.formState.targetedActivityId=i}))},makeInitFormState:e=>({title:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:!1,...l.N7,sequenceSettingsApplyToAll:!1,...e}),updateFormState(e,t){Object.assign(e.formState,t)},makeInitSticker(i){const{title:r,isInfoComplete:s,formState:a,path:o="",isSequence:p=!1,...d}=i,g=function(e,t){const i=(0,u.lm)(e);if(t)return l.R8.Sequence;if("gif"===i)return l.R8.GIF;if(["png","jpg","jpeg"].includes(i))return l.R8.Static;throw new Error(`Unsupported suffix ${i}`)}(o,p),S=function(e,t){const i=e.split(/[\\/]/g).pop(),r=t?i:i.replace(/\.\w+?$/g,"");return(0,c.aF)(r,l.S8)}(o,p),_=n.$.isEnableAuthorization,{mustPaidAuth:f}=this.materialPostConfig.authConfig;return{id:"",path:o,get title(){return this.formState.title},fileType:g,width:0,height:0,isSequence:p,firstFrameCoverSrc:"",coverSrc:"",uri:"",coverUri:"",largeImageUri:"",stickerPackage:{uri:"",md5:"",size:0},sequenceSettings:{fps:0,loop:!1,...i.isSequence&&l.N7},hasEverSelected:!1,get isInfoComplete(){const{postChannel:t,targetedActivityId:i}=this.formState;{const s="single"===e,a="single"===e,o=t===m.iu.Open||t===m.iu.Targeted&&Boolean(i);return Boolean(this.title&&this.formState.tags.length>0)&&(r=this.formState.isVip,f&&r||!f||!s)&&(o||!a)}var r},unmetRequirements:[],hasCheckedRequirements:!1,isUploadFailed:!1,isSequenceSettingsUpdating:!1,formState:t.makeInitFormState({title:S,isVip:_}),...d}},reimportSticker(e,i){const r=t.stickers.findIndex((t=>t.id===e));-1!==r&&(t.stickers[r]=i)},startToRetryUploadStickers(e){e.forEach((e=>{const i=t.getSticker(e);i&&(i.isUploadFailed=!1)}))},startToUpdateSequenceSettings(e,t){e.forEach((e=>{e.sequenceSettings=t,e.largeImageUri&&(e.largeImageUri="",e.coverUri="",e.stickerPackage={uri:"",md5:"",size:0},e.isSequenceSettingsUpdating=!0)}))},removeSticker(e){t.stickers=t.stickers.filter((t=>t.id!==e.id))},dragInsert(e,i){const r=t.stickers.splice(e,1),s=e>i?i+1:i;t.stickers.splice(s,0,...r)},get isReadyToPublish(){return t.stickers.every((e=>e.hasCheckedRequirements&&0===e.unmetRequirements.length&&e.isInfoComplete))},get uploadStats(){let e=0,i=0,r=0;return t.stickers.forEach((t=>{if(t.isUploadFailed)return void(i+=1);(t.isSequence?t.largeImageUri:t.uri)?e+=1:r+=1})),{pending:r,succeeded:e,failed:i}},collectLogData:()=>t.stickers.map((e=>({...(0,r.Z)(e,["id","isSequence","isInfoComplete","hasEverSelected","isUploadFailed","uri"]),...e.isSequence&&{isSequenceUpdating:e.isSequenceSettingsUpdating,largeImageUri:e.largeImageUri,...e.sequenceSettings}}))),makePublishItemList:(e={})=>t.stickers.map((t=>{var i;const{id:r,isSequence:s,formState:a,stickerPackage:n}=t,{is_vip:l=Boolean(a.isVip),is_business:c=a.isBusiness,is_original:u=a.isOriginal,postChannel:d=a.postChannel,targetedActivityId:g=a.targetedActivityId,sourceForSimple:S=m.r0.UserPostPc,sourceForSequence:f=m.r0.UserPostPcSequence,authFileUploadServiceManager:h,onResult:k}=e,v=s?f:S,b=(0,p.pn)({isVip:l,isBusiness:c,authFiles:null!==(i=null==h?void 0:h.getUploadedFiles(r))&&void 0!==i?i:[]});return{id:r,req:{effect_type:o.Ab.Sticker,is_vip:l,...b.root,common_data:{title:a.title,description:a.title,icon:{image_uri:t.coverUri},sdk_version:"1.0.0",source:v,tags:[...a.tags],is_original:u,is_business:c,...b.commonData,...s&&{file:{file_uri:n.uri,file_md5:n.md5,size:n.size}},post_channel:d===m.iu.Targeted?`${m.iu.Targeted}_${g}`:d,web_extra:JSON.stringify({targeted_id:g})},sticker:{large_image:{image_uri:t.largeImageUri},sticker_type:_(t)?m.Ic.Dynamic:m.Ic.Static,no_multi_sticker:!1,package_size:0}},onResult:e=>null==k?void 0:k(t,e)}}))})));return t}},38313:(e,t,i)=>{i.r(t),i.d(t,{default:()=>se});var r=i(23479),s=i(45599),a=(i(52915),i(68166)),o=i(50959),n=i(38803),l=i(36775),c=i(66589),u=i(61022),p=i(84736),m=i(73224),d=i(42983),g=i(25807),S=i(76252),_=i(97662),f=i(50666),h=i(18635),k=i(54847),v=i(60251),b=i(59787),y=i(82665),F=i(50279),I=i(8129),w=i(2555),A=i(94435);function x(e){return Boolean(e.id)}class C{constructor(){(0,b.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const i of(0,y.Z)(e,10)){const e=await Promise.all(i.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:i,onResult:r,onUpdateResult:s}=e,a=JSON.parse(JSON.stringify(e.req));let o=this.itemMap.get(i);if(null!==(t=o)&&void 0!==t&&t.promise&&(0,F.Z)(o.req,a))try{return await o.promise}catch(n){(0,I.c6)("[MaterialPublishService] publish failed, start to retry",{id:i})}return o={promise:null,id:i,req:a,onResult:r,onUpdateResult:s},this.itemMap.set(i,o),o.promise=this.publishImpl(o),o.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),i=async(i,r)=>{try{const o={error:i,errorText:this.getErrorText(i),time:Math.round(performance.now()-t),resourceId:r};var s,a;if(x(e.req))await(null===(s=e.onUpdateResult)||void 0===s?void 0:s.call(e,{req:e.req,...o}));else await(null===(a=e.onResult)||void 0===a?void 0:a.call(e,{req:e.req,...o}))}catch(o){(0,I.RF)("[MaterialPublishService] callOnResult failed",o)}};let r;try{r=await this.postOrUpdate(e)}catch(s){throw e.promise=null,i(s,""),s}return await i(null,r.resource_id),r}async postOrUpdate(e){return x(e.req)?(await(0,A.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,A.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new w.B).timeout(5e3)])}catch(t){(0,I.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const i=performance.now(),r=new w.B,s={count:50,effect_types:t,uid:g.$.userInfo.uid,cursor:0};for(;performance.now()-i<5e3;){const t=await(0,A.Js)(s).catch((()=>null));if(null!=t&&t.effect_item_list){const i=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>i.has(e))))return}await r.timeout(500)}}}var U=i(49737),q=i(24399),L=i(79668),P=i(57609),N=i(2514),T=i(539),R=i(46309),z=i(3718),M=i(51654),E=i(18370);const j="ImportSticker";const B=(0,o.createContext)(null),$=()=>(0,o.useContext)(B);var O=i(11527);const Z=(0,r.Pi)((e=>{const{className:t}=e,i=$(),{t:r}=(0,s.$)(),a=(0,o.useRef)(null);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(n.P,{className:t,leftText:r("pc_sticker_import_zero_to_hundred_web",{X:i.importLoadingStore.isImportLoading?0:i.stickerListStore.stickers.length,Y:i.maxStickerCount}),isPublishDisabled:!i.isReadyToPublish,isPublishing:i.isPublishing,needConfirmModalOnClose:i.needConfirmModalOnClose,onPublish:()=>i.uploadAndPublish(a.current)}),(0,O.jsx)(l.q,{ref:a,uploadStats:i.stickerListStore.uploadStats,onRetryUpload:i.retryUpload,onCancel:i.isAllUploadedWatcher.stop,onShowUploadFail:i.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:i.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var D=i(23073),V=i(12390),W=i(67100),J=i(74195),G=i(82725);const X="stickerList-Tcr1X1",Q=(0,r.Pi)((e=>{const{className:t}=e,i=$(),{t:r}=(0,s.$)();return(0,U.pg)(i),(0,V.O)({className:t,layout:i.mainFormLayout,uploadAreaProps:{titleForUploadArea:r("pc_sticker_release_drag_web"),titleForMainForm:r("pc_stickers_release_drag_in_web"),subTitle:r("pc_sticker_release_groups_png_web"),draggingTitle:r("pc_sticker_release_mouse_web"),disabled:i.isImportDisabled,disabledTooltip:r("pc_stickers_release_max_x_web",{X:i.maxStickerCount}),onClick:i.openStickerFilePicker,onDrop:i.uploadDroppedStickerFiles},setFormApi:i.setFormApi,renderImportArea:e=>(0,O.jsxs)(O.Fragment,{children:[e,(0,O.jsx)(W.z,{className:X,importStickerFileService:i.importServ,onSelect:i.selectSticker,onReimport:i.reimportSticker})]}),renderFormArea:()=>{const{selectedSticker:e}=i.stickerListStore;return e&&(0,O.jsx)(J.E,{importStickerFileService:i.importServ,sticker:e,initFields:i.initFields,controlField:i.field,onStartEditSequenceSettings:()=>i.sendLogServ.sendStartEditSequenceSettingsLog({}),authProps:(0,D.Z)(i,"authorSignService","authFileUploadServiceManager","sendLogServ"),showPublishDirection:!0,onSaveSequenceSettings:i.saveSequenceSettings,sendLogServ:i.sendLogServ})},scrollAreaRef:i.importServ.stickerListStore.scrollAreaRef,onRetry:G.cb})}));var Y=i(12904),H=i(65546);const K="page-BXIsLv",ee="content-z8aW2X",te="requirement-FGjxIs",ie="mainForm-qv90fk",re="footer-JhzMqS",se=(0,r.Pi)((()=>{const e=function(){const e=(0,S.WQ)("single"),t=(0,_.WQ)({stickerListStore:e}),i=new U.YL({itemType:d.Ab.Sticker}),r=(0,T.G)({watch:()=>a.isAllUploaded}),s=(0,o.useMemo)((()=>new v.l),[]),a=(0,u.fv)((()=>({formApi:null,setFormApi:e=>{a.formApi=e},mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return t.isImportLoading?"loading":"uploadArea"===a.mainFormLayoutAfterLoading&&k.appModel.isInitFailed?"error":a.mainFormLayoutAfterLoading},get maxStickerCount(){return g.$.permissions.includes(g.v.EffectBatchMore)?50:20},get isImportDisabled(){return e.stickers.length>=a.maxStickerCount},stickerListStore:e,importLoadingStore:t,importServ:new h.T({api:new f.r,stickerListStore:e,sendLogServ:i,needSaveSequenceGifUrl:!1}),pubServ:new C,sendLogServ:i,authorSignService:new P.I({signScene:z.d.BusinessArtist}),authFileUploadServiceManager:new N.r({}),performanceTimingCollector:(0,E.uY)(),get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1,canIconBlank:g.$.permissions.includes(g.v.EffectIconBlank),canHighPro:g.$.permissions.includes(g.v.EffectHighPrio),canPackOne:g.$.permissions.includes(g.v.StickerOnePackage)}},get permissions(){return g.$.permissions},getImportMinMaxCount(){const t=e.stickers.length;return{minCount:1,maxCount:Math.max(0,a.maxStickerCount-t),maxTotalCount:a.maxStickerCount}},openStickerFilePicker:()=>s.lock(j,(async()=>{i.sendUploadActionLog(a),await a.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[SingleStore]",when:"openStickerFilePicker"});const e=await a.importServ.openStickerFilePicker(a.getImportMinMaxCount());a.addNewStickers(e)})),uploadDroppedStickerFiles:()=>s.lock(j,(async()=>{i.sendUploadActionLog(a),await a.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[SingleStore]",when:"uploadDroppedStickerFiles"});const e=await a.importServ.uploadDroppedStickerFiles(a.getImportMinMaxCount());a.addNewStickers(e)})),reimportSticker:t=>s.lock(j,(async()=>{await a.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[SingleStore]",when:"reimportSticker"});const i=await a.importServ.reimportSticker(t,{});if(i){const t=e.getSticker(i);a.selectSticker(t)}})),addNewStickers(i){0!==i.length&&(e.addStickers(i),e.selectSticker(i[0].id),"uploadArea"===a.mainFormLayoutAfterLoading&&(t.showImportLoading(),a.mainFormLayoutAfterLoading="mainForm"))},selectSticker(t){a.saveFormState(),e.selectSticker(t.id)},initFields(e){var t,i;null===(t=a.formApi)||void 0===t||t.reset(),null===(i=a.formApi)||void 0===i||i.setValues({single:{...e.formState,...e.sequenceSettings}})},saveFormState(){var t;const{selectedSticker:i}=e;if(!i)return;const r=e.makeInitFormState({...null===(t=a.formApi)||void 0===t?void 0:t.getValue("single"),...i.sequenceSettings,sequenceSettingsApplyToAll:!1});e.updateFormState(i,r)},saveSequenceSettings(){var t;const{fps:r,loop:s,sequenceSettingsApplyToAll:o}=e.makeInitFormState({...null===(t=a.formApi)||void 0===t?void 0:t.getValue("single")}),n={fps:r,loop:s};a.importServ.updateSequenceSettings({newSettings:n,isApplyToAll:o}),i.sendSaveSequenceSettingsLog({collection_detail:"collection_material",sequenceSettings:{fps:r,loop:s,sequenceSettingsApplyToAll:o}})},get needConfirmModalOnClose(){return e.stickers.length>0},get isAllUploaded(){const{pending:e,failed:t}=a.stickerListStore.uploadStats;return!e&&!t},isAllUploadedWatcher:r,async uploadAndPublish(e){i.sendPageActionLog({action:"publish"}),a.isAllUploaded||(await a.retryUpload(),null==e||e.show(),await a.isAllUploadedWatcher.start());try{await a.publish()}finally{null==e||e.hide()}},get isReadyToPublish(){return e.stickers.length>0&&e.isReadyToPublish&&!a.isPublishSucceeded},collectLogData(){const t=e.collectLogData(),{isReadyToPublish:i,uploadStats:r}=e,s={stickers:t,stickersCount:t.length,stickersReadyToPublish:i,uploadStats:r};(0,I.c6)("[SingleStore] collectLogData",s)},isPublishing:!1,isPublishSucceeded:!1,async publish(){a.isPublishing=!0;try{await a.publishImpl()}catch(e){return(0,I.RF)("[SingleStore] publish failed",e),p.FN.error(m.I18n.t("pc_sticker_release_failed_retry_web")),void(0,c.z)((()=>{a.isPublishing=!1}))}(0,c.z)((()=>{a.isPublishing=!1,a.isPublishSucceeded=!0})),p.FN.success(m.I18n.t("pc_sticker_release_successful_web")),(0,R.ZM)({effect_type:d.Ab.Sticker}),setTimeout((()=>(0,R.Nt)({item_type:d.Ab.Sticker})),1e3)},async publishImpl(){a.saveFormState();const t=e.makePublishItemList({authFileUploadServiceManager:a.authFileUploadServiceManager,onResult:(e,t)=>(0,q.g)({logPrefix:"[SingleStore] ",sticker:e,publishResult:t,importServ:a.importServ,sendLogServ:a.sendLogServ})});(0,I.c6)("[SingleStore] stickers publish start",{ids:t.map((e=>e.id))});const i=(await a.pubServ.batchPublish(t)).map((e=>e.resource_id));(0,I.c6)("[SingleStore] stickers publish done",{resourceIdList:i}),await a.pubServ.pollUntilAllInEffectList({ids:i.slice(-10),types:[d.Ab.Sticker]}),(0,I.c6)("[SingleStore] poll done")},sendUploadProgressModalShowErrorLog(){const e=a.stickerListStore.stickers.filter((e=>e.isUploadFailed)).map((e=>({error_report:a.importServ.getFileStats(e.id).uploadError})));i.sendStickerPublishErrorLog(e)},retryUpload(){return this.importServ.retryUpload([])}})),{formApi:!1});return(0,L.L)({watch:()=>{a.stickerListStore.uploadStats,a.isReadyToPublish},collect:a.collectLogData}),(0,M.u)({watch:()=>a.needConfirmModalOnClose}),(0,o.useEffect)((()=>(window.store=a,a.importServ.uploadConfigService.updateCache(),a.authorSignService.init(),a.performanceTimingCollector.addRenderTiming(E.Pk),()=>{t.destroy(),a.importServ.destroy()})),[]),a}(),{t}=(0,s.$)(),{selectedSticker:i}=e.importServ.stickerListStore;return(0,Y.F)({title:t("pc_stickers_release_ing_web"),pid:"sticker-publish-single"}),(0,H.d)(),(0,U.t9)(e.sendLogServ),(0,O.jsxs)(B.Provider,{value:e,children:[(0,O.jsxs)("div",{className:K,children:[(0,O.jsxs)("div",{className:ee,children:[(0,O.jsx)(a.n,{className:te,sticker:i}),(0,O.jsx)(Q,{className:ie})]}),(0,O.jsx)(Z,{className:re})]}),!1]})}))},17095:(e,t,i)=>{i.d(t,{g:()=>s});var r=i(46309);function s(e){console.log("[sendLog]",e.eventName,e.params),(0,r.qx)(e)}},97311:(e,t,i)=>{i.d(t,{F2:()=>s,J9:()=>r,lm:()=>a});i(96706);const r=async e=>{const t=await fetch(e);return(e=>URL.createObjectURL(e))(await t.blob())},s=(e,t="")=>`data:${t};base64,${e}`;const a=e=>e.toLowerCase().split(".").pop()}}]);