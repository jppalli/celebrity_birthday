"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[493],{96194:(e,t,i)=>{i.d(t,{z:()=>n});var s=i(5455),r=i(22878);const n=(0,s.Z)(r.Z,{valueKey:"checked",valuePath:"target.checked",shouldInject:!1})},84559:(e,t,i)=>{i.d(t,{H:()=>n});var s=i(5455),r=i(45820);const n=(0,s.Z)(r.Z,{valuePath:"target.value"})},71212:(e,t,i)=>{i.d(t,{i:()=>n});var s=i(5455),r=i(37953);const n=(0,s.Z)(r.Z);n.Option=r.Z.Option,n.OptGroup=r.Z.OptGroup},92417:(e,t,i)=>{i.d(t,{Z:()=>n});var s=i(10949),r=i(75181);const n=function(e){return((e,t)=>({value:r.U2(e.values,t),error:r.U2(e.errors,t),touched:r.U2(e.touched,t)}))((0,s.Z)(),e)}},78367:(e,t,i)=>{i.d(t,{Z:()=>n});var s=i(50959),r=i(19503);function n(){return(0,s.useContext)(r.mC)}},84736:(e,t,i)=>{i.d(t,{EG:()=>g.Z,Ex:()=>a.Z,FN:()=>f.Z,FX:()=>d.Z,Form:()=>v.Z,HH:()=>b.H,II:()=>l.Z,J2:()=>c.Z,Lt:()=>o.Z,Ph:()=>p.Z,Q2:()=>y.Z,Vp:()=>m.Z,XQ:()=>k.Z,XZ:()=>r.ZP,Y8:()=>u.ZP,ih:()=>C.i,tL:()=>_.Z,u:()=>S.Z,u_:()=>n.Z,yC:()=>h.Z,z8:()=>x.z,zx:()=>s.Z});i(32913);var s=i(99891),r=i(76021),n=i(15194),o=i(89270),l=i(55550),c=i(21797),a=i(63522),u=i(86581),d=i(45820),p=i(37953),h=i(48611),m=i(40996),g=i(83335),f=i(23997),S=i(11643),v=i(60679),k=i(78367),_=i(92417),y=i(5455),C=i(71212),x=i(96194),b=i(84559)},84997:(e,t,i)=>{i.d(t,{S:()=>S,w:()=>f});var s=i(50959),r=i(44478),n=i(26800),o=i(84875),l=i.n(o),c=i(84736),a=i(45599),u=i(20468),d=i(2555),p=i(76896),h=i(45584),m=i(11527);const g=(0,s.forwardRef)(((e,t)=>{const{tooltipProps:i,getPopupContainer:r,onClosePopover:o,position:a,cursor:u="default"}=e,[g,f]=(0,s.useState)(!0),[S,v]=(0,s.useState)(!1),{top:k}=a,_=a.left-10,y=(0,s.useRef)(null),C=(0,s.useRef)(null),x=(0,n.Z)((()=>{var e;null===(e=C.current)||void 0===e||e.destroy(),v(!1),f(!1)})),b=(0,n.Z)((()=>{var e;const t=r().querySelector(`.${h.Z.tooltipWrapper}`);if(!t||(null===(e=C.current)||void 0===e?void 0:e.tooltipWrapper)===t)return;t.addEventListener("animationend",x);const i=new d.B;i.timeout(500).then(x),C.current={tooltipWrapper:t,destroy:()=>{t.removeEventListener("animationend",x),i.cancel(),C.current=null}}}));(0,s.useImperativeHandle)(t,(()=>({hide:()=>{b(),v(!0)}})));const w=(0,s.useMemo)((()=>({default:{height:18,width:12},"not-allowed":{height:(0,p.c)()?30:15,width:15}})),[]),I=w[u]||w.default;return(0,m.jsx)(c.u,{autoAdjustOverflow:!0,position:"bottomLeft",motion:!1,...i,className:l()(i.className,h.Z.tooltipWrapper,S&&h.Z.fadingOut),trigger:"custom",visible:g,showArrow:!1,rePosKey:`${k}-${_}`,getPopupContainer:r,onVisibleChange:e=>{var t;!e&&o(),null===(t=i.onVisibleChange)||void 0===t||t.call(i,e)},children:(0,m.jsx)("div",{className:h.Z.point,tabIndex:-1,ref:y,style:{top:k,left:_,...I}})})}));function f(e){const{zIndex:t=1060,cursor:i="default",checkIsTarget:o,getEllipsisDOM:l,...c}=e,d=(0,s.useRef)(null),p=(0,s.useRef)(null),[f,S]=(0,s.useState)(null),{i18n:v}=(0,a.$)(),k=()=>{const{content:e}=c;if("function"!=typeof e)return e;if(!d.current)return null;const{targetElement:t}=d.current;return i=>e({...i,target:t})},_=(0,n.Z)((()=>{d.current&&(d.current.destroy(),d.current=null,S(null))})),y=(0,n.Z)((()=>{var e;null===(e=d.current)||void 0===e||e.destroy(),d.current=null})),C=(0,n.Z)(((e,i)=>{const s=null==l?void 0:l(i);if(s&&s.offsetWidth>=s.scrollWidth)return;if(d.current){if(!d.current.hasLeaved&&d.current.targetElement===i)return;_()}const n=document.createElement("div");n.className=h.Z.root,n.style.zIndex=`${t}`;const o=e=>{S({left:e.clientX,top:e.clientY})},c=e=>{i===e.target&&(d.current&&(d.current.hasLeaved=!0),p.current?p.current.hide():_())};i.addEventListener("mousemove",o),i.addEventListener("mouseleave",c),document.body.appendChild(n);const a=(0,r.createRoot)(n);d.current={container:n,targetElement:i,hasLeaved:!1,reactRoot:a,destroy:()=>{n.remove(),Promise.resolve().then((()=>a.unmount())),i.removeEventListener("mousemove",o),i.removeEventListener("mouseleave",c)}},S({left:e.clientX,top:e.clientY})})),x=(0,n.Z)((e=>{const t=e.currentTarget;C(e,t)})),b=(0,n.Z)((e=>{var t;const i=e.target;(null!==(t=null==o?void 0:o(i))&&void 0!==t?t:e.currentTarget===i)&&C(e,i)}));return(0,s.useLayoutEffect)((()=>y),[]),(0,s.useLayoutEffect)((()=>{(()=>{if(!d.current||!f)return;const{reactRoot:e,container:s}=d.current;s.style.zIndex=`${t}`,e.render((0,m.jsx)(u.a,{i18n:v,children:(0,m.jsx)(g,{ref:p,tooltipProps:{...c,content:k()},getPopupContainer:()=>s,onClosePopover:_,position:f,cursor:i})}))})()})),{handleMouseEnter:x,handleMouseOver:b}}function S(e={}){const{getEllipsisDOM:t=(e=>e),content:i=(({target:e})=>e.textContent),...s}=e;return f({...s,getEllipsisDOM:t,content:i})}},63170:(e,t,i)=>{i.d(t,{y:()=>p});var s=i(50959),r=i(84875),n=i.n(r),o=i(84736),l=i(26800),c=i(86439),a=i(16743),u=i(80515),d=i(11527);const p=(0,o.Q2)((e=>{const{className:t,maxLength:i,onChange:r,onCompositionStart:p,onCompositionEnd:h}=e,[m,g]=(0,s.useState)(""),f=(0,s.useRef)(!1),S=(0,l.Z)((e=>void 0===i?e:(0,c.aF)(e,i))),v=(0,l.Z)((e=>{f.current=!0,g(e.currentTarget.value),null==p||p(e)})),k=(0,s.useRef)(null),{saveSelectionIfNeeded:_}=(0,a.u)({getInputElem:()=>k.current}),y=(0,l.Z)(((e,t)=>{_(e),null==r||r(e,t)})),C=(0,l.Z)((e=>{const t=S(e.currentTarget.value);f.current=!1,g(""),y(t,null),null==h||h(e)})),x=(0,l.Z)(((e,t)=>{if(f.current)return void g(e);if(void 0===i)return void y(e,t);const s=S(e);y(s,t)}));return(0,d.jsx)(o.II,{autoComplete:"off",...e,ref:k,className:n()(t,u.Z.input),value:f.current?m:e.value,maxLength:void 0,onChange:x,onCompositionStart:v,onCompositionEnd:C})}))},79679:(e,t,i)=>{i.d(t,{D:()=>g});var s=i(50959),r=i(44478),n=i(26800),o=i(84875),l=i.n(o),c=i(84736),a=i(45599),u=i(20468),d=i(44704),p=i(86057),h=i(11527);const m=e=>{const{position:t,getPopupContainer:i,onClosePopover:r,popoverProps:o}=e,[a,u]=(0,s.useState)(!0),m=(0,n.Z)((()=>u(!1))),g=(0,s.useRef)(null);return(0,s.useLayoutEffect)((()=>{var e;null===(e=g.current)||void 0===e||e.focus()}),[]),(0,h.jsx)(c.J2,{autoAdjustOverflow:!0,position:"bottomLeft",clickToHide:!0,...o,className:l()(o.className,d.i.heycanPopoverWrapperClearStyle),trigger:"custom",visible:a,onEscKeyDown:m,onClickOutSide:m,getPopupContainer:i,onVisibleChange:e=>{var t;!e&&r(),null===(t=o.onVisibleChange)||void 0===t||t.call(o,e)},children:(0,h.jsx)("div",{className:p.Z.point,tabIndex:-1,ref:g,style:{...t}})})};function g(e){const{zIndex:t=1e3,...i}=e,[o,l]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),{i18n:g}=(0,a.$)(),f=(0,n.Z)((()=>{o&&(o.destroy(),l(null),d(null))})),S=(0,n.Z)((()=>{null==o||o.destroy()})),v=(0,n.Z)((e=>{if(o)return;const i=document.createElement("div");i.className=p.Z.root,i.style.zIndex=`${t}`;i.addEventListener("wheel",(e=>{e.currentTarget===i&&(e.preventDefault(),e.stopPropagation())}),!1),window.addEventListener("resize",f),document.body.appendChild(i);const s=(0,r.createRoot)(i);l({container:i,reactRoot:s,destroy:()=>{i.remove(),Promise.resolve().then((()=>s.unmount())),window.removeEventListener("resize",f)}}),d(e)})),k=(0,n.Z)((e=>{e.preventDefault(),e.stopPropagation(),v({left:e.clientX,top:e.clientY})}));return(0,s.useLayoutEffect)((()=>S),[]),(0,s.useLayoutEffect)((()=>{o&&c&&o.reactRoot.render((0,h.jsx)(u.a,{i18n:g,children:(0,h.jsx)(m,{popoverProps:i,getPopupContainer:()=>o.container,onClosePopover:f,position:c})})),o&&(o.container.style.zIndex=`${t}`)})),{handleContextMenu:k}}},503:(e,t,i)=>{i.d(t,{m:()=>n});var s=i(3731),r=i(11527);function n(e){const{items:t}=e,i=e=>{e.currentTarget===e.target&&e.stopPropagation()};return(0,r.jsx)("div",{className:s.Z.menu,onClick:i,children:(0,r.jsx)("div",{className:s.Z.menuItemContainer,onClick:i,children:t.map((({key:e,render:t},i)=>t({key:e,index:i,className:s.Z.menuItem})))})})}},25577:(e,t,i)=>{i.d(t,{Z:()=>c});i(50959);var s=i(84875),r=i.n(s),n=i(45599),o=(i(84997),i(53803),i(40249)),l=i(11527);const c=e=>{const{t}=(0,n.$)(),{className:i,boxClassName:s,title:c,children:a,onClickUseAll:u,hiddenFieldLabel:d=!1,required:p=!1}=e;return(0,l.jsxs)("div",{className:r()(o.Z.root,i),children:[!d&&(0,l.jsxs)("div",{className:o.Z.fieldLabel,children:[(0,l.jsx)("div",{className:r()({[o.Z.showRequired]:p}),children:null!=c?c:t("pc_template_authorize_settings_web")}),u&&(0,l.jsx)("span",{className:o.Z.useAll,onClick:u,children:t("pc_material_release_apply_all")})]}),(0,l.jsx)("div",{className:r()(o.Z.box,s),children:a})]})}},38803:(e,t,i)=>{i.d(t,{P:()=>f});var s=i(50959),r=i(84875),n=i.n(r),o=i(84736),l=i(26800),c=i(45599),a=i(46309),u=i(67927),d=i(21919),p=i(54847),h=i(5696),m=i(80432),g=i(11527);const f=({className:e,leftText:t,isPublishDisabled:i,isPublishing:r,needConfirmModalOnClose:f,onPublish:S,beforeCancel:v,onCancel:k})=>{const{t:_}=(0,c.$)(),y=(0,l.Z)((async()=>{if(v&&v(),f){if(await u.Z.warn({mainText:_("pc_sticker_cancel_web"),subText:_("pc_sticker_click_unrecoverable_web"),confirmBtnText:_("pc_stickers_release_confirm_quit_web"),cancelBtnText:_("pc_stickers_release_cancel_web")})!==u.L.Confirm)return}k?k():(0,a.Nt)()})),C=d.YW.Creator,{language:x,region:b}=p.appModel.appInfo,w=(0,s.useMemo)((()=>(0,h.dr)({lang:x,region:b})),[x,b]);return(0,g.jsxs)("div",{className:n()(e,m.Z.root),children:[(0,g.jsx)("div",{className:m.Z.left,onClick:undefined,children:t}),(0,g.jsxs)("div",{className:m.Z.right,children:[(0,g.jsx)("span",{className:m.Z.remind,onClick:()=>{window.open(w,"_blank")},children:_("pc_sticker_release_agree_{X}_web",{X:(0,g.jsx)("span",{className:m.Z.protocol,children:d.rr[C]},"protocol")})}),(0,g.jsxs)("div",{className:m.Z.buttonContainer,children:[(0,g.jsx)(o.zx,{className:m.Z.button,type:"primary",theme:"solid",disabled:i,loading:r,onClick:S,children:_("pc_stickers_release_web")}),(0,g.jsx)(o.zx,{className:m.Z.button,type:"secondary",theme:"solid",onClick:y,children:_("pc_stickers_release_cancel_web")})]})]})]})}},51654:(e,t,i)=>{i.d(t,{u:()=>l});var s=i(50959),r=i(66589),n=i(46309),o=i(61022);function l(e){const t=(0,o.fv)((()=>({get watchResult(){return e.watch()}})));(0,s.useEffect)((()=>{const e=(0,r.EH)((()=>{const e=t.watchResult;(0,n.c0)({isNeed:e})}));return()=>{e()}}),[])}},79668:(e,t,i)=>{i.d(t,{L:()=>l});var s=i(93302),r=i(50959),n=i(66589);const o=5e3;function l({watch:e,collect:t}){const i=(0,r.useMemo)((()=>(0,s.Z)((async()=>{await Promise.resolve(),t()}),o)),[]);(0,r.useEffect)((()=>{const t=(0,n.EH)((()=>{e(),i()}));return()=>{t(),i.cancel()}}),[])}},81860:(e,t,i)=>{i.d(t,{ZP:()=>I});var s=i(50959),r=i(84875),n=i.n(r),o=i(84736);const l=(0,i(95571).A)((function(e){return s.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),s.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.637 16.4369C19.0513 17.0227 18.1015 17.0227 17.5157 16.4369L11.8589 10.7801L6.20202 16.4369C5.61623 17.0227 4.66648 17.0227 4.0807 16.4369C3.49491 15.8511 3.49491 14.9014 4.0807 14.3156L10.7982 7.59809C11.384 7.01231 12.3337 7.01231 12.9195 7.59809L19.637 14.3156C20.2228 14.9014 20.2228 15.8511 19.637 16.4369Z",fill:"currentColor"}))}),"chevron_up");var c=i(4343),a=i(73224),u=i(45599),d=i(84997),p=i(44704);const h="root-ZzVTGw",m="title-JCdnyN",g="titleText-Fuw67p",f="opt-YF2iRW",S="optButton-El1KQ1",v="optPrimaryButton-w8QZPM",k="content-fjkxJu",_="fpsField-n8dui5",y="loopFieldRatioGroup-NJIp0Y",C="edit-w0eg3S",x="globalSettings-fCcYV0";var b=i(11527);const w=[{value:!0,label:a.I18n.t("pc_stickers_release_cycle_start_web")},{value:!1,label:a.I18n.t("pc_stickers_release_one_start_web")}],I=e=>{const{className:t,prefix:i,onStartEdit:r,onSave:a,showGlobalSetting:I}=e,q=(0,o.XQ)(),F=(0,o.tL)(i).value,L=(0,s.useMemo)((()=>{const{fps:e=0,loop:t=!1,sequenceSettingsApplyToAll:i=!1}=F||{};return{fps:e,loop:t,sequenceSettingsApplyToAll:i}}),[null==F?void 0:F.fps,null==F?void 0:F.loop,null==F?void 0:F.sequenceSettingsApplyToAll]),[j,P]=(0,s.useState)(!1),[Z,U]=(0,s.useState)(!1),E=(0,s.useRef)(L),{t:R}=(0,u.$)(),T=(0,s.useMemo)((()=>(()=>{const e=[];for(let t=1;t<=49;t++)e.push({label:`${t} FPS`,value:t});return e})()),[]),N=(0,s.useMemo)((()=>j?R("pc_stickers_release_animation_set_web"):`${R("pc_stickers_release_sfps_web",{X:L.fps,Y:L.loop?R("pc_stickers_release_cycle_start_web"):R("pc_stickers_release_one_start_web")})}`),[L,j]),{handleMouseOver:A}=(0,d.S)({checkIsTarget:e=>null!==e.closest(".semi-form-field-label-text, .semi-radio-addon, .semi-checkbox-addon")});return(0,b.jsxs)("div",{className:n()(t,h,{[C]:j}),children:[(0,b.jsxs)("div",{className:m,children:[(0,b.jsx)("div",{className:g,children:N}),(0,b.jsx)("div",{className:f,children:j?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:S,onClick:()=>{q.setValues({[i]:{...F,...E.current}}),P(!1)},children:R("pc_stickers_release_cancel_web")}),(0,b.jsx)("span",{className:v,onClick:()=>{P(!1),a()},children:R("pc_stickers_release_saved_web")})]}):(0,b.jsx)("span",{className:v,onClick:()=>{E.current=L,P(!0),r()},children:R("pc_sticker_edit_web")})})]}),(0,b.jsxs)("div",{className:k,onMouseOver:A,children:[(0,b.jsx)(o.ih,{labelPosition:"left",field:`${i}.fps`,label:R("pc_stickers_release_fps_web"),size:"small",fieldClassName:_,optionList:T,arrowIcon:Z?(0,b.jsx)(l,{}):(0,b.jsx)(c.Z,{}),onDropdownVisibleChange:U}),(0,b.jsx)(o.HH,{fieldClassName:n()(y,p.i.heycanFormFieldEllipsis),className:p.i.heycanRatioGroupEllipsis,direction:"vertical",labelPosition:"left",field:`${i}.loop`,label:R("pc_stickers_release_cycle_set_web"),options:w}),(0,b.jsx)("div",{className:x,hidden:!I,children:(0,b.jsx)(o.z8,{labelPosition:"left",field:`${i}.sequenceSettingsApplyToAll`,fieldClassName:p.i.heycanFormFieldEllipsis,className:p.i.heycanCheckboxEllipsis,label:R("pc_stickers_release_settings_web_web"),children:R("pc_stickers_release_apply_all_frames_web")})})]})]})}},68166:(e,t,i)=>{i.d(t,{n:()=>a});var s=i(50959),r=i(45599),n=i(23479),o=i(5014),l=i(9608),c=i(11527);const a=(0,n.Pi)((({className:e,sticker:t})=>{var i,n;const{t:a}=(0,r.$)(),u=e=>Object.entries(o.BI[e]).map((([e,t])=>({key:e,title:t}))),d=(0,s.useMemo)((()=>[{key:o.R8.Static,title:a("pc_stickers_release_png_web"),link:{text:a("pc_stickers_release_template_web"),src:"https://sf16-sg.tiktokcdn.com/obj/eden-sg/lm_shpylaht_cs/ljhwZthlaukjlkulzlp/pc-heycan/downloads/1682576253/sticker%20template.psd"},instructions:u(o.R8.Static)},{key:o.R8.GIF,title:a("pc_stickers_release_gif_details_web"),link:{text:a("pc_stickers_release_template_web"),src:"https://sf16-sg.tiktokcdn.com/obj/eden-sg/lm_shpylaht_cs/ljhwZthlaukjlkulzlp/pc-heycan/downloads/1682576253/sticker%20template.psd"},instructions:u(o.R8.GIF)},{key:o.R8.Sequence,title:a("pc_stickers_release_frame_web_web"),link:{text:a("pc_stickers_release_template_web"),src:"https://sf16-sg.tiktokcdn.com/obj/eden-sg/lm_shpylaht_cs/ljhwZthlaukjlkulzlp/pc-heycan/downloads/1682576253/sticker%20template.psd"},instructions:u(o.R8.Sequence)}]),[]);return(0,c.jsx)(l.v,{className:e,groups:d,initGroup:o.R8.Static,activeGroup:null!==(i=null==t?void 0:t.fileType)&&void 0!==i?i:o.R8.Static,resetExpandedGroupKey:null!==(n=null==t?void 0:t.id)&&void 0!==n?n:null,getStatus:(e,i)=>{var s;return i.key!==(null==t?void 0:t.fileType)?"init":null!=t&&null!==(s=t.unmetRequirements)&&void 0!==s&&s.includes(e.key)?"error":"success"}})}))},74195:(e,t,i)=>{i.d(t,{E:()=>P});var s=i(50959),r=i(23479),n=i(45599),o=i(84736),l=i(42983),c=i(63170),a=i(36983),u=i(95968),d=(i(74408),i(81860)),p=i(25577),h=i(14590),m=i(25807),g=i(31686),f=i(76252),S=i(5014),v=i(45033),k=i(94435),_=i(53803);const y="root-U7gnG8",C="label-ySJjwQ",x="useAll-fBQS09",b="cover-_hZQ9Q",w="input-cVWAZF",I="advancedSettingsTitle-4hrFUR",q="fpsSettingsField-JVMreK",F="publishDirectionUseAll-FwKTNi";var L=i(11527);const{Label:j}=o.Form,P=(0,r.Pi)((e=>{const{t}=(0,n.$)(),i=(0,o.XQ)(),{importStickerFileService:r,sticker:P,initFields:Z,controlField:U,authProps:E,onStartEditSequenceSettings:R,onSaveSequenceSettings:T,showPublishDirection:N,sendLogServ:A}=e,{stickerListStore:z}=r,{authConfig:D}=z.materialPostConfig,{mustPaidAuth:B}=D,{postChannel:$,targetedActivityId:O}=P.formState,[M,G]=(0,s.useState)([]);(0,s.useLayoutEffect)((()=>{Z(P)}),[P]),(0,s.useEffect)((()=>{M.length||async function(){return(await(0,k.ip)({effect_type:l.Ab.Sticker})).tasks.map((e=>({label:e.title,value:e.task_id})))}().then((e=>{G(e)}))}),[]);const{getDisplayLength:J}=(0,v._)();return(0,L.jsxs)("div",{className:y,children:[(0,L.jsx)(a.Y,{className:b,src:(0,f.B3)(P),isSelected:!1,isInvalid:P.unmetRequirements.length>0,isUpdating:(0,f.Nf)(P),size:128}),(0,L.jsx)(c.y,{fieldClassName:w,label:t("pc_stickers_release_set_title_web"),field:"single.title",maxLength:S.S8,placeholder:t("pc_stickers_release_xy_name_web",{X:1,Y:J(S.S8)}),rules:[{required:!0,message:""}],onChange:e=>z.updateFormState(P,{title:e})}),(0,L.jsxs)("div",{className:C,children:[(0,L.jsx)(u.u,{fieldClassName:w,label:t("pc_stickers_release_tag_set_web"),placeholder:t("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"single.tags",itemType:l.Ab.Sticker,recommendConfig:{title:P.title,uri:P.largeImageUri},rules:[{required:!0,message:""}],onChange:e=>z.updateFormState(P,{tags:e})}),(0,L.jsx)("span",{className:x,onClick:()=>{var e;null==z||z.applyForTags((null===(e=i.getValue("single"))||void 0===e?void 0:e.tags)||[])},children:t("pc_stickers_release_apply_all_web")})]}),N&&(0,L.jsxs)("div",{className:C,children:[(0,L.jsx)(j,{required:!0,text:t("cc_pc_material_visual_effect_publish_creation_type_web")}),(0,L.jsx)(g.Z,{value:{postChannel:$,activityId:O},onChange:e=>{const t={postChannel:e.postChannel,targetedActivityId:e.activityId};z.updateFormState(P,t)},taskList:M,loading:!M.length,viewMoreUrl:"https://bytedance.sg.larkoffice.com/docx/PDNEdbBZxoXibnxSGn5l7U7Xgre?open_in_browser=true",onOrientationViewMoreClick:()=>{null==A||A.sendPageActionLog({action:"click_more_official_task"})}}),(0,L.jsx)("span",{className:F,onClick:()=>{null==A||A.sendPageActionLog({action:"apply_publish_type_to_all"}),z.applyPublishDirectionToAll({postChannel:P.formState.postChannel,targetedActivityId:P.formState.targetedActivityId})},children:t("pc_material_release_apply_all")})]}),!1,E&&(0,L.jsx)(p.Z,{onClickUseAll:()=>{null==A||A.sendPageActionLog({action:"authorize_apply_to_all"});const e=i.getValue("single");null==z||z.applyAuthSettingsToAll({isOriginal:e.isOriginal,isBusiness:e.isBusiness,isVip:e.isVip})},required:B,children:(0,L.jsx)("div",{className:_.Z.authGroup,children:(0,L.jsx)(h.R,{noLabel:!0,field:"single.isVip",disabled:m.$.isEnableAuthorization,disabledTooltip:t("cc_pc_material_visual_effect_publish_authorized_hover_web"),tooltip:B?t("cc_pc_material_visual_effect_publish_authorize_hover_web"):"",sendLogService:E.sendLogServ,onChange:e=>{e&&(null==A||A.sendPageActionLog({action:"choose_subscription_authorize"})),z.updateFormState(P,{isVip:e})}})})}),P.isSequence&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{className:I,children:t("pc_stickers_release_higher_settings_web")}),(0,L.jsx)(d.ZP,{className:q,prefix:"single",showGlobalSetting:!0,onStartEdit:R,onSave:T})]})]})}))},67100:(e,t,i)=>{i.d(t,{M:()=>U,z:()=>E});var s=i(50959),r=i(23479),n=i(84875),o=i.n(n),l=i(26699),c=i(4690),a=i(45599),u=i(36983),d=i(69836),p=i(503),h=i(5014),m=i(76252),g=i(79679);const f="root-xS65kc",S="statusBar-_dfb1Q",v="contextMenuItem-gUXpM3";var k=i(11527);const _=(0,r.Pi)((e=>{const{className:t,sticker:i,isSelected:s,onClick:r,onReimport:n,onRemove:l}=e,{t:c}=(0,a.$)(),_=(0,m.B3)(i),y=i.unmetRequirements.length>0,{handleContextMenu:C}=(0,g.D)({content:(0,k.jsx)(p.m,{items:[{key:"reimport",render:({key:e,className:t})=>y&&(0,k.jsx)("div",{className:o()(t,v),onClick:()=>n(i),children:c("pc_stickers_release_again_web")},e)},{key:"remove",render:({key:e,className:t})=>(0,k.jsx)("div",{className:o()(t,v),onClick:()=>l(i),children:c("pc_stickers_release_delete_web")},e)}]})});return(0,k.jsxs)("div",{className:o()(t,f),onClick:()=>{r(i)},children:[(0,k.jsx)(u.Y,{src:_,isSelected:s,isInvalid:y,isUpdating:(0,m.Nf)(i),size:80,onContextMenu:e=>{C(e),r(i)}}),(0,k.jsx)(d.ir,{className:S,loading:!_,invalid:y,errorToolip:y&&i.unmetRequirements.map((e=>{const t=h.BI[i.fileType][e];return t?(0,k.jsx)("div",{children:t},e):null})),isInfoComplete:i.isInfoComplete,title:i.title})]})}));var y=i(93302),C=i(98205),x=i(28516);const b={cursor:"move"},w=(e,t,i)=>i>e&&i<t,I=({children:e,index:t,id:i,className:r,onMoveCard:n,onHoverCard:o,onCardClick:l,startPoint:c,scrollAreaRef:a,stickerListRect:u,onStickerListRect:d})=>{const p=(0,s.useRef)(null),[{handlerId:h},m]=(0,C.L)({accept:"sticker",collect:e=>({handlerId:e.getHandlerId()})}),g=()=>(new Date).getTime()-c.current.clickTime[0]>U,[{isDragging:f},S]=(0,x.c)({type:"sticker",item:()=>({id:i,index:t}),collect:e=>({isDragging:e.isDragging(),monitor:e}),canDrag:()=>g()});m(S(p));const v=e=>{var i,s;if(!a.current||!p.current)return;if(!g())return;const r=a.current.getBoundingClientRect(),{top:n,bottom:l}=r;if(w(n,n+20,e.clientY)&&a.current.scrollTop>0)return a.current.scrollTop-=2,void o(t,-1);if(w(l-20,l,e.clientY)&&a.current.scrollTop+a.current.clientHeight<a.current.scrollHeight)return a.current.scrollTop+=2,void o(t,-1);const{hoverIndex:d,direction:h}=((e,t)=>{const i=e.findIndex((e=>w(e.left,e.right,t.x)&&w(e.top,e.bottom,t.y)));if(i<0)return{hoverIndex:-1,direction:0};const s=(e[i].right+e[i].left)/2;return{hoverIndex:i,direction:t.x<s?-1:0}})(u,{x:e.clientX+((null===(i=c.current.centerOffset)||void 0===i?void 0:i.x)||0),y:e.clientY+((null===(s=c.current.centerOffset)||void 0===s?void 0:s.y)||0)});o(t,d,h)},_=(0,y.Z)((e=>v(e)),20);return(0,s.useEffect)((()=>{if(p.current){const e=p.current.getBoundingClientRect();null==d||d(t,e)}}),[p.current,d,t]),(0,k.jsx)("div",{draggable:!0,ref:p,className:r,style:{...b,opacity:f?0:1},"data-handler-id":h,onDrag:_,onDragStart:e=>{var i;if(!a.current||!p.current)return;l(t);const s=(null===(i=a.current)||void 0===i?void 0:i.scrollTop)||0,r=p.current.getBoundingClientRect();c.current={x:(null==e?void 0:e.clientX)||-1,y:(null==e?void 0:e.clientY)||-1,start:!0,scrollTop:s,centerOffset:{x:(r.left+r.right)/2-e.clientX,y:(r.top+r.bottom)/2-e.clientY},index:t,clickTime:c.current.clickTime}},onDragEnd:()=>{g()&&n()},children:e})},q="root-bIVz24",F="container-bqVOeD",L="stickerCardDragWrapper-ohlIdQ",j="stickerCard-OqZDu8",P="hover-right-NUTXt8",Z="hover-left-mko1D3",U=1e3,E=(0,r.Pi)((e=>{const[t,i]=(0,s.useState)(-1),[r,n]=(0,s.useState)(-1),a=(0,s.useRef)({x:-1,y:-1,start:!1,scrollTop:0,index:-1,clickTime:[-3e3,0]}),u=(0,s.useRef)([]),{className:d,importStickerFileService:p,onSelect:h,onReimport:m}=e,{stickerListStore:g}=p,f=(0,s.useCallback)((e=>{(()=>{const e=Date.now()-a.current.clickTime[0]>U;a.current.clickTime=e?[a.current.clickTime[1],Date.now()]:[a.current.clickTime[0],Date.now()]})(),g.selectedId!==e.id&&h(e)}),[h,a.current]),S=()=>{-1!==t&&(g.dragInsert(a.current.index,t+r),i(-1),a.current={x:-1,y:-1,start:!1,scrollTop:0,index:-1,clickTime:a.current.clickTime})},v=(e,t,s=0)=>{a.current.start&&(i(t),n(s))},y=(e,t)=>{u.current[e]=t};return(0,k.jsx)("div",{className:o()(d,q),children:(0,k.jsx)("div",{className:F,children:(0,k.jsx)(l.W,{backend:c.PD,children:g.stickers.map(((e,i)=>(0,k.jsx)(I,{id:e.id,className:L,index:i,scrollAreaRef:g.scrollAreaRef,startPoint:a,stickerListRect:u.current,onStickerListRect:y,onMoveCard:S,onHoverCard:v,onCardClick:e=>{f(g.stickers[e])},children:(0,k.jsx)(_,{className:o()(j,{[P]:t===i&&0===r,[Z]:t===i&&-1===r}),sticker:e,isSelected:g.selectedId===e.id,onClick:f,onReimport:m,onRemove:p.removeSticker})},e.id)))})})})}))},52915:(e,t,i)=>{var s=i(50959),r=i(23479),n=i(84736),o=i(11527);(0,r.Pi)((e=>{const[t,i]=(0,s.useState)(!1);(0,s.useEffect)((()=>{window.showStickerDebugWindow=()=>{var e,t;i(!0),null===(e=window.getSelection())||void 0===e||e.removeAllRanges(),null===(t=window.vconsole)||void 0===t||t.showSwitch()}}),[]);const r=(0,s.useRef)(null),l=window.store;return t?(0,o.jsxs)("div",{style:{position:"fixed",top:10,left:0,bottom:10,width:250,zIndex:2,backgroundColor:"white",padding:8,display:"flex",flexDirection:"column",overflow:"auto",color:"black"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,o.jsx)("div",{children:"\u5bfc\u5165\u7684\u8d34\u7eb8\u72b6\u6001"}),(0,o.jsxs)("div",{style:{display:"flex"},children:[(0,o.jsx)("div",{style:{cursor:"pointer",marginInlineEnd:8},onClick:()=>{var e,t;const i=(null===(e=r.current)||void 0===e?void 0:e.innerText)||"",s=document.createElement("textarea");s.value=i,document.body.append(s),s.select(),document.execCommand("copy"),s.blur(),n.FN.info("\u590d\u5236\u6210\u529f"),null===(t=s.parentNode)||void 0===t||t.removeChild(s)},children:"\u590d\u5236"}),(0,o.jsx)("div",{style:{cursor:"pointer"},onClick:()=>i(!1),children:"\u5173\u95ed"})]})]}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"50px 1fr",rowGap:10,columnGap:8,marginTop:10},ref:r,children:[(0,o.jsx)("div",{children:"\u4e0a\u4f20 stats"}),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{children:["pending:"," ",(l.uploadStats||l.stickerListStore.uploadStats).pending]}),(0,o.jsxs)("div",{children:["succeeded:"," ",(l.uploadStats||l.stickerListStore.uploadStats).succeeded]}),(0,o.jsxs)("div",{children:["failed:"," ",(l.uploadStats||l.stickerListStore.uploadStats).failed]})]}),l.stickersForOnlineImageEditorStats&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:"\u5728\u7ebf\u8bbe\u8ba1 stats"}),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{children:["pending: ",l.stickersForOnlineImageEditorStats.pending]}),(0,o.jsxs)("div",{children:["ready: ",l.stickersForOnlineImageEditorStats.ready]}),(0,o.jsxs)("div",{children:["failed: ",l.stickersForOnlineImageEditorStats.failed]})]})]}),l.collection&&[l.collection.cover,...l.collection.exampleImages].map(((e,t)=>{const{id:i}=e,s=0===t;return[(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsx)("div",{children:t}),(0,o.jsx)("div",{children:s?"\u5c01\u9762\u56fe":"\u793a\u4f8b\u56fe"})]},`collection-${t}-1`),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["id: ",i]}),(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["uri: ",e.uri||"\u4e0a\u4f20\u4e2d..."]}),(0,o.jsxs)("div",{children:["\u7f29\u7565\u56fe: ",e.url?"OK":"\u2757\ufe0f\u65e0"]}),(0,o.jsxs)("div",{children:["isUploadFailed:"," ",e.isUploadFailed?"\u2757\ufe0ftrue - \u4e0a\u4f20\u5931\u8d25":"false"]}),s&&(0,o.jsxs)("div",{children:["needImport:"," ",e.needImport?"\u2757\ufe0ftrue - \u672a\u751f\u6210":"false"+(e.id?"":" - \u2757\ufe0f\u7b49\u5f85\u751f\u6210\u4e2d")]})]},`collection-${t}-2`)]})),l.stickerListStore.stickers.map(((e,t)=>{const{id:i,isSequence:s}=e;return[(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsx)("div",{children:t}),(0,o.jsx)("div",{children:s?"\u5e8f\u5217\u5e27":"\u666e\u901a\u8d34\u7eb8"})]},`${i}-1`),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["id: ",i]}),(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["uri:"," ",e.uri||(e.isUploadFailed?"":"\u4e0a\u4f20\u4e2d...")]}),(0,o.jsxs)("div",{children:["\u7f29\u7565\u56fe:"," ",e.coverSrc||e.firstFrameCoverSrc?"OK"+(e.coverSrc?"":" - \u7b2c\u4e00\u5e27"):"\u2757\ufe0f\u65e0"]}),(0,o.jsxs)("div",{children:["isUploadFailed:"," ",e.isUploadFailed?"true - "+(e.uri?"\u274c\u5e8f\u5217\u5e27 gif \u56fe\u5408\u6210\u5931\u8d25":"\u274c\u4e0a\u4f20\u5931\u8d25"):"false"]}),(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["unmetRequirements:"," ",e.unmetRequirements.length>0&&"\u274c",e.unmetRequirements.join(", ")||"\u65e0"]}),s&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{children:["largeImgUri:"," ",e.largeImageUri?"OK":"\u2757\ufe0f\u65e0"+(e.isUploadFailed?"":e.uri?" - \u5e8f\u5217\u5e27 gif \u56fe\u5408\u6210\u4e2d...":" - zip \u5305\u4e0a\u4f20\u4e2d...")]}),(0,o.jsxs)("div",{children:["\u5e8f\u5217\u5e27\u91cd\u65b0\u5408\u6210\u4e2d:"," ",e.isSequenceSettingsUpdating?"true":"false"]}),(0,o.jsxs)("div",{children:["\u5e8f\u5217\u5e27\u8bbe\u7f6e: ",e.sequenceSettings.fps,"fps/",e.sequenceSettings.loop?"\u5faa\u73af\u64ad\u653e":"\u5355\u6b21\u64ad\u653e"]})]})]},`${i}-2`)]}))]})]}):null}))},97662:(e,t,i)=>{i.d(t,{WQ:()=>c});var s=i(50959),r=i(66589),n=i(61022),o=i(2555);const l=1e4;function c(e){const{stickerListStore:t}=e,i=(0,n.fv)((()=>({isImportLoading:!1,hideImportLoadingTimer:new o.B,notifyImportLoadingFinish:null,showImportLoading:async()=>{i.isImportLoading=!0,await Promise.race([new Promise((e=>i.notifyImportLoadingFinish=e)),i.hideImportLoadingTimer.timeout(l)]),(0,r.z)((()=>{i.isImportLoading=!1}))},finishImportLoadingFinishIfNeeded:()=>{i.isImportLoading&&i.notifyImportLoadingFinish&&(i.notifyImportLoadingFinish(),i.notifyImportLoadingFinish=null)},destroy:()=>{i.hideImportLoadingTimer.cancel()}})));return(0,s.useEffect)((()=>{const e=(0,r.EH)((()=>{t.isAllStickersThumbnailReady&&i.finishImportLoadingFinishIfNeeded()}));return()=>{e()}}),[]),i}},18635:(e,t,i)=>{i.d(t,{T:()=>k});var s=i(59787),r=i(22310),n=i(82665),o=i(94435),l=i(5014),c=i(97311),a=i(53486),u=i(8129),d=i(2555);function p(){let e;return{promise:new Promise((t=>{e=t})),resolve:e}}class h{constructor(){(0,s.Z)(this,"schedulePromiseCtrl",p()),(0,s.Z)(this,"timer",null),(0,s.Z)(this,"finishPromiseCtrl",p())}schedule(e){var t,i;null===(t=(i=this.schedulePromiseCtrl).resolve)||void 0===t||t.call(i),this.schedulePromiseCtrl.resolve=null,e&&!this.timer&&(this.timer=new d.B,this.timer.timeout(e).then((()=>this.finish())))}scheduled(){return this.schedulePromiseCtrl.promise}finish(){var e,t,i;null===(e=(t=this.finishPromiseCtrl).resolve)||void 0===e||e.call(t),this.finishPromiseCtrl.resolve=null,null===(i=this.timer)||void 0===i||i.cancel()}finished(){return this.finishPromiseCtrl.promise}destroy(){var e;this.schedulePromiseCtrl.resolve=null,this.finishPromiseCtrl.resolve=null,null===(e=this.timer)||void 0===e||e.cancel()}}class m{constructor(e){(0,s.Z)(this,"queue",[]),(0,s.Z)(this,"runningSet",new Set),(0,s.Z)(this,"isStopped",!1),(0,s.Z)(this,"config",void 0),this.config={concurrency:1,timeout:0,...e},this.flushRunningSet()}async add(e){const t=this.createTask();await t.scheduled();try{return await e()}finally{t.finish()}}createTask(){const e=new h;return this.queue.push(e),this.flushRunningSet(),e}async flushRunningSet(){if(!this.isStopped)for(;this.runningSet.size<this.config.concurrency&&this.queue.length;){const e=this.queue.shift();this.runningSet.add(e),e.schedule(this.config.timeout),e.finished().then((()=>{this.runningSet.delete(e),this.flushRunningSet()}))}}destroy(){this.isStopped=!0,this.runningSet.forEach((e=>e.destroy())),this.runningSet.clear(),this.queue.splice(0,this.queue.length)}}var g=i(62262);class f{constructor(e){this.props=e,(0,s.Z)(this,"fileMap",new Map)}ensureFile(e){let t=this.fileMap.get(e);return t||(t={data:this.props.initData(),events:{}},this.fileMap.set(e,t)),t}getFile(e){return this.fileMap.get(e)}register(e,t,i){this.ensureFile(t).events[e]=i}dispatch(e){var t,i;const s=this.fileMap.get(e.id);s&&(null===(t=(i=s.events)[e.type])||void 0===t||t.call(i,e,s))}removeFile(e){this.fileMap.delete(e)}}var S=i(39486),v=i(66564);class k{constructor(e){this.props=e,(0,s.Z)(this,"unregisterStickerFileProcessResultEvent",void 0),(0,s.Z)(this,"fileEventDispatcher",new f({initData:()=>({stats:{isCompressed:!1,resolutionBeforeCompress:"",resolutionAfterCompress:"",sizeBeforeCompress:0,sizeAfterCompress:0,uploadStartAt:0,uploadTime:0,uploadError:""}})})),(0,s.Z)(this,"uploadConfigService",new S.w),(0,s.Z)(this,"checkIsSequenceToGifLocallyEnabled",(0,r.Z)((async()=>{const e=await(0,v.G)("sequence_to_gif_locally",["enabled"]);return(0,u.c6)("[ImportStickerFileService] getSettings sequence_to_gif_locally",{result:e}),"true"===e.enabled}))),(0,s.Z)(this,"removeSticker",(e=>{this.cleanupStickerInfo(e),this.stickerListStore.removeSticker(e)})),(0,s.Z)(this,"sequenceInfoMap",new Map),(0,s.Z)(this,"genSequenceStickerQueue",new m({concurrency:1})),(0,s.Z)(this,"genSequenceStickerLocallyQueue",new m({concurrency:4})),this.unregisterStickerFileProcessResultEvent=this.props.api.registerStickerFileProcessResultEvent((e=>this.fileEventDispatcher.dispatch(e))),this.checkIsSequenceToGifLocallyEnabled()}get stickerListStore(){return this.props.stickerListStore}get sendLogServ(){return this.props.sendLogServ}async getUploadConfigs(e){const{imageUploadConfig:t,objectUploadConfig:i}=await this.uploadConfigService.getUploadConfigs(e);return{imageUploadConfig:t,objectUploadConfig:i}}async getOpenStickerFilePickerRequest(e){return{...await this.getUploadConfigs("OpenStickerFilePicker"),...l.DefaultImportStickerFileRequest,sequence:{...l.Q0},needCheckStaticDynamicMix:!1,hasImportedType:"",...e}}async openStickerFilePicker(e){const t=await this.getOpenStickerFilePickerRequest(e),i=await this.props.api.openStickerFilePicker(t),s=this.ensureMaxImageCount(t,i);return this.initStickers(s)}async uploadDroppedStickerFiles(e){const t=await this.getOpenStickerFilePickerRequest(e),i=await this.props.api.uploadDroppedStickerFiles(t),s=this.ensureMaxImageCount(t,i);return this.initStickers(s)}ensureMaxImageCount(e,t){const{maxCount:i}=e,{images:s,...r}=t;return s.length>i&&(0,u.RF)("[ImportStickerFileService] jsb resp images.length > maxCount",null,{imagesCount:s.length,maxCount:i}),{...r,images:s.slice(0,i)}}getFileStats(e){return this.fileEventDispatcher.ensureFile(e).data.stats}registerThumbnailEvent(e,t){this.fileEventDispatcher.register("Thumbnail",e,t)}registerUploadEvent(e,t){this.fileEventDispatcher.register("Upload",e,((e,i)=>{const{uri:s,error:r,isCompressed:n,resolutionBeforeCompress:o,resolutionAfterCompress:l,sizeBeforeCompress:c,sizeAfterCompress:a}=e;i.data.stats={...i.data.stats,isCompressed:n,resolutionBeforeCompress:o,resolutionAfterCompress:l,sizeBeforeCompress:c,sizeAfterCompress:a,uploadError:s?"":r},t(e)}))}initStickers(e){const{isSequenceImport:t,images:i}=e,s=[];for(const r of i){const{id:e,path:i,width:n,height:o}=r;s.push(this.stickerListStore.makeInitSticker({id:e,path:i,width:n,height:o,isSequence:t})),this.recordFileUploadStart(e),this.registerThumbnailEvent(e,(async t=>{const i=this.stickerListStore.getSticker(e);if(!i)return void(0,u.RF)(`[ImportStickerFileService] sticker thumbnail ignored {${e}}`);if(!t.base64)return void(0,u.RF)(`[ImportStickerFileService] sticker thumbnail failed {${e}}`);const s=(0,c.F2)(t.base64),r=await(0,c.J9)(s).catch((()=>s));this.stickerListStore.updateThumbnailSrc(i,r),this.checkRequirements(i)})),this.registerUploadEvent(e,(t=>{const i=this.stickerListStore.getSticker(e);if(!i)return void(0,u.RF)(`[ImportStickerFileService] sticker upload ignored {${e}}`);const{uri:s}=t;if(!s){const s=t.error||"unknown";return this.handleStickerUploadEnd(i,s),void(0,u.RF)(`[ImportStickerFileService] sticker upload failed {${e}}`,null,{error:s,isSequence:i.isSequence})}this.stickerListStore.updateUploadedData(i,s),i.isSequence?this.generateSequenceSticker(i):this.handleStickerUploadEnd(i),(0,u.c6)(`[ImportStickerFileService] sticker upload success {${e}}`,{uri:s,isSequence:i.isSequence})}))}return s}recordFileUploadStart(e){const{stats:t}=this.fileEventDispatcher.ensureFile(e).data;t.uploadStartAt=performance.now(),t.uploadTime=0,t.uploadError=""}recordFileUploadEnd(e,t){var i;const s=null===(i=this.fileEventDispatcher.getFile(e))||void 0===i?void 0:i.data;if(!s||0!==s.stats.uploadTime)return;const{stats:r}=s;r.uploadTime=Math.round(performance.now()-r.uploadStartAt),"string"==typeof t&&(r.uploadError=t)}handleStickerUploadEnd(e,t){"string"==typeof t&&this.stickerListStore.setUploadFailed(e),this.recordFileUploadEnd(e.id,t),this.sendLogServ.sendStickerUploadStatusLog({sticker:e,stats:this.getFileStats(e.id)})}revokeBlobUrlIfNeeded(e){null!=e&&e.startsWith("blob:")&&URL.revokeObjectURL(e)}cleanupStickerInfo(e){const{id:t}=e;this.revokeBlobUrlIfNeeded(e.firstFrameCoverSrc),this.revokeBlobUrlIfNeeded(e.coverSrc),this.sequenceInfoMap.forEach(((e,i)=>{if(e.id!==t)return;this.sequenceInfoMap.delete(i);const s=e.cache.getSync();this.revokeBlobUrlIfNeeded(null==s?void 0:s.gifCover.blobUrl)})),this.removeFile(t)}removeFile(e){this.fileEventDispatcher.removeFile(e)}getSequenceInfoKey(e){const{id:t,sequenceSettings:{fps:i,loop:s}}=e;return`${t}-${i}-${s}`}getStickerWithSameSequenceSettings(e,t){const i=this.stickerListStore.getSticker(e),s=null==i?void 0:i.sequenceSettings;return s&&s.fps===t.fps&&s.loop===t.loop?i:null}async generateSequenceSticker(e){const{id:t,sequenceSettings:{fps:i,loop:s}}=e,r=this.getSequenceInfoKey(e),n=this.sequenceInfoMap.get(r);if(n)try{const i=await n.cache.get();return(0,u.c6)(`[ImportStickerFileService] get sequenceInfo cache success {${t}}`,{key:r}),this.updateSequenceStickerInfo(e,i)}catch(p){(0,u.RF)(`[ImportStickerFileService] update sequenceInfo cache failed {${t}}`,p,{key:r});const e=this.getStickerWithSameSequenceSettings(t,{fps:i,loop:s});return void(e&&this.handleStickerUploadEnd(e,"update sequenceInfo cache failed"))}let o=null,l=null;try{const t=await this.generateSequenceStickerImpl(e);t&&({sequenceStickerInfo:o,resp:l}=t)}catch(p){(0,u.RF)(`[ImportStickerFileService] genSequenceSticker failed {${t}}`,p,{key:r,resp:l});const e=this.getStickerWithSameSequenceSettings(t,{fps:i,loop:s});return void(e&&this.handleStickerUploadEnd(e,"genSequenceSticker failed"))}if(!o)return void(0,u.c6)(`[ImportStickerFileService] generateSequenceSticker canceled {${t}}`,{key:r});const c=this.getStickerWithSameSequenceSettings(t,{fps:i,loop:s});if(!c)return;const a=this.initSequenceInfoCache(o);this.sequenceInfoMap.set(r,{id:t,cache:a});const d=!c.isSequenceSettingsUpdating;await this.updateSequenceStickerInfo(c,o),d&&this.handleStickerUploadEnd(c),(0,u.c6)(`[ImportStickerFileService] genSequenceSticker success {${t}}`,{key:r,isFirstTime:d,resp:l})}async generateSequenceStickerImpl(e){const{id:t,uri:i,sequenceSettings:{fps:s,loop:r}}=e;if(await this.checkIsSequenceToGifLocallyEnabled()){const{imageUploadConfig:e}=await this.getUploadConfigs("GenerateSequenceSticker"),{gif_gen_opts:n,...a}=l.mr,[u,d]=await this.genSequenceStickerLocallyQueue.add((()=>Promise.all([(0,o.PU)({...a,file_uri:i,fps:s,loop:r}),this.props.api.sequenceToGif({id:t,...a,fps:s,loop:r,gifs:n.map(((e,t)=>({bgColor:e.bg_color,width:e.width,height:e.height,needBase64:0===t}))),imageUploadConfig:e})])));if(d.isCanceled)return null;if(d.error)throw new g.w(`sequenceToGif error - ${d.error||"unknown"}`,{});const{file_uri:p,file_md5:h,file_size:m}=u,[f,S]=d.gifs,v=(0,c.F2)(f.base64),k=await(0,c.J9)(v);return{sequenceStickerInfo:{gifCover:{uri:f.uri,url:v,blobUrl:k},gifLargeImage:{uri:S.uri,url:"",blobUrl:""},stickerPackage:{uri:p,md5:h,size:m}},resp:u}}const n=await this.genSequenceStickerQueue.add((()=>(0,o.PU)({...l.mr,file_uri:i,fps:s,loop:r}))),a=await(0,c.J9)(n.gif_infos[0].url),{gif_infos:u,file_uri:d,file_md5:p,file_size:h}=n,[m,f]=u;return{sequenceStickerInfo:{gifCover:{...m,blobUrl:a},gifLargeImage:{...f,blobUrl:""},stickerPackage:{uri:d,md5:p,size:h}},resp:n}}async updateSequenceStickerInfo(e,t){const{id:i,uri:s,sequenceSettings:{fps:r,loop:n}}=e,{gifCover:o,gifLargeImage:l}=t;this.props.needSaveSequenceGifUrl&&!await this.checkIsSequenceToGifLocallyEnabled()&&await this.props.api.saveSequenceGifUrl({id:i,url:l.url,coverUrl:o.url,fps:r,loop:n}),this.stickerListStore.updateUploadedData(e,s,t)}initSequenceInfoCache(e){const t=()=>{const e=Date.now();return{expireTime:e+72e5,refreshTime:e,silentRefreshTime:e+6e5}},i=new a.C({initCacheData:{data:e,...t()},refresh:async()=>{var s;if(await this.checkIsSequenceToGifLocallyEnabled())return{data:{...e},...t()};const{gifCoverUrl:r,gifLargeImageUrl:n}=await this.refreshStickerSequenceUrls(e),o=null!==(s=i.getSync())&&void 0!==s?s:e;return{data:{...o,gifCover:{...o.gifCover,url:r},gifLargeImage:{...o.gifLargeImage,url:n}},...t()}}});return i}async refreshStickerSequenceUrls(e){const{gifCover:t,gifLargeImage:i}=e,{uri_to_url:s}=await(0,o.nz)({uri_infos:[{uri:t.uri,width:0,height:0,format:"image"},{uri:i.uri,width:0,height:0,format:"image"}]}),r=[],n=null==s?void 0:s[t.uri];n||r.push(`cover-${t.uri}`);const l=null==s?void 0:s[i.uri];if(l||r.push(`largeImage-${i.uri}`),!n||!l)throw new Error(`Failed to get url for ${r.join(", ")}`);return{gifCoverUrl:n,gifLargeImageUrl:l}}async checkRequirements(e){if(e.isSequence)return void this.stickerListStore.updateUnmetRequirements(e,[]);const t=[],{minImageSize:i}=l.DefaultImportStickerFileRequest;(e.width<i||e.height<i)&&t.push(l.fD.MinImageSize),this.stickerListStore.updateUnmetRequirements(e,t)}async reimportSticker(e,t){const i=await this.getOpenStickerFilePickerRequest({minCount:1,maxCount:1,maxTotalCount:1,...t}),s=await this.props.api.openStickerFilePicker({...i,multiple:!1}),r=this.initStickers(s);if(0===r.length)return null;const[n]=r;return this.cleanupStickerInfo(e),this.stickerListStore.reimportSticker(e.id,n),n.id}async retryUpload(e){return this.retryUploadStickersIfNeeded(this.stickerListStore.stickers,e)}async retryUploadStickersIfNeeded(e,t){const i=[],s=[];return e.forEach((e=>{!e.isUploadFailed||e.unmetRequirements.length>0||(e.isSequence&&e.uri?s.push(e):i.push(e))})),this.retryGenerateSequence(s),this.retryUploadFile(i,t)}async retryUploadFile(e,t){const i=e.map((e=>e.id)),s=[...i,...t];if(!s.length)return;let r;try{r=await this.getOpenStickerFilePickerRequest({minCount:1,maxCount:s.length,maxTotalCount:s.length})}catch(n){throw(0,u.RF)("[ImportStickerFileService] retryUploadFile get request failed",n,{retryUploadIds:s}),n}this.props.stickerListStore.startToRetryUploadStickers(i),s.forEach((e=>this.recordFileUploadStart(e))),this.props.api.openStickerFilePicker({...r,retryUploadIds:s}),(0,u.c6)("[ImportStickerFileService] retryUploadFile start",{retryUploadIds:s})}retryGenerateSequence(e){const t=e.map((e=>e.id));t.length&&(this.stickerListStore.startToRetryUploadStickers(t),t.forEach((e=>this.recordFileUploadStart(e))),this.batchGenerateSequenceSticker(e),(0,u.c6)("[ImportStickerFileService] retryGenerateSequence start",{stickerIds:t}))}updateSequenceSettings(e){const{newSettings:t,isApplyToAll:i}=e;let s=[];if(i)s=this.stickerListStore.stickers.filter((e=>e.isSequence));else{if(!this.stickerListStore.selectedSticker)return;s=[this.stickerListStore.selectedSticker]}const r=s.filter((e=>e.isUploadFailed||e.sequenceSettings.fps!==t.fps||e.sequenceSettings.loop!==t.loop));if(0===r.length)return;this.stickerListStore.startToUpdateSequenceSettings(r,t);const n=r.filter((e=>!e.isUploadFailed&&e.uri)),o=r.filter((e=>e.isUploadFailed));this.batchGenerateSequenceSticker(n),this.retryUploadStickersIfNeeded(o,[])}async batchGenerateSequenceSticker(e){for(const i of(0,n.Z)(e,10))try{await Promise.all(i.map((e=>this.generateSequenceSticker(e))))}catch(t){(0,u.RF)("[ImportStickerFileService] batchGenerateSequenceSticker failed",t,{stickers:i.map((e=>e.id))})}}async generateCollectionCover(e){const{collectionId:t}=e,i=await this.getUploadConfigs("generateCollectionCover"),s=e.stickers.map((e=>({id:e.id,...e.sequenceSettings})));(0,u.c6)("[ImportStickerFileService] generateCollectionCover start",{collectionId:t,stickers:s});const{id:r}=await this.props.api.generateStickerCollectionCoverImage({...i,collectionId:t,stickers:s});return r}async openStickerOnlineImageEditor(e){const{stickers:t,...i}=e,s=await this.getUploadConfigs("openStickerOnlineImageEditor"),{id:r}=await this.props.api.openStickerOnlineImageEditor({...i,...s,stickers:t.map((e=>({id:e.id,...e.sequenceSettings})))});return r}async localUploadImage(e){const t=await this.getOpenStickerFilePickerRequest({...e,minCount:1,maxCount:1,maxTotalCount:1}),{images:i}=await this.props.api.openStickerFilePicker({...t,multiple:!1,enableImportSequence:!1});return 0===i.length?null:i[0]}destroy(){this.unregisterStickerFileProcessResultEvent(),this.genSequenceStickerQueue.destroy(),this.genSequenceStickerLocallyQueue.destroy()}}},50666:(e,t,i)=>{i.d(t,{r:()=>l});var s=i(23073),r=i(93639),n=i(98052);var o=i(8129);class l{getJSBRequest(e){const t=e.accept.split(",").map((e=>e.trim().replace(/^\./g,""))).join("-");return{...e,accept:t}}async openStickerFilePicker(e){var t;const i=this.getJSBRequest(e);(0,o.c6)("[JSB] openStickerFilePicker req --\x3e",{...(0,r.Z)(i,["objectUploadConfig","imageUploadConfig","sequence"])});const s=await(e=>n.Jn.call("openStickerFilePicker",e))(i);return(0,o.c6)("[JSB] openStickerFilePicker resp <--",{isSequenceImport:null==s?void 0:s.isSequenceImport,imagesCount:null==s||null===(t=s.images)||void 0===t?void 0:t.length}),s}async uploadDroppedStickerFiles(e){var t;const i=this.getJSBRequest(e);(0,o.c6)("[JSB] uploadDroppedStickerFiles req --\x3e",{...(0,r.Z)(i,["objectUploadConfig","imageUploadConfig","sequence"])});const s=await(e=>n.Jn.call("uploadDroppedStickerFiles",e))(i);return(0,o.c6)("[JSB] uploadDroppedStickerFiles resp <--",{isSequenceImport:null==s?void 0:s.isSequenceImport,imagesCount:null==s||null===(t=s.images)||void 0===t?void 0:t.length}),s}registerStickerFileProcessResultEvent(e){return(e=>{const t=t=>{t.data&&e(t.data)};return n.Jn.on("StickerFileProcessResult",t),()=>n.Jn.off("StickerFileProcessResult",t)})((t=>{(0,o.c6)(`[JSB] StickerFileProcessResult ${null==t?void 0:t.type} {${null==t?void 0:t.id}}`,{...(0,s.Z)(t,["result","uri","error"])}),e(t)}))}async saveSequenceGifUrl(e){try{return(0,o.c6)(`[JSB] saveSequenceGifUrl {${e.id}}`),await(e=>n.Jn.call("saveSequenceGifUrl",e))(e)}catch{return}}async generateStickerCollectionCoverImage(e){(0,o.c6)("[JSB] generateStickerCollectionCoverImage req --\x3e",{...(0,r.Z)(e,["objectUploadConfig","imageUploadConfig"])});const t=await(e=>n.Jn.call("generateStickerCollectionCoverImage",e))(e);return(0,o.c6)("[JSB] generateStickerCollectionCoverImage resp <--",t),t}async openStickerOnlineImageEditor(e){(0,o.c6)("[JSB] openStickerOnlineImageEditor req --\x3e",{...(0,r.Z)(e,["objectUploadConfig","imageUploadConfig"])});const t=await(e=>n.Jn.call("openStickerOnlineImageEditor",e))(e);return(0,o.c6)("[JSB] openStickerOnlineImageEditor resp <--",t),t}async sequenceToGif(e){var t;(0,o.c6)("[JSB] sequenceToGif req --\x3e",{...(0,r.Z)(e,["imageUploadConfig"])});const i=await(e=>(0,n.mu)("sequenceToGif",{...e,timeout_ms:6e5}))(e);return(0,o.c6)("[JSB] sequenceToGif resp <--",{gifs:null===(t=i.gifs)||void 0===t?void 0:t.map((e=>{var t;return{uri:e.uri,base64Length:null===(t=e.base64)||void 0===t?void 0:t.length}})),isCanceled:i.isCanceled,error:i.error}),i}}},49737:(e,t,i)=>{i.d(t,{YL:()=>d,pg:()=>h,t9:()=>p});var s=i(59787),r=i(50959),n=i(76252),o=i(9679),l=i(42983),c=i(97311),a=i(67078),u=i(94435);class d{constructor(e){(0,s.Z)(this,"materialTypeParams",{material_category:"",material_type:""}),(0,s.Z)(this,"isCollection",!1),this.isCollection=e.itemType===l.Ab.StickerCollection,this.materialTypeParams={material_category:"sticker",material_type:this.isCollection?"collection":"single"}}sendPageActionLog(e){(0,o.iL)({...this.materialTypeParams,...e,...this.isCollection&&{collection_detail:e.collection_detail||"collection_all"}})}sendUploadActionLog(e){const{mainFormLayout:t}=e,i="mainForm"===t?"upload_more":"sticker_upload";this.sendPageActionLog({action:i})}sendStartEditSequenceSettingsLog(e){const{collection_detail:t}=e;this.sendPageActionLog({action:"animation_edit",collection_detail:t})}sendSaveSequenceSettingsLog(e){const{collection_detail:t,sequenceSettings:i}=e;this.sendPageActionLog({action:"animation_edit_save",collection_detail:t,extra:{...i&&{animation_cycle_detail:i.loop?"repeat":"once",animation_fps_detail:String(i.fps),animation_is_applied_to_all:i.sequenceSettingsApplyToAll?"1":"0"}}})}sendStickerUploadStatusLog(e){const{sticker:t,stats:i}=e,{isSequence:s,isUploadFailed:r}=t,n=s&&r&&t.uri&&"sequencial_material_failed",l=!r&&t.largeImageUri&&"success",{isCompressed:c,resolutionBeforeCompress:a,resolutionAfterCompress:u,sizeBeforeCompress:d,sizeAfterCompress:p,uploadTime:h,uploadError:m}=i;(0,o.j2)({...this.materialTypeParams,...this.isCollection&&{collection_detail:"collection_material"},error_report:m,upload_status:n||l||"fail",time:h,isCompressed:c,resolutionBeforeCompress:a,resolutionAfterCompress:u,sizeBeforeCompress:d,sizeAfterCompress:p,extra:{...void 0!==s&&{is_sequential:s?1:0}}})}sendCollectionUploadStatusLog(e){const{cover:t,exampleImage:i,stats:s}=e,{isUploadFailed:r}=t||i,{isCompressed:n,resolutionBeforeCompress:l,resolutionAfterCompress:c,sizeBeforeCompress:a,sizeAfterCompress:u,uploadTime:d,uploadError:p}=s;(0,o.j2)({...this.materialTypeParams,collection_detail:t?"collection_cover":"collection_sample",error_report:p,upload_status:r?"fail":"success",time:d,isCompressed:n,resolutionBeforeCompress:l,resolutionAfterCompress:c,sizeBeforeCompress:a,sizeAfterCompress:u})}sendStickerImportErrorLog(e){return(0,o.DV)({...this.materialTypeParams,...e})}sendStickerPublishErrorLog(e){return(0,o.Sj)(e.map((e=>({...this.materialTypeParams,...e}))))}sendStickerPublishStatusLog(e){const{stickerParams:t,collectionParams:i,error:s,time:r}=e,l=s?"fail":"success",d=[];if((null!=t&&t.stickerReqItem.common_data.is_business||null!=i&&i.collectionReqItem.common_data.is_business)&&d.push("business"),(null!=t&&t.stickerReqItem.is_vip||null!=i&&i.collectionReqItem.is_vip)&&d.push("subscribe"),t){const{sticker:e,stickerReqItem:i,stats:p}=t,{common_data:h,copyright:m}=i,{isSequence:g,sequenceSettings:f,path:S}=e;return(0,o.$v)({status:l,material_category:this.materialTypeParams.material_category,material_type:"single",title:h.title,isOriginal:h.is_original||!1,tags:h.tags||[],material_format:g?"zip":(0,c.lm)(S),material_size:p.sizeAfterCompress,resolution:p.resolutionAfterCompress,error_type:s,time:r,authorize_range:d.join(","),isVipAuthorized:(0,a.$X)(i.copyright,u.$x.Vip),isBusinessAuthorized:(0,a.$X)(i.copyright,u.$x.Business),is_official_task:i.common_data.post_channel===u.iu.Open?0:1,task_id:e.formState.targetedActivityId,extra:{sticker_type:(0,n.w3)(e)?"gif":"png",sticker_animation:g?"1":"0",...g&&{animation_cycle_detail:f.loop?"repeat":"once",animation_fps_detail:String(f.fps)}}})}{const{collection:e,collectionReqItem:t}=i,{common_data:n}=t;return(0,o.$v)({status:l,...this.materialTypeParams,title:n.title,description:n.description||"",isOriginal:n.is_original||!1,tags:n.tags||[],error_type:s,cover_type:e.cover.generatedFrom,time:r,authorize_range:d.join(","),isVipAuthorized:(0,a.$X)(t.copyright,u.$x.Vip),isBusinessAuthorized:(0,a.$X)(t.copyright,u.$x.Business),is_official_task:t.common_data.post_channel===u.iu.Open?0:1,task_id:e.formState.targetedActivityId,extra:{sticker_animation:"0"}})}}sendClickSubscriptionCheckboxLog(e){this.sendPageActionLog({action:e?"check_box_subscription":"cancel_check_box_subscription"})}sendSubscriptionStatementLog(e){(0,o.ce)({...this.materialTypeParams,...e})}sendClickCommercialCheckboxLog(e){this.sendPageActionLog({action:e?"check_box_commercial":"cancel_check_box_commercial"})}sendCommercialStatementLog(e){(0,o.Ad)({...this.materialTypeParams,...e})}sendAuthorSignLog(e){(0,o._4)({...this.materialTypeParams,...e})}}function p(e){(0,r.useEffect)((()=>{e.sendPageActionLog({action:"upload_page_show"})}),[])}function h(e){const{mainFormLayout:t,sendLogServ:i}=e;(0,r.useEffect)((()=>{"mainForm"===t&&i.sendPageActionLog({action:"detail_page_show"})}),[t])}},24399:(e,t,i)=>{i.d(t,{g:()=>r});var s=i(8129);function r(e){const{logPrefix:t,sticker:i,publishResult:r,sendLogServ:n,importServ:o}=e,{req:l,error:c,errorText:a,time:u,resourceId:d}=r;n.sendStickerPublishStatusLog({error:a,time:u,stickerParams:{sticker:i,stickerReqItem:l,stats:o.getFileStats(i.id)}});const{id:p}=i;c?(0,s.RF)(`${t} sticker publish failed`,c,{id:p}):(0,s.c6)(`${t} sticker publish success`,{id:p,resourceId:d})}},74235:(e,t,i)=>{i.d(t,{xB:()=>s});function s(e){const{len:t,i18n:i}=e,[s]=(i.language||"").split("-");return"zh"===s?Math.floor(t/2):t}},80515:(e,t,i)=>{i.d(t,{Z:()=>s});const s={input:"input-gRb1O6"}},86057:(e,t,i)=>{i.d(t,{Z:()=>s});const s={root:"root-qThJ3Y",point:"point-ytHHVg"}},3731:(e,t,i)=>{i.d(t,{Z:()=>s});const s={menu:"menu-v4m02G",menuItemContainer:"menuItemContainer-K5Eent",menuItem:"menuItem-eU7buP"}},53803:(e,t,i)=>{i.d(t,{Z:()=>s});const s={group:"group-m_Apv3",authGroup:"authGroup-Yuaspf",label:"label-EV9bRs",right:"right-pmBY1Y"}}}]);