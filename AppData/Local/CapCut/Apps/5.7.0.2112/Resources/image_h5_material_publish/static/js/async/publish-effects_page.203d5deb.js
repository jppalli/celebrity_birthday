"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[464],{84997:(e,t,a)=>{a.d(t,{S:()=>h,w:()=>g});var l=a(50959),i=a(44478),o=a(26800),r=a(84875),n=a.n(r),s=a(84736),c=a(45599),d=a(20468),m=a(2555),u=a(76896),p=a(45584),f=a(11527);const _=(0,l.forwardRef)(((e,t)=>{const{tooltipProps:a,getPopupContainer:i,onClosePopover:r,position:c,cursor:d="default"}=e,[_,g]=(0,l.useState)(!0),[h,v]=(0,l.useState)(!1),{top:y}=c,b=c.left-10,C=(0,l.useRef)(null),x=(0,l.useRef)(null),I=(0,o.Z)((()=>{var e;null===(e=x.current)||void 0===e||e.destroy(),v(!1),g(!1)})),L=(0,o.Z)((()=>{var e;const t=i().querySelector(`.${p.Z.tooltipWrapper}`);if(!t||(null===(e=x.current)||void 0===e?void 0:e.tooltipWrapper)===t)return;t.addEventListener("animationend",I);const a=new m.B;a.timeout(500).then(I),x.current={tooltipWrapper:t,destroy:()=>{t.removeEventListener("animationend",I),a.cancel(),x.current=null}}}));(0,l.useImperativeHandle)(t,(()=>({hide:()=>{L(),v(!0)}})));const w=(0,l.useMemo)((()=>({default:{height:18,width:12},"not-allowed":{height:(0,u.c)()?30:15,width:15}})),[]),S=w[d]||w.default;return(0,f.jsx)(s.u,{autoAdjustOverflow:!0,position:"bottomLeft",motion:!1,...a,className:n()(a.className,p.Z.tooltipWrapper,h&&p.Z.fadingOut),trigger:"custom",visible:_,showArrow:!1,rePosKey:`${y}-${b}`,getPopupContainer:i,onVisibleChange:e=>{var t;!e&&r(),null===(t=a.onVisibleChange)||void 0===t||t.call(a,e)},children:(0,f.jsx)("div",{className:p.Z.point,tabIndex:-1,ref:C,style:{top:y,left:b,...S}})})}));function g(e){const{zIndex:t=1060,cursor:a="default",checkIsTarget:r,getEllipsisDOM:n,...s}=e,m=(0,l.useRef)(null),u=(0,l.useRef)(null),[g,h]=(0,l.useState)(null),{i18n:v}=(0,c.$)(),y=()=>{const{content:e}=s;if("function"!=typeof e)return e;if(!m.current)return null;const{targetElement:t}=m.current;return a=>e({...a,target:t})},b=(0,o.Z)((()=>{m.current&&(m.current.destroy(),m.current=null,h(null))})),C=(0,o.Z)((()=>{var e;null===(e=m.current)||void 0===e||e.destroy(),m.current=null})),x=(0,o.Z)(((e,a)=>{const l=null==n?void 0:n(a);if(l&&l.offsetWidth>=l.scrollWidth)return;if(m.current){if(!m.current.hasLeaved&&m.current.targetElement===a)return;b()}const o=document.createElement("div");o.className=p.Z.root,o.style.zIndex=`${t}`;const r=e=>{h({left:e.clientX,top:e.clientY})},s=e=>{a===e.target&&(m.current&&(m.current.hasLeaved=!0),u.current?u.current.hide():b())};a.addEventListener("mousemove",r),a.addEventListener("mouseleave",s),document.body.appendChild(o);const c=(0,i.createRoot)(o);m.current={container:o,targetElement:a,hasLeaved:!1,reactRoot:c,destroy:()=>{o.remove(),Promise.resolve().then((()=>c.unmount())),a.removeEventListener("mousemove",r),a.removeEventListener("mouseleave",s)}},h({left:e.clientX,top:e.clientY})})),I=(0,o.Z)((e=>{const t=e.currentTarget;x(e,t)})),L=(0,o.Z)((e=>{var t;const a=e.target;(null!==(t=null==r?void 0:r(a))&&void 0!==t?t:e.currentTarget===a)&&x(e,a)}));return(0,l.useLayoutEffect)((()=>C),[]),(0,l.useLayoutEffect)((()=>{(()=>{if(!m.current||!g)return;const{reactRoot:e,container:l}=m.current;l.style.zIndex=`${t}`,e.render((0,f.jsx)(d.a,{i18n:v,children:(0,f.jsx)(_,{ref:u,tooltipProps:{...s,content:y()},getPopupContainer:()=>l,onClosePopover:b,position:g,cursor:a})}))})()})),{handleMouseEnter:I,handleMouseOver:L}}function h(e={}){const{getEllipsisDOM:t=(e=>e),content:a=(({target:e})=>e.textContent),...l}=e;return g({...l,getEllipsisDOM:t,content:a})}},42983:(e,t,a)=>{a.d(t,{Ab:()=>l});let l=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({})},89766:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ta});var l=a(23479),i=a(45599),o=a(21130),r=a(12904),n=a(9608);let s=function(e){return e.Format="format",e.MaxFileSize="maxFileSize",e}({}),c=function(e){return e.ZIP="zip",e}({}),d=function(e){return e.File="file",e}({});var m=a(50959),u=a(97311),p=a(73224);const f=15,_=10485760,g={[d.File]:{[s.Format]:p.I18n.t("cc_pc_material_visual_effect_publish_guidance_format_web"),[s.MaxFileSize]:p.I18n.t("cc_pc_material_visual_effect_publish_guidance_size_web",{size:10})}},h={accept:"zip",multiple:!0,maxFileSize:_},v="ImportEffects",y=200,b=200;const C=(e,t)=>{const a=[];t>_&&a.push(s.MaxFileSize);let l="";try{l=function(e){const t=(0,u.lm)(e);if("zip"===t)return c.ZIP;throw new Error(`Unsupported suffix ${t}`)}(e)}catch(i){a.push(s.Format)}return{unmetRequirements:a,fileType:l}};var x=a(93639),I=a(61022),L=a(66589),w=a(84736),S=a(54847),Z=a(2555);const E=1e4;var A=a(39486),P=a(60251),F=a(42983),M=a(59787),T=a(82665),k=a(50279),N=a(25807),j=a(8129),U=a(94435);function R(e){return Boolean(e.id)}class O{constructor(){(0,M.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const a of(0,T.Z)(e,10)){const e=await Promise.all(a.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:a,onResult:l,onUpdateResult:i}=e,o=JSON.parse(JSON.stringify(e.req));let r=this.itemMap.get(a);if(null!==(t=r)&&void 0!==t&&t.promise&&(0,k.Z)(r.req,o))try{return await r.promise}catch(n){(0,j.c6)("[MaterialPublishService] publish failed, start to retry",{id:a})}return r={promise:null,id:a,req:o,onResult:l,onUpdateResult:i},this.itemMap.set(a,r),r.promise=this.publishImpl(r),r.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),a=async(a,l)=>{try{const r={error:a,errorText:this.getErrorText(a),time:Math.round(performance.now()-t),resourceId:l};var i,o;if(R(e.req))await(null===(i=e.onUpdateResult)||void 0===i?void 0:i.call(e,{req:e.req,...r}));else await(null===(o=e.onResult)||void 0===o?void 0:o.call(e,{req:e.req,...r}))}catch(r){(0,j.RF)("[MaterialPublishService] callOnResult failed",r)}};let l;try{l=await this.postOrUpdate(e)}catch(i){throw e.promise=null,a(i,""),i}return await a(null,l.resource_id),l}async postOrUpdate(e){return R(e.req)?(await(0,U.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,U.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new Z.B).timeout(5e3)])}catch(t){(0,j.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const a=performance.now(),l=new Z.B,i={count:50,effect_types:t,uid:N.$.userInfo.uid,cursor:0};for(;performance.now()-a<5e3;){const t=await(0,U.Js)(i).catch((()=>null));if(null!=t&&t.effect_item_list){const a=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>a.has(e))))return}await l.timeout(500)}}}var q=a(57609),z=a(2514),B=a(67078),D=a(539),V=a(46309),$=a(98052);let J=function(e){return e.Thumbnail="Thumbnail",e.UploadCover="UploadCover",e.UploadEffect="UploadEffect",e}({});var W=a(3718),Y=a(51654),G=a(18370),H=a(23073),X=a(1946);const K=new class{async openEffectFilePicker(e){const t={...e,temporaryId:(0,X.V)("single")};(0,j.c6)("[JSB] openEffectFilePicker req --\x3e",{...(0,x.Z)(t,[])});const a=await(e=>$.Jn.call("openEffectFilePicker",e))(t);return(0,j.c6)("[JSB] openEffectFilePicker resp <--",a.effects),a}async uploadDroppedEffectFiles(e){var t;const a={...e,temporaryId:(0,X.V)("single")};(0,j.c6)("[JSB] uploadDroppedEffectFiles req --\x3e",{...(0,x.Z)(a,[])});const l=await(e=>$.Jn.call("uploadDroppedEffectFiles",e))(a);return(0,j.c6)("[JSB] uploadDroppedEffectFiles resp <--",{imagesCount:null==l||null===(t=l.effects)||void 0===t?void 0:t.length}),l}async setEffectCoverImage(e){(0,j.c6)("[JSB] setEffectCoverImage req --\x3e",e);const t=await(e=>$.Jn.call("setEffectCoverImage",e))(e);return(0,j.c6)("[JSB] setEffectCoverImage resp <--",{}),t}async uploadEffectCoverImage(e){(0,j.c6)("[JSB] uploadEffectCoverImage req --\x3e",e);const t=await(e=>$.Jn.call("uploadEffectCoverImage",e))(e);return(0,j.c6)("[JSB] uploadEffectCoverImage resp <--",{}),t}registerEffectFileProcessResultEvent(e){return(e=>{const t=t=>{t.data&&e(t.data)};return $.Jn.on("effectProcessResult",t),()=>$.Jn.off("effectProcessResult",t)})((t=>{(0,j.c6)(`[JSB] EffectFileProcessResult ${null==t?void 0:t.type} {${null==t?void 0:t.id}}`,{...(0,H.Z)(t,["result","uri","error","fileUri","temporaryId","id","collectionId"])}),e(t)}))}async cancelEffectUpload(e){(0,j.c6)("[JSB] cancelEffectUpload req --\x3e",e),await(e=>$.Jn.call("cancelEffectUpload",e))(e),(0,j.c6)("[JSB] cancelEffectUpload resp <--")}};var Q=a(74235),ee=a(11304);function te(e){switch(e){case F.Ab.Special:return"special_effect";case F.Ab.Transition:return"transition";case F.Ab.VideoAnimation:return"video_animation";case F.Ab.FaceSpecial:return"face_effect";default:return"effect"}}class ae extends o.D5{sendUploadActionLog(e){const{mainFormLayout:t}=e,a="mainForm"===t?"upload_more":"effect_upload";this.sendPageActionLog({action:a})}sendMaterialPublishLog({publishResult:e,effect:t,logPrefix:a}){this.sendMaterialPublishStatusLog({...e,publishParams:t,status:e.error?"fail":"success",path:t.payload.path,error_type:e.errorText},{material_size:t.payload.size,is_official_task:t.common_data.post_channel===U.iu.Open?0:1,task_id:t.payload.targetedActivityId,material_id:e.resourceId,material_subcategory:te(t.effect_type),effect_type_id:t.payload.categoryId,effect_type_title:t.payload.categoryName}),e.error?(0,j.RF)(`${a} effects publish failed`,e.error,{id:t.payload.localId}):(0,j.c6)(`${a} effects publish success`,{id:t.payload.localId,resourceId:e.resourceId})}}function le(){const e=function(){const e=(0,I.fv)((()=>({uploadConfigService:new A.w,materialList:[],scrollAreaRef:(0,m.createRef)(),effectsPostConfigMap:{[F.Ab.Special]:new ee.E(F.Ab.Special),[F.Ab.FaceSpecial]:new ee.E(F.Ab.FaceSpecial),[F.Ab.VideoAnimation]:new ee.E(F.Ab.VideoAnimation),[F.Ab.Transition]:new ee.E(F.Ab.Transition)},get hasMaterials(){return this.materialList.length>0},selectedId:null,get selectedMaterial(){return e.selectedId?e.getMaterial(e.selectedId):null},get isAllReady(){return e.materialList.length>0},addMaterials(t){t.length&&(e.materialList=[...e.materialList,...t],e.materialList.length===t.length&&(e.selectedId=t[0].payload.localId))},getMaterial:t=>{var a;return null!==(a=e.materialList.find((e=>{var a;return(null===(a=e.payload)||void 0===a?void 0:a.localId)===t})))&&void 0!==a?a:null},selectMaterial(t){e.selectedId=t,e.selectedMaterial&&(e.selectedMaterial.payload.hasEverSelected=!0)},updateThumbnailSrc(e,t){e.payload.thumbImg=t},updateUnmetRequirements(e,t){e.payload.unmetRequirements=t,e.payload.hasCheckedRequirements=!0},makeInitForm:({payload:e,title:t,format:a,is_vip:l,effect_type:i,md5:o})=>{var r;return{effect_type:i,common_data:{title:t,description:"",tags:[],source:U.r0.UserPostPc,is_original:!1,is_business:!1,web_extra:"",icon:{image_uri:"",width:y,height:b},format:a,file:{size:null!==(r=e.size)&&void 0!==r?r:0,file_uri:"",file_md5:o},md5:o},is_vip:l,payload:{hasEverSelected:!1,itemId:void 0,unmetRequirements:[],hasCheckedRequirements:!1,localId:"",thumbImg:"",size:0,path:"",error:"",temporary:{UploadCover:"",Thumbnail:"",UploadEffect:""},coverUpdating:!1,coverImgUrls:{fadeInUrl:""},duration:0,...e}}},updateFormState(e,t){Object.assign(e,t)},updateUploadResp(e,{fileUri:t,imgUri:a}){t&&e.common_data.file&&(e.common_data.file.file_uri=t),a&&(e.common_data.icon.image_uri=a)},reimportMaterial(t,a){const l=e.materialList.findIndex((e=>e.payload.localId===t));-1!==l&&(e.materialList[l]=a)},removeMaterial(t){e.materialList=e.materialList.filter((e=>e.payload.localId!==t.payload.localId)),K.cancelEffectUpload({id:t.payload.localId})},applyAuthSettingsToAll:({isOriginal:t,isBusiness:a,isVip:l})=>{e.materialList.forEach((e=>{e.is_vip=Boolean(l),e.common_data.is_original=Boolean(t),e.common_data.is_business=Boolean(a)}))},applyCommonDataToAll:t=>{e.materialList.forEach((e=>{e.common_data={...e.common_data,...t}}))},applyPayloadDataToAll:t=>{e.materialList.forEach((e=>{e.payload={...e.payload,...t}}))},dragInsert(t,a){const l=e.materialList.splice(t,1),i=t>a?a+1:a;e.materialList.splice(i,0,...l)},get isReadyToPublish(){return e.materialList.every((e=>{var t;return 0===(null===(t=e.payload.unmetRequirements)||void 0===t?void 0:t.length)&&this.getIsInfoComplete(e)}))},get uploadStats(){let t=0,a=0,l=0;return e.materialList.forEach((e=>{var i,o;"UploadFailed"!==e.payload.failedType?(null===(i=e.common_data.icon)||void 0===i?void 0:i.image_uri)&&(null===(o=e.common_data.file)||void 0===o?void 0:o.file_uri)?t+=1:l+=1:a+=1})),{pending:l,succeeded:t,failed:a}},getIsInfoComplete(e){const{title:t,tags:a,post_channel:l}=e.common_data,{categoryId:i,targetedActivityId:o}=e.payload,r=this.effectsPostConfigMap[e.effect_type],{mustPaidAuth:n}=r.authConfig;{const r=l===U.iu.Open||l===U.iu.Targeted&&Boolean(o),s=n&&e.is_vip||!n;return Boolean(t&&(null==a?void 0:a.length)&&e.payload.thumbImg&&i&&r&&s)}},collectLogData:()=>e.materialList.map((e=>{const t=(0,x.Z)(e.payload,"thumbImg");return{...e,payload:t}})),handleFilePickerResp(t){const a=N.$.isEnableAuthorization;return t.effects.map((t=>{const l=C(t.path,t.size),i=(0,Q.YB)(t.path,{maxLength:this.effectsPostConfigMap[t.effect_type].resourceCommonConfig.maxTitleLen||f}),o={EffectFile:t.temporaryId,EffectImg:t.temporaryId,Thumbnail:t.temporaryId};return e.makeInitForm({effect_type:t.effect_type,payload:{localId:t.id,duration:Math.round(1e3*t.duration),...(0,H.Z)(t,["size","path","error"]),...l,temporary:o,failedType:"importFailed"},title:i,format:l.fileType,is_vip:a,md5:t.md5})}))},async refreshUploadConfigsIfNeeded(t){await e.uploadConfigService.refreshUploadConfigsIfNeeded({when:t,logPrefix:"[EffectStore]"})},async openEffectPicker({maxTotalCount:t,maxCount:a,minCount:l}){await e.refreshUploadConfigsIfNeeded("openEffectFilePicker");const i=await K.openEffectFilePicker({...await e.uploadConfigService.getUploadConfigs("openEffectPicker"),...h,minCount:l,maxCount:a,maxTotalCount:t}),o=e.handleFilePickerResp(i);e.addMaterials(o)},async reimportEffectFilePicker({maxTotalCount:t,maxCount:a,minCount:l,oldId:i}){await e.refreshUploadConfigsIfNeeded("openEffectFilePicker");const o=await K.openEffectFilePicker({...await e.uploadConfigService.getUploadConfigs("openEffectPicker"),...h,minCount:l,maxCount:a,maxTotalCount:t,multiple:!1}),r=e.handleFilePickerResp(o);r[0]&&(e.reimportMaterial(i,r[0]),K.cancelEffectUpload({id:i}))},async uploadDroppedEffectFiles({maxTotalCount:t,maxCount:a,minCount:l}){await e.refreshUploadConfigsIfNeeded("uploadDroppedEffectFiles");const i=await K.uploadDroppedEffectFiles({...await e.uploadConfigService.getUploadConfigs("uploadDroppedEffectFiles"),...h,minCount:l,maxCount:a,maxTotalCount:t}),o=e.handleFilePickerResp(i);e.addMaterials(o)},async setEffectCoverImage(t){const a=e.getMaterial(t.payload.localId);if(!a)return;const l=(0,X.V)("single");return a.payload.coverUpdating=!0,a.payload.temporary.Thumbnail=l,"updateCoverFailed"===a.payload.failedType&&(a.payload.failedType=void 0),K.setEffectCoverImage({id:t.payload.localId,fadeInUrl:t.payload.coverImgUrls.fadeInUrl,fadeOutUrl:t.payload.coverImgUrls.fadeOutUrl,imageWidth:y,imageHeight:b,temporaryId:l})},async retryUpdateCover(e){return e.payload.failedType=void 0,this.setEffectCoverImage(e)},async retryUpload(t){if(!t.length)return;const a=t.map((e=>e.payload.localId));return a.forEach((t=>{const a=e.getMaterial(t);a&&(a.payload.failedType=void 0)})),K.openEffectFilePicker({...await e.uploadConfigService.getUploadConfigs("openEffectPicker"),...h,minCount:1,maxCount:t.length,maxTotalCount:t.length,retryUploadIds:a})}})));return e}(),t=function(e){const t=(0,I.fv)((()=>({isImportLoading:!1,hideImportLoadingTimer:new Z.B,notifyImportLoadingFinish:null,showImportLoading:async()=>{t.isImportLoading=!0,await Promise.race([new Promise((e=>t.notifyImportLoadingFinish=e)),t.hideImportLoadingTimer.timeout(E)]),(0,L.z)((()=>{t.isImportLoading=!1}))},finishImportLoadingFinishIfNeeded:()=>{t.isImportLoading&&t.notifyImportLoadingFinish&&(t.notifyImportLoadingFinish(),t.notifyImportLoadingFinish=null)},destroy:()=>{t.hideImportLoadingTimer.cancel()}})));return(0,m.useEffect)((()=>{const a=(0,L.EH)((()=>{e.isAllReady&&t.finishImportLoadingFinishIfNeeded()}));return()=>{a()}}),[]),t}(e),a=new P.l,l=new ae({itemType:F.Ab.LocalEffects}),i=(0,D.G)({watch:()=>o.isAllUploaded}),o=(0,I.fv)((()=>({uploadConfigService:new A.w,formApi:null,setFormApi:e=>{o.formApi=e},isPublishing:!1,sendLogServ:l,authorSignService:new q.I({signScene:W.d.BusinessArtist}),authFileUploadServiceManager:new z.r({}),performanceTimingCollector:(0,G.uY)(),setIsPublishing:(0,L.aD)((e=>o.isPublishing=e)),mainFormLayoutAfterLoading:"uploadArea",startPublishTime:0,get mainFormLayout(){return t.isImportLoading?"loading":"uploadArea"===o.mainFormLayoutAfterLoading&&S.appModel.isInitFailed?"error":0===o.materialListStore.materialList.length?"uploadArea":o.mainFormLayoutAfterLoading},pubServ:new O,get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1}},get maxTotalCount(){return 10},get isImportDisabled(){return e.materialList.length>=10},get needConfirmModalOnClose(){return e.materialList.length>0},materialListStore:e,importLoadingStore:t,getImportMinMaxCount(){const t=e.materialList.length;return{minCount:1,maxCount:Math.max(0,o.maxTotalCount-t),maxTotalCount:o.maxTotalCount}},get isAllReadyPublish(){return e.materialList.length&&e.isReadyToPublish},handleLoading(){o.materialListStore.materialList.length&&"uploadArea"===o.mainFormLayoutAfterLoading&&(t.showImportLoading(),o.mainFormLayoutAfterLoading="mainForm")},openEffectPicker(){a.lock(v,(async()=>{l.sendUploadActionLog(o),await e.openEffectPicker({...o.getImportMinMaxCount()}),o.handleLoading()}))},uploadDroppedEffectFiles(){a.lock(v,(async()=>{l.sendUploadActionLog(o),await e.uploadDroppedEffectFiles({...o.getImportMinMaxCount()}),o.handleLoading()}))},reimport(t){a.lock(v,(async()=>{await e.reimportEffectFilePicker({...o.getImportMinMaxCount(),oldId:t.payload.localId}),o.handleLoading()}))},get isAllUploaded(){const{pending:e,failed:t}=o.materialListStore.uploadStats;return!e&&!t},sendUploadProgressModalShowErrorLog(){const e=o.materialListStore.materialList.filter((e=>"UploadFailed"===e.payload.failedType)).map((e=>({error_report:e.payload.error})));l.sendMaterialPublishErrorLog(e)},async retryUpload(){const e=o.materialListStore.materialList.filter((e=>"UploadFailed"===e.payload.failedType));return o.materialListStore.retryUpload(e)},isAllUploadedWatcher:i,asyncFormData(){var t;const a=null===(t=o.formApi)||void 0===t?void 0:t.getValues(),l=o.materialListStore.selectedMaterial;l&&a&&e.updateFormState(l,{is_vip:a.is_vip||!1,common_data:{...l.common_data,title:a.common_data.title||"",description:a.common_data.description,post_channel:a.common_data.post_channel,tags:a.common_data.tags||[],is_original:a.common_data.is_original||!1,is_business:a.common_data.is_business||!1}})},async uploadAndPublish(t){this.startPublishTime=performance.now(),o.asyncFormData(),l.sendPageActionLog({action:"publish",material_cnt:e.materialList.length}),o.isAllUploaded||(await o.retryUpload(),await K.uploadEffectCoverImage({ids:e.materialList.map((e=>e.payload.localId))}),null==t||t.show(),await o.isAllUploadedWatcher.start());try{await o.publishImpl()}finally{null==t||t.hide()}},async publishImpl(){try{o.setIsPublishing(!0);const t=e.materialList.map((e=>{const t=(0,B.pn)({isVip:e.is_vip,isBusiness:e.common_data.is_business,authFiles:o.authFileUploadServiceManager.getUploadedFiles(e.payload.localId)}),{categoryId:a,targetedActivityId:i,duration:r}=e.payload,{post_channel:n}=e.common_data;return{id:e.payload.localId,req:{...(0,x.Z)(e,["payload"]),...t.root,common_data:{...e.common_data,...t.commonData,post_channel:n===U.iu.Targeted?`${U.iu.Targeted}_${i}`:n,web_extra:JSON.stringify({choose_category_id:[a],targeted_id:i})},biz_extra:JSON.stringify({effect_duration:r})},onResult:a=>{l.sendMaterialPublishLog({publishResult:a,effect:{...e,...t.root},logPrefix:"[SingleStore]"})}}}));(0,j.c6)("[SingleStore] effects publish start",{ids:t.map((e=>e.id))});const a=(await o.pubServ.batchPublish(t)).map((e=>e.resource_id));(0,j.c6)("[SingleStore] effects publish done",{resourceIdList:a}),this.sendLogServ.sendMaterialPublishPageResultLog({status:"success",time:Math.round(performance.now()-this.startPublishTime),material_cnt:a.length,material_id:a.join(",")}),await o.pubServ.pollUntilAllInEffectList({ids:a.slice(-10),types:[F.Ab.Special,F.Ab.FaceSpecial,F.Ab.VideoAnimation,F.Ab.Transition]}),(0,j.c6)("[SingleStore] effects poll done"),w.FN.success(p.I18n.t("pc_filter_release_successful")),(0,V.ZM)({effect_type:F.Ab.Special}),setTimeout((()=>(0,V.Nt)({item_type:F.Ab.Special})),1e3)}catch(a){var t;this.sendLogServ.sendMaterialPublishPageResultLog({status:"fail",error_type:null!==(t=null==a?void 0:a.message)&&void 0!==t?t:`publish error: ${JSON.stringify(a)}`,time:Math.round(performance.now()-this.startPublishTime),material_cnt:e.materialList.length,material_id:""}),w.FN.error(p.I18n.t("pc_sticker_release_failed_retry_web")),(0,j.RF)("Effects [SingleStore] publish fail",a)}finally{o.setIsPublishing(!1)}},handleEffectFileProcessResult(t){const a=e.getMaterial(t.id);if(a){if(t.type===J.Thumbnail){if(!(t.temporaryId===a.payload.temporary[J.Thumbnail]))return}if("Success"===t.result)switch(t.type){case J.Thumbnail:const{base64:l}=t;e.updateFormState(a,{payload:{...a.payload,thumbImg:`data:;base64,${l}`}});break;case J.UploadEffect:e.updateUploadResp(a,{fileUri:t.uri});break;case J.UploadCover:e.updateUploadResp(a,{imgUri:t.uri});break;default:return}else switch(t.type){case J.Thumbnail:e.updateFormState(a,{payload:{...a.payload,failedType:"updateCoverFailed"}});break;case J.UploadEffect:case J.UploadCover:e.updateFormState(a,{payload:{...a.payload,failedType:"UploadFailed"}});break;default:return}t.type===J.Thumbnail&&e.updateFormState(a,{payload:{...a.payload,coverUpdating:!1}})}}})));return(0,Y.u)({watch:()=>o.needConfirmModalOnClose}),(0,m.useEffect)((()=>{window.store=o,window.toJS=L.ZN;const e=K.registerEffectFileProcessResultEvent(o.handleEffectFileProcessResult);return o.authorSignService.init(),o.performanceTimingCollector.addRenderTiming(G.Pk),()=>{e(),t.destroy()}}),[]),o}const ie=(0,m.createContext)(null),oe=()=>(0,m.useContext)(ie);var re=a(11527);const ne=(0,l.Pi)((({className:e})=>{var t,a;const l=function(){const{t:e}=(0,i.$)(),t={link:{text:e("cc_pc_material_visual_effect_publish_guidance_linked_web"),src:"https://bytedance.sg.larkoffice.com/docx/LfCWds6fLoPI3PxTpxJl9iA4gsT?open_in_browser=true"}};return(0,m.useMemo)((()=>{return[{key:d.File,title:e("cc_pc_material_visual_effect_publish_guidance_web"),...t,instructions:(a=d.File,Object.entries(g[a]).map((([e,t])=>({key:e,title:t}))))}];var a}),[])}(),o=oe(),r=o.materialListStore.selectedMaterial;return(0,re.jsx)(n.v,{className:e,groups:l,initGroup:d.File,activeGroup:d.File,resetExpandedGroupKey:null!==(t=null==r||null===(a=r.payload)||void 0===a?void 0:a.localId)&&void 0!==t?t:null,getStatus:e=>{var t;return r?null!==(t=r.payload)&&void 0!==t&&null!==(t=t.unmetRequirements)&&void 0!==t&&t.includes(e.key)?"error":"success":"init"},onClickGroupLink:()=>{o.sendLogServ.sendPageActionLog({action:"click_doc_guide"})}})}));var se=a(38803),ce=a(36775);const de=(0,l.Pi)((({className:e})=>{const t=oe(),{t:a}=(0,i.$)(),l=(0,m.useRef)(null),o=(0,m.useMemo)((()=>t.materialListStore.materialList.length),[t.materialListStore.materialList]),r=(0,m.useMemo)((()=>t.isAllReadyPublish),[t.isAllReadyPublish]);return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(se.Z,{className:e,leftText:a("pc_sticker_import_zero_to_hundred_web",{X:o,Y:t.maxTotalCount}),isPublishDisabled:!r,isPublishing:t.isPublishing,needConfirmModalOnClose:t.needConfirmModalOnClose,onPublish:()=>t.uploadAndPublish(l.current),onCancel:()=>{(0,V.Nt)(),t.sendLogServ.sendPageActionLog({action:"cancel"})}}),(0,re.jsx)(ce.q,{ref:l,uploadStats:t.materialListStore.uploadStats,onRetryUpload:t.retryUpload,onCancel:()=>{t.isAllUploadedWatcher.stop(),t.sendLogServ.sendMaterialPublishPageResultLog({status:"cancel",time:Math.round(performance.now()-t.startPublishTime),material_cnt:t.materialListStore.materialList.length,material_id:""})},onShowUploadFail:t.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:t.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var me,ue,pe,fe,_e,ge=a(12390),he=a(82725),ve=a(84875),ye=a.n(ve),be=a(74474);function Ce(){return Ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},Ce.apply(this,arguments)}const xe=e=>m.createElement("svg",Ce({xmlns:"http://www.w3.org/2000/svg",width:30,height:30,fill:"none",viewBox:"0 0 30 30"},e),me||(me=m.createElement("path",{stroke:"#CCC",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 23.5H7.5a1 1 0 0 1-1-1v-15a1 1 0 0 1 1-1h15a1 1 0 0 1 1 1V15"})),ue||(ue=m.createElement("path",{fill:"#CCC",fillRule:"evenodd",d:"M17.8 11.457a2 2 0 0 0 1.513-2.942 2 2 0 1 1-1.513 2.943Z",clipRule:"evenodd"})),pe||(pe=m.createElement("path",{fill:"#CCC",d:"M14.358 15.392a.764.764 0 0 1 .99-.991l1.381.508a.78.78 0 0 0 .742-.103l1.137-.858c.521-.393 1.29.01 1.287.675l-.004 1.452a.83.83 0 0 0 .355.678l1.212.85c.555.39.438 1.23-.195 1.409l-1.384.388a.75.75 0 0 0-.522.522l-.388 1.383c-.178.634-1.02.75-1.409.196l-.85-1.212a.83.83 0 0 0-.678-.355l-1.452.005c-.665.002-1.068-.767-.675-1.288l.858-1.137a.78.78 0 0 0 .103-.742l-.508-1.38Z"})),fe||(fe=m.createElement("rect",{width:2,height:4,x:20.186,y:21.643,fill:"#CCC",rx:1,transform:"rotate(-45 20.186 21.643)"})),_e||(_e=m.createElement("path",{stroke:"#CCC",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6.5 18.67 11 14l1.5 1"})));var Ie,Le,we,Se,Ze,Ee;function Ae(){return Ae=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},Ae.apply(this,arguments)}const Pe=e=>m.createElement("svg",Ae({xmlns:"http://www.w3.org/2000/svg",width:30,height:30,fill:"none",viewBox:"0 0 30 30"},e),Ie||(Ie=m.createElement("path",{stroke:"#fff",strokeOpacity:.8,strokeWidth:1.5,d:"M7.886 9.4a4.163 4.163 0 0 0-1.038 3.853l1.086 4.507a7.75 7.75 0 1 0 15.069-3.632l-1.087-4.507a4.163 4.163 0 0 0-2.679-2.957l-.394-.137A10.148 10.148 0 0 0 8.174 9.1l-.288.301Z"})),Le||(Le=m.createElement("mask",{id:"faceSpecial_svg__a",fill:"#fff"},m.createElement("path",{fillRule:"evenodd",d:"M11.067 14.184a.586.586 0 0 1-.195-.807l.49-.8a.235.235 0 0 0-.078-.323l-.8-.49a.586.586 0 0 1 .612-1l1.5.918c.277.169.364.53.195.806l-.918 1.501a.586.586 0 0 1-.806.194Z",clipRule:"evenodd"}),m.createElement("path",{d:"M15.994 9.483a.352.352 0 0 1 .616-.149l.408.5c.075.091.19.14.308.127l.641-.066a.352.352 0 0 1 .332.54l-.349.542a.352.352 0 0 0-.026.333l.261.59a.352.352 0 0 1-.411.482l-.623-.164a.352.352 0 0 0-.325.078l-.48.43a.352.352 0 0 1-.586-.242l-.036-.643a.352.352 0 0 0-.175-.285l-.557-.323a.352.352 0 0 1 .049-.633l.6-.233a.352.352 0 0 0 .217-.254l.136-.63Z"}),m.createElement("path",{fillRule:"evenodd",d:"M12.957 17.222c-.238-.01-.421.208-.323.424a2.1 2.1 0 0 0 1.078 1.056 3.92 3.92 0 0 0 4.551-1.096 2.1 2.1 0 0 0 .48-1.432c-.012-.237-.274-.347-.481-.23a9.932 9.932 0 0 1-5.305 1.278Zm-.777-1.206a.867.867 0 0 0-.903.9 3.266 3.266 0 0 0 1.971 2.864 5.093 5.093 0 0 0 5.92-1.427c.797-.965.976-2.31.45-3.447a.867.867 0 0 0-1.214-.39l-.72.407a8.76 8.76 0 0 1-4.678 1.127l-.826-.034Z",clipRule:"evenodd"}))),we||(we=m.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M11.067 14.184a.586.586 0 0 1-.195-.807l.49-.8a.235.235 0 0 0-.078-.323l-.8-.49a.586.586 0 0 1 .612-1l1.5.918c.277.169.364.53.195.806l-.918 1.501a.586.586 0 0 1-.806.194Z",clipRule:"evenodd"})),Se||(Se=m.createElement("path",{fill:"#fff",d:"M15.994 9.483a.352.352 0 0 1 .616-.149l.408.5c.075.091.19.14.308.127l.641-.066a.352.352 0 0 1 .332.54l-.349.542a.352.352 0 0 0-.026.333l.261.59a.352.352 0 0 1-.411.482l-.623-.164a.352.352 0 0 0-.325.078l-.48.43a.352.352 0 0 1-.586-.242l-.036-.643a.352.352 0 0 0-.175-.285l-.557-.323a.352.352 0 0 1 .049-.633l.6-.233a.352.352 0 0 0 .217-.254l.136-.63Z"})),Ze||(Ze=m.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M12.957 17.222c-.238-.01-.421.208-.323.424a2.1 2.1 0 0 0 1.078 1.056 3.92 3.92 0 0 0 4.551-1.096 2.1 2.1 0 0 0 .48-1.432c-.012-.237-.274-.347-.481-.23a9.932 9.932 0 0 1-5.305 1.278Zm-.777-1.206a.867.867 0 0 0-.903.9 3.266 3.266 0 0 0 1.971 2.864 5.093 5.093 0 0 0 5.92-1.427c.797-.965.976-2.31.45-3.447a.867.867 0 0 0-1.214-.39l-.72.407a8.76 8.76 0 0 1-4.678 1.127l-.826-.034Z",clipRule:"evenodd"})),Ee||(Ee=m.createElement("path",{fill:"#fff",fillOpacity:.8,d:"m10.872 13.377.853.522-.853-.522Zm-.388-1.612.521-.854-.521.854Zm.612-1.001-.522.853.522-.853Zm1.5.918-.521.853.522-.853Zm.195.806.853.522-.853-.522Zm-.918 1.501-.853-.522.853.522Zm-.511-1.412-.853-.522.853.522Zm-.078-.323-.522.853.522-.853Zm4.358-1.887-.362-.932.362.932Zm.216-.254-.977-.21.977.21Zm-.866 1.12-.502.865.502-.865Zm.049-.633.362.932-.362-.932Zm.683 1.24.998-.055-.998.056Zm-.175-.284.502-.865-.502.865Zm.797 1.17.668.745-.668-.745Zm-.586-.242-.998.056.998-.056Zm1.39-.266.256-.967-.255.967Zm-.324.078-.668-.744.668.744Zm1.36-.397.914-.404-.915.404Zm-.412.483-.255.967.255-.967Zm.176-1.405.841.542-.84-.542Zm-.026.333-.914.405.914-.405Zm.043-1.415.103.995-.103-.995Zm.332.54-.84-.541.84.541Zm-1.281-.602-.775.633.775-.633Zm.308.128-.102-.995.102.995Zm-.716-.627.775-.632-.775.632Zm-.616.149.977.21-.977-.21Zm-2.282 9.22.396-.919-.396.919Zm4.551-1.097-.77-.637.77.637Zm-.001-1.662.492.87-.492-.87Zm-5.305 1.278.041-.999-.041 1Zm-1.68-.306-1 .04 1-.04Zm.903-.9.042-1-.042 1Zm1.068 3.764-.396.918.396-.918Zm5.92-1.427.77.637-.77-.637Zm.45-3.447-.908.42.908-.42Zm-1.214-.39.492.87-.492-.87Zm-.72.407-.492-.87.492.87Zm-4.678 1.127-.042 1 .042-1Zm5.736.124-.999.045 1-.045Zm-6.108 1.472.91-.415-.91.415Zm-2.615-4.79a1.586 1.586 0 0 0 .526 2.18l1.043-1.706c.195.12.257.374.137.569l-1.706-1.043Zm.49-.801-.49.8 1.706 1.044.49-.8-1.706-1.044Zm-.547.563.8.49 1.044-1.707-.8-.49-1.044 1.707Zm-.526-2.181a1.586 1.586 0 0 0 .526 2.18l1.043-1.706c.195.12.257.374.137.57l-1.706-1.044Zm2.181-.526a1.586 1.586 0 0 0-2.18.526l1.706 1.043a.414.414 0 0 1-.57.137l1.044-1.706Zm1.501.918-1.5-.918-1.044 1.706 1.5.918 1.044-1.706Zm.526 2.181a1.586 1.586 0 0 0-.526-2.181l-1.043 1.706a.414.414 0 0 1-.137-.569l1.706 1.044Zm-.918 1.501.918-1.501-1.706-1.043-.918 1.5 1.706 1.044Zm-2.181.526a1.586 1.586 0 0 0 2.181-.526l-1.706-1.043a.413.413 0 0 1 .568-.138l-1.043 1.707Zm1.67-1.939a1.235 1.235 0 0 0-.41-1.697l-1.043 1.706a.765.765 0 0 1-.253-1.052l1.706 1.043Zm3.62-3.132.408.5 1.55-1.265-.408-.499-1.55 1.264Zm1.594.99.641-.066-.205-1.99-.641.066.205 1.99Zm.03-1.062-.35.542 1.682 1.083.349-.542-1.681-1.083Zm-.449 1.821.261.59 1.829-.81-.261-.59-1.829.81Zm1.02-.3-.624-.164-.51 1.934.623.164.51-1.934Zm-1.872.137-.48.43 1.336 1.489.48-.43-1.336-1.49Zm.6.876-.036-.643-1.997.112.037.643 1.997-.112Zm-.707-1.737-.558-.323-1.003 1.73.557.323 1.004-1.73Zm-.648.841.6-.233-.723-1.864-.6.233.723 1.864Zm1.433-1.21.135-.63-1.955-.419-.135.63 1.955.42Zm-.833.977c.425-.164.738-.531.833-.976l-1.955-.42a.648.648 0 0 1 .399-.468l.723 1.864Zm-.51-.931a.648.648 0 0 1-.09 1.164l-.724-1.864c-1.057.41-1.17 1.86-.189 2.43l1.003-1.73Zm1.23 1.417a1.352 1.352 0 0 0-.672-1.094l-1.003 1.73a.648.648 0 0 1-.322-.524l1.996-.112Zm-1.044.197a.648.648 0 0 1 1.08.446l-1.997.112c.063 1.132 1.408 1.688 2.252.93l-1.335-1.488Zm1.727-.731a1.352 1.352 0 0 0-1.248.3l1.336 1.49a.648.648 0 0 1-.599.143l.511-1.933Zm-.135 1.053a.648.648 0 0 1 .758-.889l-.51 1.934c1.096.29 2.04-.818 1.58-1.854l-1.828.81Zm-.161-1.868a1.352 1.352 0 0 0-.1 1.28l1.829-.81c.088.199.07.43-.048.613l-1.681-1.083Zm.96.454a.648.648 0 0 1-.611-.996l1.681 1.083c.614-.953-.147-2.193-1.275-2.077l.205 1.99Zm-1.827-.424c.288.352.733.536 1.186.49l-.205-1.99a.648.648 0 0 1 .569.235l-1.55 1.265Zm1.142-1.764c-.717-.879-2.131-.538-2.37.571l1.956.42a.648.648 0 0 1-1.136.273l1.55-1.264Zm-3.277 9.082a1.1 1.1 0 0 1-.564-.553l-1.82.83a3.1 3.1 0 0 0 1.592 1.56l.792-1.837Zm3.385-.815a2.92 2.92 0 0 1-3.385.815l-.792 1.837a4.92 4.92 0 0 0 5.718-1.378l-1.541-1.274Zm.25-.75a1.1 1.1 0 0 1-.25.75l1.541 1.274a3.1 3.1 0 0 0 .707-2.113l-1.998.09Zm-4.828 2.002c2.04.086 4.062-.402 5.84-1.407l-.986-1.74a8.932 8.932 0 0 1-4.77 1.15l-.084 1.997Zm-.639-1.344a.133.133 0 0 1-.138.138l.084-1.998a1.867 1.867 0 0 0-1.944 1.938l1.998-.078Zm1.368 1.984a2.266 2.266 0 0 1-1.368-1.984l-1.998.078a4.266 4.266 0 0 0 2.574 3.743l.792-1.837Zm4.753-1.145a4.092 4.092 0 0 1-4.753 1.145l-.792 1.837a6.092 6.092 0 0 0 7.086-1.708l-1.541-1.274Zm.313-2.39a2.266 2.266 0 0 1-.313 2.39l1.541 1.274a4.266 4.266 0 0 0 .587-4.504l-1.815.84Zm.186.06a.133.133 0 0 1-.186-.06l1.815-.84a1.867 1.867 0 0 0-2.614-.84l.985 1.74Zm-.72.407.72-.407-.985-1.74-.72.406.986 1.741Zm-5.212 1.256a9.758 9.758 0 0 0 5.213-1.256l-.985-1.74a7.758 7.758 0 0 1-4.145.998l-.083 1.998Zm-.826-.034.826.034.083-1.998-.825-.034-.084 1.998Zm7.603-.886a1.28 1.28 0 0 0-.748-1.112 1.346 1.346 0 0 0-1.224.056l.985 1.741a.654.654 0 0 1-.596.021.72.72 0 0 1-.415-.616l1.998-.09Zm-6.197 1.102a.72.72 0 0 1-.09.738.654.654 0 0 1-.54.252L13 16.223a1.346 1.346 0 0 0-1.115.507 1.28 1.28 0 0 0-.16 1.331l1.82-.83Z",mask:"url(#faceSpecial_svg__a)"})));a.p;var Fe;function Me(){return Me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},Me.apply(this,arguments)}const Te=e=>m.createElement("svg",Me({xmlns:"http://www.w3.org/2000/svg",width:30,height:30,fill:"none",viewBox:"0 0 30 30"},e),Fe||(Fe=m.createElement("path",{fill:"#fff",fillOpacity:.8,fillRule:"evenodd",d:"M7.5 8.5h14.3v13.282H7.5V8.5ZM6 7h17.3v16.282H6V7Zm10.655 8-2.905 1.756v-3.512L16.655 15Zm-3.544-3.75a.862.862 0 0 0-.861.862v5.776a.863.863 0 0 0 1.307.738l4.777-2.888a.862.862 0 0 0 0-1.476l-4.777-2.888a.86.86 0 0 0-.446-.124Z",clipRule:"evenodd"})));var ke;function Ne(){return Ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},Ne.apply(this,arguments)}const je=e=>m.createElement("svg",Ne({xmlns:"http://www.w3.org/2000/svg",width:30,height:30,fill:"none",viewBox:"0 0 30 30"},e),ke||(ke=m.createElement("path",{stroke:"#D4D4D4",strokeLinejoin:"bevel",strokeWidth:1.6,d:"M7 21.625 24 7v14.625L7 7v14.625Z",clipRule:"evenodd"})));var Ue=a(36983),Re=a(96426),Oe=a(85083),qe=a(88623),ze=a(82346),Be=a(84997),De=a(40699),Ve=a(96305);const $e=e=>{const{className:t,loadingText:a}=e,{t:l}=(0,i.$)(),{handleMouseEnter:o}=(0,Be.S)();return(0,re.jsxs)("div",{className:ye()(Ve.Z.root,t),children:[(0,re.jsx)(ze.a,{className:Ve.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,re.jsx)("div",{className:Ve.Z.text,onMouseEnter:o,children:a||l("pc_stickers_release_in_web")})]})},Je=e=>{const{className:t,tooltip:a}=e,{t:l}=(0,i.$)(),{handleMouseEnter:o}=(0,Be.w)({content:a,className:Ve.Z.tooltip}),r=(0,m.useRef)(null),{setIsMarqueeLoopRunning:n,reactNode:s}=(0,De.J)({text:l("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>r.current});return(0,re.jsxs)("div",{className:ye()(Ve.Z.root,t,Ve.Z.error),onMouseEnter:e=>{n(!0),o(e)},onMouseLeave:()=>n(!1),children:[(0,re.jsx)(Re.r,{className:Ve.Z.icon}),(0,re.jsx)("div",{ref:r,className:Ve.Z.text,children:s})]})},We=e=>{const{className:t,text:a}=e,{handleMouseEnter:l}=(0,Be.S)();return(0,re.jsxs)("div",{className:ye()(Ve.Z.root,t,Ve.Z.checked),children:[(0,re.jsx)(qe.r,{className:Ve.Z.icon}),(0,re.jsx)("div",{className:Ve.Z.text,onMouseEnter:l,children:a})]})},Ye=e=>{const{className:t}=e,{t:a}=(0,i.$)(),{handleMouseEnter:l}=(0,Be.S)();return(0,re.jsxs)("div",{className:ye()(Ve.Z.root,t),children:[(0,re.jsx)("div",{className:ye()(Ve.Z.icon,Ve.Z.yellowIcon),children:(0,re.jsx)("div",{className:Ve.Z.yellowPoint})}),(0,re.jsx)("div",{className:Ve.Z.text,onMouseEnter:l,children:a("pc_stickers_release_editing_web")}),(0,re.jsx)(Oe.r,{className:Ve.Z.icon})]})},Ge=e=>{const{className:t,loading:a,invalid:l,errorToolip:i,isInfoComplete:o,title:r,loadingText:n}=e;return a?(0,re.jsx)($e,{className:t,loadingText:n}):l?(0,re.jsx)(Je,{className:t,tooltip:i}):o?(0,re.jsx)(We,{className:t,text:r}):(0,re.jsx)(Ye,{className:t})};var He=a(503),Xe=a(79679);const Ke="root-dTVjo3",Qe="statusBar-s3NSaI",et="contextMenuItem-AyAlEH",tt="coverIcon-_65uTe",at=(0,l.Pi)((({className:e,material:t,isSelected:a,onClick:l,onReimport:o,onRemove:r,effectType:n,isInfoComplete:s,onRetryUpdateCover:c})=>{var m;const{t:u}=(0,i.$)(),{common_data:p}=t,{coverUpdating:f}=t.payload,_=t.payload.thumbImg,h=Boolean(null===(m=t.payload)||void 0===m||null===(m=m.unmetRequirements)||void 0===m?void 0:m.length),v="updateCoverFailed"===t.payload.failedType,y=h||v,{handleContextMenu:b}=(0,Xe.D)({content:(0,re.jsx)(He.m,{items:[{key:"retryUpdateCover",render:({key:e,className:a})=>Boolean(v)&&(0,re.jsx)("div",{className:ye()(a,et),onClick:()=>c(t),children:u("cc_pc_material_visual_effect_publish_cover_retry_web")},e)},{key:"reimport",render:({key:e,className:a})=>Boolean(y)&&(0,re.jsx)("div",{className:ye()(a,et),onClick:()=>o(t),children:u("pc_stickers_release_again_web")},e)},{key:"remove",render:({key:e,className:a})=>(0,re.jsx)("div",{className:ye()(a,et),onClick:()=>r(t),children:u("pc_stickers_release_delete_web")},e)}]})});return(0,re.jsxs)("div",{className:ye()(e,Ke),onClick:()=>{var e;l(null===(e=t.payload)||void 0===e?void 0:e.localId)},children:[(0,re.jsx)(Ue.Y,{src:f?"":t.payload.thumbImg,customRenderIcon:(()=>{if(!_&&!f)return()=>{switch(n){case F.Ab.Special:return(0,re.jsx)(xe,{className:tt});case F.Ab.FaceSpecial:return(0,re.jsx)(Pe,{className:tt});case F.Ab.VideoAnimation:return(0,re.jsx)(Te,{className:tt});case F.Ab.Transition:return(0,re.jsx)(je,{className:tt});default:return null}}})(),isSelected:a,isInvalid:Boolean(y),size:80,onContextMenu:e=>{var a;b(e),l(null===(a=t.payload)||void 0===a?void 0:a.localId)}}),(0,re.jsx)(Ge,{className:Qe,loading:f,loadingText:u("cc_pc_material_visual_effect_publish_cover_fail_updating_web"),invalid:y,errorToolip:h?null===(C=t.payload)||void 0===C||null===(C=C.unmetRequirements)||void 0===C?void 0:C.map((e=>{const t=g[d.File][e];return t?(0,re.jsx)("div",{children:t},e):null})):v?u("cc_pc_material_visual_effect_publish_cover_fail_web"):null,isInfoComplete:s,title:p.title})]});var C})),lt="root-tZNHZs",it="container-x9pyNI",ot="cardDragWrapper-szN40I",rt="card-DcrvQZ",nt="hover-right-YTbO59",st="hover-left-C7z4sq",ct=(0,l.Pi)((()=>{const e=oe(),{materialListStore:t}=e,a=(0,m.useCallback)((e=>{t.selectedId!==e.payload.localId&&t.selectMaterial(e.payload.localId)}),[t.selectMaterial]),l=(0,m.useCallback)(((a,l)=>{var i;return(0,re.jsx)(at,{className:ye()(rt,{[nt]:"right"===l,[st]:"left"===l}),material:a,onClick:e.materialListStore.selectMaterial,isSelected:e.materialListStore.selectedId===a.payload.localId,onRemove:e.materialListStore.removeMaterial,onReimport:e.reimport,effectType:a.effect_type,isInfoComplete:t.getIsInfoComplete(a),onRetryUpdateCover:t.retryUpdateCover},null===(i=a.payload)||void 0===i?void 0:i.localId)}),[e.reimport,e.materialListStore.selectMaterial,e.materialListStore.removeMaterial,e.materialListStore.selectedId]);return(0,re.jsx)("div",{className:lt,children:(0,re.jsx)("div",{className:it,children:(0,re.jsx)(be.y,{list:t.materialList,renderCard:l,onMoveCard:t.dragInsert,className:ot,getId:e=>e.payload.localId,scrollAreaRef:e.materialListStore.scrollAreaRef,onCardClick:a})})})}));var dt=a(73622),mt=a(26800),ut=a(86439),pt=a(16743);const ft="textarea-LCPYTj",_t=e=>{var t;const a=(0,m.useRef)(!1),[l,i]=(0,m.useState)(""),{allowEnter:o=!0,value:r,...n}=e,{className:s,maxLength:c,onChange:d,onCompositionEnd:u,onCompositionStart:p}=n,f=a.current?l:r,_=(0,mt.Z)((e=>{const t=e||"";return o?t:t.replace(/\n/g,"")})),g=(0,mt.Z)((e=>{const t=_(e);return void 0!==c?(0,ut.aF)(t,c):t})),h=(0,mt.Z)((e=>{a.current=!0,i(e.currentTarget.value),null==p||p(e)})),v=(0,m.useRef)(null),{saveSelectionIfNeeded:y}=(0,pt.u)({getInputElem:()=>v.current}),b=(0,mt.Z)(((e,t)=>{y(e),null==d||d(e,t)})),C=(0,mt.Z)((e=>{const t=g(e.currentTarget.value);a.current=!1,i(t),b(t,e),null==u||u(e)})),x=(0,mt.Z)(((e,t)=>{const l=_(e);if(a.current)return void i(l);if(void 0===c)return void b(l,t);const o=g(l);b(o,t)})),I=(0,m.useMemo)((()=>({maxRows:3})),[]);return(0,re.jsx)(w.Kx,{autoComplete:"off",...n,ref:v,value:f,className:ye()(s,ft),maxLength:void 0,autosize:null!==(t=n.autosize)&&void 0!==t?t:I,rows:1,onChange:x,onCompositionStart:h,onCompositionEnd:C})},gt=(0,w.Q2)(_t);a(74408);var ht=a(14590),vt=a(45033);const yt="authGroup-Yuaspf";var bt=a(40249);const Ct=e=>{const{t}=(0,i.$)(),{className:a,boxClassName:l,title:o,children:r,onClickUseAll:n,hiddenFieldLabel:s=!1,required:c=!1}=e;return(0,re.jsxs)("div",{className:ye()(bt.Z.root,a),children:[!s&&(0,re.jsxs)("div",{className:bt.Z.fieldLabel,children:[(0,re.jsx)("div",{className:ye()({[bt.Z.showRequired]:c}),children:null!=o?o:t("pc_template_authorize_settings_web")}),n&&(0,re.jsx)("span",{className:bt.Z.useAll,onClick:n,children:t("pc_material_release_apply_all")})]}),(0,re.jsx)("div",{className:ye()(bt.Z.box,l),children:r})]})};var xt=a(2237),It=a(31686),Lt=a(95968),wt=a(89556),St=a(53237);const Zt="root-gQdqRP",Et="rootCategory-gHMpjw",At="secondCategoryWrapper-UM_jLd",Pt="secondCategory-t3M31B",Ft=e=>{const{value:t,onChange:a,categories:l,loading:o,effectType:r}=e,n=(0,m.useRef)(""),[s,c]=(0,wt.Z)(void 0,{dimension:"width"}),{handleMouseEnter:d}=(0,Be.w)({content:(0,re.jsx)("div",{children:n.current})}),{t:u}=(0,i.$)(),{handleMouseEnter:p}=(0,Be.S)();return(0,re.jsxs)("div",{className:Zt,children:[(0,re.jsx)("div",{className:Et,onMouseEnter:p,children:(()=>{switch(r){case F.Ab.Special:return u("cc_pc_material_visual_effect_type_video_effect_web");case F.Ab.FaceSpecial:return u("cc_pc_material_visual_effect_type_body_effect_web");case F.Ab.Transition:return u("cc_pc_material_visual_effect_type_transition_web");case F.Ab.VideoAnimation:return u("cc_pc_material_visual_effect_type_animation_web");default:return""}})()}),(0,re.jsx)("div",{className:At,ref:s,children:(0,re.jsx)(w.Ph,{value:t,loading:o,className:Pt,placeholder:u("cc_pc_material_visual_effect_type_category_web"),optionList:l.map(((e,t)=>({value:e.id,label:e.name,desc:e.desc,key:t,fadeInUrl:e.fade_in_url,fadeOutUrl:e.fade_out_url}))),renderOptionItem:t=>{const{label:l,desc:i,value:o,onClick:r,fadeInUrl:s,fadeOutUrl:m}=t,u=o===e.value;return(0,re.jsxs)("div",{className:"custom-select-option",onMouseEnter:e=>((e,t)=>{n.current=t,d(e)})(e,i),onClick:e=>{null==r||r(e),null==a||a({categoryId:o,categoryName:l,fadeInUrl:s,fadeOutUrl:m}),n.current=""},style:{maxWidth:c.width-12},children:[u&&(0,re.jsx)(St.r,{className:"checkedIcon"}),!u&&(0,re.jsx)("div",{className:"placeholder"}),l]})}})})]})},Mt="root-KVaL4a",Tt="coverWrapper-IJ2U5k",kt="box-l32ETe",Nt="img-UsMa71",jt="label-iZB0vG",Ut="useAll-euWGNE",Rt="initialCover-TMGtxi",Ot="coverDesc-c6sUQG",qt="titleLabel-DBP9RC",zt="titleName-aHymLh",Bt="titleIcon-kLKwkO",Dt="input-oQfVTZ",Vt="icon-WX0oFX",$t="publishDirectionUseAll-z6m7mf",{Label:Jt}=w.Form,Wt=(0,l.Pi)((({material:e,materialListStore:t,formApi:a,authProps:l,sendLogServ:o})=>{var r,n,s;const{t:c}=(0,i.$)(),{payload:d,effect_type:u}=e,{coverUpdating:p,categoryId:_,targetedActivityId:g}=d,{effectsPostConfigMap:h}=t,{authConfig:v,resourceCommonConfig:y}=h[e.effect_type],{mustPaidAuth:b}=v,C=y.maxTitleLen||f,{value:x}=(0,w.tL)("common_data.title"),{value:I}=(0,w.tL)("common_data.post_channel"),[L,S]=(0,m.useState)({}),[Z,E]=(0,m.useState)({});(0,m.useLayoutEffect)((()=>(null==a||a.reset(),null==a||a.setValues(e,{isOverride:!0}),()=>{const l=null==a?void 0:a.getValues();l&&t.updateFormState(e,{is_vip:l.is_vip||!1,common_data:{...e.common_data,title:l.common_data.title||"",post_channel:l.common_data.post_channel,description:l.common_data.description,tags:l.common_data.tags,is_original:l.common_data.is_original||!1,is_business:l.common_data.is_business||!1}})})),[e]),(0,m.useEffect)((()=>{L[u]||async function(e){return(await(0,U.ip)({effect_type:e})).tasks.map((e=>({label:e.title,value:e.task_id})))}(u).then((e=>{S((t=>({...t,[u]:e})))})),Z[u]||async function(e){return(await(0,U.kM)({effect_type:e})).categories}(u).then((e=>{E((t=>({...t,[u]:e})))}))}),[u]);const{getDisplayLength:A}=(0,vt._)(),P=(e,t)=>(0,re.jsxs)("div",{className:qt,children:[(0,re.jsx)("span",{className:zt,children:e}),(0,re.jsx)(w.u,{autoAdjustOverflow:!0,content:t,position:"right",showArrow:!1,trigger:"hover",children:(0,re.jsx)("span",{children:(0,re.jsx)(dt.r,{className:Bt})})})]});return(0,re.jsxs)("div",{className:Mt,children:[(0,re.jsx)("div",{className:Tt,children:(0,re.jsxs)("div",{className:kt,children:[p?(0,re.jsx)(xt.t,{className:Vt,iconWidth:28}):d.thumbImg?(0,re.jsx)("img",{className:Nt,src:d.thumbImg}):(0,re.jsx)("div",{className:Rt,children:c("cc_pc_material_visual_effect_publish_preview_note_web")}),(0,re.jsx)("div",{className:Ot,children:c("cc_pc_material_visual_effect_publish_preview_bottom_web")})]})}),(0,re.jsx)(gt,{fieldClassName:Dt,label:P(c("cc_pc_material_visual_effect_publish_name_web"),c("cc_pc_material_visual_effect_publish_name_hover_web")),field:"common_data.title",maxLength:C,placeholder:c("pc_stickers_release_xy_name_web",{X:1,Y:A(C)}),allowEnter:!1,rules:[{required:!0,message:""}],onChange:a=>((a,l)=>{t.updateFormState(e,{common_data:{...e.common_data,[l]:a}})})(a,"title")}),(0,re.jsxs)("div",{className:jt,children:[(0,re.jsx)(Jt,{required:!0,text:P(c("cc_pc_material_visual_effect_type_web"),c("cc_pc_material_visual_effect_type_hover_web"))}),(0,re.jsx)(Ft,{effectType:u,value:_,onChange:a=>{_?o.sendPageActionLog({action:"change_effect_category"}):o.sendPageActionLog({action:"choose_effect_category"}),e.payload.coverImgUrls={fadeInUrl:a.fadeInUrl,fadeOutUrl:a.fadeOutUrl},e.payload.categoryId=a.categoryId,e.payload.categoryName=a.categoryName,t.setEffectCoverImage(e)},categories:null!==(r=Z[u])&&void 0!==r?r:[],loading:!(null!==(n=Z[u])&&void 0!==n&&n.length)})]}),(0,re.jsxs)("div",{className:jt,children:[(0,re.jsx)(Lt.u,{fieldClassName:Dt,label:c("pc_stickers_release_tag_set_web"),placeholder:c("cc_pc_material_visual_effect_tag_grey_web"),max:10,field:"common_data.tags",onChange:l=>{const i={...e.common_data,tags:l};t.updateFormState(e,{common_data:i}),null==a||a.setValue("common_data",i)},itemType:u,recommendConfig:{title:x},rules:[{required:!0,message:""}],onRecentTagSelect:()=>{o.sendPageActionLog({action:"click_lastest_hashtag"})},disableRecommend:!0}),(0,re.jsx)("span",{className:Ut,onClick:()=>{o.sendPageActionLog({action:"apply_hashtag_to_all"});const e=null==a?void 0:a.getValues();e&&t.applyCommonDataToAll({tags:e.common_data.tags})},children:c("pc_material_release_apply_all")})]}),(0,re.jsxs)("div",{className:jt,children:[(0,re.jsx)(Jt,{required:!0,text:c("cc_pc_material_visual_effect_publish_creation_type_web")}),(0,re.jsx)(It.Z,{value:{postChannel:I,activityId:g},onChange:l=>{const i={...e.common_data,post_channel:l.postChannel};t.updateFormState(e,{common_data:i}),null==a||a.setValue("common_data",i),e.payload.targetedActivityId=l.activityId},taskList:L[u]||[],loading:!(null!==(s=L[u])&&void 0!==s&&s.length),viewMoreUrl:"https://bytedance.sg.larkoffice.com/docx/LFfKdQUOOogNLExPM4zl0nXGgsi?open_in_browser=true",onOrientationViewMoreClick:()=>{o.sendPageActionLog({action:"click_more_official_task"})}}),(0,re.jsx)("span",{className:$t,onClick:()=>{o.sendPageActionLog({action:"apply_publish_type_to_all"});const e=null==a?void 0:a.getValues();e&&(t.applyCommonDataToAll({post_channel:e.common_data.post_channel}),t.applyPayloadDataToAll({targetedActivityId:g}))},children:c("pc_material_release_apply_all")})]}),!1,l&&(0,re.jsx)(Ct,{onClickUseAll:()=>{o.sendPageActionLog({action:"authorize_apply_to_all "});const e=null==a?void 0:a.getValues();e&&t.applyAuthSettingsToAll({isVip:e.is_vip,isOriginal:e.common_data.is_original,isBusiness:e.common_data.is_business})},required:b,title:c("cc_pc_material_visual_effect_publish_authorization_web"),children:(0,re.jsx)("div",{className:yt,children:(0,re.jsx)(ht.R,{noLabel:!0,field:"is_vip",disabled:N.$.isEnableAuthorization,disabledTooltip:c("cc_pc_material_visual_effect_publish_authorized_hover_web"),tooltip:b?c("cc_pc_material_visual_effect_publish_authorize_hover_web"):"",sendLogService:o,onChange:l=>{l&&o.sendPageActionLog({action:"choose_subscription_authorize"}),t.updateFormState(e,{is_vip:l}),null==a||a.setValue("is_vip",l)}})})})]})})),Yt=(0,l.Pi)((({className:e})=>{const t=oe(),{t:a}=(0,i.$)(),l=(0,m.useCallback)((()=>t.materialListStore.selectedMaterial&&(0,re.jsx)(Wt,{material:t.materialListStore.selectedMaterial,materialListStore:t.materialListStore,formApi:t.formApi,authProps:(0,H.Z)(t,"authorSignService","authFileUploadServiceManager"),sendLogServ:t.sendLogServ})),[t.materialListStore.selectedMaterial,t.materialListStore,t.formApi]);return(0,o.pg)(t),(0,ge.O)({className:e,layout:t.mainFormLayout,uploadAreaProps:{titleForUploadArea:a("pc_sticker_release_drag_web"),titleForMainForm:a("pc_stickers_release_drag_in_web"),subTitle:a("cc_pc_material_visual_effect_publish_guidance_zip_web"),draggingTitle:a("pc_sticker_release_mouse_web"),disabled:t.isImportDisabled,disabledTooltip:"",onClick:t.openEffectPicker,onDrop:t.uploadDroppedEffectFiles},setFormApi:t.setFormApi,renderImportArea:e=>(0,re.jsxs)(re.Fragment,{children:[e,(0,re.jsx)(ct,{})]}),renderFormArea:l,scrollAreaRef:t.materialListStore.scrollAreaRef,onRetry:he.cb})}));var Gt=a(65546);const Ht="page-gReLnA",Xt="content-zqASBO",Kt="requirement-cAMPWF",Qt="mainForm-cORglw",ea="footer-rHRMuw",ta=(0,l.Pi)((()=>{const e=le(),{t}=(0,i.$)();return(0,r.F)({title:t("cc_pc_material_visual_effect_publish_title_web"),pid:"effects-publish-single"}),(0,Gt.d)(),(0,o.t9)(e.sendLogServ),(0,re.jsx)(ie.Provider,{value:e,children:(0,re.jsxs)("div",{className:Ht,children:[(0,re.jsxs)("div",{className:Xt,children:[(0,re.jsx)(ne,{className:Kt}),(0,re.jsx)(Yt,{className:Qt})]}),(0,re.jsx)(de,{className:ea})]})})}))},74235:(e,t,a)=>{a.d(t,{YB:()=>o,xB:()=>i});var l=a(86439);function i(e){const{len:t,i18n:a}=e,[l]=(a.language||"").split("-");return"zh"===l?Math.floor(t/2):t}function o(e,t){const a=e.split(/[\\/]/g).pop().replace(/\.\w+?$/g,"");return(0,l.aF)(a,null==t?void 0:t.maxLength)}}}]);