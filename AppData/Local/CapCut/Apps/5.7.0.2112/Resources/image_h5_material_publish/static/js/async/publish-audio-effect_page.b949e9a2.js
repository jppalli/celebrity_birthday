"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[829],{42983:(e,i,o)=>{o.d(i,{Ab:()=>a});let a=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({})},81441:(e,i,o)=>{o.r(i),o.d(i,{default:()=>li});var a=o(23479),l=o(45599),t=o(50959),s=o(9608),r=o(73224);let n=function(e){return e.File="file",e}({}),d=function(e){return e.Format="format",e.FileDuration="fileDuration",e.RecommendFileSize="RecommendFileSize",e}({});const c={[n.File]:{[d.Format]:r.I18n.t("pc_sound_form"),[d.FileDuration]:r.I18n.t("pc_filter_time_limit"),[d.RecommendFileSize]:r.I18n.t("pc_filter_file_size_ten_m")}},u=100,p=10485760,m="ImportAudio";var A=o(93639),f=o(61022),g=o(66589),v=o(84736),h=o(42983),F=o(54847),_=o(60251),y=o(97311),x=o(68954),b=o(17941),C=o(21919),L=o(74235),S=o(94435);const w=e=>{const{id:i,path:o,duration:a,size:l=0}=e,t=(0,y.lm)(o),s=[];["mp3","wav"].includes(t)||s.push(d.Format),l>p&&s.push(d.RecommendFileSize),a>60&&s.push(d.FileDuration);const r=(0,L.YB)(o,{maxLength:x.S8});return{effect_type:h.Ab.AudioEffect,common_data:{title:r,description:"",tags:[],source:S.r0.UserPostPc,is_original:!1,is_business:!1,web_extra:"",icon:{image_uri:"",width:200,height:200},file:{file_uri:"",file_md5:"",size:l}},is_vip:(0,b.K)(C.YW.OriginalForSubscription),payload:{hasEverSelected:!1,itemId:void 0,unmetRequirements:s,localId:i,path:o,fileBase64:"",isUploadFailed:!1,uploadFailedText:""},audio:{audio_id:"",duration:a}}};var I=o(39486),E=o(8129),k=o(31086),R=o(21130),U=o(57609),j=o(2514),P=o(67078),N=o(539),T=o(98052);const M=new class{async openAudioFilePicker(e){(0,E.c6)("[JSB] openAudioFilePicker req --\x3e",{...(0,A.Z)(e,["objectUploadConfig","imageUploadConfig","videoUploadConfig"])});const i=await(e=>T.Jn.call("openAudioFilePicker",e))(e);return(0,E.c6)("[JSB] openAudioFilePicker resp <--",i),i}async uploadDroppedAudioFiles(e){var i;(0,E.c6)("[JSB] uploadDroppedAudioFiles req --\x3e",{...(0,A.Z)(e,["objectUploadConfig","imageUploadConfig","videoUploadConfig"])});const o=await(e=>T.Jn.call("uploadDroppedAudioFiles",e))(e);return(0,E.c6)("[JSB] uploadDroppedAudioFiles resp <--",{imagesCount:null==o||null===(i=o.audios)||void 0===i?void 0:i.length}),o}registerAudioFileProcessResultEvent(e){return(e=>{const i=i=>{i.data&&e(i.data)};return T.Jn.on("audioFileProcessResult",i),()=>T.Jn.off("audioFileProcessResult",i)})((i=>{(0,E.c6)(`[JSB] audioFileProcessResult {${null==i?void 0:i.id}}`,i),e(i)}))}async cancelAudioUpload(e){(0,E.c6)("[JSB] cancelAudioUploadRequest req --\x3e",{...e}),await(e=>T.Jn.call("cancelAudioUpload",e))(e)}};var B=o(46309),D=o(3718),W=o(51654),V=o(18370);const z=(0,t.createContext)(null),O=()=>(0,t.useContext)(z);var Q=o(11527);const Y=(0,a.Pi)((({className:e})=>{var i,o;const{t:a}=(0,l.$)(),r=(0,t.useMemo)((()=>{return[{key:n.File,title:a("pc_sound_specification"),instructions:(e=n.File,Object.entries(c[e]).map((([e,i])=>({key:e,title:i}))))}];var e}),[]),d=O().selectedAudio;return(0,Q.jsx)(s.v,{className:e,groups:r,initGroup:n.File,activeGroup:n.File,resetExpandedGroupKey:null!==(i=null==d||null===(o=d.payload)||void 0===o?void 0:o.localId)&&void 0!==i?i:null,getStatus:e=>{var i;return d?null!==(i=d.payload)&&void 0!==i&&null!==(i=i.unmetRequirements)&&void 0!==i&&i.includes(e.key)?"error":"success":"init"}})}));var Z=o(38803),q=o(36775);const K=(0,a.Pi)((({className:e})=>{const i=O(),{t:o}=(0,l.$)(),a=(0,t.useRef)(null),s=(0,t.useMemo)((()=>i.audioList.length),[i.audioList]);return(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(Z.Z,{className:e,leftText:o("pc_sticker_import_zero_to_hundred_web",{X:s,Y:u}),isPublishDisabled:!i.isAllReadyPublish,isPublishing:i.isPublishing,needConfirmModalOnClose:i.needConfirmModalOnClose,onPublish:()=>i.uploadAndPublish(a.current),beforeCancel:()=>{var e;return null===(e=i.audioRef.current)||void 0===e?void 0:e.pause()}}),(0,Q.jsx)(q.q,{ref:a,uploadStats:i.uploadStats,onRetryUpload:i.retryUpload,onCancel:i.isAllUploadedWatcher.stop,onShowUploadFail:i.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:i.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var J=o(12390),G=o(82725),H=o(26800),$=o(84875),X=o.n($),ee=o(74474);var ie=o(36983),oe=o(69836),ae=o(503),le=o(79679);const te="root-l5vahz",se="statusBar-oVVULl",re="contextMenuItem-ELwi1D",ne=(0,a.Pi)((({className:e,audio:i,isSelected:o,onClick:a,onReimport:t,onRemove:s})=>{var r,d;const{t:u}=(0,l.$)(),{common_data:p,payload:m}=i,A=m.fileBase64,f=Boolean(null==m||null===(r=m.unmetRequirements)||void 0===r?void 0:r.length),g=Boolean(p.title&&(null===(d=p.tags)||void 0===d?void 0:d.length)),{handleContextMenu:v}=(0,le.D)({content:(0,Q.jsx)(ae.m,{items:[{key:"reimport",render:({key:e,className:o})=>Boolean(f)&&(0,Q.jsx)("div",{className:X()(o,re),onClick:()=>t(i),children:u("pc_material_release_import_again")},e)},{key:"remove",render:({key:e,className:o})=>(0,Q.jsx)("div",{className:X()(o,re),onClick:()=>s(i),children:u("pc_material_release_delete")},e)}]})});return(0,Q.jsxs)("div",{className:X()(e,te),onClick:()=>{a(i.payload.localId)},children:[(0,Q.jsx)(ie.Y,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAK/SURBVHgB7Z0xbhNBGIXfOiYQiAFRBNLQcQA4ABegRIIDpEWipKCloEWCMgegoEWihQPQE/oIOgMxEEzM/zwzhJDYsvOKnZXeJ72ss+vq0//PjFbr2Qb/MZlMzsbhfGQt0och+znDpml+/3uhKR9CHD9fjlyIfM85gCH9HLrZQxI54YWpwCzvKpKwrzwFcxL0RImU+YkSe/kCK28c+QLLmwfdfIuwjS/xRC+qbwVpzNuDWRRKXOd80cSfK0it+wNmGdjKB2zhVaT2NcvBgluzwNPDcbDfg5GwQBELFLFAEQsUsUARCxSxQBELFLFAEQsUsUARCxSxQBELFLFAEQsUsUARCxSxQBELFLFAEQsU6YLA25E3kceRa6iMLgi8ERlE7kReRLZQEV1q4buR90gCXyFVZut0SeBu5EnkUf5/HRXQxUd43+VUgWdhEQsUqamFb0buI826HO92Ii9ROTUI5GTwNHIL6QF3jm9c71EmZ9odVEwNArksobxnOFpxm5HnqGS5Mou2x8BSads43q5s4wdIVVktbQss1fV6xnVKrGbJchJtCxzk4+6c78y71jptCyztuTnnO5yVP6BS2hZYWvfejOscI9nmH1EpbQvkL344+3IieYijt6u4LuTdF7bwNiqFv1S6HsfPaJctHN6mojCuDQc4nIlrHQc3ahFIOA6yEstdlrc5NVOVwC6y4ZsJIhYoYoEiFihigSIWKGKBIhYoYoEiFihigSIWKGKBIhYoYoEiFihigSIWKGKBIhYoYoEiFihigSIUyN0rV2CWhc72KZAbbp+DWZYzkV8UOELaBrmBWZSyIfew1zTNT+R9kWEWhfJG4W5cJpEhUk9ToitxNnRzEenh/GE5MWUymW4Lz+3Ny67mY3h75AKLi/ME33BRXkYwfVHDsWoLkbRLkRwkV2EIC4mT7SgPeX/5A5B3gyFEXzzuAAAAAElFTkSuQmCC",isSelected:o,isInvalid:Boolean(f),size:80,onContextMenu:e=>{v(e),a(i.payload.localId)}}),(0,Q.jsx)(oe.ir,{className:se,loading:!A,invalid:f,errorToolip:f&&(null===(h=i.payload)||void 0===h||null===(h=h.unmetRequirements)||void 0===h?void 0:h.map((e=>{const i=c[n.File][e];return i?(0,Q.jsx)("div",{children:i},e):null}))),isInfoComplete:g,title:p.title})]});var h})),de="root-vGN3fF",ce="container-Z43yJw",ue="cardDragWrapper-tHHY7g",pe="audioCard-Jqin4l",me="hover-right-UhQwRW",Ae="hover-left-glFzow",fe=(0,a.Pi)((()=>{const e=O(),i=(0,H.Z)(((i,o)=>{e.selectedId!==i.payload.localId&&e.selectMaterial(i.payload.localId)})),o=(0,H.Z)(((i,o)=>{var a;return(0,Q.jsx)(ne,{className:X()(pe,{[me]:"right"===o,[Ae]:"left"===o}),audio:i,onClick:e.selectMaterial,isSelected:e.selectedId===i.payload.localId,onRemove:e.removeAudio,onReimport:e.reimportAudio},null===(a=i.payload)||void 0===a?void 0:a.localId)}));return(0,Q.jsx)("div",{className:de,children:(0,Q.jsx)("div",{className:ce,children:(0,Q.jsx)(ee.y,{list:e.audioList,renderCard:o,onMoveCard:e.dragInsert,className:ue,getId:e=>e.payload.localId,scrollAreaRef:e.scrollAreaRef,onCardClick:i})})})}));var ge,ve,he,Fe,_e,ye=o(70252),xe=o(95968),be=(o(74408),o(76199)),Ce=o(6858),Le=o(45033),Se=o(25577);function we(){return we=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var o=arguments[i];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},we.apply(this,arguments)}const Ie=e=>t.createElement("svg",we({xmlns:"http://www.w3.org/2000/svg",width:18,height:18,fill:"none",viewBox:"0 0 18 18"},e),ge||(ge=t.createElement("circle",{cx:9,cy:9,r:9,fill:"#29292D",opacity:.5})),ve||(ve=t.createElement("path",{fill:"#FAFAFA",fillRule:"evenodd",d:"M6.975 12.15v-6.3 6.3Z",clipRule:"evenodd"})),he||(he=t.createElement("path",{stroke:"#FAFAFA",strokeLinejoin:"bevel",strokeWidth:1.62,d:"M6.975 12.15v-6.3"})),Fe||(Fe=t.createElement("path",{fill:"#FAFAFA",fillRule:"evenodd",d:"M11.025 12.15v-6.3 6.3Z",clipRule:"evenodd"})),_e||(_e=t.createElement("path",{stroke:"#FAFAFA",strokeLinejoin:"bevel",strokeWidth:1.62,d:"M11.025 12.15v-6.3"})));var Ee,ke;function Re(){return Re=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var o=arguments[i];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},Re.apply(this,arguments)}const Ue=e=>t.createElement("svg",Re({xmlns:"http://www.w3.org/2000/svg",width:18,height:18,fill:"none",viewBox:"0 0 18 18"},e),Ee||(Ee=t.createElement("circle",{cx:9,cy:9,r:9,fill:"#29292D",opacity:.5})),ke||(ke=t.createElement("path",{fill:"#FAFAFA",fillRule:"evenodd",stroke:"#FAFAFA",strokeLinejoin:"bevel",strokeWidth:1.35,d:"m12.375 9-5.25 3.375v-6.75L12.375 9Z",clipRule:"evenodd"}))),je="icon-box-YEUJAD",Pe="content-lkyAWs",Ne="iconWraper-YgV3wS",Te="icon-HXRhiF",Me="desc-JTU6u4",Be="text-aeq8p1",De="time-Y_QjIl",We=e=>`${`${Math.floor(e/60)}`.padStart(2,"0")}:${`${Math.floor(e%60)}`.padStart(2,"0")}`,Ve=({audio:e,audioRef:i})=>{const{fileBase64:o}=e.payload,[a,l]=(0,t.useState)(!1),[s,r]=(0,t.useState)("00:00"),[n,d]=(0,t.useState)(0),c=(0,t.useMemo)((()=>We(n)),[n]),u=(0,t.useMemo)((()=>{var i;return(0,L.Bc)((null===(i=e.payload)||void 0===i?void 0:i.path)||"")}),[e]);return(0,t.useEffect)((()=>{if(i.current)return l(!1),r("00:00"),i.current.load(),()=>{var e;null===(e=i.current)||void 0===e||e.pause()}}),[o,i]),(0,Q.jsxs)("div",{className:je,children:[(0,Q.jsxs)("audio",{ref:i,onCanPlay:()=>{var e;d(null===(e=i.current)||void 0===e?void 0:e.duration)},onEnded:()=>l(!1),onPause:()=>l(!1),onTimeUpdate:()=>{var e;const o=We((null===(e=i.current)||void 0===e?void 0:e.currentTime)||0);r(o)},children:[(0,Q.jsx)("source",{src:`data:audio/x-mpeg;base64,${o}`}),(0,Q.jsx)("source",{src:`data:audio/wav;base64,${o}`})]}),(0,Q.jsxs)("div",{className:Pe,onClick:()=>{var e,o;a?null===(e=i.current)||void 0===e||e.pause():null===(o=i.current)||void 0===o||o.play(),l(!a)},children:[a?(0,Q.jsx)("div",{className:Ne,children:(0,Q.jsx)(Ie,{className:Te})}):(0,Q.jsx)("div",{className:Te,children:(0,Q.jsx)(Ue,{})}),(0,Q.jsxs)("div",{className:Me,children:[(0,Q.jsx)("div",{className:Be,children:u}),(0,Q.jsxs)("div",{className:De,children:[s," | ",c]})]})]})]})};var ze=o(53803);const Oe="root-F4oZT7",Qe="label-JWNfR2",Ye="useAll-UNQhcm",Ze="input-K5QDCm",qe="businessCheckbox-gZGrLh",Ke=(0,a.Pi)((({audio:e})=>{const{t:i}=(0,l.$)(),o=O();(0,t.useLayoutEffect)((()=>{var i,a;return null===(i=o.formApi)||void 0===i||i.reset(),null===(a=o.formApi)||void 0===a||a.setValues(e,{isOverride:!0}),()=>o.syncFormData(e)}),[e]);const{getDisplayLength:a}=(0,Le._)(),s=(i,a)=>{o.updateFormState(e,{common_data:{...e.common_data,[a]:i}})};return(0,Q.jsxs)("div",{className:Oe,children:[(0,Q.jsx)(Ve,{audio:e,audioRef:o.audioRef}),(0,Q.jsx)(ye.l,{fieldClassName:Ze,label:i("pc_filter_voice_effect_name"),field:"common_data.title",maxLength:x.S8,placeholder:i("pc_stickers_release_xy_name_web",{X:1,Y:a(x.S8)}),allowEnter:!1,rules:[{required:!0,message:""}],onChange:e=>s(e,"title")}),(0,Q.jsxs)("div",{className:Qe,children:[(0,Q.jsx)(xe.u,{fieldClassName:Ze,label:i("pc_stickers_release_tag_set_web"),placeholder:i("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"common_data.tags",itemType:h.Ab.AudioEffect,recommendConfig:{title:e.common_data.title},rules:[{required:!0,message:""}],onChange:e=>s(e,"tags"),temporaryId:e.payload.localId}),(0,Q.jsx)("span",{className:Ye,onClick:()=>{var e;const{tags:i}=(null===(e=o.formApi)||void 0===e?void 0:e.getValue("common_data"))||{};null!=i&&i.length&&o.applyForTags({tags:i})},children:i("pc_material_release_apply_all")})]}),!1,(0,Q.jsx)(Se.Z,{onClickUseAll:()=>{var e;const i=null===(e=o.formApi)||void 0===e?void 0:e.getValues();i&&o.applyAuthSettingsToAll({isVip:i.is_vip,isOriginal:i.common_data.is_original,isBusiness:i.common_data.is_business})},children:(0,Q.jsxs)("div",{className:ze.Z.authGroup,children:[(0,Q.jsx)(Se._,{text:i("pc_template_authorize_range_web")}),(0,Q.jsxs)("div",{className:ze.Z.right,children:[(0,Q.jsx)(be.l,{noLabel:!0,field:"is_vip",sendLogService:o.sendLogServ}),(0,Q.jsx)(Ce.R,{fieldClassName:qe,noLabel:!0,field:"common_data.is_business",vipField:"is_vip",authorSignService:o.authorSignService,getAuthFileUploadService:()=>o.authFileUploadServiceManager.ensure(e.payload.localId),sendLogService:o.sendLogServ})]})]})})]})})),Je=(0,a.Pi)((({className:e})=>{const i=O(),{t:o}=(0,l.$)(),a=(0,t.useCallback)((()=>i.selectedAudio&&(0,Q.jsx)(Ke,{audio:i.selectedAudio})),[i.selectedAudio]),s=(0,t.useMemo)((()=>i.audioList.length>=u),[i.audioList]);return(0,R.pg)({mainFormLayout:i.mainFormLayout,sendLogServ:i.sendLogServ}),(0,J.O)({className:e,layout:i.mainFormLayout,uploadAreaProps:{titleForUploadArea:o("pc_material_release_click"),titleForMainForm:o("pc_stickers_release_drag_in_web"),subTitle:".mp3/.wav",draggingTitle:o("pc_sticker_release_mouse_web"),disabled:s,disabledTooltip:"",onClick:i.openAudioPicker,onDrop:i.droppedAudioFiles},setFormApi:i.setFormApi,renderImportArea:e=>(0,Q.jsxs)(Q.Fragment,{children:[e,(0,Q.jsx)(fe,{})]}),renderFormArea:a,scrollAreaRef:i.scrollAreaRef,onRetry:G.cb})}));var Ge=o(12904),He=o(65546);const $e="page-1cbeHL",Xe="content-Y3uYfw",ei="requirement-zgTG7N",ii="mainForm-CN2Z8q",oi="footer-Klb8rU",ai=(0,a.Pi)((()=>{const e=function(){const{t:e}=(0,l.$)(),i=new _.l,o=new I.w,a=new R.D5({itemType:h.Ab.AudioEffect}),s=(0,N.G)({watch:()=>r.isAllUploaded}),r=(0,f.fv)((()=>({audioList:[],formApi:null,isPublishing:!1,pubServ:new k.Z,sendLogServ:a,authorSignService:new U.I({signScene:D.d.BusinessArtist}),authFileUploadServiceManager:new j.r({}),scrollAreaRef:(0,t.createRef)(),audioRef:(0,t.createRef)(),performanceTimingCollector:(0,V.uY)(),mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return"uploadArea"===r.mainFormLayoutAfterLoading&&F.appModel.isInitFailed?"error":r.mainFormLayoutAfterLoading},get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1}},get importMinMaxCount(){const e=r.audioList.length;return{minCount:1,maxCount:Math.max(0,u-e),maxTotalCount:u}},get needConfirmModalOnClose(){return r.audioList.length>0},selectedId:"",get selectedAudio(){return r.selectedId?r.getAudio(r.selectedId):null},getAudio:e=>{var i;return null!==(i=r.audioList.find((i=>{var o;return(null===(o=i.payload)||void 0===o?void 0:o.localId)===e})))&&void 0!==i?i:null},getAudioIndex:e=>r.audioList.findIndex((i=>{var o;return(null===(o=i.payload)||void 0===o?void 0:o.localId)===e})),selectMaterial(e){r.selectedId=e,r.selectedAudio&&(r.selectedAudio.payload.hasEverSelected=!0)},updateFormState(e,i){Object.assign(e,i)},setIsPublishing:(0,g.aD)((e=>r.isPublishing=e)),setFormApi:(0,g.aD)((e=>r.formApi=e)),applyForTags:({tags:e})=>{r.audioList.forEach((i=>{i.common_data.tags=e}))},applyAuthSettingsToAll:({isOriginal:e,isBusiness:i,isVip:o})=>{r.audioList.forEach((a=>{a.is_vip=Boolean(o),a.common_data.is_original=Boolean(e),a.common_data.is_business=Boolean(i)}))},dragInsert(e,i){const o=r.audioList.splice(e,1),a=e>i?i+1:i;r.audioList.splice(a,0,...o)},addAudios(e){0!==e.length&&(r.audioList=[...r.audioList,...e],r.selectMaterial(e[0].payload.localId),"uploadArea"===r.mainFormLayoutAfterLoading&&(r.mainFormLayoutAfterLoading="mainForm"))},async removeAudio(e){await M.cancelAudioUpload({id:e.payload.localId}),r.audioList=r.audioList.filter((i=>{var o,a;return(null===(o=i.payload)||void 0===o?void 0:o.localId)!==(null===(a=e.payload)||void 0===a?void 0:a.localId)}))},getUploadParams:async(e,i)=>(await o.refreshUploadConfigsIfNeeded({when:i,logPrefix:"[AudioStore]"}),{...await o.getUploadConfigs("openAudioPicker"),accept:"mp3-wav",maxFileDuration:60,maxFileSize:p,...e}),async handleAudioFileProcessResult(e){const i=r.getAudio(e.id);if(i)if("Success"===e.result)switch(e.type){case"AudioBase64":i.payload.fileBase64=e.base64;break;case"AudioFile":const{audio_id:o,size:a,file_uri:l}=e;i.audio.audio_id=o,i.common_data.file={file_md5:"",size:a,file_uri:l};break;default:return}else"Error"===e.result&&"AudioFile"===e.type&&(i.payload.isUploadFailed=!0,i.payload.uploadFailedText=e.error||"")},initAudios({audios:e}){if(!e.length)return[];const i=[];for(const o of e){const e=w(o);i.push(e)}return i},async openAudioPicker(){i.lock(m,(async()=>{try{a.sendPageActionLog({action:"mainForm"===r.mainFormLayout?"upload_more":"upload"});const e=await r.getUploadParams({...r.importMinMaxCount,multiple:!0},"openAudioPicker"),i=await M.openAudioFilePicker(e),o=r.initAudios(i);r.addAudios(o)}catch(e){(0,E.RF)("openAudioFilePicker jsb failed ",e,{action:"openAudioPicker"})}}))},async droppedAudioFiles(){i.lock(m,(async()=>{try{a.sendPageActionLog({action:"mainForm"===r.mainFormLayout?"upload_more":"upload"});const e=await r.getUploadParams({...r.importMinMaxCount,multiple:!0},"droppedAudioFiles"),i=await M.uploadDroppedAudioFiles(e),o=r.initAudios(i);r.addAudios(o)}catch(e){(0,E.RF)("uploadDroppedAudioFiles jsb failed ",e,{action:"droppedAudioFiles"})}}))},async reimportAudio(e){i.lock(m,(async()=>{var i;await M.cancelAudioUpload({id:e.payload.localId});const o=await r.getUploadParams({minCount:1,maxCount:1,maxTotalCount:1,multiple:!1},"reimportAudio"),a=await M.openAudioFilePicker(o),l=w(a.audios[0]),t=r.getAudioIndex(e.payload.localId);-1!==t&&(r.audioList[t]=l,r.selectMaterial(null===(i=l.payload)||void 0===i?void 0:i.localId))}))},isAllUploadedWatcher:s,async retryUpload(){const e=r.audioList.filter((e=>e.payload.isUploadFailed)).map((e=>e.payload.localId));if(!e.length)return;e.forEach((e=>{const i=r.getAudio(e);i&&(i.payload.isUploadFailed=!1)}));const i=await r.getUploadParams({multiple:!0,minCount:1,maxCount:e.length,maxTotalCount:e.length,retryUploadIds:e},"retryUpload");await M.openAudioFilePicker(i)},sendUploadProgressModalShowErrorLog(){const e=r.audioList.filter((e=>e.payload.isUploadFailed)).map((e=>({error_report:e.payload.uploadFailedText})));a.sendMaterialPublishErrorLog(e)},get uploadStats(){let e=0,i=0,o=0;return r.audioList.forEach((a=>{var l;a.payload.isUploadFailed?i+=1:(null===(l=a.common_data.file)||void 0===l?void 0:l.file_uri)&&a.audio.audio_id?e+=1:o+=1})),{pending:o,succeeded:e,failed:i}},get isAllReadyPublish(){const e=r.audioList.every((e=>{var i,o;return e.common_data.title&&(null===(i=e.common_data.tags)||void 0===i?void 0:i.length)&&!(null!==(o=e.payload.unmetRequirements)&&void 0!==o&&o.length)}));return r.audioList.length>0&&e},get isAllUploaded(){const{pending:e,failed:i}=r.uploadStats;return!e&&!i},syncFormData(e){var i;const o=null===(i=r.formApi)||void 0===i?void 0:i.getValues();e&&o&&r.updateFormState(e,{is_vip:o.is_vip||!1,common_data:{...e.common_data,title:o.common_data.title||"",tags:o.common_data.tags||[],is_original:o.common_data.is_original||!1,is_business:o.common_data.is_business||!1}})},async uploadAndPublish(e){var i;a.sendPageActionLog({action:"publish"}),null===(i=r.audioRef.current)||void 0===i||i.pause(),r.selectedAudio&&r.syncFormData(r.selectedAudio),r.isAllUploaded||(await r.retryUpload(),null==e||e.show(),await r.isAllUploadedWatcher.start());try{await r.publishImpl()}finally{null==e||e.hide()}},async publishImpl(){try{r.setIsPublishing(!0);const i=r.audioList.map((e=>{const i=(0,P.pn)({isVip:e.is_vip,isBusiness:e.common_data.is_business,authFiles:r.authFileUploadServiceManager.getUploadedFiles(e.payload.localId)});return{id:e.payload.localId,req:{...(0,A.Z)(e,["payload"]),...i.root,common_data:{...e.common_data,...i.commonData}},onResult:i=>{const{req:o,error:l,errorText:t,time:s,resourceId:n}=i;l||r.updateFormState(e,{payload:{...e.payload,itemId:n}}),a.sendMaterialPublishStatusLog({status:l?"fail":"success",time:s,error_type:t,publishParams:o,path:e.payload.path})}}}));(0,E.c6)("[AudioStore] audios publish start",{ids:i.map((e=>e.id))});const o=(await r.pubServ.batchPublish(i)).map((e=>e.resource_id));(0,E.c6)("[AudioStore] audios publish done",{resourceIdList:o}),await r.pubServ.pollUntilAllInEffectList({ids:o.slice(-k.f),types:[h.Ab.AudioEffect]}),(0,E.c6)("[AudioStore] poll done"),v.FN.success(e("pc_filter_release_successful")),(0,B.ZM)({effect_type:h.Ab.AudioEffect}),setTimeout((()=>(0,B.Nt)({item_type:h.Ab.AudioEffect})),1e3)}catch(i){v.FN.error(e("pc_sticker_release_failed_retry_web")),(0,E.RF)("[AudioStore] publish fail",i)}finally{r.setIsPublishing(!1)}}})));return(0,W.u)({watch:()=>r.needConfirmModalOnClose}),(0,t.useEffect)((()=>{window.store=r,o.uploadConfigsCache.update(),r.authorSignService.init(),r.performanceTimingCollector.addRenderTiming(V.Pk)}),[]),(0,t.useEffect)((()=>{const e=M.registerAudioFileProcessResultEvent(r.handleAudioFileProcessResult),i=(0,B.ih)((()=>{var e;return null===(e=r.audioRef.current)||void 0===e?void 0:e.pause()}));return()=>{e(),i()}}),[]),r}(),{t:i}=(0,l.$)();return(0,Ge.F)({title:i("pc_filter_voice_effect"),pid:"audio-publish-single"}),(0,He.d)(),(0,R.t9)(e.sendLogServ),(0,Q.jsx)(z.Provider,{value:e,children:(0,Q.jsxs)("div",{className:$e,children:[(0,Q.jsxs)("div",{className:Xe,children:[(0,Q.jsx)(Y,{className:ei}),(0,Q.jsx)(Je,{className:ii})]}),(0,Q.jsx)(K,{className:oi})]})})})),li=()=>(0,Q.jsx)(ai,{})},74235:(e,i,o)=>{o.d(i,{Bc:()=>s,YB:()=>t,xB:()=>l});var a=o(86439);function l(e){const{len:i,i18n:o}=e,[a]=(o.language||"").split("-");return"zh"===a?Math.floor(i/2):i}function t(e,i){const o=e.split(/[\\/]/g).pop().replace(/\.\w+?$/g,"");return(0,a.aF)(o,null==i?void 0:i.maxLength)}function s(e){return e.replace(/^.*[\\\/]/,"")}}}]);