"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[839],{42983:(e,t,i)=>{i.d(t,{Ab:()=>a,qG:()=>a});let a=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({})},69836:(e,t,i)=>{i.d(t,{ir:()=>b});var a=i(50959),r=i(84875),l=i.n(r),o=i(45599),s=i(96426),n=i(85083),c=i(88623),d=i(82346),m=i(84997),u=i(40699),p=i(96305),h=i(11527);const f=e=>{const{className:t,loadingText:i}=e,{t:a}=(0,o.$)(),{handleMouseEnter:r}=(0,m.S)();return(0,h.jsxs)("div",{className:l()(p.Z.root,t),children:[(0,h.jsx)(d.a,{className:p.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,h.jsx)("div",{className:p.Z.text,onMouseEnter:r,children:i||a("pc_stickers_release_in_web")})]})},g=e=>{const{className:t,tooltip:i}=e,{t:r}=(0,o.$)(),{handleMouseEnter:n}=(0,m.w)({content:i,className:p.Z.tooltip}),c=(0,a.useRef)(null),{setIsMarqueeLoopRunning:d,reactNode:f}=(0,u.J)({text:r("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>c.current});return(0,h.jsxs)("div",{className:l()(p.Z.root,t,p.Z.error),onMouseEnter:e=>{d(!0),n(e)},onMouseLeave:()=>d(!1),children:[(0,h.jsx)(s.r,{className:p.Z.icon}),(0,h.jsx)("div",{ref:c,className:p.Z.text,children:f})]})},_=e=>{const{className:t,text:i}=e,{handleMouseEnter:a}=(0,m.S)();return(0,h.jsxs)("div",{className:l()(p.Z.root,t,p.Z.checked),children:[(0,h.jsx)(c.r,{className:p.Z.icon}),(0,h.jsx)("div",{className:p.Z.text,onMouseEnter:a,children:i})]})},S=e=>{const{className:t}=e,{t:i}=(0,o.$)(),{handleMouseEnter:a}=(0,m.S)();return(0,h.jsxs)("div",{className:l()(p.Z.root,t),children:[(0,h.jsx)("div",{className:l()(p.Z.icon,p.Z.yellowIcon),children:(0,h.jsx)("div",{className:p.Z.yellowPoint})}),(0,h.jsx)("div",{className:p.Z.text,onMouseEnter:a,children:i("pc_stickers_release_editing_web")}),(0,h.jsx)(n.r,{className:p.Z.icon})]})},b=e=>{const{className:t,loading:i,invalid:a,errorToolip:r,isInfoComplete:l,title:o,loadingText:s}=e;return i?(0,h.jsx)(f,{className:t,loadingText:s}):a?(0,h.jsx)(g,{className:t,tooltip:r}):l?(0,h.jsx)(_,{className:t,text:o}):(0,h.jsx)(S,{className:t})}},95218:(e,t,i)=>{i.d(t,{KD:()=>c,Pc:()=>u,S8:()=>o,Tb:()=>n,ZV:()=>d,Zk:()=>m,dr:()=>p,iq:()=>l,t2:()=>s});var a=i(73224),r=i(60209);const l=30,o=24,s=80,n=20971520,c="#BB984B",d={[r.nb.File]:{[r.id.Format]:a.I18n.t("pc_filter_form"),[r.id.MaxFileSize]:a.I18n.t("pc_filter_size_eight_m"),[r.id.CollectionNum]:a.I18n.t("pc_filter_collection_number")},[r.nb.Cover]:{[r.id.CoverCopyright]:a.I18n.t("pc_filter_original_cover_copyright"),[r.id.CoverLut]:a.I18n.t("pc_filter_lut_match"),[r.id.CoverFormat]:a.I18n.t("pc_filter_file_format"),[r.id.CoverMinImageSize]:a.I18n.t("pc_filter_pixel_size"),[r.id.CoverMaxFileSize]:a.I18n.t("pc_filter_file_size_ten_m")}},m={accept:"cube-3dl",multiple:!0,thumbnailSize:210,maxFileSize:20971520},u={accept:"png-jpg-jpeg",thumbnailSize:210,maxFileSize:10485760,minImageSize:720},p="ImportFilter"},17421:(e,t,i)=>{i.r(t),i.d(t,{default:()=>_e});var a=i(23479),r=i(45599),l=i(21130),o=i(12904),s=i(9608),n=i(60209),c=i(18882),d=i(93639),m=i(50959),u=i(61022),p=i(66589),h=i(84736),f=i(73224),g=i(54847),_=i(893),S=i(82186),b=i(39486),v=i(60251),y=i(42983),F=i(59787),L=i(82665),x=i(50279),M=i(25807),I=i(8129),C=i(2555),A=i(94435);function w(e){return Boolean(e.id)}class P{constructor(){(0,F.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const i of(0,L.Z)(e,10)){const e=await Promise.all(i.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:i,onResult:a,onUpdateResult:r}=e,l=JSON.parse(JSON.stringify(e.req));let o=this.itemMap.get(i);if(null!==(t=o)&&void 0!==t&&t.promise&&(0,x.Z)(o.req,l))try{return await o.promise}catch(s){(0,I.c6)("[MaterialPublishService] publish failed, start to retry",{id:i})}return o={promise:null,id:i,req:l,onResult:a,onUpdateResult:r},this.itemMap.set(i,o),o.promise=this.publishImpl(o),o.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),i=async(i,a)=>{try{const o={error:i,errorText:this.getErrorText(i),time:Math.round(performance.now()-t),resourceId:a};var r,l;if(w(e.req))await(null===(r=e.onUpdateResult)||void 0===r?void 0:r.call(e,{req:e.req,...o}));else await(null===(l=e.onResult)||void 0===l?void 0:l.call(e,{req:e.req,...o}))}catch(o){(0,I.RF)("[MaterialPublishService] callOnResult failed",o)}};let a;try{a=await this.postOrUpdate(e)}catch(r){throw e.promise=null,i(r,""),r}return await i(null,a.resource_id),a}async postOrUpdate(e){return w(e.req)?(await(0,A.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,A.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new C.B).timeout(5e3)])}catch(t){(0,I.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const i=performance.now(),a=new C.B,r={count:50,effect_types:t,uid:M.$.userInfo.uid,cursor:0};for(;performance.now()-i<5e3;){const t=await(0,A.Js)(r).catch((()=>null));if(null!=t&&t.effect_item_list){const i=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>i.has(e))))return}await a.timeout(500)}}}var N=i(57609),T=i(2514),U=i(67078),j=i(539),k=i(95218),R=i(99181),E=i(56714),Z=i(46309),q=i(3718),D=i(51654),z=i(18370);const O=(0,m.createContext)(null),W=()=>(0,m.useContext)(O);var V=i(11527);const G=(0,a.Pi)((({className:e})=>{var t,i;const a=(0,c.$Y)(),r=W().materialListStore.selectedMaterial;return(0,V.jsx)(s.v,{className:e,groups:a,initGroup:n.nb.File,activeGroup:n.nb.File,resetExpandedGroupKey:null!==(t=null==r||null===(i=r.payload)||void 0===i?void 0:i.localId)&&void 0!==t?t:null,getStatus:e=>{var t;return r?null!==(t=r.payload)&&void 0!==t&&null!==(t=t.unmetRequirements)&&void 0!==t&&t.includes(e.key)?"error":"success":"init"}})}));var $=i(38803),B=i(36775);const J=(0,a.Pi)((({className:e})=>{const t=W(),{t:i}=(0,r.$)(),a=(0,m.useRef)(null),l=(0,m.useMemo)((()=>t.materialListStore.materialList.length),[t.materialListStore.materialList]),o=(0,m.useMemo)((()=>t.isAllReadyPublish),[t.isAllReadyPublish]);return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)($.Z,{className:e,leftText:i("pc_sticker_import_zero_to_hundred_web",{X:l,Y:t.maxTotalCount}),isPublishDisabled:!o,isPublishing:t.isPublishing,needConfirmModalOnClose:t.needConfirmModalOnClose,onPublish:()=>t.uploadAndPublish(a.current)}),(0,V.jsx)(B.q,{ref:a,uploadStats:t.materialListStore.uploadStats,onRetryUpload:t.retryUpload,onCancel:t.isAllUploadedWatcher.stop,onShowUploadFail:t.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:t.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var X=i(23073),Y=i(12390),K=i(82725),Q=i(74474),H=i(84875),ee=i.n(H),te=i(99826);const ie="root-WXT7id",ae="container-fzoSrD",re="cardDragWrapper-G4KMNQ",le="card-DaDLFa",oe="hover-right-MOxz48",se="hover-left-A_1gm_",ne=(0,a.Pi)((()=>{const e=W(),{materialListStore:t}=e,i=(0,m.useCallback)(((e,i)=>{t.selectedId!==e.payload.localId&&t.selectMaterial(e.payload.localId)}),[t.selectMaterial]),a=(0,m.useCallback)(((t,i)=>{var a;return(0,V.jsx)(te.Z,{className:ee()(le,{[oe]:"right"===i,[se]:"left"===i}),material:t,onClick:e.materialListStore.selectMaterial,isSelected:e.materialListStore.selectedId===t.payload.localId,onRemove:e.materialListStore.removeMaterial,onReimport:e.reimport},null===(a=t.payload)||void 0===a?void 0:a.localId)}),[e.reimport,e.materialListStore.selectMaterial,e.materialListStore.removeMaterial,e.materialListStore.selectedId]);return(0,V.jsx)("div",{className:ie,children:(0,V.jsx)("div",{className:ae,children:(0,V.jsx)(Q.y,{list:t.materialList,renderCard:a,onMoveCard:t.dragInsert,className:re,getId:e=>e.payload.localId,scrollAreaRef:e.materialListStore.scrollAreaRef,onCardClick:i})})})}));var ce=i(60681);const de=(0,a.Pi)((({className:e})=>{const t=W(),{t:i}=(0,r.$)(),a=(0,m.useCallback)((()=>t.materialListStore.selectedMaterial&&(0,V.jsx)(ce.Z,{material:t.materialListStore.selectedMaterial,materialListStore:t.materialListStore,formApi:t.formApi,authProps:(0,X.Z)(t,"authorSignService","authFileUploadServiceManager","sendLogServ")})),[t.materialListStore.selectedMaterial,t.materialListStore,t.formApi]);return(0,l.pg)(t),(0,Y.O)({className:e,layout:t.mainFormLayout,uploadAreaProps:{titleForUploadArea:i("pc_sticker_release_drag_web"),titleForMainForm:i("pc_stickers_release_drag_in_web"),subTitle:".cube/.3dl",draggingTitle:i("pc_sticker_release_mouse_web"),disabled:t.isImportDisabled,disabledTooltip:"",onClick:t.openFilterPicker,onDrop:t.uploadDroppedAudioFiles},setFormApi:t.setFormApi,renderImportArea:e=>(0,V.jsxs)(V.Fragment,{children:[e,(0,V.jsx)(ne,{})]}),renderFormArea:a,scrollAreaRef:t.materialListStore.scrollAreaRef,onRetry:K.cb})}));var me=i(65546);const ue="page-V3sPge",pe="content-XEi3Mp",he="requirement-wXJ3Fh",fe="mainForm-oqhmIl",ge="footer-WOGAqV",_e=(0,a.Pi)((()=>{const e=function(){const e=(0,_.WQ)(),t=(0,S.WQ)(e),i=new v.l,a=new E.v({itemType:y.qG.Filter}),r=(0,j.G)({watch:()=>l.isAllUploaded}),l=(0,u.fv)((()=>({uploadConfigService:new b.w,formApi:null,setFormApi:e=>{l.formApi=e},isPublishing:!1,sendLogServ:a,authorSignService:new N.I({signScene:q.d.BusinessArtist}),authFileUploadServiceManager:new T.r({}),performanceTimingCollector:(0,z.uY)(),setIsPublishing:(0,p.aD)((e=>l.isPublishing=e)),mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return t.isImportLoading?"loading":"uploadArea"===l.mainFormLayoutAfterLoading&&g.appModel.isInitFailed?"error":l.mainFormLayoutAfterLoading},pubServ:new P,get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1}},get maxTotalCount(){return k.iq},get isImportDisabled(){return e.materialList.length>=k.iq},get needConfirmModalOnClose(){return e.materialList.length>0},materialListStore:e,importLoadingStore:t,getImportMinMaxCount(){const t=e.materialList.length;return{minCount:1,maxCount:Math.max(0,l.maxTotalCount-t),maxTotalCount:l.maxTotalCount}},get isAllReadyPublish(){return e.materialList.length&&e.isReadyToPublish},handleLoading(){l.materialListStore.materialList.length&&"uploadArea"===l.mainFormLayoutAfterLoading&&(t.showImportLoading(),l.mainFormLayoutAfterLoading="mainForm")},openFilterPicker(){i.lock(k.dr,(async()=>{a.sendUploadActionLog(l),await e.openFilterPicker({...l.getImportMinMaxCount(),source:A.r0.UserPostPc}),l.handleLoading()}))},uploadDroppedAudioFiles(){i.lock(k.dr,(async()=>{a.sendUploadActionLog(l),await e.uploadDroppedFilterFiles({...l.getImportMinMaxCount(),source:A.r0.UserPostPc}),l.handleLoading()}))},reimport(t){i.lock(k.dr,(async()=>{await e.reimportFilterFilePicker({...l.getImportMinMaxCount(),source:A.r0.UserPostPc,oldId:t.payload.localId}),l.handleLoading()}))},get isAllUploaded(){const{pending:e,failed:t}=l.materialListStore.uploadStats;return!e&&!t},sendUploadProgressModalShowErrorLog(){const e=l.materialListStore.materialList.filter((e=>e.payload.isUploadFailed)).map((e=>({error_report:e.payload.error})));a.sendMaterialPublishErrorLog(e)},async retryUpload(){const e=l.materialListStore.materialList.filter((e=>e.payload.isUploadFailed));return l.materialListStore.retryUpload(e,[])},isAllUploadedWatcher:r,asyncFormData(){var t;const i=null===(t=l.formApi)||void 0===t?void 0:t.getValues(),a=l.materialListStore.selectedMaterial;a&&i&&e.updateFormState(a,{is_vip:i.is_vip||!1,common_data:{...a.common_data,title:i.common_data.title||"",description:i.common_data.description,is_original:i.common_data.is_original||!1,is_business:i.common_data.is_business||!1}})},async uploadAndPublish(e){l.asyncFormData(),a.sendPageActionLog({action:"publish"}),l.isAllUploaded||(await l.retryUpload(),null==e||e.show(),await l.isAllUploadedWatcher.start());try{await l.publishImpl()}finally{null==e||e.hide()}},async publishImpl(){try{l.setIsPublishing(!0);const t=e.materialList.map((e=>{const t=(0,U.pn)({isVip:e.is_vip,isBusiness:e.common_data.is_business,authFiles:l.authFileUploadServiceManager.getUploadedFiles(e.payload.localId)});return{id:e.payload.localId,req:{...(0,d.Z)(e,["payload"]),...t.root,common_data:{...e.common_data,...t.commonData}},onResult:t=>{a.sendMaterialPublishLog({publishResult:t,filter:e,logPrefix:"[SingleStore]"})}}}));(0,I.c6)("[SingleStore] stickers publish start",{ids:t.map((e=>e.id))});const i=(await l.pubServ.batchPublish(t)).map((e=>e.resource_id));(0,I.c6)("[SingleStore] filters publish done",{resourceIdList:i}),await l.pubServ.pollUntilAllInEffectList({ids:i.slice(-10),types:[y.qG.Filter]}),(0,I.c6)("[SingleStore] poll done"),h.FN.success(f.I18n.t("pc_filter_release_successful")),(0,Z.ZM)({effect_type:y.qG.Filter}),setTimeout((()=>(0,Z.Nt)({item_type:y.qG.Filter})),1e3)}catch(t){h.FN.error(f.I18n.t("pc_sticker_release_failed_retry_web")),(0,I.RF)("Filter [SingleStore] publish fail",t)}finally{l.setIsPublishing(!1)}},handleFilterFileProcessResult(t){const i=e.getMaterial(t.id);if(!i)return;const a=t.temporaryId===i.payload.temporary[t.type];if("Success"===t.result)switch(t.type){case"Thumbnail":if(!a)return;const{base64:r}=t;e.updateFormState(i,{payload:{...i.payload,filterImg:`data:;base64,${r}`}});break;case"FilterImg":if(!a)return;const{sourceUri:l,filterUri:o}=t;e.updateUploadResp(i,{sourceUri:l,filterUri:o});break;case"FilterFile":const{fileUri:s}=t;e.updateUploadResp(i,{fileUri:s});break;default:return}else e.updateFormState(i,{payload:{...i.payload,isUploadFailed:!0}})}})));return(0,D.u)({watch:()=>l.needConfirmModalOnClose}),(0,m.useEffect)((()=>{window.store=l;const e=R.Z.registerFilterFileProcessResultEvent(l.handleFilterFileProcessResult);return l.authorSignService.init(),l.performanceTimingCollector.addRenderTiming(z.Pk),()=>{e(),t.destroy()}}),[]),l}(),{t}=(0,r.$)();return(0,o.F)({title:t("pc_filter_release_item"),pid:"filter-publish-single"}),(0,me.d)(),(0,l.t9)(e.sendLogServ),(0,V.jsx)(O.Provider,{value:e,children:(0,V.jsxs)("div",{className:ue,children:[(0,V.jsxs)("div",{className:pe,children:[(0,V.jsx)(G,{className:he}),(0,V.jsx)(de,{className:fe})]}),(0,V.jsx)(J,{className:ge})]})})}))}}]);