"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[243],{84997:(e,t,s)=>{s.d(t,{S:()=>v,w:()=>f});var n=s(50959),l=s(44478),i=s(26800),r=s(84875),o=s.n(r),a=s(84736),c=s(45599),d=s(20468),u=s(2555),p=s(76896),m=s(45584),h=s(11527);const g=(0,n.forwardRef)(((e,t)=>{const{tooltipProps:s,getPopupContainer:l,onClosePopover:r,position:c,cursor:d="default"}=e,[g,f]=(0,n.useState)(!0),[v,_]=(0,n.useState)(!1),{top:x}=c,C=c.left-10,b=(0,n.useRef)(null),w=(0,n.useRef)(null),S=(0,i.Z)((()=>{var e;null===(e=w.current)||void 0===e||e.destroy(),_(!1),f(!1)})),T=(0,i.Z)((()=>{var e;const t=l().querySelector(`.${m.Z.tooltipWrapper}`);if(!t||(null===(e=w.current)||void 0===e?void 0:e.tooltipWrapper)===t)return;t.addEventListener("animationend",S);const s=new u.B;s.timeout(500).then(S),w.current={tooltipWrapper:t,destroy:()=>{t.removeEventListener("animationend",S),s.cancel(),w.current=null}}}));(0,n.useImperativeHandle)(t,(()=>({hide:()=>{T(),_(!0)}})));const y=(0,n.useMemo)((()=>({default:{height:18,width:12},"not-allowed":{height:(0,p.c)()?30:15,width:15}})),[]),N=y[d]||y.default;return(0,h.jsx)(a.u,{autoAdjustOverflow:!0,position:"bottomLeft",motion:!1,...s,className:o()(s.className,m.Z.tooltipWrapper,v&&m.Z.fadingOut),trigger:"custom",visible:g,showArrow:!1,rePosKey:`${x}-${C}`,getPopupContainer:l,onVisibleChange:e=>{var t;!e&&r(),null===(t=s.onVisibleChange)||void 0===t||t.call(s,e)},children:(0,h.jsx)("div",{className:m.Z.point,tabIndex:-1,ref:b,style:{top:x,left:C,...N}})})}));function f(e){const{zIndex:t=1060,cursor:s="default",checkIsTarget:r,getEllipsisDOM:o,...a}=e,u=(0,n.useRef)(null),p=(0,n.useRef)(null),[f,v]=(0,n.useState)(null),{i18n:_}=(0,c.$)(),x=()=>{const{content:e}=a;if("function"!=typeof e)return e;if(!u.current)return null;const{targetElement:t}=u.current;return s=>e({...s,target:t})},C=(0,i.Z)((()=>{u.current&&(u.current.destroy(),u.current=null,v(null))})),b=(0,i.Z)((()=>{var e;null===(e=u.current)||void 0===e||e.destroy(),u.current=null})),w=(0,i.Z)(((e,s)=>{const n=null==o?void 0:o(s);if(n&&n.offsetWidth>=n.scrollWidth)return;if(u.current){if(!u.current.hasLeaved&&u.current.targetElement===s)return;C()}const i=document.createElement("div");i.className=m.Z.root,i.style.zIndex=`${t}`;const r=e=>{v({left:e.clientX,top:e.clientY})},a=e=>{s===e.target&&(u.current&&(u.current.hasLeaved=!0),p.current?p.current.hide():C())};s.addEventListener("mousemove",r),s.addEventListener("mouseleave",a),document.body.appendChild(i);const c=(0,l.createRoot)(i);u.current={container:i,targetElement:s,hasLeaved:!1,reactRoot:c,destroy:()=>{i.remove(),Promise.resolve().then((()=>c.unmount())),s.removeEventListener("mousemove",r),s.removeEventListener("mouseleave",a)}},v({left:e.clientX,top:e.clientY})})),S=(0,i.Z)((e=>{const t=e.currentTarget;w(e,t)})),T=(0,i.Z)((e=>{var t;const s=e.target;(null!==(t=null==r?void 0:r(s))&&void 0!==t?t:e.currentTarget===s)&&w(e,s)}));return(0,n.useLayoutEffect)((()=>b),[]),(0,n.useLayoutEffect)((()=>{(()=>{if(!u.current||!f)return;const{reactRoot:e,container:n}=u.current;n.style.zIndex=`${t}`,e.render((0,h.jsx)(d.a,{i18n:_,children:(0,h.jsx)(g,{ref:p,tooltipProps:{...a,content:x()},getPopupContainer:()=>n,onClosePopover:C,position:f,cursor:s})}))})()})),{handleMouseEnter:S,handleMouseOver:T}}function v(e={}){const{getEllipsisDOM:t=(e=>e),content:s=(({target:e})=>e.textContent),...n}=e;return f({...n,getEllipsisDOM:t,content:s})}},16566:(e,t,s)=>{s.r(t),s.d(t,{default:()=>is});var n=s(23479),l=s(45599),i=s(50959),r=s(9608),o=s(23073),a=s(66589),c=s(61022),d=s(84736);let u=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({});var p=s(54847),m=s(60251),h=s(59787),g=s(82665),f=s(50279),v=s(25807),_=s(8129),x=s(2555),C=s(94435);function b(e){return Boolean(e.id)}class w{constructor(){(0,h.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const s of(0,g.Z)(e,10)){const e=await Promise.all(s.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:s,onResult:n,onUpdateResult:l}=e,i=JSON.parse(JSON.stringify(e.req));let r=this.itemMap.get(s);if(null!==(t=r)&&void 0!==t&&t.promise&&(0,f.Z)(r.req,i))try{return await r.promise}catch(o){(0,_.c6)("[MaterialPublishService] publish failed, start to retry",{id:s})}return r={promise:null,id:s,req:i,onResult:n,onUpdateResult:l},this.itemMap.set(s,r),r.promise=this.publishImpl(r),r.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),s=async(s,n)=>{try{const r={error:s,errorText:this.getErrorText(s),time:Math.round(performance.now()-t),resourceId:n};var l,i;if(b(e.req))await(null===(l=e.onUpdateResult)||void 0===l?void 0:l.call(e,{req:e.req,...r}));else await(null===(i=e.onResult)||void 0===i?void 0:i.call(e,{req:e.req,...r}))}catch(r){(0,_.RF)("[MaterialPublishService] callOnResult failed",r)}};let n;try{n=await this.postOrUpdate(e)}catch(l){throw e.promise=null,s(l,""),l}return await s(null,n.resource_id),n}async postOrUpdate(e){return b(e.req)?(await(0,C.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,C.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new x.B).timeout(5e3)])}catch(t){(0,_.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const s=performance.now(),n=new x.B,l={count:50,effect_types:t,uid:v.$.userInfo.uid,cursor:0};for(;performance.now()-s<5e3;){const t=await(0,C.Js)(l).catch((()=>null));if(null!=t&&t.effect_item_list){const s=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>s.has(e))))return}await n.timeout(500)}}}var S=s(57609),T=s(2514),y=s(539),N=s(46309),j=s(3718),E=s(39486);var P=s(98052);const F="CollectionActionLockKey";var k=s(82725);class I{constructor(e){this.props=e,(0,h.Z)(this,"fetchStatus",{isPending:!1,isFailed:!1,hasFetched:!1,fetchVersion:0,hasMore:!1}),(0,h.Z)(this,"nextCursor",null),(0,h.Z)(this,"fetchContext",null),(0,a.ky)(this,{fetchContext:!1})}async fetchFirstPage(e){const t=this.fetchStatus.isFailed;try{e.isRefresh||this.runStartAction();const t=await this.props.fetchFirstPage(this.fetchContext),{action:s,hasMore:n,nextCursor:l}=this.normalizeFetchResult(t);this.runSuccessAction((()=>{this.fetchStatus.fetchVersion+=1,this.fetchStatus.hasMore=null!=n&&n,this.nextCursor=null!=l?l:null,s()}))}catch(s){this.runFailureAction({isFirstPage:!0,isRefresh:e.isRefresh});const n=e.isRefresh&&"refresh_first_page"||t&&"retry_fetch_first_page"||"init_fetch_first_page";throw this.props.slardarErrorLog(n,s,{}),s}}async fetchMorePage(){if(!this.props.fetchMorePage)throw new Error("props.fetchMorePage not implemented");const e=this.fetchStatus.isFailed,t=this.nextCursor;try{this.runStartAction();const e=await this.props.fetchMorePage(t,this.fetchContext),{action:s,hasMore:n,nextCursor:l}=this.normalizeFetchResult(e);this.runSuccessAction((()=>{this.fetchStatus.hasMore=null!=n&&n,this.nextCursor=null!=l?l:null,s()}))}catch(s){this.runFailureAction({isFirstPage:!1,isRefresh:!1});const n=e?"retry_fetch_more_page":"fetch_more_page";throw this.props.slardarErrorLog(n,s,{cursor:t}),s}}normalizeFetchResult(e){return"function"==typeof e?{action:e,hasMore:!1,nextCursor:null}:e}runStartAction(){this.fetchStatus.isPending=!0,this.fetchStatus.isFailed=!1}runSuccessAction(e){this.fetchStatus.isPending=!1,this.fetchStatus.isFailed=!1,this.fetchStatus.hasFetched=!0,e()}runFailureAction(e){var t,s;this.fetchStatus.isPending=!1,this.fetchStatus.isFailed=!0,null===(t=(s=this.props).actionOnFailure)||void 0===t||t.call(s,e,this.fetchContext)}async initFetchFirstPage(e){this.fetchContext=e;const{isPending:t,hasFetched:s}=this.fetchStatus;if(!t&&!s)return this.fetchFirstPage({isRefresh:!1})}async retryFetchFirstPage(){const{isPending:e}=this.fetchStatus;if(!e)return this.fetchFirstPage({isRefresh:!1})}async refreshFirstPage(){const{isPending:e}=this.fetchStatus;if(!e)return this.fetchFirstPage({isRefresh:!0})}async retryFetchMorePage(){const{isPending:e,hasMore:t}=this.fetchStatus;if(!e&&t)return this.fetchMorePage()}async fetchMorePageOnScrollToEnd(){const{isPending:e,hasMore:t,isFailed:s}=this.fetchStatus;if(!e&&t&&!s)return this.fetchMorePage()}reduceToFirstPageStatus(e){this.nextCursor=e,this.fetchStatus.hasMore=!0}}s(96706);const Z=async e=>{const t=await fetch(e);return(e=>URL.createObjectURL(e))(await t.blob())};var M=s(1946);class R{constructor(e){this.props=e,(0,h.Z)(this,"fileMap",new Map)}ensureFile(e){let t=this.fileMap.get(e);return t||(t={data:this.props.initData(),events:{}},this.fileMap.set(e,t)),t}getFile(e){return this.fileMap.get(e)}register(e,t,s){this.ensureFile(t).events[e]=s}dispatch(e){var t,s;const n=this.fileMap.get(e.id);n&&(null===(t=(s=n.events)[e.type])||void 0===t||t.call(s,e,n))}removeFile(e){this.fileMap.delete(e)}}function A(e){return Boolean(e.title&&e.tags.length&&e.cover.id)}var L=s(17095);var O=s(18370);function U(){const e=(0,y.G)({watch:()=>n.isAllUploaded}),t=new m.l,{t:s}=(0,l.$)(),n=(0,c.fv)((()=>({formApi:null,setFormApi:e=>{n.formApi=e},performanceTimingCollector:(0,O.uY)(),initOp:new I({fetchFirstPage:async()=>{p.appModel.isInited||await(0,k.cb)({throwOnError:!0}),n.performanceTimingCollector.addTiming("initFullAppInfoDone"),(0,_.c6)("[CollectionStore] getTextTemplateCollectionInitialData req --\x3e");const e=await(0,P.mu)("getTextTemplateCollectionInitialData",{});return(0,_.c6)("[CollectionStore] getTextTemplateCollectionInitialData resp <--",{singles:e.singles}),()=>{n.handleNewSingles(e.singles),n.selectCollectionCard(),n.performanceTimingCollector.addSetStateTiming(O.Pk)}},slardarErrorLog:(e,t)=>{n.performanceTimingCollector.addSetStateTiming(O.Pk,{scene:"initFailed"}),(0,_.RF)(`[CollectionStore] ${e} failed`,t)}}),get mainFormLayout(){const{fetchStatus:e}=n.initOp;return e.isFailed?"error":e.hasFetched?"mainForm":"loading"},get needConfirmModalOnClose(){return!0},pubServ:new w,authorSignService:new S.I({signScene:j.d.BusinessArtist}),authFileUploadServiceManager:new T.r({}),uploadConfigService:new E.w,isAllUploadedWatcher:e,textTemplateIds:[],textTemplateMap:new Map,get textTemplates(){return n.textTemplateIds.map((e=>n.textTemplateMap.get(e)))},selectedTextTemplateId:"",get selectedTextTemplate(){var e;return n.textTemplateIds.includes(n.selectedTextTemplateId)&&null!==(e=n.textTemplateMap.get(n.selectedTextTemplateId))&&void 0!==e?e:null},isCollectionCardSelected:!1,collection:{id:(0,M.V)("text-template-collection"),title:"",description:"",tags:[],cover:{id:"",uri:"",src:"",isUploadFailed:!1}},async init(){n.initOp.initFetchFirstPage(null)},async retryInit(){n.initOp.retryFetchFirstPage()},openOnlineTextTemplatePicker(){t.lock(F,(async()=>{const e=[...n.textTemplateIds];(0,_.c6)("[CollectionStore] openOnlineTextTemplatePicker req --\x3e",{singles:e});const t=await(s={singles:e},P.Jn.call("openOnlineTextTemplatePicker",s));var s;(0,_.c6)("[CollectionStore] openOnlineTextTemplatePicker resp <--",{singles:t.singles}),0!==t.singles.length&&n.handleNewSingles(t.singles)}))},async handleNewSingles(e){if(!e)return;const t=[];if(e.forEach((e=>{const{id:s,source:l,title:i,cover:r,isVip:o}=e;n.textTemplateMap.has(e.id)||(t.push(s),n.textTemplateMap.set(s,{id:s,source:l,title:i,coverSrc:"",tags:[],isOriginal:!1,isVip:o,isBusiness:!1}),n.updateWithBlobUrl(s,r))})),n.textTemplateIds=e.map((e=>e.id)),0===t.length)return void(0,_.c6)("[CollectionStore] handleNewSingles no addedIds");(0,_.c6)("[CollectionStore] handleNewSingles mgetItem start",{ids:t});const s=await(0,C.yF)({items:t.map((e=>({id:e,source:n.textTemplateMap.get(e).source,effect_type:u.TextTemplate}))),pack_optional:{need_tag:!0,need_parent_tag:!1}});(0,_.c6)("[CollectionStore] handleNewSingles mgetItem success",{ids:s.effect_item_list.map((e=>e.common_attr.id))}),(0,a.z)((()=>{s.effect_item_list.forEach((e=>{var t;const{id:s,business_info:l,is_business:i,is_original:r,tag_list:o}=e.common_attr,a=n.textTemplateMap.get(s);if(!a)return;const c=[...new Set((o||[]).map((e=>e.name)))];a.tags=c,a.isOriginal=r,a.isVip=Boolean(null===(t=l.json)||void 0===t?void 0:t.is_vip),a.isBusiness=i,n.selectedTextTemplateId===s&&n.updateSingleForm({tags:[...c]})}))})),(0,_.c6)("[CollectionStore] handleNewSingles updated with online data")},async updateWithBlobUrl(e,t){try{const s=await Z(t),l=n.textTemplateMap.get(e);if(!l)return;(0,a.z)((()=>{l.coverSrc=s}))}catch(s){(0,_.RF)("[CollectionStore] updateWithBlobUrl error",s,{id:e,src:t})}},selectTextTemplateCard(e){n.saveCurrentForm(),n.isCollectionCardSelected=!1,n.selectedTextTemplateId=e.id},selectCollectionCard(){n.saveCurrentForm(),n.isCollectionCardSelected=!0,n.selectedTextTemplateId=""},initSingleForm(e){n.updateSingleForm({title:e.title,tags:[...e.tags]})},updateSingleForm(e){var t;null===(t=n.formApi)||void 0===t||t.setValues({single:{...n.formApi.getValue("single"),...e}})},initCollectionForm(){var e;const{collection:t}=n;null===(e=n.formApi)||void 0===e||e.setValues({collection:{title:t.title,description:t.description,tags:t.tags}})},updateCollection(e){Object.assign(n.collection,e)},saveCurrentForm(){if(n.isCollectionCardSelected){var e;const t=null===(e=n.formApi)||void 0===e?void 0:e.getValue("collection");if(!t)return;n.collection.title=t.title,n.collection.description=t.description,n.collection.tags=t.tags}},fileEventDispatcher:new R({initData:()=>null}),openCoverImageEditor(){t.lock(F,(async()=>{await n.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"openCoverImageEditor"});const{imageUploadConfig:e,objectUploadConfig:t}=await n.uploadConfigService.getUploadConfigs("openCoverImageEditor"),s={collectionId:n.collection.id,type:"CoverImage",singles:n.textTemplateIds,thumbnailSize:200,minImageSize:320,maxImageSize:1e3,maxFileSize:20971520,imageUploadConfig:e,objectUploadConfig:t};(0,_.c6)("[CollectionStore] openTextTemplateImageEditor req --\x3e",{...(0,o.Z)(s,"singles")});const{id:l}=await(e=>P.Jn.call("openTextTemplateImageEditor",e))(s);(0,_.c6)("[CollectionStore] openTextTemplateImageEditor resp <--",{id:l}),l&&n.replaceCover(l)}))},replaceCover(e){n.collection.cover.id&&n.fileEventDispatcher.removeFile(n.collection.cover.id),n.collection.cover={id:e,uri:"",src:"",isUploadFailed:!1},n.fileEventDispatcher.register("Thumbnail",e,(t=>{n.collection.cover.id===e?t.base64?(0,a.z)((()=>{const{cover:e}=n.collection;e.src=((e,t="")=>`data:${t};base64,${e}`)(t.base64)})):(0,_.RF)(`[CollectionStore] cover thumbnail failed {${e}}`):(0,_.c6)(`[CollectionStore] cover thumbnail ignored {${e}}`,{coverId:n.collection.cover.id})})),n.fileEventDispatcher.register("Upload",e,(t=>{if(n.collection.cover.id!==e)return void(0,_.c6)(`[CollectionStore] cover upload ignored {${e}}`,{coverId:n.collection.cover.id});const{cover:s}=n.collection,{uri:l}=t;(0,a.z)((()=>{if(l)s.uri=l,(0,_.c6)(`[CollectionStore] cover upload success {${e}}`,{uri:l});else{s.isUploadFailed=!0;const n=t.error||"unknown";(0,_.RF)(`[CollectionStore] cover upload failed {${e}}`,null,{error:n})}}))}))},async retryUpload(){const e=[],{collection:t}=n;var s;(t.cover.isUploadFailed&&e.push(t.cover.id),e.length)&&((0,_.c6)("[CollectionStore] retryUploadTextTemplateFiles req --\x3e",{ids:e}),await(s={ids:e},P.Jn.call("retryUploadTextTemplateFiles",s)),(0,_.c6)("[CollectionStore] retryUploadTextTemplateFiles resp <--",{}),(0,a.z)((()=>{e.includes(t.cover.id)&&(t.cover.isUploadFailed=!1)})))},get uploadStats(){let e=0,t=0,s=0;const{cover:l}=n.collection;return l.isUploadFailed?s+=1:l.uri?t+=1:e+=1,{pending:e,succeeded:t,failed:s}},get isAllUploaded(){const{pending:e,failed:t}=n.uploadStats;return!e&&!t},get isReadyToPublish(){const e=n.textTemplates.length;return Boolean(e>=3&&e<=20&&A(n.collection)&&!n.isPublishSucceeded)},async uploadAndPublish(e){n.sendMaterialToolClickPublishLog(),n.isAllUploaded||(await n.retryUpload(),null==e||e.show(),await n.isAllUploadedWatcher.start());try{await n.publish()}finally{null==e||e.hide()}},isPublishing:!1,isPublishSucceeded:!1,async publish(){n.isPublishing=!0;try{await n.publishImpl()}catch(e){return d.FN.error(s("pc_sticker_release_failed_retry_web")),(0,a.z)((()=>{n.isPublishing=!1})),void(0,_.RF)("[CollectionStore] publish failed",e)}(0,a.z)((()=>{n.isPublishing=!1,n.isPublishSucceeded=!0})),(0,_.c6)("[CollectionStore] publish success"),setTimeout((()=>(0,N.gk)({showHomePage:!0})),1e3)},async publishImpl(){n.saveCurrentForm();const{collection:e,textTemplates:t,textTemplateIds:s}=n,{cover:l,title:i,description:r,tags:o}=e,a={effect_type:u.TextTemplateCollection,is_vip:!1,common_data:{title:i,description:r,icon:{image_uri:l.uri},source:C.r0.UserPostPcCollection,tags:[...o],is_business:!1,is_original:!1},collection_info:{resource_id_list:s}};(0,_.c6)("[CollectionStore] collection publish start",{resourceIdList:s});const{resource_id:c}=await n.pubServ.publish({id:e.id,req:a,onResult:({error:e,resourceId:t})=>{!function(e){const{multiLang:t,...s}=e,n=e=>({zh:"cn",en:"en",ja:"jp",ko:"kr"}[e]||""),l=e=>{var s;return null!==(s=null==t?void 0:t.map(e).join(","))&&void 0!==s?s:""};(0,L.g)({eventName:"material_tool_publish_status",params:{...s,...t&&{language_setting:l((({isMultiLang:e})=>e?"multi":"single")),language_type:l((({langs:e})=>n(e[0]))),language_total_type:l((({langs:e})=>e.map(n).join(";")))}}})}({text_template_cnt:s.length,material_type:"collection",status:e?"fail":"success",success_cnt:1}),e?(0,_.RF)("[CollectionStore] collection publish failed",e):(0,_.c6)("[CollectionStore] collection publish success",{resourceId:t})}});(0,_.c6)("[CollectionStore] collection publish done",{resourceId:c}),await n.pubServ.pollUntilAllInEffectList({ids:[c],types:[u.TextTemplateCollection]}),(0,_.c6)("[CollectionStore] poll done")},sendMaterialToolClickPublishLog(){const{textTemplateIds:e}=n;!function(e){const{caption_template_cnt:t,captionAnimationIds:s=[],text_template_cnt:n,material_type:l,text_special_effect_cnt:i}=e;(0,L.g)({eventName:"material_tool_click_publish_confirm",params:{caption_template_cnt:t,caption_animation_id:s.join(","),text_template_cnt:n,material_type:l,text_special_effect_cnt:i}})}({text_template_cnt:e.length,material_type:"collection"})}})));return function(e){const t=(0,c.fv)((()=>({get watchResult(){return e.watch()}})));(0,i.useEffect)((()=>{const e=(0,a.EH)((()=>{const e=t.watchResult;(0,N.c0)({isNeed:e})}));return()=>{e()}}),[])}({watch:()=>n.needConfirmModalOnClose}),(0,i.useEffect)((()=>{window.store=n,n.init(),n.uploadConfigService.uploadConfigsCache.update();const e=(0,N.KS)("TextTemplateFileProcessResult",(e=>{(0,_.c6)(`[JSB] TextTemplateFileProcessResult ${null==e?void 0:e.type} {${null==e?void 0:e.id}}`,{...(0,o.Z)(e,["result","uri","error"])}),n.fileEventDispatcher.dispatch(e)}));return()=>{e()}}),[]),n}const z=(0,i.createContext)(null),$=()=>(0,i.useContext)(z);var D=s(11527);const B=(0,n.Pi)((e=>{const{className:t}=e,{t:s}=(0,l.$)(),n=(0,i.useMemo)((()=>[{key:"collection",title:s("pc_text_template_collection_desc_web"),instructions:[{key:"",title:s("pc_text_template_release_combination_web")}]},{key:"single",title:s("pc_text_template_desc_web"),instructions:[{key:"",title:s("pc_text_template_release_effect_web")}]}]),[]),{isCollectionCardSelected:o,selectedTextTemplateId:a}=$(),c=(0,i.useMemo)((()=>()=>"init"),[]);return(0,D.jsx)(r.v,{className:t,groups:n,initGroup:"collection",activeGroup:o?"collection":"single",resetExpandedGroupKey:o?"collection":`single-${a}`,getStatus:c})}));var q=s(26800),W=s(12390),V=s(84875),H=s.n(V);const X="root-Jdq72k",J="title-x8UGgH",Y="line-HKnXMT";function G(e){const{className:t,title:s}=e;return(0,D.jsxs)("div",{className:H()(X,t),children:[(0,D.jsx)("div",{className:J,children:s}),(0,D.jsx)("div",{className:Y})]})}var K=s(2237),Q=s(96426),ee=s(85083),te=s(88623),se=s(82346),ne=s(84997),le=s(40699),ie=s(96305);const re=e=>{const{className:t,loadingText:s}=e,{t:n}=(0,l.$)(),{handleMouseEnter:i}=(0,ne.S)();return(0,D.jsxs)("div",{className:H()(ie.Z.root,t),children:[(0,D.jsx)(se.a,{className:ie.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,D.jsx)("div",{className:ie.Z.text,onMouseEnter:i,children:s||n("pc_stickers_release_in_web")})]})},oe=e=>{const{className:t,tooltip:s}=e,{t:n}=(0,l.$)(),{handleMouseEnter:r}=(0,ne.w)({content:s,className:ie.Z.tooltip}),o=(0,i.useRef)(null),{setIsMarqueeLoopRunning:a,reactNode:c}=(0,le.J)({text:n("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>o.current});return(0,D.jsxs)("div",{className:H()(ie.Z.root,t,ie.Z.error),onMouseEnter:e=>{a(!0),r(e)},onMouseLeave:()=>a(!1),children:[(0,D.jsx)(Q.r,{className:ie.Z.icon}),(0,D.jsx)("div",{ref:o,className:ie.Z.text,children:c})]})},ae=e=>{const{className:t,text:s}=e,{handleMouseEnter:n}=(0,ne.S)();return(0,D.jsxs)("div",{className:H()(ie.Z.root,t,ie.Z.checked),children:[(0,D.jsx)(te.r,{className:ie.Z.icon}),(0,D.jsx)("div",{className:ie.Z.text,onMouseEnter:n,children:s})]})},ce=e=>{const{className:t}=e,{t:s}=(0,l.$)(),{handleMouseEnter:n}=(0,ne.S)();return(0,D.jsxs)("div",{className:H()(ie.Z.root,t),children:[(0,D.jsx)("div",{className:H()(ie.Z.icon,ie.Z.yellowIcon),children:(0,D.jsx)("div",{className:ie.Z.yellowPoint})}),(0,D.jsx)("div",{className:ie.Z.text,onMouseEnter:n,children:s("pc_stickers_release_editing_web")}),(0,D.jsx)(ee.r,{className:ie.Z.icon})]})},de=e=>{const{className:t,loading:s,invalid:n,errorToolip:l,isInfoComplete:i,title:r,loadingText:o}=e;return s?(0,D.jsx)(re,{className:t,loadingText:o}):n?(0,D.jsx)(oe,{className:t,tooltip:l}):i?(0,D.jsx)(ae,{className:t,text:r}):(0,D.jsx)(ce,{className:t})},ue="root-W9YKLd",pe="selected-MfKVC9",me="cover-Sg1bSx",he="icon-NjGS_M",ge="textInfo-zYCck9",fe="title-PHGLK_",ve="description-W4AGHI",_e="statusBar-wU3FIA",xe="checkedStatusBar-YMzSep",Ce=({className:e,selected:t,coverSrc:s,title:n,description:i,isInfoComplete:r,onClick:o})=>{const{t:a}=(0,l.$)(),{handleMouseEnter:c}=(0,ne.S)();return(0,D.jsxs)("div",{className:H()(e,ue,t&&pe),onClick:o,children:[(0,D.jsx)("div",{className:me,children:s?(0,D.jsx)("img",{className:he,src:s}):(0,D.jsx)(K.t,{className:he,iconWidth:28})}),(0,D.jsxs)("div",{className:ge,children:[(0,D.jsx)("div",{className:fe,onMouseEnter:c,children:n||a("pc_stickers_release_group_name_web")}),(0,D.jsx)("div",{className:ve,onMouseEnter:c,children:i||a("pc_stickers_release_details_recommend_web")})]}),r?(0,D.jsx)(ae,{className:xe,text:a("pc_stickers_release_finish_fill_web")}):(0,D.jsx)(ce,{className:_e})]})},be=(0,n.Pi)((e=>{const{className:t}=e,s=$(),{collection:n}=s;return(0,D.jsx)(Ce,{className:t,selected:s.isCollectionCardSelected,coverSrc:n.cover.src,title:n.title,description:n.description,isInfoComplete:A(n),onClick:s.selectCollectionCard})}));var we=s(36983);const Se="menu-v4m02G",Te="menuItemContainer-K5Eent",ye="menuItem-eU7buP";function Ne(e){const{items:t}=e,s=e=>{e.currentTarget===e.target&&e.stopPropagation()};return(0,D.jsx)("div",{className:Se,onClick:s,children:(0,D.jsx)("div",{className:Te,onClick:s,children:t.map((({key:e,render:t},s)=>t({key:e,index:s,className:ye})))})})}var je=s(44478),Ee=s(20468),Pe=s(44704);const Fe="root-qThJ3Y",ke="point-ytHHVg",Ie=e=>{const{position:t,getPopupContainer:s,onClosePopover:n,popoverProps:l}=e,[r,o]=(0,i.useState)(!0),a=(0,q.Z)((()=>o(!1))),c=(0,i.useRef)(null);return(0,i.useLayoutEffect)((()=>{var e;null===(e=c.current)||void 0===e||e.focus()}),[]),(0,D.jsx)(d.J2,{autoAdjustOverflow:!0,position:"bottomLeft",clickToHide:!0,...l,className:H()(l.className,Pe.i.heycanPopoverWrapperClearStyle),trigger:"custom",visible:r,onEscKeyDown:a,onClickOutSide:a,getPopupContainer:s,onVisibleChange:e=>{var t;!e&&n(),null===(t=l.onVisibleChange)||void 0===t||t.call(l,e)},children:(0,D.jsx)("div",{className:ke,tabIndex:-1,ref:c,style:{...t}})})};function Ze(e){const{zIndex:t=1e3,...s}=e,[n,r]=(0,i.useState)(null),[o,a]=(0,i.useState)(null),{i18n:c}=(0,l.$)(),d=(0,q.Z)((()=>{n&&(n.destroy(),r(null),a(null))})),u=(0,q.Z)((()=>{null==n||n.destroy()})),p=(0,q.Z)((e=>{if(n)return;const s=document.createElement("div");s.className=Fe,s.style.zIndex=`${t}`;s.addEventListener("wheel",(e=>{e.currentTarget===s&&(e.preventDefault(),e.stopPropagation())}),!1),window.addEventListener("resize",d),document.body.appendChild(s);const l=(0,je.createRoot)(s);r({container:s,reactRoot:l,destroy:()=>{s.remove(),Promise.resolve().then((()=>l.unmount())),window.removeEventListener("resize",d)}}),a(e)})),m=(0,q.Z)((e=>{e.preventDefault(),e.stopPropagation(),p({left:e.clientX,top:e.clientY})}));return(0,i.useLayoutEffect)((()=>u),[]),(0,i.useLayoutEffect)((()=>{n&&o&&n.reactRoot.render((0,D.jsx)(Ee.a,{i18n:c,children:(0,D.jsx)(Ie,{popoverProps:s,getPopupContainer:()=>n.container,onClosePopover:d,position:o})})),n&&(n.container.style.zIndex=`${t}`)})),{handleContextMenu:m}}const Me="root-NGa4yU",Re="statusBar-z9k5q0",Ae="contextMenuItem-MQ4rUL",Le=(0,n.Pi)((e=>{const{className:t,textTemplate:s,isSelected:n,onClick:i,onDelete:r}=e,{t:o}=(0,l.$)(),{handleContextMenu:a}=Ze({content:(0,D.jsx)(Ne,{items:[{key:"remove",render:({key:e,className:t})=>(0,D.jsx)("div",{className:H()(t,Ae),onClick:()=>r(s),children:o("pc_stickers_release_delete_web")},e)}]})});return(0,D.jsxs)("div",{className:H()(Me,t),onClick:()=>{i(s)},children:[(0,D.jsx)(we.Y,{src:s.coverSrc,isInvalid:!1,isSelected:n,size:80,onContextMenu:e=>{e.preventDefault(),i(s)}}),(0,D.jsx)(de,{className:Re,loading:!1,invalid:!1,errorToolip:"",isInfoComplete:!0,title:s.title})]})})),Oe="root-LbkeWz",Ue="container-jnsvSx",ze="card-yURKE_",$e=(0,n.Pi)((e=>{const{className:t}=e,s=$();return(0,D.jsx)("div",{className:H()(Oe,t),children:(0,D.jsx)("div",{className:Ue,children:s.textTemplates.map(((e,t)=>(0,D.jsx)(Le,{className:ze,textTemplate:e,isSelected:s.selectedTextTemplateId===e.id,onClick:s.selectTextTemplateCard,onDelete:()=>{}},e.id)))})})})),De="root-SiuXcn",Be="icon-pvz0IF",qe=e=>{const{className:t,src:s}=e,n=H()(De,t);return(0,D.jsx)("div",{className:n,children:s?(0,D.jsx)("img",{className:Be,src:s}):(0,D.jsx)(K.t,{className:Be,iconWidth:28})})};var We;function Ve(){return Ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},Ve.apply(this,arguments)}const He=e=>i.createElement("svg",Ve({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),We||(We=i.createElement("path",{fill:"#D4A500",d:"M8 14c3.292 0 6-2.71 6-6.003C14 4.703 11.292 2 8 2S2 4.703 2 7.997C2 11.29 4.708 14 8 14Zm0-5.142c-.391 0-.62-.217-.638-.614l-.09-2.493c-.024-.421.277-.704.722-.704.445 0 .752.289.728.71l-.09 2.48c-.018.404-.247.621-.632.621Zm0 2.047c-.445 0-.794-.283-.794-.71 0-.428.349-.717.794-.717.451 0 .788.29.788.717s-.343.71-.788.71Z"}))),Xe="root-OOqubc",Je="loadingText-blkQ9S",Ye="errorText-b8vNmn",Ge="retryText-cBAROb",Ke="warnText-XizvZZ",Qe=e=>{const{className:t,isUploadFailed:s,onRetry:n,needImport:i,loading:r}=e,o=H()(Xe,t),{t:a}=(0,l.$)();return s?(0,D.jsx)("div",{className:o,children:(0,D.jsx)("span",{className:Ye,children:a("pc_stickers_release_error_x_web",{X:(0,D.jsx)("span",{className:Ge,onClick:n,children:a("pc_stickers_release_click_again_web")},"X")})})}):i?(0,D.jsxs)("div",{className:o,children:[(0,D.jsx)(He,{height:14,width:14}),(0,D.jsx)("span",{className:Ke,children:a("pc_stickers_release_add_cover_web")})]}):r?(0,D.jsxs)("div",{className:o,children:[(0,D.jsx)(se.a,{size:12,arcColor:"var(--grey-1)"}),(0,D.jsx)("span",{className:Je,children:a("pc_stickers_release_in_web")})]}):(0,D.jsx)("div",{className:o})},et="root-RGRrw_",tt="statusBar-g7EX3X",st="edit-gNJiPH",nt=(0,n.Pi)((e=>{const{t}=(0,l.$)(),s=$(),{cover:n}=s.collection;return(0,D.jsxs)("div",{className:et,children:[(0,D.jsx)(qe,{src:n.src}),(0,D.jsx)("div",{className:st,onClick:s.openCoverImageEditor,children:t("pc_stickers_release_cover_edit_web")}),(0,D.jsx)(Qe,{className:tt,isUploadFailed:n.isUploadFailed,onRetry:s.retryUpload,needImport:!n.id,loading:Boolean(n.id&&!n.src)})]})}));var lt=s(86439),it=s(16743);const rt="textarea-LCPYTj",ot=e=>{var t;const s=(0,i.useRef)(!1),[n,l]=(0,i.useState)(""),{allowEnter:r=!0,value:o,...a}=e,{className:c,maxLength:u,onChange:p,onCompositionEnd:m,onCompositionStart:h}=a,g=s.current?n:o,f=(0,q.Z)((e=>{const t=e||"";return r?t:t.replace(/\n/g,"")})),v=(0,q.Z)((e=>{const t=f(e);return void 0!==u?(0,lt.aF)(t,u):t})),_=(0,q.Z)((e=>{s.current=!0,l(e.currentTarget.value),null==h||h(e)})),x=(0,i.useRef)(null),{saveSelectionIfNeeded:C}=(0,it.u)({getInputElem:()=>x.current}),b=(0,q.Z)(((e,t)=>{C(e),null==p||p(e,t)})),w=(0,q.Z)((e=>{const t=v(e.currentTarget.value);s.current=!1,l(t),b(t,e),null==m||m(e)})),S=(0,q.Z)(((e,t)=>{const n=f(e);if(s.current)return void l(n);if(void 0===u)return void b(n,t);const i=v(n);b(i,t)})),T=(0,i.useMemo)((()=>({maxRows:3})),[]);return(0,D.jsx)(d.Kx,{autoComplete:"off",...a,ref:x,value:g,className:H()(c,rt),maxLength:void 0,autosize:null!==(t=a.autosize)&&void 0!==t?t:T,rows:1,onChange:S,onCompositionStart:_,onCompositionEnd:w})},at=(0,d.Q2)(ot);var ct=s(10422),dt=s(3298);let ut=function(e){return e.TagEachUser="TagEachUser",e.UseHasAgree="useHasAgree",e}({});const pt={TagEachUser:20};function mt(e,t,s=pt[e]){return{get:()=>JSON.parse(localStorage.getItem(e)||"{}")[t]||[],set:(n,l)=>{const i=JSON.parse(localStorage.getItem(e)||"{}"),r=i[t]||[];let o=[];"add"===n?(Array.isArray(l)?r.unshift(...l):r.unshift(l),o=Array.isArray(l)?Array.from(new Set(r.slice(0,s))):l):"remove"===n?o=r.filter((e=>Array.isArray(l)?l.includes(e):e!==l)):"change"===n&&(o=l),i[t]=o;const a=JSON.stringify(i);localStorage.setItem(e,a)}}}const ht="tag-ZaY7YS",gt="selected-umR1Vs",ft="disabled-A37DzB",vt=({className:e,value:t,selected:s,disabled:n,onClick:l})=>(0,D.jsx)(d.Vp,{className:H()(e,ht,s&&gt,n&&ft),color:s?"cyan":void 0,onClick:()=>null==l?void 0:l(t),children:t},t),_t="block-smxiey",xt="title-aqS4Cg",Ct="content-IyBLdN",bt="loading-QuFv_G",wt="text-ukrQOj",St=({className:e,title:t,loading:s,loadingText:n,value:l,options:r,onSelect:o})=>{const a=(0,i.useCallback)((e=>l.includes(e)),[l]),c=(0,i.useMemo)((()=>r.filter((e=>!l.includes(e)))),[l,r]);return 0===c.length?null:(0,D.jsxs)("div",{className:H()([_t,e]),children:[(0,D.jsx)("p",{className:xt,children:t}),(0,D.jsx)("div",{className:Ct,children:s?(0,D.jsxs)("div",{className:bt,children:[(0,D.jsx)("span",{className:wt,children:n}),(0,D.jsx)(d.yC,{size:"small"})]}):c.map((e=>(0,D.jsx)(vt,{selected:a(e),value:e,onClick:()=>o(e)},e)))})]})},Tt=(0,n.Pi)((({value:e,onSelect:t})=>{const[s,n]=(0,i.useState)([]),{t:r}=(0,l.$)();return(0,i.useEffect)((()=>{const e=mt(ut.TagEachUser,v.$.userInfo.uid).get();n(e)}),[v.$.userInfo.uid,e]),(0,D.jsx)(St,{title:r("pc_recently_used_web"),value:e,options:s,onSelect:t})})),yt=((0,n.Pi)((({title:e,uri:t,value:s,itemType:n,onSelect:r})=>{const[o,a]=(0,i.useState)([]),[c,d]=(0,i.useState)([]),[u,p]=(0,i.useState)(!1),m=(0,i.useRef)({selfConfigTagsReady:{}}),{t:h}=(0,l.$)(),g=(0,i.useMemo)((()=>[...c,...o]),[o,c]),f=(0,q.Z)((e=>{const{title:t,uri:s}=e;return t?m.current.cvid&&m.current.uri===s?{cvid:m.current.cvid,title:t}:s?{image_uri:s,title:t}:null:null})),v=(0,i.useCallback)((async()=>{try{p(!0);const s=f({title:e,uri:t});await Promise.all([s&&(0,C.Uz)(s).then((e=>{d(e.cv_tags),m.current.cvid=e.cvid,s.image_uri&&(m.current.uri=s.image_uri)})),!m.current.selfConfigTagsReady[n]&&(0,C.On)({effect_type:n}).then((e=>{a(e.rec_tags),m.current.selfConfigTagsReady[n]=!0}))])}finally{p(!1)}}),[e,t,n]);return(0,dt.Z)(v,500,[v]),(0,i.useEffect)((()=>{v()}),[n]),(0,D.jsx)(St,{title:h("recommend_signature_web"),loading:u,loadingText:h("loading_web"),value:s,options:g,onSelect:r})})),"tagSelect-KEPqcU"),Nt="dropItem-bpnHuZ",jt="suggestListDropdown-fV0lMc",Et=(0,n.Pi)((({recommendConfig:e,value:t=[],itemType:s,disabled:n,disableRecommend:r,disableLatest:o,onChange:a,placeholder:c,max:u=15,temporaryId:p,ignoreAddTagOnBlurSelector:h,onRecentTagSelect:g})=>{const f=(0,i.useRef)(!1),[x,b]=(0,i.useState)(""),[w,S]=(0,i.useState)(""),T=(0,i.useRef)(!1),y=T.current?w:x,[N,j]=(0,i.useState)([]),[E,P]=(0,i.useState)([]),{t:F}=(0,l.$)(),k=e=>mt(ut.TagEachUser,v.$.userInfo.uid).set("add",[e]),I=(0,q.Z)((e=>{P(x?e:[])}));(0,dt.Z)((async()=>{if(!s||!x)return;const e=await(0,C.EO)({query:x,count:10}),t=(null==e?void 0:e.sug_tags)||[];I(t)}),500,[x,s]),(0,i.useEffect)((()=>{x||P([])}),[x]);const Z=(0,i.useCallback)((e=>{if(u&&e.length>u)return d.FN.error(F("pc_stickers_release_max_tag_web",{X:u})),void(null==a||a(e.slice(0,u)));null==a||a(e)}),[a]),M=(0,q.Z)((e=>{t.includes(e)||Z([...t,e])})),R=(0,i.useMemo)((()=>new m.l),[]),A=(0,q.Z)((async e=>{const s=await R.lock("",(async()=>{if(t.includes(e))return!0;let s=!1;try{const t=await(0,C._K)({words:e,scene:C.Xb.Tag});s=!1===(null==t?void 0:t.is_hit)}catch(n){return(0,_.RF)("[TagSelect] call checkAntiDirt failed",n,{tag:e}),d.FN.error(F("pc_tag_retry_web")),!1}return s?(M(e),!0):((0,_.c6)("[TagSelect] checkAntiDirt not passed",{tag:e}),d.FN.error(F("pc_tag_illegal_fail_web")),!1)}));return null!=s&&s})),L=(0,q.Z)((e=>{if(0===e.length)return;const s=t.filter((t=>!e.includes(t)));Z(s)})),O=(0,i.useRef)(null),{saveSelectionIfNeeded:U}=(0,it.u)({getInputElem:()=>{var e;return null===(e=O.current)||void 0===e?void 0:e.inputRef.current}}),z=e=>{const t=(0,lt.aF)(e,30);U(t),b(t)},$=(0,q.Z)((e=>{z(""),t.includes(e)?L([e]):(M(e),k(e))})),B=e=>{const t=N.includes(e);j(t?N.filter((t=>t!==e)):[...N,e])},W=(0,q.Z)((()=>{L(N),j([])})),V=(0,q.Z)((()=>O.current&&O.current.inputRef.current&&O.current.tagInputRef.current?{tagInput:O.current,tagInputElem:O.current.tagInputRef.current,inputElem:O.current.inputRef.current}:null)),H=(0,q.Z)((e=>{const t=V();return!!(t&&e&&e instanceof Element)&&e.closest(".semi-tagInput")===t.tagInputElem})),X=(0,q.Z)((e=>!!(e&&e instanceof Element)&&null!==e.closest(".semi-tag"))),J=(0,q.Z)((e=>{const t=e.target,s=V();if(!s||!H(t))return;const{tagInput:n,tagInputElem:l,inputElem:i}=s,{selectionStart:r,selectionEnd:o}=i;return N.length>0&&X(t)?(W(),null==i||i.setSelectionRange(0,0),void n.focus()):void 0})),Y=(0,q.Z)((e=>{const t=e.target;V()&&H(t)&&X(t)&&(H(e.relatedTarget)&&X(e.relatedTarget)||j([]))}));(0,i.useEffect)((()=>{const e=e=>{"Delete"===e.code||"Backspace"===e.code?(f.current=!0,J(e)):f.current=!1};return window.addEventListener("keydown",e,!0),window.addEventListener("blur",Y,!0),()=>{window.removeEventListener("keydown",e,!0),window.removeEventListener("blur",Y,!0)}}),[]);const G=(0,q.Z)((e=>{e.replace(/ {1,}/g,"")===x.replace(/ {1,}/g,"")&&z("")})),K=async e=>{const[t]=e;Promise.resolve().then((()=>z(x)));const s=t.replace(/ {1,}/g,"");if(0===s.length)return;await A(s)&&(k(s),G(x))},Q=async e=>{if(T.current)return void S(e);const t=e.replace(/ {1,}$/,""),s=t.replace(/ {1,}/g,"");if(z(t),t===e||!t||f.current)return;await A(s)&&(k(s),G(x))};(0,i.useEffect)((()=>{var e;const t=null===(e=O.current)||void 0===e?void 0:e.inputRef.current;if(!t)return;const s=()=>{T.current=!0,S(t.value)},n=()=>(0,ct.unstable_batchedUpdates)((()=>{T.current=!1,S(""),Q(t.value)}));return t.addEventListener("compositionstart",s),t.addEventListener("compositionend",n),()=>{t.removeEventListener("compositionstart",s),t.removeEventListener("compositionend",n)}}),[]);(0,i.useEffect)((()=>{p&&b("")}),[p]);return(0,D.jsxs)("div",{className:yt,children:[(0,D.jsx)(d.Lt,{position:"bottomLeft",trigger:"focus",className:jt,style:{maxHeight:200,overflow:"scroll"},render:(0,D.jsx)(d.Lt.Menu,{children:E.map((e=>(0,D.jsx)(d.Lt.Item,{className:Nt,onClick:()=>$(e),children:e},e)))}),children:(0,D.jsx)(d.EG,{ref:O,inputValue:y,onInputChange:Q,value:t,placeholder:c,renderTagItem:(e,t,s)=>(0,D.jsx)(vt,{value:e,selected:N.includes(e),disabled:n,onClick:B},e),onAdd:K,onBlur:e=>{if(e.relatedTarget&&e.relatedTarget instanceof Element){const t=[`.${jt}`,h].filter((e=>e)).join(",");if(null!==e.relatedTarget.closest(t)||X(e.relatedTarget))return}K([x])},disabled:n})}),!1,!n&&!o&&(0,D.jsx)(Tt,{value:t,onSelect:e=>{$(e),null==g||g()}})]})})),Pt=(0,d.Q2)(Et);var Ft=s(45033);const kt="root-rKCzio",It="titleField-DfDWNz",Zt=(0,n.Pi)((()=>{const{t:e}=(0,l.$)(),t=$(),{collection:s}=t;(0,i.useLayoutEffect)((()=>t.initCollectionForm()),[]);const{getDisplayLength:n}=(0,Ft._)();return(0,D.jsxs)("div",{className:kt,children:[(0,D.jsx)(nt,{}),(0,D.jsx)(at,{fieldClassName:It,label:e("pc_text_template_name_n_web"),field:"collection.title",maxLength:40,allowEnter:!1,placeholder:e("pc_stickers_release_xy_name_web",{X:1,Y:n(40)}),rules:[{required:!0,message:""}],onChange:e=>t.updateCollection({title:e})}),(0,D.jsx)(at,{label:e("pc_stickers_release_details_recommend_web"),field:"collection.description",maxLength:52,allowEnter:!1,placeholder:e("pc_stickers_release_xy_details_web",{X:1,Y:n(52)}),onChange:e=>t.updateCollection({description:e})}),(0,D.jsx)(Pt,{label:e("pc_text_template_tag_settings_web"),placeholder:e("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"collection.tags",itemType:u.TextTemplate,recommendConfig:{title:s.title,uri:s.cover.uri},rules:[{required:!0,message:""}],onChange:e=>t.updateCollection({tags:e})})]})})),Mt="root-l6malL",Rt="cover-NC1s_6",At="titleField-GmjT0V",Lt=(0,n.Pi)((e=>{const{t}=(0,l.$)(),s=$(),n=s.selectedTextTemplate;(0,i.useLayoutEffect)((()=>{n&&s.initSingleForm(n)}),[n]);const{getDisplayLength:r}=(0,Ft._)();return n?(0,D.jsxs)("div",{className:Mt,children:[(0,D.jsx)(we.Y,{className:Rt,src:n.coverSrc,isInvalid:!1,isSelected:!1,size:128}),(0,D.jsx)(at,{fieldClassName:At,label:t("pc_stickers_release_set_title_web"),disabled:!0,field:"single.title",maxLength:40,allowEnter:!1,placeholder:t("pc_stickers_release_xy_name_web",{X:1,Y:r(40)}),rules:[{required:!0,message:""}]}),(0,D.jsx)(Pt,{label:t("pc_stickers_release_tag_set_web"),placeholder:t("please_enter_the_label_enter_key_to_confirm_the_input_web"),disabled:!0,field:"single.tags",max:15,itemType:u.TextTemplate,rules:[{required:!0,message:""}]})]}):null})),Ot=(0,n.Pi)((e=>{const{className:t}=e,s=$(),{t:n}=(0,l.$)(),r=(0,q.Z)((()=>{})),o=(0,i.useRef)(null);return(0,W.O)({className:t,layout:s.mainFormLayout,uploadAreaProps:{titleForUploadArea:"",titleForMainForm:n("pc_text_template_add_click_web"),draggingDisabled:!0,disabled:!1,onClick:s.openOnlineTextTemplatePicker,onDrop:r},setFormApi:s.setFormApi,renderImportArea:e=>(0,D.jsxs)(D.Fragment,{children:[e,(0,D.jsx)(G,{title:n("pc_text_template_collection_web")}),(0,D.jsx)(be,{}),(0,D.jsx)(G,{title:n("pc_text_template_n_collection_web",{X:s.textTemplateIds.length})}),(0,D.jsx)($e,{})]}),renderFormArea:()=>s.isCollectionCardSelected?(0,D.jsx)(Zt,{}):s.selectedTextTemplate?(0,D.jsx)(Lt,{}):null,scrollAreaRef:o,onRetry:s.retryInit})}));var Ut=s(67927),zt=s(73224),$t=s(41750),Dt=s(5696),Bt=s(7911),qt=s(68212);let Wt=function(e){return e.Origin="originUserAuthProtocol",e.OriginalForSubscription="originalWorkProtocolForSubscription",e.OriginalForCommercial="originalWorkProtocolForCommercial",e.Creator="createProtocol",e.AuthorAgreement="AuthorAgreementProtocol",e}({});const Vt={[Wt.Origin]:(0,Dt.OD)(),[Wt.OriginalForSubscription]:(0,Dt.OD)(),[Wt.OriginalForCommercial]:(0,Dt.NZ)(),[Wt.Creator]:(0,Dt.dr)({}),[Wt.AuthorAgreement]:(0,Dt.kx)()},Ht={[Wt.Origin]:"Original Work Notice",[Wt.OriginalForSubscription]:"Original Work Notice",[Wt.OriginalForCommercial]:"Original Work Notice",[Wt.Creator]:zt.I18n.t("pc_capcut_creator_agreement_web"),[Wt.AuthorAgreement]:zt.I18n.t("cc_pc_material_publish_paid_authorize_popup_title_web")};(0,n.Pi)((({onCancel:e,onOk:t,protocol:s,handleBtnText:n,closeIcon:r=!1,needReview:o=!0,useIframe:a=!0,needHasRead:c=!0,renderConfirmExtra:u,getCanConfirmExtra:p})=>{const{t:m}=(0,l.$)(),[h,g]=(0,i.useState)(!1),[f,v]=(0,i.useState)(!1),x=!c||h,C=()=>!o||x&&f&&(!p||p()),{handleMouseEnter:b}=(0,ne.w)({content:m("pc_template_authorize_read_all_web"),cursor:"not-allowed"}),w=(0,i.useRef)(null),S={disabled:!x,handleMouseEnter:!o||x?void 0:b},T=()=>{C()&&(null==t||t())};(0,i.useEffect)((()=>{const e=e=>{const t=e.data;try{const e=JSON.parse(t),s=document.getElementById("protocol-content"),n="protocal"===e.from||"protocol"===e.from;if(n&&"load"===e.event)if(s){const{clientHeight:t}=s;e.scrollHeight<=t&&g(!0)}else g(!0);n&&"bottom"===e.event&&g(!0)}catch(s){g(!0),(0,_.RF)("[Protocol] handle protocol message",s,{text:t})}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}}),[]);const y=()=>{if(w.current&&!a){const{scrollHeight:e,clientHeight:t,scrollTop:s}=w.current;!x&&s+t>=e&&g(!0)}};return(0,i.useEffect)((()=>{var e;return null===(e=w.current)||void 0===e||e.addEventListener("scroll",y),()=>{var e;null===(e=w.current)||void 0===e||e.removeEventListener("scroll",y)}}),[w.current]),(0,i.useLayoutEffect)((()=>{const e=document.getElementById("protocol-content");if(e&&!a){const{scrollHeight:t,clientHeight:s}=e;g(!(t>s)),w.current=e}}),[]),(0,D.jsxs)("div",{className:Bt.Z.protocol,children:[(0,D.jsxs)("div",{className:qt.Z.root,children:[(0,D.jsx)("div",{className:qt.Z.title,children:Ht[s]}),(0,D.jsx)("div",{className:qt.Z.right,children:r&&(0,D.jsx)($t.r,{className:qt.Z.closeIcon,onClick:()=>{null==e||e("close")}})})]}),(0,D.jsx)("div",{className:H()(Bt.Z.content,!o&&Bt.Z.withBorder,o&&Bt.Z.flexHeight),id:"protocol-content",children:a?(0,D.jsx)("iframe",{id:"frame",src:Vt[s]}):(0,D.jsx)("div",{className:Bt.Z.protocolContent,children:null})}),n&&o?(0,D.jsxs)("div",{className:Bt.Z.confirmArea,children:[(0,D.jsx)(d.XZ,{className:Bt.Z.confirmCheckbox,checked:f,disabled:S.disabled,onMouseEnter:S.handleMouseEnter,onChange:e=>v(Boolean(e.target.checked)),autoFocus:!1,children:(0,D.jsx)("span",{className:Bt.Z.confirmCheckboxText,children:m("pc_template_authorize_read_agree_web",{X:(0,D.jsx)("span",{className:Bt.Z.confirmCheckboxProtocolTitle,children:Ht[s]},"X")})})}),null==u?void 0:u()]}):null,(()=>{const e=n;return e?(0,D.jsx)("div",{className:H()(Bt.Z.footer,o&&Bt.Z.withBorder),children:(0,D.jsx)(d.zx,{className:Bt.Z.btn,type:"primary",theme:"solid",disabled:!C(),onClick:T,children:e})}):null})()]})}));var Xt=s(80432);const Jt=({className:e,leftText:t,isPublishDisabled:s,isPublishing:n,needConfirmModalOnClose:r,onPublish:o,beforeCancel:a,onCancel:c})=>{const{t:u}=(0,l.$)(),m=(0,q.Z)((async()=>{if(a&&a(),r){if(await Ut.Z.warn({mainText:u("pc_sticker_cancel_web"),subText:u("pc_sticker_click_unrecoverable_web"),confirmBtnText:u("pc_stickers_release_confirm_quit_web"),cancelBtnText:u("pc_stickers_release_cancel_web")})!==Ut.L.Confirm)return}c?c():(0,N.Nt)()})),h=Wt.Creator,{language:g,region:f}=p.appModel.appInfo,v=(0,i.useMemo)((()=>(0,Dt.dr)({lang:g,region:f})),[g,f]);return(0,D.jsxs)("div",{className:H()(e,Xt.Z.root),children:[(0,D.jsx)("div",{className:Xt.Z.left,onClick:undefined,children:t}),(0,D.jsxs)("div",{className:Xt.Z.right,children:[(0,D.jsx)("span",{className:Xt.Z.remind,onClick:()=>{window.open(v,"_blank")},children:u("pc_sticker_release_agree_{X}_web",{X:(0,D.jsx)("span",{className:Xt.Z.protocol,children:Ht[h]},"protocol")})}),(0,D.jsxs)("div",{className:Xt.Z.buttonContainer,children:[(0,D.jsx)(d.zx,{className:Xt.Z.button,type:"primary",theme:"solid",disabled:s,loading:n,onClick:o,children:u("pc_stickers_release_web")}),(0,D.jsx)(d.zx,{className:Xt.Z.button,type:"secondary",theme:"solid",onClick:m,children:u("pc_stickers_release_cancel_web")})]})]})]})};var Yt=s(36775);const Gt=(0,n.Pi)((e=>{const{className:t}=e,s=$(),{t:n}=(0,l.$)(),r=(0,i.useRef)(null);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Jt,{className:t,leftText:n("pc_text_template_import_web",{X:s.textTemplateIds.length,Y:3,Z:20}),isPublishDisabled:!s.isReadyToPublish,isPublishing:s.isPublishing,needConfirmModalOnClose:s.needConfirmModalOnClose,onPublish:()=>s.uploadAndPublish(r.current),onCancel:()=>(0,N.gk)({showHomePage:!0})}),(0,D.jsx)(Yt.q,{ref:r,uploadStats:s.uploadStats,onRetryUpload:s.retryUpload,onCancel:s.isAllUploadedWatcher.stop,onShowUploadFail:()=>{},onPromptConfirmToCancel:s.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var Kt=s(12904),Qt=s(65546);const es="page-HRk3ka",ts="content-LGuZmP",ss="instruction-eUXPJ0",ns="mainForm-PzQVLp",ls="footer-t1kXBF",is=(0,n.Pi)((e=>{const t=U(),{t:s}=(0,l.$)();return(0,Kt.F)({title:s("pc_text_template_collection_release_web"),pid:"publish-text-template-collection"}),(0,Qt.d)(),(0,D.jsx)(z.Provider,{value:t,children:(0,D.jsxs)("div",{className:es,children:[(0,D.jsxs)("div",{className:ts,children:[(0,D.jsx)(B,{className:ss}),(0,D.jsx)(Ot,{className:ns})]}),(0,D.jsx)(Gt,{className:ls})]})})}))},17095:(e,t,s)=>{s.d(t,{g:()=>l});var n=s(46309);function l(e){console.log("[sendLog]",e.eventName,e.params),(0,n.qx)(e)}}}]);