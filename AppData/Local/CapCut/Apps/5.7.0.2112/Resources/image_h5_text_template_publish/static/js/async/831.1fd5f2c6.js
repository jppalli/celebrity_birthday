"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[831],{42983:(e,t,i)=>{i.d(t,{Ab:()=>s});let s=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({})},38803:(e,t,i)=>{i.d(t,{P:()=>g});var s=i(50959),r=i(84875),a=i.n(r),n=i(84736),o=i(26800),l=i(45599),c=i(46309),d=i(67927),u=i(21919),p=i(54847),h=i(5696),m=i(80432),f=i(11527);const g=({className:e,leftText:t,isPublishDisabled:i,isPublishing:r,needConfirmModalOnClose:g,onPublish:_,beforeCancel:v,onCancel:w})=>{const{t:x}=(0,l.$)(),y=(0,o.Z)((async()=>{if(v&&v(),g){if(await d.Z.warn({mainText:x("pc_sticker_cancel_web"),subText:x("pc_sticker_click_unrecoverable_web"),confirmBtnText:x("pc_stickers_release_confirm_quit_web"),cancelBtnText:x("pc_stickers_release_cancel_web")})!==d.L.Confirm)return}w?w():(0,c.Nt)()})),F=u.YW.Creator,{language:b,region:T}=p.appModel.appInfo,S=(0,s.useMemo)((()=>(0,h.dr)({lang:b,region:T})),[b,T]);return(0,f.jsxs)("div",{className:a()(e,m.Z.root),children:[(0,f.jsx)("div",{className:m.Z.left,onClick:undefined,children:t}),(0,f.jsxs)("div",{className:m.Z.right,children:[(0,f.jsx)("span",{className:m.Z.remind,onClick:()=>{window.open(S,"_blank")},children:x("pc_sticker_release_agree_{X}_web",{X:(0,f.jsx)("span",{className:m.Z.protocol,children:u.rr[F]},"protocol")})}),(0,f.jsxs)("div",{className:m.Z.buttonContainer,children:[(0,f.jsx)(n.zx,{className:m.Z.button,type:"primary",theme:"solid",disabled:i,loading:r,onClick:_,children:x("pc_stickers_release_web")}),(0,f.jsx)(n.zx,{className:m.Z.button,type:"secondary",theme:"solid",onClick:y,children:x("pc_stickers_release_cancel_web")})]})]})]})}},69836:(e,t,i)=>{i.d(t,{ir:()=>w});var s=i(50959),r=i(84875),a=i.n(r),n=i(45599),o=i(96426),l=i(85083),c=i(88623),d=i(82346),u=i(84997),p=i(40699),h=i(96305),m=i(11527);const f=e=>{const{className:t,loadingText:i}=e,{t:s}=(0,n.$)(),{handleMouseEnter:r}=(0,u.S)();return(0,m.jsxs)("div",{className:a()(h.Z.root,t),children:[(0,m.jsx)(d.a,{className:h.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,m.jsx)("div",{className:h.Z.text,onMouseEnter:r,children:i||s("pc_stickers_release_in_web")})]})},g=e=>{const{className:t,tooltip:i}=e,{t:r}=(0,n.$)(),{handleMouseEnter:l}=(0,u.w)({content:i,className:h.Z.tooltip}),c=(0,s.useRef)(null),{setIsMarqueeLoopRunning:d,reactNode:f}=(0,p.J)({text:r("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>c.current});return(0,m.jsxs)("div",{className:a()(h.Z.root,t,h.Z.error),onMouseEnter:e=>{d(!0),l(e)},onMouseLeave:()=>d(!1),children:[(0,m.jsx)(o.r,{className:h.Z.icon}),(0,m.jsx)("div",{ref:c,className:h.Z.text,children:f})]})},_=e=>{const{className:t,text:i}=e,{handleMouseEnter:s}=(0,u.S)();return(0,m.jsxs)("div",{className:a()(h.Z.root,t,h.Z.checked),children:[(0,m.jsx)(c.r,{className:h.Z.icon}),(0,m.jsx)("div",{className:h.Z.text,onMouseEnter:s,children:i})]})},v=e=>{const{className:t}=e,{t:i}=(0,n.$)(),{handleMouseEnter:s}=(0,u.S)();return(0,m.jsxs)("div",{className:a()(h.Z.root,t),children:[(0,m.jsx)("div",{className:a()(h.Z.icon,h.Z.yellowIcon),children:(0,m.jsx)("div",{className:h.Z.yellowPoint})}),(0,m.jsx)("div",{className:h.Z.text,onMouseEnter:s,children:i("pc_stickers_release_editing_web")}),(0,m.jsx)(l.r,{className:h.Z.icon})]})},w=e=>{const{className:t,loading:i,invalid:s,errorToolip:r,isInfoComplete:a,title:n,loadingText:o}=e;return i?(0,m.jsx)(f,{className:t,loadingText:o}):s?(0,m.jsx)(g,{className:t,tooltip:r}):a?(0,m.jsx)(_,{className:t,text:n}):(0,m.jsx)(v,{className:t})}},37991:(e,t,i)=>{i.d(t,{v:()=>S});var s=i(50959),r=i(23479),a=i(61022),n=i(84875),o=i.n(n),l=i(84736),c=i(45599),d=i(20468),u=i(66589),p=i(1938),h=i(86156),m=i(8129),f=i(26800),g=i(73023);let _;const v=new WeakMap;function w(e){let t=v.get(e);return t||(t=new Set,v.set(e,t)),t}const x="46px",y="2px",F={macos:"macos",windows:"windows",heycanRatioGroupEllipsis:"heycan-ratio-group-ellipsis",heycanCheckboxEllipsis:"heycan-checkbox-ellipsis",heycanFormFieldEllipsis:"heycan-form-field-ellipsis",heycanPopoverWrapperClearStyle:"heycan-popover-wrapper-clear-style",heycanTextareaThemeGrey:"heycan-textarea-theme-grey",heycanInputThemeGrey:"heycan-input-theme-grey",frameWidth:"46px",sliderWidth:"2px",modal:"modal-iFkPHk",root:"root-Zq2UXx",title:"title-RjRwF3",content:"content-pMppxf",loading:"loading-J12Xi0",footer:"footer-otMNTQ",buttonContainer:"buttonContainer-aC2XIN",button:"button-ekKG5u",previewImg:"previewImg-tCoExU",invisible:"invisible-Kg_ArH",frameViewer:"frameViewer-cEhK3e",frameList:"frameList-YrZVfi",frame:"frame-XEvw9I",slider:"slider-RraD19",isSliding:"isSliding-I3_Tp0"};var b=i(11527);const T=(0,r.Pi)((e=>{const{fetchData:t,onOK:i,onClose:r}=e,n=(0,a.fv)((()=>({dataFrameList:[],dataFrameIndex:0,setDataFrameIndex(e){n.dataFrameIndex=Math.max(0,Math.min(e,n.dataFrameList.length-1))},fetchOp:new h.q({fetchFirstPage:async()=>{const{list:e,index:i}=await t();return()=>{n.dataFrameList=e,n.dataFrameIndex=i,n.initSliderIfNeeded()}},slardarErrorLog:(e,t,i)=>(0,m.RF)(`[FramePicker] ${e} failed`,t,i)}),frameListWidth:0,halfSliderWidth:Number.parseInt(y,10)/2,frameWidth:Number.parseInt(x,10),get frameList(){const{dataFrameList:e,frameListWidth:t}=n;if(!e.length||!t)return[];const i=Math.ceil(t/n.frameWidth);return Array(i).fill(0).map(((t,s)=>{if(0===s)return e[0];if(s===i-1)return e[e.length-1];{const t=Math.floor(e.length*(s+.5)/i);return e[t]}}))},setWidth(e){n.frameListWidth=e,n.initSliderIfNeeded()},sliderCenterOffset:0,initSliderIfNeeded(){const{dataFrameList:e,frameListWidth:t}=n;e.length&&t&&(n.dataFrameIndex===n.dataFrameList.length-1?n.setSliderCenterOffset(t):n.setSliderCenterOffset(t*n.dataFrameIndex/n.dataFrameList.length))},setSliderCenterOffset(e){const t=n.halfSliderWidth,i=n.frameListWidth-n.halfSliderWidth;n.sliderCenterOffset=Math.max(t,Math.min(i,e))},handleOK(){i(n.dataFrameIndex)}}))),{handleRef:d}=function(e){const t=(0,f.Z)(((t,i)=>e.onResize(t,i))),i=(0,s.useMemo)((()=>({element:null,observer:(_||(_=new g.Z((e=>{let t=null;if(e.forEach((e=>{const i=w(e.target),s=e.target.getBoundingClientRect();i.forEach((e=>{try{e.props.onResize(s,e)}catch(i){null===t&&(t=i)}}))})),null!==t)throw t}))),_),props:{onResize:t},rect:null,unobserve:null})),[]),r=(0,f.Z)((e=>{var t;null===(t=i.unobserve)||void 0===t||t.call(i),e&&(i.observer.observe(e),i.element=e,i.rect=null,w(e).add(i),i.unobserve=()=>{i.unobserve=null,i.element=null,i.rect=null,i.observer.unobserve(e),w(e).delete(i)})}));return(0,s.useLayoutEffect)((()=>{if(i.element){const e=i.element.getBoundingClientRect();i.rect=null,t(e,i)}}),[]),(0,s.useEffect)((()=>()=>{var e;null===(e=i.unobserve)||void 0===e||e.call(i)}),[]),{resizeData:i,handleRef:r}}({onResize:(e,t)=>{t.element&&n.setWidth(t.element.clientWidth)}}),v=(0,s.useRef)(null),T=(0,s.useRef)({isSliding:!1,destroy:null}),S=e=>{var t,i;if(null===(t=(i=T.current).destroy)||void 0===t||t.call(i),!v.current)return;const s=v.current.getBoundingClientRect().left,r=(0,u.aD)((e=>{T.current.isSliding||(document.body.classList.add(F.isSliding),T.current.isSliding=!0),e.preventDefault(),n.setSliderCenterOffset(e.clientX-s);const t=Math.floor(n.dataFrameList.length*n.sliderCenterOffset/n.frameListWidth);n.setDataFrameIndex(t)})),a=()=>{var e,t;null===(e=(t=T.current).destroy)||void 0===e||e.call(t)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",a),r(e.nativeEvent),T.current.destroy=()=>{T.current.destroy=null,document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a),T.current.isSliding=!1,document.body.classList.remove(F.isSliding)},document.activeElement instanceof HTMLElement&&document.activeElement.blur()};(0,s.useEffect)((()=>{n.fetchOp.initFetchFirstPage(null)}),[]);const{isPending:k}=n.fetchOp.fetchStatus,C=n.frameList.length>0,{t:M}=(0,c.$)();return(0,b.jsxs)("div",{className:F.root,children:[(0,b.jsx)("div",{className:F.title,children:M("pc_stickers_release_cover_edit_web")}),k?(0,b.jsx)("div",{className:F.loading,children:(0,b.jsx)(p.Y,{status:"loading",children:M("loading_web")})}):(0,b.jsxs)("div",{className:F.content,children:[(0,b.jsx)("img",{className:o()(F.previewImg,!C&&F.invisible),src:C?n.dataFrameList[n.dataFrameIndex]:""}),(0,b.jsxs)("div",{ref:v,className:F.frameViewer,onMouseDown:S,children:[(0,b.jsx)("div",{ref:d,className:F.frameList,children:n.frameList.map(((e,t)=>(0,b.jsx)("img",{src:e,className:F.frame},t)))}),C&&(0,b.jsx)("div",{className:F.slider,style:{left:n.sliderCenterOffset}})]})]}),(0,b.jsx)("div",{className:F.footer,children:(0,b.jsxs)("div",{className:F.buttonContainer,children:[(0,b.jsx)(l.zx,{className:F.button,type:"primary",theme:"solid",disabled:!C,onClick:n.handleOK,children:M("pc_text_template_complete_web")}),(0,b.jsx)(l.zx,{className:F.button,type:"secondary",theme:"solid",onClick:r,children:M("pc_text_template_cancel_n_web")})]})})]})}));function S(){const{i18n:e}=(0,c.$)(),t=(0,s.useRef)(null);return(0,s.useEffect)((()=>()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.call(t)}),[]),{openFramePicker:i=>{var s;const r=l.u_.info({width:"auto",height:"auto",header:null,footer:null,centered:!0,maskClosable:!1,closable:!1,className:F.modal,icon:null,closeOnEsc:!1,content:(0,b.jsx)(d.a,{i18n:e,children:(0,b.jsx)(T,{...i,onOK:e=>{var s;i.onOK(e),null===(s=t.current)||void 0===s||s.call(t)},onClose:()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.call(t)}})})});return null===(s=t.current)||void 0===s||s.call(t),t.current=()=>{t.current=null,r.destroy()},r}}}},17641:(e,t,i)=>{i.d(t,{S:()=>o});var s=i(84875),r=i.n(s),a=i(64641),n=i(11527);function o(e){const{className:t,title:i}=e;return(0,n.jsxs)("div",{className:r()(a.Z.root,t),children:[(0,n.jsx)("div",{className:a.Z.title,children:i}),(0,n.jsx)("div",{className:a.Z.line})]})}},89563:(e,t,i)=>{i.d(t,{M:()=>p});var s=i(23479),r=i(84875),a=i.n(r),n=i(36983),o=i(69836),l=i(33372);const c="root-ITIgwH",d="statusBar-PBKTou";var u=i(11527);const p=(0,s.Pi)((e=>{const{className:t,flowerText:i,isSelected:s,onClick:r}=e;return(0,u.jsxs)("div",{className:a()(c,t),onClick:()=>{r(i)},children:[(0,u.jsx)(n.Y,{src:(0,l.Pc)(i).cover.src,isInvalid:!1,isSelected:s,size:80,onContextMenu:e=>{e.preventDefault(),r(i)}}),(0,u.jsx)(o.ir,{className:d,loading:!1,invalid:!1,errorToolip:"",isInfoComplete:(0,l.QX)(i),title:i.title})]})}))},88370:(e,t,i)=>{i.d(t,{p:()=>w});var s=i(50959),r=i(66589),a=i(23479),n=i(45599),o=i(84736),l=i(36983),c=i(70252),d=i(95968),u=i(42983),p=i(45033),h=i(33372),m=i(56130);const f="root-ti0rBz",g="cover-FWyxQo",_="titleField-gXEG6N";var v=i(11527);const w=(0,a.Pi)((e=>{const{flowerText:t,initFlowerTextForm:i,applyTagsToAll:a,maxTitleLength:w}=e,{t:x}=(0,n.$)();(0,s.useLayoutEffect)((()=>{i(t)}),[]);const{getDisplayLength:y}=(0,p._)(),F=(0,h.Pc)(t);return(0,v.jsxs)("div",{className:f,children:[(0,v.jsx)(l.Y,{className:g,src:F.cover.src,isInvalid:!1,isSelected:!1,size:128}),(0,v.jsx)(c.l,{fieldClassName:_,label:x("pc_text_template_name_n_web"),field:"flowerText.title",maxLength:w,allowEnter:!1,placeholder:x("pc_stickers_release_xy_name_web",{X:1,Y:y(w)}),rules:[{required:!0,message:""}],onChange:(0,r.aD)((e=>t.title=e))}),(0,v.jsx)(d.u,{label:(0,v.jsxs)("div",{className:m.Z.labelHeader,children:[(0,v.jsx)(o.Form.Label,{required:!0,children:x("pc_text_template_tag_settings_web")}),(0,v.jsx)("div",{className:m.Z.applyToAll,tabIndex:-1,onClick:()=>a([...t.tags]),children:x("pc_text_template_apply_all_effect_web")})]}),placeholder:x("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"flowerText.tags",itemType:u.Ab.WordArt,recommendConfig:{title:t.title,uri:F.cover.uri},ignoreAddTagOnBlurSelector:`.${m.Z.applyToAll}`,onChange:(0,r.aD)((e=>t.tags=e))})]})}))},21130:(e,t,i)=>{i.d(t,{D5:()=>d});var s=i(59787),r=(i(50959),i(42983)),a=i(97311),n=i(94435),o=i(9679),l=i(67078);const c={[r.Ab.Sticker]:"sticker",[r.Ab.Filter]:"filter",[r.Ab.FilterCollection]:"filter",[r.Ab.AudioEffect]:"audio",[r.Ab.Video]:"video",[r.Ab.TextTemplate]:"text_template",[r.Ab.SubtitleTemplate]:"caption_template",[r.Ab.WordArt]:"flower",[r.Ab.LocalEffects]:"effect"};class d{constructor({itemType:e}){(0,s.Z)(this,"materialTypeParams",{material_category:"",material_type:""}),(0,s.Z)(this,"isCollection",!1),this.isCollection=e>100,this.materialTypeParams={material_category:c[e]||"",material_type:e>100?"collection":"single"}}sendPageActionLog(e){(0,o.iL)({...this.materialTypeParams,...e,...this.isCollection&&{collection_detail:e.collection_detail||"collection_all"}})}sendMaterialUploadStatusLog(e){(0,o.j2)({...this.materialTypeParams,...e})}sendMaterialImportErrorLog(e){return(0,o.DV)({...this.materialTypeParams,...e})}sendMaterialPublishErrorLog(e){return(0,o.Sj)(e.map((e=>({...this.materialTypeParams,...e}))))}sendMaterialPublishStatusLog(e,t){var i;const{status:s,error_type:r,cover_type:c,resolution:d,time:u,path:p,targetedActivityId:h}=e,{common_data:m,is_vip:f}=e.publishParams,g=[];return m.is_business&&g.push("business"),f&&g.push("subscribe"),(0,o.$v)({...this.materialTypeParams,status:s,title:m.title,isOriginal:Boolean(m.is_original),tags:m.tags||[],material_format:(0,a.lm)(p),material_size:null===(i=m.file)||void 0===i?void 0:i.size,description:m.description,resolution:d,error_type:r,time:u,cover_type:c,authorize_range:g.join(","),isVipAuthorized:(0,l.$X)(e.publishParams.copyright,n.$x.Vip),isBusinessAuthorized:(0,l.$X)(e.publishParams.copyright,n.$x.Business),is_official_task:m.post_channel===n.iu.Open?0:1,task_id:h,...t})}sendMaterialPublishPageResultLog(e){(0,o.S4)({...this.materialTypeParams,...e})}sendClickSubscriptionCheckboxLog(e){this.sendPageActionLog({action:e?"check_box_subscription":"cancel_check_box_subscription"})}sendSubscriptionStatementLog(e){(0,o.ce)({...this.materialTypeParams,...e})}sendClickCommercialCheckboxLog(e){this.sendPageActionLog({action:e?"check_box_commercial":"cancel_check_box_commercial"})}sendCommercialStatementLog(e){(0,o.Ad)({...this.materialTypeParams,...e})}sendAuthorSignLog(e){(0,o._4)({...this.materialTypeParams,...e})}}},35686:(e,t,i)=>{i.d(t,{T:()=>a});var s=i(59787),r=i(66589);class a{get materials(){return this.ids.map((e=>this.data.get(e)))}get selected(){var e;return this.ids.includes(this.selectedId)&&null!==(e=this.data.get(this.selectedId))&&void 0!==e?e:null}get length(){return this.ids.length}select(e){this.selectedId=e&&this.ids.includes(e.id)?e.id:""}constructor(e){this.options=e,(0,s.Z)(this,"ids",[]),(0,s.Z)(this,"data",new Map),(0,s.Z)(this,"selectedId",""),(0,s.Z)(this,"op",null),(0,r.ky)(this),this.options.createOp&&(this.op=this.options.createOp(this))}get(e){return this.ids.includes(e)&&this.data.get(e)||null}add(...e){for(const t of e)this.ids.includes(t.id)||(this.ids.push(t.id),this.data.set(t.id,t))}replaceByMap(e,t){const i=this.ids;if(e.forEach((e=>{var i;const s=null!==(i=this.data.get(e.id))&&void 0!==i?i:null;this.data.set(e.id,t(e,s))})),this.ids=e.map((e=>e.id)),this.ids.includes(this.selectedId)||(this.selectedId=""),!this.options.keepDataOnDelete){const e=new Set(this.ids);i.filter((t=>!e.has(t))).forEach((e=>this.deleteData(e)))}}delete(e){const t=this.ids.findIndex((t=>t===e.id));-1!==t&&(this.ids.splice(t,1),e.id===this.selectedId&&(this.selectedId=""),this.options.keepDataOnDelete||this.deleteData(e.id))}deleteData(e){var t,i;const s=this.data.get(e);this.data.delete(e),s&&(null===(t=(i=this.options).onDeleteData)||void 0===t||t.call(i,s))}updateAll(e){this.materials.forEach((t=>e(t)))}}},31086:(e,t,i)=>{i.d(t,{Z:()=>p,f:()=>d});var s=i(59787),r=i(82665),a=i(50279),n=i(25807),o=i(8129),l=i(2555),c=i(94435);const d=10;function u(e){return Boolean(e.id)}class p{constructor(){(0,s.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const i of(0,r.Z)(e,d)){const e=await Promise.all(i.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:i,onResult:s,onUpdateResult:r}=e,n=JSON.parse(JSON.stringify(e.req));let l=this.itemMap.get(i);if(null!==(t=l)&&void 0!==t&&t.promise&&(0,a.Z)(l.req,n))try{return await l.promise}catch(c){(0,o.c6)("[MaterialPublishService] publish failed, start to retry",{id:i})}return l={promise:null,id:i,req:n,onResult:s,onUpdateResult:r},this.itemMap.set(i,l),l.promise=this.publishImpl(l),l.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),i=async(i,s)=>{try{const n={error:i,errorText:this.getErrorText(i),time:Math.round(performance.now()-t),resourceId:s};var r,a;if(u(e.req))await(null===(r=e.onUpdateResult)||void 0===r?void 0:r.call(e,{req:e.req,...n}));else await(null===(a=e.onResult)||void 0===a?void 0:a.call(e,{req:e.req,...n}))}catch(n){(0,o.RF)("[MaterialPublishService] callOnResult failed",n)}};let s;try{s=await this.postOrUpdate(e)}catch(r){throw e.promise=null,i(r,""),r}return await i(null,s.resource_id),s}async postOrUpdate(e){return u(e.req)?(await(0,c.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,c.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new l.B).timeout(5e3)])}catch(t){(0,o.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const i=performance.now(),s=new l.B,r={count:50,effect_types:t,uid:n.$.userInfo.uid,cursor:0};for(;performance.now()-i<5e3;){const t=await(0,c.Js)(r).catch((()=>null));if(null!=t&&t.effect_item_list){const i=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>i.has(e))))return}await s.timeout(500)}}}},79668:(e,t,i)=>{i.d(t,{L:()=>o});var s=i(93302),r=i(50959),a=i(66589);const n=5e3;function o({watch:e,collect:t}){const i=(0,r.useMemo)((()=>(0,s.Z)((async()=>{await Promise.resolve(),t()}),n)),[]);(0,r.useEffect)((()=>{const t=(0,a.EH)((()=>{e(),i()}));return()=>{t(),i.cancel()}}),[])}},28706:(e,t,i)=>{i.d(t,{N0:()=>M,r:()=>C,B4:()=>T,Dz:()=>S,wt:()=>k});var s=i(59787),r=i(50279),a=i(66589),n=i(8129);class o{constructor(e){this.props=e,(0,s.Z)(this,"fileMap",new Map)}ensureFile(e){let t=this.fileMap.get(e);return t||(t={data:this.props.initData(),events:{}},this.fileMap.set(e,t)),t}getFile(e){return this.fileMap.get(e)}register(e,t,i){this.ensureFile(t).events[e]=i}dispatch(e){var t,i;const s=this.fileMap.get(e.id);s&&(null===(t=(i=s.events)[e.type])||void 0===t||t.call(i,e,s))}removeFile(e){this.fileMap.delete(e)}}var l=i(62262),c=i(29755),d=i(97311),u=i(94435);class p{constructor(){(0,s.Z)(this,"uploadConfigService",null),(0,s.Z)(this,"fileEventDispatcher",null),(0,s.Z)(this,"map",new Map)}init(e){const{uploadConfigService:t,fileEventDispatcher:i}=e;this.uploadConfigService=t,this.fileEventDispatcher=i}async initUpload(e){return this.map.set(e.id,e),this.upload(e.id)}async retryUpload(e){return this.upload(e)}async upload(e){const t={type:"Upload",result:"Error",id:e,uri:"",size:0,md5:"",error:""},{uploadConfigService:i,fileEventDispatcher:s}=this;if(!i||!s){const t=new l.w("not inited",{id:e});throw(0,n.RF)("[SimpleFileUploader] init upload failed",t),t}const r=this.map.get(e);if(!r){const i=new l.w("data not set",{id:e});throw(0,n.RF)("[SimpleFileUploader] init upload failed",i),t.error=i.message,s.dispatch(t),i}const{type:a,file:o}=r,p=async()=>{const{imageUploadConfig:e,videoUploadConfig:t,objectUploadConfig:s}=await i.getUploadConfigs("SimpleFileUploader");let r;return r=a===u.AJ.Image?e:a===u.AJ.Video?t:s,{current_time:r.currentTime,expired_time:r.expiredTime,access_key_id:r.accessKey,secret_access_key:r.secretKey,session_token:r.sessionToken,upload_domain:r.hostDomain,space_name:r.serviceId||r.nameSpace,space_type:r.serviceId?2:1,region:r.region||""}};try{const i=await(0,c.ws)({file:o,getUploadToken:p});t.result="Success",t.uri=i.uploadResult.Uri,t.size=i.fileSize,t.md5=r.withMD5?await(0,d.C3)(o):"",s.dispatch(t),this.map.delete(e)}catch(m){var h;throw(0,n.RF)("[SimpleFileUploader] upload failed",m),t.result="Error",t.uri="",t.size=0,t.error=null!=m&&m.message?`${m.message}, code=${null===(h=m.context)||void 0===h?void 0:h.code}`:JSON.stringify(m||{}),s.dispatch(t),m}}}var h=i(84677),m=i(82188),f=i(2555);function g(e){const{base64List:t}=(0,m.eK)(e);return t}function _(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}function v(e){const t=_(e);let i=0;for(let s=0;s<e.length;s++){const r=e[s];i+=(r-t)*(r-t)}return Math.sqrt(i/e.length)}const w=async e=>{const t=await e.arrayBuffer();return(0,m.eK)(t).base64List},x=e=>new Promise(((t,i)=>{const s=new Image;s.src=e,s.setAttribute("crossOrigin","Anonymous"),s.onload=()=>{const e=document.createElement("canvas"),i=e.getContext("2d");e.width=s.width,e.height=s.height,null==i||i.drawImage(s,0,0,e.width,e.height);const r=async function(e){const t=e.width,i=e.height,s=Array(i*t).fill(0),r=Array(i*t).fill(0);let a=0,n=performance.now();for(let u=0;u<i;u++){for(let i=0;i<t;i++){const t=4*(i+u*i),n=e.data[t],o=e.data[t+1],l=e.data[t+2];s[a]=Math.abs(n-o),r[a]=Math.abs((n+o)/2-l),a+=1}performance.now()-n>16&&(await(0,f.N)(),n=performance.now())}await(0,f.N)();const o=_(s),l=v(s),c=_(r),d=v(r);return Math.sqrt(l*l+d*d)+.3*Math.sqrt(o*o+c*c)}(null==i?void 0:i.getImageData(0,0,e.width,e.height));t(r)}})),y=async e=>{var t;let i=[];if("string"==typeof e&&(i=await async function(e){const{base64List:t}=await(0,m.Jx)(e);return t}(e)),e instanceof ArrayBuffer&&(i=await g(e)),e instanceof File&&(i=await w(e)),null===(t=i)||void 0===t||!t.length)throw new Error("\u9519\u8befgif\u6587\u4ef6");const s=[];let r=0,a=0;for(let n=0;n<i.length;n++){const e=i[n],t=await x(e);s.push(t),t>r&&(r=t,a=n)}return{max:r,maxIndex:a,frameList:i,frame:i[a]}};var F=i(1946),b=i(33372);function T(e){return{id:"",src:"",uri:"",isUploadFailed:!1,file:new File([],""),...e}}function S(e){return{id:"",uri:"",isUploadFailed:!1,file:new File([],""),md5:"",size:0,...e}}function k(e){return{id:"",src:"",uri:"",isUploadFailed:!1,file:new File([],""),index:0,duration:3,list:[],...e}}function C(e,...t){for(const i of t)i.id||null==e.uninited||(e.uninited+=1),i.isUploadFailed?e.failed+=1:i.uri?e.succeeded+=1:e.pending+=1}class M{constructor(e){this.props=e,(0,s.Z)(this,"fileEventDispatcher",new o({initData:()=>null})),(0,s.Z)(this,"fileUploader",new p),(0,s.Z)(this,"prevDepResourceIdMap",{}),(0,s.Z)(this,"templateZipCacheMap",new Map),(0,a.ky)(this),this.fileUploader.init({fileEventDispatcher:this.fileEventDispatcher,uploadConfigService:this.props.uploadConfigService})}async initUploadCover(e){const t=e.getCover();if(!t||t.id)return;if((0,h.L)(t,{...e.getInitValues(),uri:"",isUploadFailed:!1}),!t.file.size&&!t.file.name){const e=new l.w("file is empty",{id:t.id});throw(0,n.RF)("[TemplateFileOperator] initUploadCover failed",e),e}const{id:i}=t;this.fileUploader.initUpload({id:i,type:u.AJ.Image,file:t.file}),this.fileEventDispatcher.register("Upload",t.id,(0,a.aD)((t=>{const s=e.getCover();var r;if(!s||s.id!==i)return void(0,n.c6)(`[TemplateFileOperator] cover upload ignored {${i}}`,{coverId:null!==(r=null==s?void 0:s.id)&&void 0!==r?r:"null"});const{uri:a}=t;if(a)s.uri=a,(0,n.c6)(`[TemplateFileOperator] cover upload success {${i}}`,{uri:a});else{s.isUploadFailed=!0;const e=t.error||"unknown";(0,n.RF)(`[TemplateFileOperator] cover upload failed {${i}}`,null,{error:e})}})))}async initUploadFile(e){const{typeName:t}=e,i=e.getFile();if(!i||i.id)return;if((0,h.L)(i,{...e.getInitValues(),uri:"",isUploadFailed:!1,md5:"",size:0}),!i.file.size&&!i.file.name){const e=new l.w("file is empty",{id:i.id,type:t});throw(0,n.RF)("[TemplateFileOperator] initUploadFile failed",e),e}const{id:s}=i;this.fileUploader.initUpload({id:s,type:u.AJ.Object,file:i.file,withMD5:!0}),this.fileEventDispatcher.register("Upload",s,(0,a.aD)((i=>{const r=e.getFile();var a;if(!r||r.id!==s)return void(0,n.c6)(`[TemplateFileOperator] ${t} upload ignored {${s}}`,{fileId:null!==(a=null==r?void 0:r.id)&&void 0!==a?a:"null"});const{uri:o,size:l,md5:c}=i;if(o)r.uri=o,r.size=l,r.md5=c,(0,n.c6)(`[TemplateFileOperator] ${t} upload success {${s}}`,{uri:o});else{r.isUploadFailed=!0;const e=i.error||"unknown";(0,n.RF)(`[TemplateFileOperator] ${t} upload failed {${s}}`,null,{error:e})}})))}retryUpload(...e){for(const t of e)t.id&&t.isUploadFailed&&(t.isUploadFailed=!1,this.fileUploader.retryUpload(t.id))}async getStaticFrame(e,t){if(null==t){const{maxIndex:t,frameList:i}=await y(e);return{index:t,frameList:i}}return{index:t,frameList:await w(e)}}async initStaticFrame(e){var t;const{id:i,templateZipData:s,staticFrame:r}=e,{coverFile:a}=s.template;(0,n.c6)(`[TemplateFileOperator] getGifColorFrame start {${i}}`);const{index:o,frameList:l}=await this.getStaticFrame(a,null===(t=e.getInitIndex)||void 0===t?void 0:t.call(e));(0,n.c6)(`[TemplateFileOperator] getGifColorFrame done {${i}}`),(0,h.L)(r,{id:"",uri:"",isUploadFailed:!1,src:l[o],index:o,list:l})}updateStaticFrame(e,t){const{list:i}=e;0!==i.length&&(0,h.L)(e,{id:"",uri:"",isUploadFailed:!1,src:i[t],index:t})}saveTemplateZipCache(e,t,i){i.id&&!i.isUploadFailed&&i.uri&&this.templateZipCacheMap.set(`${t}-${e}`,{...i}),(0,h.L)(i,{...S({}),extraJson:{}})}async initUploadTemplateZip(e){const{zipFile:t,templateZipData:i,staticFrame:s,depResourceIdMap:a,checkIsCanceled:o}=e,l=`${e.lang}-${e.id}`,c=this.templateZipCacheMap.get(l),d=(0,r.Z)(a,this.prevDepResourceIdMap);d&&(this.prevDepResourceIdMap=a);const u=s.index/s.list.length*s.duration;if(c&&u===c.previewTime&&d)return(0,h.L)(t,c),void(0,n.c6)(`[TemplateFileOperator] zip reuse cache success {${l}}`,{uri:c.uri});const p=(0,b.ii)(e.lang,i,a),{file:m,extraJson:f}=await i.createNewZipFile({previewTime:u,depResourceIdMap:p});(0,n.c6)(`[SingleStore] createNewZipFile success {${l}}`,{depResourceIdMap:p}),o()||this.initUploadFile({getFile:()=>t,typeName:"zip",getInitValues:()=>({id:(0,F.V)("template-zip"),file:m,previewTime:u,extraJson:f})})}}},86324:(e,t,i)=>{i.d(t,{v:()=>f});var s=i(59787),r=i(34210),a=i.n(r),n=i(46309),o=i(42983);async function l(e,t={}){const i=new(a());return(await i.loadAsync(e,t)).files}var c=i(8129),d=i(74235);async function u(e,t){try{const i=await e.async("blob"),s=await i.text();return(0,d.ZP)(s,t)}catch(i){throw(0,c.RF)("[TextTmp] file error",i,e),i}}i(94435);var p=i(62262);const h="content.json",m="extra.json";o.Ab.Font,o.Ab.Font,o.Ab.WordArt,o.Ab.Sticker;class f{constructor(e){this.options=e,(0,s.Z)(this,"timing",{}),(0,s.Z)(this,"sdkVersion",""),(0,s.Z)(this,"rootFiles",{}),(0,s.Z)(this,"_template",null),(0,s.Z)(this,"flowerTexts",[]),(0,s.Z)(this,"stickers",[])}get template(){if(!this._template)throw new p.w("template not inited",{id:this.options.id});return this._template}async init(){this.timing.startTime=performance.now();const{id:e,fetchZipBase64:t}=this.options;(0,c.c6)(`[TemplateZipData] init start {${e}}`);let i="";try{[i,this.sdkVersion]=await Promise.all([t(e),(0,n.mI)().then((e=>e.sdk))])}catch(a){throw(0,c.RF)(`[TemplateZipData] fetch from native failed {${e}}`,a),a}this.timing.fetchZipBase64EndTime=performance.now(),(0,c.c6)("[TemplateZipData] fetchZipBase64 done"),this.rootFiles=await l(i,{base64:!0}),this.timing.decompressRootEndTime=performance.now(),(0,c.c6)("[TemplateZipData] decompress root done",{files:Object.keys(this.rootFiles)});const s=[this.initFlowerTexts()],r=this.rootFiles["template_sticker.zip"];if(r){const e=await r.async("blob"),t=await l(e);(0,c.c6)("[TemplateZipData] decompress template_sticker.zip done",{files:Object.keys(t)});const i=t["caption_animation.json"],[a,n,o]=await Promise.all([u(t[m],{}),u(t[h],{root:{duration:3,preview_time:0},children:[]}),i&&u(i,{caption_animation:[]})]);a.depend_resource_list&&(a.depend_resource_list=a.depend_resource_list.filter((e=>e.resource_id))),this._template={files:t,extraJson:a,contentJson:n,captionAnimationJson:o,coverFile:new File([],""),notBusinessEffectTypes:[]},this.timing.decompressTemplateZipEndTime=performance.now(),(0,c.c6)("[TemplateZipData] decompress template.zip done",{files:Object.keys(t),extraJson:a,contentJson:n}),s.push(this.initTemplateFiles(this.template),this.initNonBusinessInfo(this.template),this.initStickers(this.template))}await Promise.all(s),this.timing.endTime=performance.now(),(0,c.c6)(`[TemplateZipData] all done {${e}}`)}async initTemplateFiles(e){const t=await this.rootFiles["preview_gif.gif"].async("blob");e.coverFile=new File([t],"text.gif",{type:"image/gif"}),this.timing.initTemplateFilesEndTime=performance.now(),(0,c.c6)("[TemplateZipData] initTemplateFiles done")}async initNonBusinessInfo(e){}async initFlowerTexts(){const e=this.rootFiles["flower_text.json"];if(!e)return;const{text_template:t=[],local:i=[]}=await u(e,{});if((0,c.c6)("[TemplateZipData] flower_text.json",{text_template:t,local:i}),!t.length&&!i.length)return;const s=await Promise.all(t.map((async e=>{const t=e.local_id,i=this.rootFiles[`${t}.zip`];if(!i)return null;const s=await i.async("blob"),r=new File([s],"flower.zip",{type:"application/zip"}),a=await l(s);(0,c.c6)(`[TemplateZipData] decompress flower.zip done {${t}}`,{id:t,files:Object.keys(a)});const n=await a["cover_icon.png"].async("blob"),o=new File([n],"flower.png",{type:"image/png"}),{version:d="1.0.0"}=await u(a["config.json"],{});return{id:t,isDepMaterial:!0,file:r,coverFile:o,sdkVersion:d,groupId:e.group_id||""}})));this.flowerTexts=s.filter((e=>null!==e)),this.timing.initFlowerTextsEndTime=performance.now(),(0,c.c6)("[TemplateZipData] initFlowerTexts done",{flowers:this.flowerTexts.map((e=>e.id))})}async initStickers(e){const t=this.rootFiles["local_sticker.json"];if(!t)return;const{text_template:i=[],local:s=[]}=await u(t,{});(0,c.c6)("[TemplateZipData] local_sticker.json",{text_template:i,local:s});const r=await Promise.all(i.map((async t=>{var i;const s=t.local_id,r="true"===t.is_sequence,a=t.type,n=null===(i=e.contentJson.children)||void 0===i?void 0:i.find((e=>e.name===t.local_id)),o="sticker"===(null==n?void 0:n.type)&&n.sticker_path||"",l=e.files[o];if(!l)return null;const c=await l.async("blob");return{id:s,isDepMaterial:!0,file:new File([c],l.name,{type:`image/${a}`}),isSequence:r}})));this.stickers=r.filter((e=>null!==e)),this.timing.initStickersEndTime=performance.now(),(0,c.c6)("[TemplateZipData] initStickers done",{stickers:this.stickers.map((e=>e.id))})}async createNewZipFile(e){var t;const{previewTime:i,depResourceIdMap:s}=e,{files:r,contentJson:n,extraJson:o}=this.template,l={...n,root:{...n.root,preview_time:i},children:n.children.map((e=>{var t;if("text"===e.type&&null!==(t=e.text_params)&&void 0!==t&&t.richText){let t=e.text_params.richText;return Object.entries(s).forEach((([e,i])=>{const s=new RegExp(e,"g");t=t.replace(s,i)})),{...e,text_params:{...e.text_params,richText:t}}}return"sticker"===e.type&&!e.sticker_resource_id&&s[e.name]&&e.sticker_path?{...e,sticker_path:"",sticker_design_type:0,sticker_resource_id:s[e.name]}:e}))},c={...o,depend_resource_list:null===(t=o.depend_resource_list)||void 0===t?void 0:t.map((e=>{const t=s[e.resource_id];return t?{...e,resource_id:t,source:1}:e}))},d=new(a());d.file(h,JSON.stringify(l)),d.file(m,JSON.stringify(c)),d.files={...r,...d.files};const u=await d.generateAsync({type:"blob"});return{file:new File([u],"text_template.zip",{type:"application/zip"}),contentJson:l,extraJson:c}}}},33372:(e,t,i)=>{i.d(t,{Id:()=>v,Kl:()=>w,Pc:()=>f,QX:()=>m,Rd:()=>x,Sv:()=>h,Wl:()=>y,er:()=>_,ii:()=>F,wu:()=>g});var s=i(23073),r=i(66589),a=i(28706),n=i(97311),o=i(1946),l=i(8129),c=i(45735),d=i(9679),u=i(94435),p=i(67078);function h(e){const t=e.subFlowerTexts.map(((e,t)=>function(e,t){const{lang:i,data:s}=e,{id:r,coverFile:o,file:l}=s;return{id:r,lang:i,resourceId:"",cover:(0,a.B4)({src:t.needSrc?(0,n.y8)(o):"",file:o}),file:(0,a.Dz)({file:l})}}(e,{needSrc:0===t}))),{isDepMaterial:i,sdkVersion:s}=e.subFlowerTexts[0].data;return(0,r.LO)({id:t[0].id,groupId:e.groupId,isDepMaterial:i,sdkVersion:s,title:"",tags:[],subFlowerTexts:t})}function m(e){return Boolean(e.title&&e.tags.length)}function f(e){return e.subFlowerTexts[0]}function g(e){const{id:t,isDepMaterial:i,isSequence:s,file:r}=e;return{id:t,resourceId:"",isDepMaterial:i,title:"",tags:[],isSequence:s,cover:(0,a.B4)({file:r})}}function _(e,t){for(const i of t.flowerTexts)for(const t of i.subFlowerTexts)e.initUploadCover({getCover:()=>t.cover,getInitValues:()=>({id:(0,o.V)("flower-text-cover")})}),e.initUploadFile({getFile:()=>t.file,typeName:"zip",getInitValues:()=>({id:(0,o.V)("flower-text-zip")})});for(const i of t.stickers)e.initUploadCover({getCover:()=>i.cover,getInitValues:()=>({id:(0,o.V)("sticker-cover")})})}function v(e,t){for(const i of t.flowerTexts)for(const t of i.subFlowerTexts)e.retryUpload(t.cover,t.file);for(const i of t.stickers)e.retryUpload(i.cover)}function w(e,t){return e.map((e=>e.subFlowerTexts.map((i=>{const{lang:a}=i,n=i.id;return{id:n,req:(0,c.h$)({...(0,s.Z)(e,["tags","sdkVersion"]),...(0,s.Z)(i,["cover","file"]),...t,title:e.title,baseSource:u.r0.UserPostPcInTextTemplate}),onResult:(0,r.aD)((({resourceId:e,error:t,req:s,time:r,errorText:o})=>{var c;(0,d.$v)({status:t?"fail":"success",material_category:"flower",material_type:"single",title:s.common_data.title,isOriginal:Boolean(s.common_data.is_original),tags:null!==(c=s.common_data.tags)&&void 0!==c?c:[],time:r,isVipAuthorized:(0,p.$X)(s.copyright,u.$x.Vip),isBusinessAuthorized:(0,p.$X)(s.copyright,u.$x.Business),error_type:o}),t?(0,l.RF)(`[DepMaterial] dep publish failed {${n}}`,t,{lang:a}):(i.resourceId=e,(0,l.c6)(`[DepMaterial] dep publish success {${n}}`,{resourceId:e,lang:a}))}))}})))).flat()}function x(e,t){const{getTitle:i,...a}=t;return e.map(((e,t)=>{const{id:n}=e,o=i(e,t),d=e.isSequence?u.r0.UserPostPcInTextTemplateSequence:u.r0.UserPostPcInTextTemplate;return{id:n,req:(0,c.td)({...(0,s.Z)(e,["tags","isSequence","cover"]),...a,title:o,baseSource:d}),onResult:(0,r.aD)((({resourceId:t,error:i})=>{i?(0,l.RF)(`[DepMaterial] dep publish failed {${n}}`,i):(e.id===n&&(e.resourceId=t),(0,l.c6)(`[DepMaterial] dep publish success {${n}}`,{resourceId:t,latestId:e.id}))}))}})).flat()}function y(e){const t={};for(const i of e.flowerTexts)for(const e of i.subFlowerTexts)t[`${e.lang}-${e.id}`]=e.resourceId;for(const i of e.stickers)t[i.id]=i.resourceId;return t}function F(e,t,i){const s={};for(const r of t.flowerTexts){const t=`${e}-${r.id}`;r.isDepMaterial&&i[t]&&(s[r.id]=i[t])}for(const r of t.stickers)r.isDepMaterial&&i[r.id]&&(s[r.id]=i[r.id]);return s}},45735:(e,t,i)=>{i.d(t,{Ob:()=>l,h$:()=>n,td:()=>o,xo:()=>c});var s=i(42983),r=i(67078),a=i(94435);function n(e){const{title:t,isHighPriority:i,isVip:a,isBusiness:n,isOriginal:o,tags:l,sdkVersion:c,baseSource:d,cover:u,file:p}=e,h=i?`${d}_without_review`:d,m=(0,r.pn)({isVip:a,isBusiness:n});return{effect_type:s.Ab.WordArt,is_vip:a,...m.root,common_data:{title:t,description:t,icon:{image_uri:u.uri},file:{file_md5:p.md5,file_uri:p.uri,size:p.size},sdk_version:c,source:h,tags:l,is_original:o,is_business:n,...m.commonData}}}function o(e){const{title:t,isHighPriority:i,isVip:n,isBusiness:o,isOriginal:l,tags:c,baseSource:d,cover:u}=e,p=i?`${d}_without_review`:d,h=(0,r.pn)({isVip:n,isBusiness:o}),m=u.file.name.split(".").pop();return{effect_type:s.Ab.Sticker,is_vip:n,...h.root,common_data:{title:t,description:t,icon:{image_uri:u.uri},sdk_version:"1.0.0",source:p,tags:c,is_original:l,is_business:o,...h.commonData},sticker:{large_image:{image_uri:u.uri},sticker_type:"gif"===m?a.Ic.Dynamic:a.Ic.Static}}}function l(e){var t,i;const{effectType:n,title:o,tags:l,isHighPriority:c,isVip:d,postChannel:u,targetedActivityId:p,isBusiness:h,isOriginal:m,templateZipData:f,cover:g,staticFrame:_,file:v,lang:w,extraJson:x,authFiles:y,baseSource:F}=e,{sdkVersion:b}=f,T=(0,r.pn)({isVip:d,isBusiness:h,authFiles:y}),S=c?`${F}_without_review`:F,k=n===s.Ab.SubtitleTemplate?"subtitle_template":"text_template";return{effect_type:n,is_vip:d,...T.root,common_data:{title:o,description:o,icon:{image_uri:g.uri,static_uri:_.uri},file:{file_md5:v.md5,file_uri:v.uri,size:v.size},sdk_version:b,source:S,tags:l,is_original:m,is_business:h,post_channel:u===a.iu.Targeted?`${a.iu.Targeted}_${p}`:u,web_extra:JSON.stringify({targeted_id:p}),...T.commonData,...w&&{item_language:w}},[k]:{depend_resource_list:null!==(t=x.depend_resource_list)&&void 0!==t?t:[],script_template_version:null!==(i=x.script_template_version)&&void 0!==i?i:"",...x.texts&&{texts:x.texts}}}}function c(e){const{id:t,title:i,tags:s,isVip:a,isBusiness:n,isOriginal:o,cover:l,staticFrame:c,file:d,authFiles:u,onlineData:p}=e,h=(0,r.sR)({isOriginal:o,isVip:a,isBusiness:n,authFiles:u,onlineData:p});return{id:t,title:i,description:i,icon:{image_uri:l.uri,static_uri:c.uri},file:{file_md5:d.md5,file_uri:d.uri,size:d.size},tags:s,...h}}},17095:(e,t,i)=>{i.d(t,{g:()=>r});var s=i(46309);function r(e){console.log("[sendLog]",e.eventName,e.params),(0,s.qx)(e)}},86156:(e,t,i)=>{i.d(t,{q:()=>a});var s=i(59787),r=i(66589);class a{constructor(e){this.props=e,(0,s.Z)(this,"fetchStatus",{isPending:!1,isFailed:!1,hasFetched:!1,fetchVersion:0,hasMore:!1}),(0,s.Z)(this,"nextCursor",null),(0,s.Z)(this,"fetchContext",null),(0,r.ky)(this,{fetchContext:!1})}async fetchFirstPage(e){const t=this.fetchStatus.isFailed;try{e.isRefresh||this.runStartAction();const t=await this.props.fetchFirstPage(this.fetchContext),{action:i,hasMore:s,nextCursor:r}=this.normalizeFetchResult(t);this.runSuccessAction((()=>{this.fetchStatus.fetchVersion+=1,this.fetchStatus.hasMore=null!=s&&s,this.nextCursor=null!=r?r:null,i()}))}catch(i){this.runFailureAction({isFirstPage:!0,isRefresh:e.isRefresh});const s=e.isRefresh&&"refresh_first_page"||t&&"retry_fetch_first_page"||"init_fetch_first_page";throw this.props.slardarErrorLog(s,i,{}),i}}async fetchMorePage(){if(!this.props.fetchMorePage)throw new Error("props.fetchMorePage not implemented");const e=this.fetchStatus.isFailed,t=this.nextCursor;try{this.runStartAction();const e=await this.props.fetchMorePage(t,this.fetchContext),{action:i,hasMore:s,nextCursor:r}=this.normalizeFetchResult(e);this.runSuccessAction((()=>{this.fetchStatus.hasMore=null!=s&&s,this.nextCursor=null!=r?r:null,i()}))}catch(i){this.runFailureAction({isFirstPage:!1,isRefresh:!1});const s=e?"retry_fetch_more_page":"fetch_more_page";throw this.props.slardarErrorLog(s,i,{cursor:t}),i}}normalizeFetchResult(e){return"function"==typeof e?{action:e,hasMore:!1,nextCursor:null}:e}runStartAction(){this.fetchStatus.isPending=!0,this.fetchStatus.isFailed=!1}runSuccessAction(e){this.fetchStatus.isPending=!1,this.fetchStatus.isFailed=!1,this.fetchStatus.hasFetched=!0,e()}runFailureAction(e){var t,i;this.fetchStatus.isPending=!1,this.fetchStatus.isFailed=!0,null===(t=(i=this.props).actionOnFailure)||void 0===t||t.call(i,e,this.fetchContext)}async initFetchFirstPage(e){this.fetchContext=e;const{isPending:t,hasFetched:i}=this.fetchStatus;if(!t&&!i)return this.fetchFirstPage({isRefresh:!1})}async retryFetchFirstPage(){const{isPending:e}=this.fetchStatus;if(!e)return this.fetchFirstPage({isRefresh:!1})}async refreshFirstPage(){const{isPending:e}=this.fetchStatus;if(!e)return this.fetchFirstPage({isRefresh:!0})}async retryFetchMorePage(){const{isPending:e,hasMore:t}=this.fetchStatus;if(!e&&t)return this.fetchMorePage()}async fetchMorePageOnScrollToEnd(){const{isPending:e,hasMore:t,isFailed:i}=this.fetchStatus;if(!e&&t&&!i)return this.fetchMorePage()}reduceToFirstPageStatus(e){this.nextCursor=e,this.fetchStatus.hasMore=!0}}},84677:(e,t,i)=>{i.d(t,{L:()=>r});var s=i(66589);function r(e,...t){return(0,s.z)((()=>Object.assign(e,...t)))}},64641:(e,t,i)=>{i.d(t,{Z:()=>s});const s={root:"root-Jdq72k",title:"title-x8UGgH",line:"line-HKnXMT"}},73008:(e,t,i)=>{i.d(t,{Z:()=>s});const s={root:"root-LbkeWz",container:"container-jnsvSx",card:"card-yURKE_"}},56130:(e,t,i)=>{i.d(t,{Z:()=>s});const s={labelHeader:"labelHeader-YVMW2T",applyToAll:"applyToAll-TCdMm4"}},89100:(e,t,i)=>{i.d(t,{Z:()=>s});const s={page:"page-HRk3ka",content:"content-LGuZmP",requirement:"requirement-sURfql",instruction:"instruction-eUXPJ0",mainForm:"mainForm-PzQVLp",footer:"footer-t1kXBF"}}}]);