"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[26],{28747:(e,t,s)=>{s.d(t,{u:()=>q});var n=s(50959),r=s(10422),l=s(84736),a=s(26800),i=s(3298),c=s(45599),o=s(23479),u=s(25807),d=s(69905),m=s(60251),p=s(8129),f=s(86439),g=s(94435),v=s(16743),h=s(84875),w=s.n(h);const x="tag-ZaY7YS",_="selected-umR1Vs",y="disabled-A37DzB";var E=s(11527);const N=({className:e,value:t,selected:s,disabled:n,onClick:r})=>(0,E.jsx)(l.Vp,{className:w()(e,x,s&&_,n&&y),color:s?"cyan":void 0,onClick:()=>null==r?void 0:r(t),children:t},t),b="block-smxiey",Z="title-aqS4Cg",j="content-IyBLdN",S="loading-QuFv_G",I="text-ukrQOj",T=({className:e,title:t,loading:s,loadingText:r,value:a,options:i,onSelect:c})=>{const o=(0,n.useCallback)((e=>a.includes(e)),[a]),u=(0,n.useMemo)((()=>i.filter((e=>!a.includes(e)))),[a,i]);return 0===u.length?null:(0,E.jsxs)("div",{className:w()([b,e]),children:[(0,E.jsx)("p",{className:Z,children:t}),(0,E.jsx)("div",{className:j,children:s?(0,E.jsxs)("div",{className:S,children:[(0,E.jsx)("span",{className:I,children:r}),(0,E.jsx)(l.yC,{size:"small"})]}):u.map((e=>(0,E.jsx)(N,{selected:o(e),value:e,onClick:()=>c(e)},e)))})]})},R=(0,o.Pi)((({value:e,onSelect:t})=>{const[s,r]=(0,n.useState)([]),{t:l}=(0,c.$)();return(0,n.useEffect)((()=>{const e=(0,d.cF)(d.Qt.TagEachUser,u.$.userInfo.uid).get();r(e)}),[u.$.userInfo.uid,e]),(0,E.jsx)(T,{title:l("pc_recently_used_web"),value:e,options:s,onSelect:t})})),k=((0,o.Pi)((({title:e,uri:t,value:s,itemType:r,onSelect:l})=>{const[o,u]=(0,n.useState)([]),[d,m]=(0,n.useState)([]),[p,f]=(0,n.useState)(!1),v=(0,n.useRef)({selfConfigTagsReady:{}}),{t:h}=(0,c.$)(),w=(0,n.useMemo)((()=>[...d,...o]),[o,d]),x=(0,a.Z)((e=>{const{title:t,uri:s}=e;return t?v.current.cvid&&v.current.uri===s?{cvid:v.current.cvid,title:t}:s?{image_uri:s,title:t}:null:null})),_=(0,n.useCallback)((async()=>{try{f(!0);const s=x({title:e,uri:t});await Promise.all([s&&(0,g.Uz)(s).then((e=>{m(e.cv_tags),v.current.cvid=e.cvid,s.image_uri&&(v.current.uri=s.image_uri)})),!v.current.selfConfigTagsReady[r]&&(0,g.On)({effect_type:r}).then((e=>{u(e.rec_tags),v.current.selfConfigTagsReady[r]=!0}))])}finally{f(!1)}}),[e,t,r]);return(0,i.Z)(_,500,[_]),(0,n.useEffect)((()=>{_()}),[r]),(0,E.jsx)(T,{title:h("recommend_signature_web"),loading:p,loadingText:h("loading_web"),value:s,options:w,onSelect:l})})),"tagSelect-KEPqcU"),M="dropItem-bpnHuZ",L="suggestListDropdown-fV0lMc",C=(0,o.Pi)((({recommendConfig:e,value:t=[],itemType:s,disabled:o,disableRecommend:h,disableLatest:w,onChange:x,placeholder:_,max:y=15,temporaryId:b,ignoreAddTagOnBlurSelector:Z,onRecentTagSelect:j})=>{const S=(0,n.useRef)(!1),[I,T]=(0,n.useState)(""),[C,q]=(0,n.useState)(""),P=(0,n.useRef)(!1),U=P.current?C:I,[$,O]=(0,n.useState)([]),[F,A]=(0,n.useState)([]),{t:B}=(0,c.$)(),D=e=>(0,d.cF)(d.Qt.TagEachUser,u.$.userInfo.uid).set("add",[e]),J=(0,a.Z)((e=>{A(I?e:[])}));(0,i.Z)((async()=>{if(!s||!I)return;const e=await(0,g.EO)({query:I,count:10}),t=(null==e?void 0:e.sug_tags)||[];J(t)}),500,[I,s]),(0,n.useEffect)((()=>{I||A([])}),[I]);const Q=(0,n.useCallback)((e=>{if(y&&e.length>y)return l.FN.error(B("pc_stickers_release_max_tag_web",{X:y})),void(null==x||x(e.slice(0,y)));null==x||x(e)}),[x]),z=(0,a.Z)((e=>{t.includes(e)||Q([...t,e])})),V=(0,n.useMemo)((()=>new m.l),[]),Y=(0,a.Z)((async e=>{const s=await V.lock("",(async()=>{if(t.includes(e))return!0;let s=!1;try{const t=await(0,g._K)({words:e,scene:g.Xb.Tag});s=!1===(null==t?void 0:t.is_hit)}catch(n){return(0,p.RF)("[TagSelect] call checkAntiDirt failed",n,{tag:e}),l.FN.error(B("pc_tag_retry_web")),!1}return s?(z(e),!0):((0,p.c6)("[TagSelect] checkAntiDirt not passed",{tag:e}),l.FN.error(B("pc_tag_illegal_fail_web")),!1)}));return null!=s&&s})),G=(0,a.Z)((e=>{if(0===e.length)return;const s=t.filter((t=>!e.includes(t)));Q(s)})),H=(0,n.useRef)(null),{saveSelectionIfNeeded:K}=(0,v.u)({getInputElem:()=>{var e;return null===(e=H.current)||void 0===e?void 0:e.inputRef.current}}),X=e=>{const t=(0,f.aF)(e,30);K(t),T(t)},W=(0,a.Z)((e=>{X(""),t.includes(e)?G([e]):(z(e),D(e))})),ee=e=>{const t=$.includes(e);O(t?$.filter((t=>t!==e)):[...$,e])},te=(0,a.Z)((()=>{G($),O([])})),se=(0,a.Z)((()=>H.current&&H.current.inputRef.current&&H.current.tagInputRef.current?{tagInput:H.current,tagInputElem:H.current.tagInputRef.current,inputElem:H.current.inputRef.current}:null)),ne=(0,a.Z)((e=>{const t=se();return!!(t&&e&&e instanceof Element)&&e.closest(".semi-tagInput")===t.tagInputElem})),re=(0,a.Z)((e=>!!(e&&e instanceof Element)&&null!==e.closest(".semi-tag"))),le=(0,a.Z)((e=>{const t=e.target,s=se();if(!s||!ne(t))return;const{tagInput:n,tagInputElem:r,inputElem:l}=s,{selectionStart:a,selectionEnd:i}=l;return $.length>0&&re(t)?(te(),null==l||l.setSelectionRange(0,0),void n.focus()):void 0})),ae=(0,a.Z)((e=>{const t=e.target;se()&&ne(t)&&re(t)&&(ne(e.relatedTarget)&&re(e.relatedTarget)||O([]))}));(0,n.useEffect)((()=>{const e=e=>{"Delete"===e.code||"Backspace"===e.code?(S.current=!0,le(e)):S.current=!1};return window.addEventListener("keydown",e,!0),window.addEventListener("blur",ae,!0),()=>{window.removeEventListener("keydown",e,!0),window.removeEventListener("blur",ae,!0)}}),[]);const ie=(0,a.Z)((e=>{e.replace(/ {1,}/g,"")===I.replace(/ {1,}/g,"")&&X("")})),ce=async e=>{const[t]=e;Promise.resolve().then((()=>X(I)));const s=t.replace(/ {1,}/g,"");if(0===s.length)return;await Y(s)&&(D(s),ie(I))},oe=async e=>{if(P.current)return void q(e);const t=e.replace(/ {1,}$/,""),s=t.replace(/ {1,}/g,"");if(X(t),t===e||!t||S.current)return;await Y(s)&&(D(s),ie(I))};(0,n.useEffect)((()=>{var e;const t=null===(e=H.current)||void 0===e?void 0:e.inputRef.current;if(!t)return;const s=()=>{P.current=!0,q(t.value)},n=()=>(0,r.unstable_batchedUpdates)((()=>{P.current=!1,q(""),oe(t.value)}));return t.addEventListener("compositionstart",s),t.addEventListener("compositionend",n),()=>{t.removeEventListener("compositionstart",s),t.removeEventListener("compositionend",n)}}),[]);(0,n.useEffect)((()=>{b&&T("")}),[b]);return(0,E.jsxs)("div",{className:k,children:[(0,E.jsx)(l.Lt,{position:"bottomLeft",trigger:"focus",className:L,style:{maxHeight:200,overflow:"scroll"},render:(0,E.jsx)(l.Lt.Menu,{children:F.map((e=>(0,E.jsx)(l.Lt.Item,{className:M,onClick:()=>W(e),children:e},e)))}),children:(0,E.jsx)(l.EG,{ref:H,inputValue:U,onInputChange:oe,value:t,placeholder:_,renderTagItem:(e,t,s)=>(0,E.jsx)(N,{value:e,selected:$.includes(e),disabled:o,onClick:ee},e),onAdd:ce,onBlur:e=>{if(e.relatedTarget&&e.relatedTarget instanceof Element){const t=[`.${L}`,Z].filter((e=>e)).join(",");if(null!==e.relatedTarget.closest(t)||re(e.relatedTarget))return}ce([I])},disabled:o})}),!1,!o&&!w&&(0,E.jsx)(R,{value:t,onSelect:e=>{W(e),null==j||j()}})]})})),q=(0,l.Q2)(C)},69836:(e,t,s)=>{s.d(t,{ir:()=>x});var n=s(50959),r=s(84875),l=s.n(r),a=s(45599),i=s(96426),c=s(85083),o=s(88623),u=s(87842),d=s(84997),m=s(40699),p=s(96305),f=s(11527);const g=e=>{const{className:t,loadingText:s}=e,{t:n}=(0,a.$)(),{handleMouseEnter:r}=(0,d.S)();return(0,f.jsxs)("div",{className:l()(p.Z.root,t),children:[(0,f.jsx)(u.a,{className:p.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,f.jsx)("div",{className:p.Z.text,onMouseEnter:r,children:s||n("pc_stickers_release_in_web")})]})},v=e=>{const{className:t,tooltip:s}=e,{t:r}=(0,a.$)(),{handleMouseEnter:c}=(0,d.w)({content:s,className:p.Z.tooltip}),o=(0,n.useRef)(null),{setIsMarqueeLoopRunning:u,reactNode:g}=(0,m.J)({text:r("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>o.current});return(0,f.jsxs)("div",{className:l()(p.Z.root,t,p.Z.error),onMouseEnter:e=>{u(!0),c(e)},onMouseLeave:()=>u(!1),children:[(0,f.jsx)(i.r,{className:p.Z.icon}),(0,f.jsx)("div",{ref:o,className:p.Z.text,children:g})]})},h=e=>{const{className:t,text:s}=e,{handleMouseEnter:n}=(0,d.S)();return(0,f.jsxs)("div",{className:l()(p.Z.root,t,p.Z.checked),children:[(0,f.jsx)(o.r,{className:p.Z.icon}),(0,f.jsx)("div",{className:p.Z.text,onMouseEnter:n,children:s})]})},w=e=>{const{className:t}=e,{t:s}=(0,a.$)(),{handleMouseEnter:n}=(0,d.S)();return(0,f.jsxs)("div",{className:l()(p.Z.root,t),children:[(0,f.jsx)("div",{className:l()(p.Z.icon,p.Z.yellowIcon),children:(0,f.jsx)("div",{className:p.Z.yellowPoint})}),(0,f.jsx)("div",{className:p.Z.text,onMouseEnter:n,children:s("pc_stickers_release_editing_web")}),(0,f.jsx)(c.r,{className:p.Z.icon})]})},x=e=>{const{className:t,loading:s,invalid:n,errorToolip:r,isInfoComplete:l,title:a,loadingText:i}=e;return s?(0,f.jsx)(g,{className:t,loadingText:i}):n?(0,f.jsx)(v,{className:t,tooltip:r}):l?(0,f.jsx)(h,{className:t,text:a}):(0,f.jsx)(w,{className:t})}},31086:(e,t,s)=>{s.d(t,{Z:()=>m,f:()=>u});var n=s(59787),r=s(82665),l=s(50279),a=s(25807),i=s(8129),c=s(2555),o=s(94435);const u=10;function d(e){return Boolean(e.id)}class m{constructor(){(0,n.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const s of(0,r.Z)(e,u)){const e=await Promise.all(s.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:s,onResult:n,onUpdateResult:r}=e,a=JSON.parse(JSON.stringify(e.req));let c=this.itemMap.get(s);if(null!==(t=c)&&void 0!==t&&t.promise&&(0,l.Z)(c.req,a))try{return await c.promise}catch(o){(0,i.c6)("[MaterialPublishService] publish failed, start to retry",{id:s})}return c={promise:null,id:s,req:a,onResult:n,onUpdateResult:r},this.itemMap.set(s,c),c.promise=this.publishImpl(c),c.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),s=async(s,n)=>{try{const a={error:s,errorText:this.getErrorText(s),time:Math.round(performance.now()-t),resourceId:n};var r,l;if(d(e.req))await(null===(r=e.onUpdateResult)||void 0===r?void 0:r.call(e,{req:e.req,...a}));else await(null===(l=e.onResult)||void 0===l?void 0:l.call(e,{req:e.req,...a}))}catch(a){(0,i.RF)("[MaterialPublishService] callOnResult failed",a)}};let n;try{n=await this.postOrUpdate(e)}catch(r){throw e.promise=null,s(r,""),r}return await s(null,n.resource_id),n}async postOrUpdate(e){return d(e.req)?(await(0,o.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,o.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new c.B).timeout(5e3)])}catch(t){(0,i.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const s=performance.now(),n=new c.B,r={count:50,effect_types:t,uid:a.$.userInfo.uid,cursor:0};for(;performance.now()-s<5e3;){const t=await(0,o.Js)(r).catch((()=>null));if(null!=t&&t.effect_item_list){const s=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>s.has(e))))return}await n.timeout(500)}}}}}]);