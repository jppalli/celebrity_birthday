"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[165],{19608:(e,i,o)=>{function l(e){e.stopPropagation(),e.preventDefault()}o.d(i,{Jt:()=>l})},92417:(e,i,o)=>{o.d(i,{Z:()=>t});var l=o(10949),a=o(75181);const t=function(e){return((e,i)=>({value:a.U2(e.values,i),error:a.U2(e.errors,i),touched:a.U2(e.touched,i)}))((0,l.Z)(),e)}},84736:(e,i,o)=>{o.d(i,{Ex:()=>d.Z,FN:()=>c.Z,Form:()=>u.Z,II:()=>r.Z,J2:()=>s.Z,Kx:()=>n.Z,Q2:()=>v.Z,XQ:()=>m.Z,XZ:()=>a.ZP,ih:()=>f.i,tL:()=>g.Z,u:()=>p.Z,u_:()=>t.Z,zx:()=>l.Z});o(32913);var l=o(99891),a=o(63436),t=o(15194),r=o(55550),n=o(88161),s=o(21797),d=o(63522),c=o(23997),p=o(11643),u=o(60679),m=o(78367),g=o(92417),v=o(5455),f=o(71212)},82186:(e,i,o)=>{o.d(i,{WQ:()=>s});var l=o(50959),a=o(66589),t=o(52918),r=o(2555);const n=1e4;function s(e){const i=(0,t.fv)((()=>({isImportLoading:!1,hideImportLoadingTimer:new r.B,notifyImportLoadingFinish:null,showImportLoading:async()=>{i.isImportLoading=!0,await Promise.race([new Promise((e=>i.notifyImportLoadingFinish=e)),i.hideImportLoadingTimer.timeout(n)]),(0,a.z)((()=>{i.isImportLoading=!1}))},finishImportLoadingFinishIfNeeded:()=>{i.isImportLoading&&i.notifyImportLoadingFinish&&(i.notifyImportLoadingFinish(),i.notifyImportLoadingFinish=null)},destroy:()=>{i.hideImportLoadingTimer.cancel()}})));return(0,l.useEffect)((()=>{const o=(0,a.EH)((()=>{e.isAllReady&&i.finishImportLoadingFinishIfNeeded()}));return()=>{o()}}),[]),i}},99826:(e,i,o)=>{o.d(i,{Z:()=>_});var l=o(84875),a=o.n(l),t=o(23479),r=o(45599),n=o(36983),s=o(69836),d=o(49749),c=o(17843),p=o(60209),u=o(95218);const m="root-bPt1FS",g="statusBar-HPGgP6",v="contextMenuItem-HpV5Jn";var f=o(11527);const _=(0,t.Pi)((({className:e,material:i,isSelected:o,onClick:l,onReimport:t,onRemove:_})=>{var F;const{t:h}=(0,r.$)(),{common_data:y}=i,I=i.payload.filterImg,C=Boolean(null===(F=i.payload)||void 0===F||null===(F=F.unmetRequirements)||void 0===F?void 0:F.length),x=Boolean(y.title&&y.description),{handleContextMenu:b}=(0,c.D)({content:(0,f.jsx)(d.m,{items:[{key:"reimport",render:({key:e,className:o})=>Boolean(C)&&(0,f.jsx)("div",{className:a()(o,v),onClick:()=>t(i),children:h("pc_stickers_release_again_web")},e)},{key:"remove",render:({key:e,className:o})=>(0,f.jsx)("div",{className:a()(o,v),onClick:()=>_(i),children:h("pc_stickers_release_delete_web")},e)}]})});return(0,f.jsxs)("div",{className:a()(e,m),onClick:()=>{var e;l(null===(e=i.payload)||void 0===e?void 0:e.localId)},children:[(0,f.jsx)(n.Y,{src:i.payload.filterImg,isSelected:o,isInvalid:Boolean(C),size:80,onContextMenu:e=>{var o;b(e),l(null===(o=i.payload)||void 0===o?void 0:o.localId)}}),(0,f.jsx)(s.ir,{className:g,loading:!I,invalid:C,errorToolip:C&&(null===(L=i.payload)||void 0===L||null===(L=L.unmetRequirements)||void 0===L?void 0:L.map((e=>{const i=u.ZV[p.nb.File][e]||u.ZV[p.nb.Cover][e];return i?(0,f.jsx)("div",{children:i},e):null}))),isInfoComplete:x,title:y.title})]});var L}))},60681:(e,i,o)=>{o.d(i,{Z:()=>S});var l=o(50959),a=o(23479),t=o(45599),r=o(84736),n=(o(42983),o(91285)),s=(o(11036),o(76199)),d=o(6858),c=o(45033),p=o(25577),u=o(2237),m=o(95218),g=o(53803),v=o(94435);const f="root-qPd6XE",_="coverWrapper-YHEPdi",F="box-Tn50Wt",h="img-MkfnN9",y="tag-rTNBT4",I="editCover-cZ6Noe",C="input-ixM0l_",x="icon-nenuZE",b="businessCheckbox-RcPes0";var L=o(11527);const S=(0,a.Pi)((({material:e,materialListStore:i,formApi:o,collectionId:a,authProps:S})=>{var k;const{t:U}=(0,t.$)(),{payload:P}=e,{value:Z}=(0,r.tL)("common_data.title");(0,l.useMemo)((()=>e.common_data.source===v.r0.UserPostPc),[e]);(0,l.useLayoutEffect)((()=>(null==o||o.reset(),null==o||o.setValues(e,{isOverride:!0}),()=>{const l=null==o?void 0:o.getValues();l&&i.updateFormState(e,{is_vip:l.is_vip||!1,common_data:{...e.common_data,title:l.common_data.title||"",description:l.common_data.description,is_original:l.common_data.is_original||!1,is_business:l.common_data.is_business||!1}})})),[e]);const{getDisplayLength:w}=(0,c._)(),E=(o,l)=>{i.updateFormState(e,{common_data:{...e.common_data,[l]:o}})};return(0,L.jsxs)("div",{className:f,children:[(0,L.jsx)("div",{className:_,children:(0,L.jsxs)("div",{className:F,children:[P.filterImg?(0,L.jsx)("img",{className:h,src:P.filterImg}):(0,L.jsx)(u.t,{className:x,iconWidth:28}),(0,L.jsx)("div",{className:y,style:{backgroundColor:null===(k=e.filter)||void 0===k?void 0:k.desc_background_color},children:Z}),(0,L.jsx)("div",{className:I,onClick:async()=>{i.openFilterCoverEditor(e,a)},children:U("pc_stickers_release_cover_edit_web")})]})}),(0,L.jsx)(n.l,{fieldClassName:C,label:U("pc_filter_title"),field:"common_data.title",maxLength:m.S8,placeholder:U("pc_stickers_release_xy_name_web",{X:1,Y:w(m.S8)}),allowEnter:!1,rules:[{required:!0,message:""}],onChange:e=>E(e,"title")}),(0,L.jsx)(n.l,{fieldClassName:C,label:U("pc_filter_setting_describe"),field:"common_data.description",maxLength:m.t2,placeholder:U("pc_stickers_release_xy_details_web",{X:1,Y:w(m.t2)}),allowEnter:!1,rules:[{required:!0,message:""}],onChange:e=>E(e,"description")}),!1,S&&(0,L.jsx)(p.Z,{onClickUseAll:()=>{const e=null==o?void 0:o.getValues();e&&i.applyAuthSettingsToAll({isVip:e.is_vip,isOriginal:e.common_data.is_original,isBusiness:e.common_data.is_business})},children:(0,L.jsxs)("div",{className:g.Z.authGroup,children:[(0,L.jsx)(p._,{text:U("pc_template_authorize_range_web")}),(0,L.jsxs)("div",{className:g.Z.right,children:[(0,L.jsx)(s.l,{noLabel:!0,field:"is_vip",sendLogService:S.sendLogServ}),(0,L.jsx)(d.R,{fieldClassName:b,noLabel:!0,field:"common_data.is_business",vipField:"is_vip",authorSignService:S.authorSignService,getAuthFileUploadService:()=>S.authFileUploadServiceManager.ensure(P.localId),sendLogService:S.sendLogServ})]})]})})]})}))},56714:(e,i,o)=>{o.d(i,{v:()=>t});var l=o(64979),a=o(8129);class t extends l.D5{sendUploadActionLog(e){const{mainFormLayout:i}=e,o="mainForm"===i?"upload_more":"upload";this.sendPageActionLog({action:o})}sendMaterialPublishLog({publishResult:e,filter:i,logPrefix:o}){this.sendMaterialPublishStatusLog({...e,publishParams:i,status:e.error?"fail":"success",cover_type:i.payload.coverEditType,path:i.payload.path},{material_size:i.payload.size}),e.error?(0,a.RF)(`${o} filter publish failed`,e.error,{id:i.payload.localId}):(0,a.c6)(`${o} filter publish success`,{id:i.payload.localId,resourceId:e.resourceId})}sendMaterialCollectionPublishLog({publishResult:e,collection:i}){this.sendMaterialPublishStatusLog({...e,cover_type:"online_generated",publishParams:i,status:e.error?"fail":"success",path:"",resolution:"720x720"}),e.error?(0,a.RF)("[CollectionStore] collection publish failed",e.error,{id:i.payload.localId}):(0,a.c6)("[CollectionStore] collection publish success",{id:i.payload.localId,resourceId:e.resourceId}),(0,a.c6)("[CollectionStore] collection publish done",{resourceId:e.resourceId})}}},99181:(e,i,o)=>{o.d(i,{Z:()=>s});var l=o(23073),a=o(93639),t=o(98052);var r=o(8129),n=o(1946);const s=new class{async openFilterFilePicker(e){const i={...e,temporaryId:(0,n.V)("single")};(0,r.c6)("[JSB] openFilterFilePicker req --\x3e",{...(0,a.Z)(i,[])});const o=await(e=>t.Jn.call("openFilterFilePicker",e))(i);return(0,r.c6)("[JSB] openFilterFilePicker resp <--",(0,a.Z)(o,["filterImg"])),o}async uploadDroppedFilterFiles(e){var i;const o={...e,temporaryId:(0,n.V)("single")};(0,r.c6)("[JSB] uploadDroppedFilterFiles req --\x3e",{...(0,a.Z)(o,[])});const l=await(e=>t.Jn.call("uploadDroppedFilterFiles",e))(o);return(0,r.c6)("[JSB] uploadDroppedFilterFiles resp <--",{imagesCount:null==l||null===(i=l.filters)||void 0===i?void 0:i.length}),l}registerFilterFileProcessResultEvent(e){return(e=>{const i=i=>{i.data&&e(i.data)};return t.Jn.on("FilterFileProcessResult",i),()=>t.Jn.off("FilterFileProcessResult",i)})((i=>{(0,r.c6)(`[JSB] FilterFileProcessResult ${null==i?void 0:i.type} {${null==i?void 0:i.id}}`,{...(0,l.Z)(i,["result","uri","error","fileUri","sourceUri","filterUri","temporaryId","id","collectionId"])}),e(i)}))}async openFilterCollectionCoverImage(e){const i={...e,temporaryId:(0,n.V)("collection")};(0,r.c6)("[JSB] openFilterCollectionCoverImage req --\x3e",{...(0,a.Z)(i,[])});const o=await(e=>t.Jn.call("openFilterCollectionCoverImage",e))(i);return(0,r.c6)("[JSB] openFilterCollectionCoverImage resp <--",(0,a.Z)(o,["filterImg"])),o}async openFilterCoverImage(e){const i={...e,temporaryId:(0,n.V)("single")};(0,r.c6)("[JSB] openFilterCoverImage req --\x3e",{...(0,a.Z)(i,[])});const o=await(e=>t.Jn.call("openFilterCoverImage",e))(i);return(0,r.c6)("[JSB] openFilterCoverImage resp <--",(0,a.Z)(o,["filterImg"])),o}async cancelFilterUpload(e){(0,r.c6)("[JSB] cancelFilterUpload req --\x3e",e),await(e=>t.Jn.call("cancelFilterUpload",e))(e),(0,r.c6)("[JSB] cancelFilterUpload resp <--")}}},893:(e,i,o)=>{o.d(i,{WQ:()=>v});var l=o(23073),a=o(93639),t=o(50959),r=o(52918),n=o(42983),s=o(50366),d=o(99181),c=o(18882),p=o(95218),u=o(17941),m=o(93668),g=o(74235);function v(){const e=(0,r.fv)((()=>({uploadConfigService:new s.w,materialList:[],scrollAreaRef:(0,t.createRef)(),get hasMaterials(){return this.materialList.length>0},selectedId:null,get selectedMaterial(){return e.selectedId?e.getMaterial(e.selectedId):null},get isAllReady(){return e.materialList.length>0&&e.materialList.every((e=>e.payload.filterImg))},addMaterials(i){i.length&&(e.materialList=[...e.materialList,...i],e.materialList.length===i.length&&(e.selectedId=i[0].payload.localId))},getMaterial:i=>{var o;return null!==(o=e.materialList.find((e=>{var o;return(null===(o=e.payload)||void 0===o?void 0:o.localId)===i})))&&void 0!==o?o:null},selectMaterial(i){e.selectedId=i,e.selectedMaterial&&(e.selectedMaterial.payload.hasEverSelected=!0)},updateThumbnailSrc(e,i){e.payload.filterImg=i},updateUploadedData(e,i){i.fileUri&&(e.filter={...e.filter,original_file_uri:i.fileUri})},updateUnmetRequirements(e,i){e.payload.unmetRequirements=i,e.payload.hasCheckedRequirements=!0},makeInitForm:({payload:e,source:i,title:o,format:l,is_vip:a})=>({effect_type:n.Ab.Filter,common_data:{title:o,description:"",tags:[],source:i,is_original:!1,is_business:!1,web_extra:"",icon:{image_uri:""},format:l},is_vip:a,payload:{hasEverSelected:!1,itemId:void 0,unmetRequirements:[],hasCheckedRequirements:!1,isUploadFailed:!1,localId:"",filterImg:"",size:0,path:"",error:"",temporary:{FilterFile:"",Thumbnail:"",FilterImg:""},coverEditType:void 0,...e},filter:{desc_background_color:p.KD,original_image:{image_uri:(0,c.c_)()},original_file_uri:""}}),updateFormState(e,i){Object.assign(e,i)},updateUploadResp(e,{fileUri:i,sourceUri:o,filterUri:l,uri:a}){i&&(e.filter={...e.filter,original_file_uri:i}),o&&(e.filter={...e.filter,original_image:{image_uri:o}}),a&&(e.filter={...e.filter,original_image:{image_uri:a}}),l&&(e.common_data.icon.image_uri=l)},reimportMaterial(i,o){const l=e.materialList.findIndex((e=>e.payload.localId===i));-1!==l&&(e.materialList[l]=o)},removeMaterial(i){e.materialList=e.materialList.filter((e=>e.payload.localId!==i.payload.localId)),d.Z.cancelFilterUpload({id:i.payload.localId})},applyAuthSettingsToAll:({isOriginal:i,isBusiness:o,isVip:l})=>{e.materialList.forEach((e=>{e.is_vip=Boolean(l),e.common_data.is_original=Boolean(i),e.common_data.is_business=Boolean(o)}))},dragInsert(i,o){const l=e.materialList.splice(i,1),a=i>o?o+1:o;e.materialList.splice(a,0,...l)},get isReadyToPublish(){return e.materialList.every((e=>{var i,o,l;return 0===(null===(i=e.payload.unmetRequirements)||void 0===i?void 0:i.length)&&(null===(o=e.common_data)||void 0===o?void 0:o.title)&&(null===(l=e.common_data)||void 0===l?void 0:l.description)&&e.payload.filterImg}))},get uploadStats(){let i=0,o=0,l=0;return e.materialList.forEach((e=>{var a,t,r;if(e.payload.isUploadFailed)return void(o+=1);(null===(a=e.common_data.icon)||void 0===a?void 0:a.image_uri)&&(null===(t=e.filter)||void 0===t?void 0:t.original_file_uri)&&(null===(r=e.filter)||void 0===r||null===(r=r.original_image)||void 0===r?void 0:r.image_uri)?i+=1:l+=1})),{pending:l,succeeded:i,failed:o}},collectLogData:()=>e.materialList.map((e=>{const i=(0,a.Z)(e.payload,"filterImg");return{...e,payload:i}})),async openFilterCoverEditor(i,o){var l;const a=await d.Z.openFilterCoverImage({...await e.uploadConfigService.getUploadConfigs("openFilterCoverImage"),...p.Pc,id:i.payload.localId,tagColor:null===(l=i.filter)||void 0===l?void 0:l.desc_background_color,title:i.common_data.title,filters:e.materialList.map((e=>({id:e.payload.localId}))),collectionId:o});"Success"===a.result&&(a.isUseAll?e.materialList.forEach((e=>{e.filter={...e.filter,desc_background_color:a.tagColor},e.payload.temporary={...e.payload.temporary,FilterImg:a.temporaryId,Thumbnail:a.temporaryId},e.payload.coverEditType=a.coverEditType})):(i.filter={...i.filter,desc_background_color:a.tagColor},i.payload.temporary={...i.payload.temporary,FilterImg:a.temporaryId,Thumbnail:a.temporaryId},i.payload.coverEditType=a.coverEditType)),"Error"===a.result&&(i.payload.isUploadFailed=!0,i.payload.error=a.error)},handleFilePickerResp(i,o){const a=(0,u.K)(m.YW.OriginalForSubscription);return i.filters.map((i=>{const t=(0,c.td)(i.path,i.size),r=(0,g.YB)(i.path,{maxLength:p.S8}),n={FilterFile:i.temporaryId,FilterImg:i.temporaryId,Thumbnail:i.temporaryId};return e.makeInitForm({payload:{localId:i.id,...(0,l.Z)(i,["size","path","error"]),...t,temporary:n,isUploadFailed:"Error"===i.result},source:o,title:r,format:t.fileType,is_vip:a})}))},async refreshUploadConfigsIfNeeded(i){await e.uploadConfigService.refreshUploadConfigsIfNeeded({when:i,logPrefix:"[FilterStore]"})},async openFilterPicker({maxTotalCount:i,maxCount:o,minCount:l,source:a,collectionId:t}){await e.refreshUploadConfigsIfNeeded("openFilterFilePicker");const r=await d.Z.openFilterFilePicker({...await e.uploadConfigService.getUploadConfigs("openFilterPicker"),...p.Zk,minCount:l,maxCount:o,maxTotalCount:i,collectionId:t}),n=e.handleFilePickerResp(r,a);e.addMaterials(n)},async reimportFilterFilePicker({maxTotalCount:i,maxCount:o,minCount:l,source:a,oldId:t,collectionId:r}){await e.refreshUploadConfigsIfNeeded("openFilterFilePicker");const n=await d.Z.openFilterFilePicker({...await e.uploadConfigService.getUploadConfigs("openFilterPicker"),...p.Zk,minCount:l,maxCount:o,maxTotalCount:i,multiple:!1,collectionId:r}),s=e.handleFilePickerResp(n,a);s[0]&&(e.reimportMaterial(t,s[0]),d.Z.cancelFilterUpload({id:t}))},async uploadDroppedFilterFiles({maxTotalCount:i,maxCount:o,minCount:l,source:a,collectionId:t}){await e.refreshUploadConfigsIfNeeded("uploadDroppedFilterFiles");const r=await d.Z.uploadDroppedFilterFiles({...await e.uploadConfigService.getUploadConfigs("uploadDroppedFilterFiles"),...p.Zk,minCount:l,maxCount:o,maxTotalCount:i,collectionId:t}),n=e.handleFilePickerResp(r,a);e.addMaterials(n)},async retryUpload(i,o){if(!(i.length+o.length))return;const l=i.map((e=>e.payload.localId));l.forEach((i=>{const o=e.getMaterial(i);o&&(o.payload.isUploadFailed=!1)}));await d.Z.openFilterFilePicker({...await e.uploadConfigService.getUploadConfigs("openFilterPicker"),...p.Zk,minCount:1,maxCount:i.length,maxTotalCount:i.length,retryUploadIds:[...l,...o]})}})));return e}},18882:(e,i,o)=>{o.d(i,{$Y:()=>p,c_:()=>c,td:()=>d});var l=o(50959),a=o(45599),t=o(97311),r=o(54847),n=o(60209),s=o(95218);const d=(e,i)=>{const o=[];i>s.Tb&&o.push(n.id.MaxFileSize);let l="";try{l=function(e){const i=(0,t.lm)(e);if("cube"===i)return n.FU.CUBE;if("3dl"===i)return n.FU.THREEDL;throw new Error(`Unsupported suffix ${i}`)}(e)}catch(a){o.push(n.id.Format)}return{unmetRequirements:o,fileType:l}},c=()=>r.appModel.debugInfo.useBOE?"tos-boei18n-i-9ove8i7dyj/1760c449404c48e79f65500872fbf75c":"tos-maliva-i-dwpf7vt6ri-us/c7ea4ddb53394986a5d524457a5c66ef";function p(){const{t:e}=(0,a.$)(),i=e=>Object.entries(s.ZV[e]).map((([e,i])=>({key:e,title:i})));return(0,l.useMemo)((()=>[{key:n.nb.File,title:e("pc_filter_specification"),instructions:i(n.nb.File)},{key:n.nb.Cover,title:e("pc_filter_cover_description"),instructions:i(n.nb.Cover)}]),[])}},60209:(e,i,o)=>{o.d(i,{FU:()=>a,id:()=>l,nb:()=>t});let l=function(e){return e.Format="format",e.MaxFileSize="maxFileSize",e.CollectionNum="collectionNum",e.CoverCopyright="coverCopyright",e.CoverLut="coverLut",e.CoverFormat="coverFormat",e.CoverMinImageSize="coverMinImageSize",e.CoverMaxFileSize="coverMaxFileSize",e}({}),a=function(e){return e.CUBE="cube",e.THREEDL="3dl",e}({}),t=function(e){return e.File="file",e.Cover="cover",e}({})},74235:(e,i,o)=>{o.d(i,{YB:()=>t,xB:()=>a});var l=o(86439);function a(e){const{len:i,i18n:o}=e,[l]=(o.language||"").split("-");return"zh"===l?Math.floor(i/2):i}function t(e,i){const o=e.split(/[\\/]/g).pop().replace(/\.\w+?$/g,"");return(0,l.aF)(o,null==i?void 0:i.maxLength)}}}]);