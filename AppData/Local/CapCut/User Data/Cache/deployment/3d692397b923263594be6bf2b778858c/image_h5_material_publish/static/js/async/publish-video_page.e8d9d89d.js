"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[776],{84736:(e,o,i)=>{i.d(o,{EG:()=>m.Z,Ex:()=>c.Z,FN:()=>v.Z,Form:()=>_.Z,II:()=>s.Z,J2:()=>n.Z,Kx:()=>d.Z,Lt:()=>r.Z,Q2:()=>h.Z,Vp:()=>u.Z,XQ:()=>f.Z,XZ:()=>l.ZP,ih:()=>y.i,u:()=>g.Z,u_:()=>t.Z,yC:()=>p.Z,zx:()=>a.Z});i(32913);var a=i(99891),l=i(63436),t=i(15194),r=i(89270),s=i(55550),d=i(88161),n=i(21797),c=i(63522),p=i(48611),u=i(40996),m=i(83335),v=i(23997),g=i(11643),_=i(60679),f=i(78367),h=i(5455),y=i(71212)},42983:(e,o,i)=>{i.d(o,{Ab:()=>a});let a=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({})},16565:(e,o,i)=>{i.r(o),i.d(o,{default:()=>Ze});var a=i(23479),l=i(45599),t=i(12904),r=i(64979),s=i(50959),d=i(9608),n=i(73224);let c=function(e){return e.Format="format",e.RecommendFileSize="RecommendFileSize",e.FileDuration="FileDuration",e.ResolutionSize="ResolutionSize",e}({}),p=function(e){return e.File="file",e}({});const u={[p.File]:{[c.Format]:n.I18n.t("pc_video_form"),[c.FileDuration]:n.I18n.t("pc_filter_time_limit"),[c.RecommendFileSize]:n.I18n.t("pc_filter_file_size_one_g"),[c.ResolutionSize]:n.I18n.t("pc_filter_pixel_size_n")}},m="ImportVideo";var v=i(93639),g=i(52918),_=i(66589),f=i(84736),h=i(42983),y=i(54847),F=i(50366),A=i(60251),C=i(8129),b=i(31086),V=i(1946),S=i(57609),x=i(93340),I=i(67078),L=i(75028),w=i(98052);const P=new class{async openVideoFilePicker(e){(0,C.c6)("[JSB] openVideoFilePicker req --\x3e",{request:e});const o=await(e=>w.Jn.call("openVideoFilePicker",e))(e);return(0,C.c6)("[JSB] openVideoFilePicker resp <--",o),o}async uploadDroppedVideoFiles(e){var o;(0,C.c6)("[JSB] uploadDroppedVideoFiles req --\x3e",{...(0,v.Z)(e,[])});const i=await(e=>w.Jn.call("uploadDroppedVideoFiles",e))(e);return(0,C.c6)("[JSB] uploadDroppedVideoFiles resp <--",{imagesCount:null==i||null===(o=i.videos)||void 0===o?void 0:o.length,ids:i.videos.map((e=>e.id))}),i}registerVideoFileProcessResultEvent(e){return(e=>{const o=o=>{o.data&&e(o.data)};return w.Jn.on("videoFileProcessResult",o),()=>w.Jn.off("videoFileProcessResult",o)})((o=>{(0,C.c6)(`[JSB] videoFileProcessResult {${null==o?void 0:o.id}}`,o),e(o)}))}async openVideoCoverEdit(e){(0,C.c6)("[JSB] openVideoCoverEdit req --\x3e",{...(0,v.Z)(e,[])});const o=await(e=>w.Jn.call("openVideoCoverEdit",e))(e);return(0,C.c6)("[JSB] openVideoCoverEdit resp <--",o),o}async cancelVideoUpload(e){(0,C.c6)("[JSB] CancelVideoUploadRequest req --\x3e",{...e}),await(e=>w.Jn.call("cancelVideoUpload",e))(e)}};h.Ab.Emoticons,h.Ab.Sticker,h.Ab.StickerCollection,h.Ab.Filter,h.Ab.FilterCollection,h.Ab.Video,h.Ab.AudioEffect;var k=i(97311),R=i(17941),E=i(93668),U=i(74235),j=i(94435);const M=e=>e.filter((e=>{var o;return!(null!==(o=e.payload)&&void 0!==o&&o.itemId)})).map((e=>(e.payload.hasVideoFrameSelect||(e.common_data.icon.image_uri=e.payload.coverUri),e))),N=e=>{const{id:o,path:i,size:a,duration:l,video_size_type:t}=e,r=(0,k.lm)(i),s=[];["mp4","mov","avi"].includes(r)||s.push(c.Format),a>1073741824&&s.push(c.RecommendFileSize),l>60&&s.push(c.FileDuration);return{effect_type:5,common_data:{title:(0,U.YB)(i,{maxLength:40}),description:"",tags:[],source:j.r0.UserPostPc,is_original:!1,is_business:!1,web_extra:"",icon:{image_uri:""},file:{file_uri:"",file_md5:"",size:Number(a)}},is_vip:(0,R.K)(E.YW.OriginalForSubscription),payload:{hasEverSelected:!1,itemId:void 0,unmetRequirements:s,localId:o,path:i,coverBase64:"",size:a,hasVideoFrameSelect:!1,coverUri:"",isUploadFailed:!1,uploadFailedText:"",temporaryRecord:{VideoCover:""}},video:{video_id:"",duration:l,video_size_type:t}}};var T=i(46309),B=i(3718),z=i(51654),Z=i(18370);const D=(0,s.createContext)(null),q=()=>(0,s.useContext)(D);var J=i(11527);const O=(0,a.Pi)((({className:e})=>{var o,i;const{t:a}=(0,l.$)(),t=(0,s.useMemo)((()=>{return[{key:p.File,title:a("pc_video_specification"),instructions:(e=p.File,Object.entries(u[e]).map((([e,o])=>({key:e,title:o}))))}];var e}),[]),r=q().selectedVideo;return(0,J.jsx)(d.v,{className:e,groups:t,initGroup:p.File,activeGroup:p.File,resetExpandedGroupKey:null!==(o=null==r||null===(i=r.payload)||void 0===i?void 0:i.localId)&&void 0!==o?o:null,getStatus:e=>{var o;return r?null!==(o=r.payload)&&void 0!==o&&null!==(o=o.unmetRequirements)&&void 0!==o&&o.includes(e.key)?"error":"success":"init"}})}));var G=i(74502),Y=i(36775);const Q=(0,a.Pi)((({className:e})=>{const o=q(),{t:i}=(0,l.$)(),a=(0,s.useRef)(null),t=(0,s.useMemo)((()=>o.videoList.length),[o.videoList]);return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(G.Z,{className:e,leftText:i("pc_sticker_import_zero_to_hundred_web",{X:t,Y:50}),isPublishDisabled:!o.isAllReadyPublish,isPublishing:o.isPublishing,needConfirmModalOnClose:o.needConfirmModalOnClose,onPublish:()=>o.uploadAndPublish(a.current)}),(0,J.jsx)(Y.q,{ref:a,uploadStats:o.uploadStats,onRetryUpload:o.retryUpload,onCancel:o.isAllUploadedWatcher.stop,onShowUploadFail:o.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:o.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var W=i(74083),X=i(82725),H=i(84875),K=i.n(H),$=i(74474);const ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAA2CAYAAACMRWrdAAAACXBIWXMAAAhOAAAITgGMMQDsAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAGOSURBVHgB7ZjpbsIwEIQnhUI5erz/M/YXhzgqSHdIIhVqIuPdpn/mk6xIITY73mXWARBCCCGEEEIIIQKp4KCu67ldpjZGKKe2cayqan2zNtcc2f0jChijEPtiCnpFDGNb72witnblZi9tcNM2NoYV5pybYmaieKWgJziJCu6EcpghCmHpLRFEpLCNldJX7oS25ObtSMESPKCQYvOwwBb4vcMMZG0CTz3zfgpKlRwFbUtNo8OTsXPiHg1lasHv0AR3JdDuv6DZjJSLnto5OwTgtXsGyMzN7jxyEYgmM+9IC+IG7UzQBoG4hHVkCExxEYQmSzWCCRHWkSnwTwV1uPtFYr1RxjM14r/7ishSfLMxeWAazYKZ2/e5aClDmcekfe6eG7IH7hGIp4/R2j/ufMwetErYPTdgEIHRDTqruQ4hMEpY0WkhQ+Bq8NeWGy7m0Z7OH6XqWfMZ//DachuEF2aI5bdAAJ5ekn2Sz+TQHqs+0bipC6/d8zfCg603Y8zU1UnE+9eAEEIIIYQQQggRyjdM3Jsueus4uQAAAABJRU5ErkJggg==";var oe=i(36983),ie=i(69836),ae=i(49749),le=i(17843);const te="root-Gp6SAy",re="statusBar-RlHIzL",se="contextMenuItem-Q1pqvP",de=(0,a.Pi)((({className:e,video:o,isSelected:i,onClick:a,onReimport:t,onRemove:r})=>{var s,d;const{t:n}=(0,l.$)(),{common_data:c,payload:m}=o,v=m.coverBase64,g=Boolean(null===(s=o.payload)||void 0===s||null===(s=s.unmetRequirements)||void 0===s?void 0:s.length),_=Boolean(c.title&&(null===(d=c.tags)||void 0===d?void 0:d.length)),{handleContextMenu:f}=(0,le.D)({content:(0,J.jsx)(ae.m,{items:[{key:"reimport",render:({key:e,className:i})=>Boolean(g)&&(0,J.jsx)("div",{className:K()(i,se),onClick:()=>t(o),children:n("pc_material_release_import_again")},e)},{key:"remove",render:({key:e,className:i})=>(0,J.jsx)("div",{className:K()(i,se),onClick:()=>r(o),children:n("pc_material_release_delete")},e)}]})});return(0,J.jsxs)("div",{className:K()(e,te),onClick:()=>{a(o.payload.localId)},children:[(0,J.jsx)(oe.Y,{src:o.payload.coverBase64||ee,isSelected:i,isInvalid:Boolean(g),size:80,onContextMenu:e=>{var i;f(e),a(null===(i=o.payload)||void 0===i?void 0:i.localId)}}),(0,J.jsx)(ie.ir,{className:re,loading:!v,invalid:g,errorToolip:g&&(null===(h=o.payload)||void 0===h||null===(h=h.unmetRequirements)||void 0===h?void 0:h.map((e=>{const o=u[p.File][e];return o?(0,J.jsx)("div",{children:o},e):null}))),isInfoComplete:_,title:c.title})]});var h})),ne="root-zxRVxw",ce="container-X208Ej",pe="cardDragWrapper-FfPLEp",ue="videoCard-erG3SL",me="hover-right-LBd8Iu",ve="hover-left-HN679b",ge=(0,a.Pi)((()=>{const e=q(),o=(0,s.useCallback)(((o,i)=>{e.selectedId!==o.payload.localId&&e.selectMaterial(o.payload.localId)}),[e.selectMaterial]),i=(0,s.useCallback)(((o,i)=>{var a;return(0,J.jsx)(de,{className:K()(ue,{[me]:"right"===i,[ve]:"left"===i}),video:o,onClick:e.selectMaterial,isSelected:e.selectedId===o.payload.localId,onRemove:e.removeVideo,onReimport:e.reimport},null===(a=o.payload)||void 0===a?void 0:a.localId)}),[e.reimport,e.selectMaterial,e.removeVideo,e.selectedId]);return(0,J.jsx)("div",{className:ne,children:(0,J.jsx)("div",{className:ce,children:(0,J.jsx)($.y,{list:e.videoList,renderCard:i,onMoveCard:e.dragInsert,className:pe,getId:e=>e.payload.localId,scrollAreaRef:e.scrollAreaRef,onCardClick:o})})})}));var _e=i(91285),fe=i(28747),he=(i(11036),i(45033)),ye=i(25577),Fe=i(76199),Ae=i(6858),Ce=i(53803);const be="root-KZIMjN",Ve="coverWrapper-RGIBQO",Se="box-DSqyOS",xe="imgBox-DIFFJg",Ie="editCover-CztcLw",Le="label-AoVgOz",we="useAll-_BX2u3",Pe="input-ZRdCJO",ke="businessCheckbox-TvUDwv",Re=(0,a.Pi)((({video:e})=>{const{t:o}=(0,l.$)(),i=q();(0,s.useLayoutEffect)((()=>{var o,a;return null===(o=i.formApi)||void 0===o||o.reset(),null===(a=i.formApi)||void 0===a||a.setValues(e,{isOverride:!0}),()=>i.syncFormData(e)}),[e]);const{getDisplayLength:a}=(0,he._)(),t=(o,a)=>{i.updateFormState(e,{common_data:{...e.common_data,[a]:o}})};return(0,J.jsxs)("div",{className:be,children:[(0,J.jsx)("div",{className:Ve,children:(0,J.jsxs)("div",{className:Se,children:[(0,J.jsx)("div",{className:xe,style:{backgroundImage:`url(${e.payload.coverBase64||ee})`}}),(0,J.jsx)("div",{className:Ie,onClick:()=>i.openCoverEdit(e.payload.localId),children:o("pc_video_frame_select")})]})}),(0,J.jsx)(_e.l,{fieldClassName:Pe,label:o("pc_filter_video_name"),field:"common_data.title",maxLength:40,placeholder:o("pc_stickers_release_xy_name_web",{X:1,Y:a(40)}),allowEnter:!1,rules:[{required:!0,message:""}],onChange:e=>t(e,"title")}),(0,J.jsxs)("div",{className:Le,children:[(0,J.jsx)(fe.u,{fieldClassName:Pe,label:o("pc_stickers_release_tag_set_web"),placeholder:o("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"common_data.tags",itemType:5,recommendConfig:{title:e.common_data.title},rules:[{required:!0,message:""}],onChange:e=>t(e,"tags"),temporaryId:e.payload.localId}),(0,J.jsx)("span",{className:we,onClick:()=>{var e;const{tags:o}=(null===(e=i.formApi)||void 0===e?void 0:e.getValue("common_data"))||{};null!=o&&o.length&&i.applyForTags({tags:o})},children:o("pc_material_release_apply_all")})]}),!1,(0,J.jsx)(ye.Z,{onClickUseAll:()=>{var e;const o=null===(e=i.formApi)||void 0===e?void 0:e.getValues();o&&i.applyAuthSettingsToAll({isVip:o.is_vip,isOriginal:o.common_data.is_original,isBusiness:o.common_data.is_business})},children:(0,J.jsxs)("div",{className:Ce.Z.authGroup,children:[(0,J.jsx)(ye._,{text:o("pc_template_authorize_range_web")}),(0,J.jsxs)("div",{className:Ce.Z.right,children:[(0,J.jsx)(Fe.l,{noLabel:!0,field:"is_vip",sendLogService:i.sendLogServ}),(0,J.jsx)(Ae.R,{fieldClassName:ke,noLabel:!0,field:"common_data.is_business",vipField:"is_vip",authorSignService:i.authorSignService,getAuthFileUploadService:()=>i.authFileUploadServiceManager.ensure(e.payload.localId),sendLogService:i.sendLogServ})]})]})})]})})),Ee=(0,a.Pi)((({className:e})=>{const o=q(),{t:i}=(0,l.$)(),a=(0,s.useCallback)((()=>o.selectedVideo&&(0,J.jsx)(Re,{video:o.selectedVideo})),[o.selectedVideo]);(0,r.pg)({mainFormLayout:o.mainFormLayout,sendLogServ:o.sendLogServ});const t=(0,s.useMemo)((()=>o.videoList.length>=50),[o.videoList]);return(0,W.O)({className:e,layout:o.mainFormLayout,uploadAreaProps:{titleForUploadArea:i("pc_sticker_release_drag_web"),titleForMainForm:i("pc_stickers_release_drag_in_web"),subTitle:".mov/.mp4/.avi",draggingTitle:i("pc_sticker_release_mouse_web"),disabled:t,disabledTooltip:"",onClick:o.openVideoPicker,onDrop:o.droppedVideoFiles},setFormApi:o.setFormApi,renderImportArea:e=>(0,J.jsxs)(J.Fragment,{children:[e,(0,J.jsx)(ge,{})]}),renderFormArea:a,scrollAreaRef:o.scrollAreaRef,onRetry:X.cb})}));var Ue=i(65546);const je="page-jqxfuS",Me="content-JGf9Xk",Ne="requirement-qtA9wp",Te="mainForm-TtAQN9",Be="footer-bDqSJs",ze=(0,a.Pi)((()=>{const e=function(){const{t:e}=(0,l.$)(),o=new A.l,i=new F.w,a=new r.D5({itemType:h.Ab.Video}),t=(0,L.G)({watch:()=>d.isAllUploaded}),d=(0,g.fv)((()=>({videoList:[],formApi:null,isPublishing:!1,pubServ:new b.Z,sendLogServ:a,scrollAreaRef:(0,s.createRef)(),authorSignService:new S.I({signScene:B.d.BusinessArtist}),authFileUploadServiceManager:new x.r({}),performanceTimingCollector:(0,Z.uY)(),mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return"uploadArea"===d.mainFormLayoutAfterLoading&&y.appModel.isInitFailed?"error":d.mainFormLayoutAfterLoading},get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1}},get importMinMaxCount(){const e=d.videoList.length;return{minCount:1,maxCount:Math.max(0,50-e),maxTotalCount:50}},get needConfirmModalOnClose(){return d.videoList.length>0},selectedId:"",get selectedVideo(){return d.selectedId?d.getVideo(d.selectedId):null},getVideo:e=>{var o;return null!==(o=d.videoList.find((o=>{var i;return(null===(i=o.payload)||void 0===i?void 0:i.localId)===e})))&&void 0!==o?o:null},getVideoIndex:e=>d.videoList.findIndex((o=>{var i;return(null===(i=o.payload)||void 0===i?void 0:i.localId)===e})),selectMaterial(e){d.selectedId=e,d.selectedVideo&&(d.selectedVideo.payload.hasEverSelected=!0)},updateFormState(e,o){Object.assign(e,o)},setIsPublishing:(0,_.aD)((e=>d.isPublishing=e)),setFormApi:(0,_.aD)((e=>d.formApi=e)),applyForTags:({tags:e})=>{d.videoList.forEach((o=>{o.common_data.tags=e}))},applyAuthSettingsToAll:({isOriginal:e,isBusiness:o,isVip:i})=>{d.videoList.forEach((a=>{a.is_vip=Boolean(i),a.common_data.is_original=Boolean(e),a.common_data.is_business=Boolean(o)}))},dragInsert(e,o){const i=d.videoList.splice(e,1),a=e>o?o+1:o;d.videoList.splice(a,0,...i)},addVideos(e){0!==e.length&&(d.videoList=[...d.videoList,...e],d.selectMaterial(e[0].payload.localId),"uploadArea"===d.mainFormLayoutAfterLoading&&(d.mainFormLayoutAfterLoading="mainForm"))},async removeVideo(e){await P.cancelVideoUpload({id:e.payload.localId}),d.videoList=d.videoList.filter((o=>o.payload.localId!==e.payload.localId))},getUploadParams:async(e,o)=>(await i.refreshUploadConfigsIfNeeded({when:o,logPrefix:"[VideoStore]"}),{...await i.getUploadConfigs("openVideoPicker"),accept:"mp4-mov-avi",thumbnailSize:236,maxFileSize:1073741824,maxFileDuration:60,...e}),async handleVideoFileProcessResult(e){var o;const i=d.getVideo(e.id);if(i)if("Success"===e.result)switch(e.type){case"Thumbnail":i.payload.coverBase64=`data:;base64,${e.base64}`;break;case"VideoInitCover":i.payload.coverUri=e.coverUri;break;case"VideoFile":const{videoId:a,fileUri:l}=e;i.video.video_id=a,i.common_data.file={file_md5:"",size:null===(o=i.common_data.file)||void 0===o?void 0:o.size,file_uri:l};break;case"VideoCover":const{temporaryId:t,coverUri:r}=e;i.payload.temporaryRecord[e.type]===t&&(i.common_data.icon.image_uri=r);break;default:return}else"Error"===e.result&&(i.payload.isUploadFailed=!0,i.payload.uploadFailedText=e.error||"")},initVideos({videos:e}){if(!e.length)return[];const o=[];for(const i of e){const e=N(i);o.push(e)}return o},async openVideoPicker(){o.lock(m,(async()=>{try{a.sendPageActionLog({action:"mainForm"===d.mainFormLayout?"upload_more":"upload"});const e=await d.getUploadParams({...d.importMinMaxCount,multiple:!0},"openVideoPicker"),o=await P.openVideoFilePicker(e),i=d.initVideos(o);d.addVideos(i)}catch(e){(0,C.RF)("openVideoFilePicker jsb failed ",e,{action:"openVideoPicker"})}}))},async droppedVideoFiles(){o.lock(m,(async()=>{try{a.sendPageActionLog({action:"mainForm"===d.mainFormLayout?"upload_more":"upload"});const e=await d.getUploadParams({...d.importMinMaxCount,multiple:!0},"droppedVideoFiles"),o=await P.uploadDroppedVideoFiles(e),i=d.initVideos(o);d.addVideos(i)}catch(e){(0,C.RF)("uploadDroppedVideoFiles jsb failed ",e,{action:"droppedVideoFiles"})}}))},async reimport(e){o.lock(m,(async()=>{var o;await P.cancelVideoUpload({id:e.payload.localId});const i=await d.getUploadParams({minCount:1,maxCount:1,maxTotalCount:1,multiple:!1},"reimport"),a=await P.openVideoFilePicker(i),l=N(a.videos[0]),t=d.getVideoIndex(e.payload.localId);-1!==t&&(d.videoList[t]=l,d.selectMaterial(null===(o=l.payload)||void 0===o?void 0:o.localId))}))},async openCoverEdit(e){try{const o=d.getVideo(e);if(!o)return;await i.refreshUploadConfigsIfNeeded({when:"openCoverEdit",logPrefix:"[VideoStore]"});const a=await i.getUploadConfigs("openCoverEdit"),l=(0,V.V)("video"),t=await P.openVideoCoverEdit({id:e,temporaryId:l,...a});t.coverBase64&&d.updateFormState(o,{common_data:{...o.common_data,icon:{image_uri:""}},payload:{...null==o?void 0:o.payload,coverBase64:`data:;base64,${t.coverBase64}`,hasVideoFrameSelect:!0,temporaryRecord:{VideoCover:l}}})}catch(o){(0,C.RF)("openVideoCoverEdit jsb failed ",o,{action:"openCoverEdit"})}},isAllUploadedWatcher:t,async retryUpload(){const e=d.videoList.filter((e=>e.payload.isUploadFailed)).map((e=>e.payload.localId));if(!e.length)return;e.forEach((e=>{const o=d.getVideo(e);o&&(o.payload.isUploadFailed=!1)}));const o=await d.getUploadParams({multiple:!0,minCount:1,maxCount:e.length,maxTotalCount:e.length,retryUploadIds:e},"retryUpload");await P.openVideoFilePicker(o)},sendUploadProgressModalShowErrorLog(){const e=d.videoList.filter((e=>e.payload.isUploadFailed)).map((e=>({error_report:e.payload.uploadFailedText})));a.sendMaterialPublishErrorLog(e)},get uploadStats(){let e=0,o=0,i=0;return M(d.videoList).forEach((a=>{var l;a.payload.isUploadFailed?o+=1:(null===(l=a.common_data.file)||void 0===l?void 0:l.file_uri)&&a.video.video_id&&a.common_data.icon.image_uri?e+=1:i+=1})),{pending:i,succeeded:e,failed:o}},get isAllReadyPublish(){const e=d.videoList.every((e=>{var o,i;return e.common_data.title&&(null===(o=e.common_data.tags)||void 0===o?void 0:o.length)&&!(null!==(i=e.payload.unmetRequirements)&&void 0!==i&&i.length)}));return d.videoList.length>0&&e},get isAllUploaded(){const{pending:e,failed:o}=d.uploadStats;return!e&&!o},syncFormData(e){var o;const i=null===(o=d.formApi)||void 0===o?void 0:o.getValues();i&&d.updateFormState(e,{is_vip:i.is_vip||!1,common_data:{...e.common_data,title:i.common_data.title||"",tags:i.common_data.tags||[],is_original:i.common_data.is_original||!1,is_business:i.common_data.is_business||!1}})},async uploadAndPublish(e){a.sendPageActionLog({action:"publish"}),d.selectedVideo&&d.syncFormData(d.selectedVideo),d.isAllUploaded||(await d.retryUpload(),null==e||e.show(),await d.isAllUploadedWatcher.start());try{await d.publishImpl()}finally{null==e||e.hide()}},async publishImpl(){try{d.setIsPublishing(!0);const o=M(d.videoList).map((e=>{const o=(0,I.pn)({isVip:e.is_vip,isBusiness:e.common_data.is_business,authFiles:d.authFileUploadServiceManager.getUploadedFiles(e.payload.localId)});return{id:e.payload.localId,req:{...(0,v.Z)(e,["payload"]),...o.root,common_data:{...e.common_data,...o.commonData}},onResult:o=>{const{req:i,error:l,errorText:t,time:r,resourceId:s}=o;l||d.updateFormState(e,{payload:{...e.payload,itemId:s}}),a.sendMaterialPublishStatusLog({status:l?"fail":"success",time:r,error_type:t,publishParams:i,path:e.payload.path})}}}));(0,C.c6)("[VideoStore] videos publish start",{ids:o.map((e=>e.id))});const i=(await d.pubServ.batchPublish(o)).map((e=>e.resource_id));(0,C.c6)("[VideoStore] videos publish done",{resourceIdList:i}),await d.pubServ.pollUntilAllInEffectList({ids:i.slice(-b.f),types:[5]}),(0,C.c6)("[VideoStore] poll done"),f.FN.success(e("pc_filter_release_successful")),(0,T.ZM)({effect_type:h.Ab.Video}),setTimeout((()=>(0,T.Nt)({item_type:h.Ab.Video})),1e3)}catch(o){f.FN.error(e("pc_sticker_release_failed_retry_web")),(0,C.RF)("[VideoStore] publish fail",o)}finally{d.setIsPublishing(!1)}}})));return(0,z.u)({watch:()=>d.needConfirmModalOnClose}),(0,s.useEffect)((()=>{window.store=d,i.uploadConfigsCache.update(),d.authorSignService.init(),d.performanceTimingCollector.addRenderTiming(Z.Pk)}),[]),(0,s.useEffect)((()=>{const e=P.registerVideoFileProcessResultEvent(d.handleVideoFileProcessResult);return()=>{e()}}),[]),d}(),{t:o}=(0,l.$)();return(0,t.F)({title:o("pc_filter_video_release"),pid:"video-publish-single"}),(0,Ue.d)(),(0,r.t9)(e.sendLogServ),(0,J.jsx)(D.Provider,{value:e,children:(0,J.jsxs)("div",{className:je,children:[(0,J.jsxs)("div",{className:Me,children:[(0,J.jsx)(O,{className:Ne}),(0,J.jsx)(Ee,{className:Te})]}),(0,J.jsx)(Q,{className:Be})]})})})),Ze=()=>(0,J.jsx)(ze,{})},74235:(e,o,i)=>{i.d(o,{YB:()=>t,xB:()=>l});var a=i(86439);function l(e){const{len:o,i18n:i}=e,[a]=(i.language||"").split("-");return"zh"===a?Math.floor(o/2):o}function t(e,o){const i=e.split(/[\\/]/g).pop().replace(/\.\w+?$/g,"");return(0,a.aF)(i,null==o?void 0:o.maxLength)}}}]);