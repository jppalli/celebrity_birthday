"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[464],{84997:(e,t,a)=>{a.d(t,{S:()=>g,w:()=>h});var l=a(50959),i=a(44478),o=a(26800),r=a(84875),n=a.n(r),s=a(84736),c=a(45599),d=a(20468),u=a(2555),m=a(76896),p=a(45584),f=a(11527);const _=(0,l.forwardRef)(((e,t)=>{const{tooltipProps:a,getPopupContainer:i,onClosePopover:r,position:c,cursor:d="default"}=e,[_,h]=(0,l.useState)(!0),[g,v]=(0,l.useState)(!1),{top:y}=c,b=c.left-10,C=(0,l.useRef)(null),L=(0,l.useRef)(null),w=(0,o.Z)((()=>{var e;null===(e=L.current)||void 0===e||e.destroy(),v(!1),h(!1)})),x=(0,o.Z)((()=>{var e;const t=i().querySelector(`.${p.Z.tooltipWrapper}`);if(!t||(null===(e=L.current)||void 0===e?void 0:e.tooltipWrapper)===t)return;t.addEventListener("animationend",w);const a=new u.B;a.timeout(500).then(w),L.current={tooltipWrapper:t,destroy:()=>{t.removeEventListener("animationend",w),a.cancel(),L.current=null}}}));(0,l.useImperativeHandle)(t,(()=>({hide:()=>{x(),v(!0)}})));const I=(0,l.useMemo)((()=>({default:{height:18,width:12},"not-allowed":{height:(0,m.c)()?30:15,width:15}})),[]),S=I[d]||I.default;return(0,f.jsx)(s.u,{autoAdjustOverflow:!0,position:"bottomLeft",motion:!1,...a,className:n()(a.className,p.Z.tooltipWrapper,g&&p.Z.fadingOut),trigger:"custom",visible:_,showArrow:!1,rePosKey:`${y}-${b}`,getPopupContainer:i,onVisibleChange:e=>{var t;!e&&r(),null===(t=a.onVisibleChange)||void 0===t||t.call(a,e)},children:(0,f.jsx)("div",{className:p.Z.point,tabIndex:-1,ref:C,style:{top:y,left:b,...S}})})}));function h(e){const{zIndex:t=1060,cursor:a="default",checkIsTarget:r,getEllipsisDOM:n,...s}=e,u=(0,l.useRef)(null),m=(0,l.useRef)(null),[h,g]=(0,l.useState)(null),{i18n:v}=(0,c.$)(),y=()=>{const{content:e}=s;if("function"!=typeof e)return e;if(!u.current)return null;const{targetElement:t}=u.current;return a=>e({...a,target:t})},b=(0,o.Z)((()=>{u.current&&(u.current.destroy(),u.current=null,g(null))})),C=(0,o.Z)((()=>{var e;null===(e=u.current)||void 0===e||e.destroy(),u.current=null})),L=(0,o.Z)((()=>{u.current&&(u.current.destroy(),u.current=null,g(null))})),w=(0,o.Z)(((e,a)=>{const l=null==n?void 0:n(a);if(l&&l.offsetWidth>=l.scrollWidth)return;if(u.current){if(!u.current.hasLeaved&&u.current.targetElement===a)return;b()}const o=document.createElement("div");o.className=p.Z.root,o.style.zIndex=`${t}`;const r=e=>{g({left:e.clientX,top:e.clientY})},s=e=>{a===e.target&&(u.current&&(u.current.hasLeaved=!0),m.current?m.current.hide():b())};a.addEventListener("mousemove",r),a.addEventListener("mouseleave",s),document.body.appendChild(o);const c=(0,i.createRoot)(o);u.current={container:o,targetElement:a,hasLeaved:!1,reactRoot:c,destroy:()=>{o.remove(),Promise.resolve().then((()=>c.unmount())),a.removeEventListener("mousemove",r),a.removeEventListener("mouseleave",s)}},g({left:e.clientX,top:e.clientY})})),x=(0,o.Z)((e=>{const t=e.currentTarget;w(e,t)})),I=(0,o.Z)((e=>{var t;const a=e.target;(null!==(t=null==r?void 0:r(a))&&void 0!==t?t:e.currentTarget===a)&&w(e,a)}));return(0,l.useLayoutEffect)((()=>C),[]),(0,l.useLayoutEffect)((()=>{(()=>{if(!u.current||!h)return;const{reactRoot:e,container:l}=u.current;l.style.zIndex=`${t}`,e.render((0,f.jsx)(d.a,{i18n:v,children:(0,f.jsx)(_,{ref:m,tooltipProps:{...s,content:y()},getPopupContainer:()=>l,onClosePopover:b,position:h,cursor:a})}))})()})),{handleMouseEnter:x,handleMouseOver:I,destroyTooltip:L}}function g(e={}){const{getEllipsisDOM:t=(e=>e),content:a=(({target:e})=>e.textContent),...l}=e;return h({...l,getEllipsisDOM:t,content:a})}},42983:(e,t,a)=>{a.d(t,{Ab:()=>l});let l=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.VideoAnimation=13]="VideoAnimation",e[e.Transition=19]="Transition",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e[e.LocalEffects=-1]="LocalEffects",e}({})},90334:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Ht});var l=a(23479),i=a(45599),o=a(64979),r=a(12904),n=a(9608);let s=function(e){return e.Format="format",e.MaxFileSize="maxFileSize",e}({}),c=function(e){return e.ZIP="zip",e}({}),d=function(e){return e.File="file",e}({});var u=a(50959),m=a(97311),p=a(73224);const f=15,_=10485760,h={[d.File]:{[s.Format]:p.I18n.t("cc_pc_material_visual_effect_publish_guidance_format_web"),[s.MaxFileSize]:p.I18n.t("cc_pc_material_visual_effect_publish_guidance_size_web",{size:10})}},g={accept:"zip",multiple:!0,maxFileSize:_},v="ImportEffects",y=200,b=200;const C=(e,t)=>{const a=[];t>_&&a.push(s.MaxFileSize);let l="";try{l=function(e){const t=(0,m.lm)(e);if("zip"===t)return c.ZIP;throw new Error(`Unsupported suffix ${t}`)}(e)}catch(i){a.push(s.Format)}return{unmetRequirements:a,fileType:l}};var L=a(93639),w=a(52918),x=a(66589),I=a(84736),S=a(54847),A=a(2555);const E=1e4;var Z=a(50366),k=a(60251),P=a(42983),F=a(31086),T=a(8129),M=a(57609),j=a(93340),U=a(67078),N=a(75028),R=a(46309),O=a(98052);let z=function(e){return e.Thumbnail="Thumbnail",e.UploadCover="UploadCover",e.UploadEffect="UploadEffect",e}({});var B=a(3718),D=a(51654),V=a(18370),W=a(94435),q=a(23073),$=a(1946);const J=new class{async openEffectFilePicker(e){const t={...e,temporaryId:(0,$.V)("single")};(0,T.c6)("[JSB] openEffectFilePicker req --\x3e",{...(0,L.Z)(t,[])});const a=await(e=>O.Jn.call("openEffectFilePicker",e))(t);return(0,T.c6)("[JSB] openEffectFilePicker resp <--",a.effects),a}async uploadDroppedEffectFiles(e){var t;const a={...e,temporaryId:(0,$.V)("single")};(0,T.c6)("[JSB] uploadDroppedEffectFiles req --\x3e",{...(0,L.Z)(a,[])});const l=await(e=>O.Jn.call("uploadDroppedEffectFiles",e))(a);return(0,T.c6)("[JSB] uploadDroppedEffectFiles resp <--",{imagesCount:null==l||null===(t=l.effects)||void 0===t?void 0:t.length}),l}async setEffectCoverImage(e){(0,T.c6)("[JSB] setEffectCoverImage req --\x3e",e);const t=await(e=>O.Jn.call("setEffectCoverImage",e))(e);return(0,T.c6)("[JSB] setEffectCoverImage resp <--",{}),t}async uploadEffectCoverImage(e){(0,T.c6)("[JSB] uploadEffectCoverImage req --\x3e",e);const t=await(e=>O.Jn.call("uploadEffectCoverImage",e))(e);return(0,T.c6)("[JSB] uploadEffectCoverImage resp <--",{}),t}registerEffectFileProcessResultEvent(e){return(e=>{const t=t=>{t.data&&e(t.data)};return O.Jn.on("effectProcessResult",t),()=>O.Jn.off("effectProcessResult",t)})((t=>{(0,T.c6)(`[JSB] EffectFileProcessResult ${null==t?void 0:t.type} {${null==t?void 0:t.id}}`,{...(0,q.Z)(t,["result","uri","error","fileUri","temporaryId","id","collectionId"])}),e(t)}))}async cancelEffectUpload(e){(0,T.c6)("[JSB] cancelEffectUpload req --\x3e",e),await(e=>O.Jn.call("cancelEffectUpload",e))(e),(0,T.c6)("[JSB] cancelEffectUpload resp <--")}};var H=a(25807),Y=a(74235),G=a(59787);class X{constructor(e){(0,G.Z)(this,"_effectType",void 0),(0,G.Z)(this,"_isInitialized",!1),(0,G.Z)(this,"authConfig",{mustPaidAuth:!1,mustCommerceAuth:!1}),(0,G.Z)(this,"resourceCommonConfig",{maxTitleLen:0}),this._effectType=e,this.init()}async init(){{const e=await(0,W.A1)({effect_type:this._effectType});this.authConfig={mustPaidAuth:e.auth_config.must_paid_auth,mustCommerceAuth:e.auth_config.must_commerce_auth}}this._isInitialized=!0}}function Q(e){switch(e){case P.Ab.Special:return"special_effect";case P.Ab.Transition:return"transition";case P.Ab.VideoAnimation:return"video_animation";case P.Ab.FaceSpecial:return"face_effect";default:return"effect"}}class K extends o.D5{sendUploadActionLog(e){const{mainFormLayout:t}=e,a="mainForm"===t?"upload_more":"effect_upload";this.sendPageActionLog({action:a})}sendMaterialPublishLog({publishResult:e,effect:t,logPrefix:a}){this.sendMaterialPublishStatusLog({...e,publishParams:t,status:e.error?"fail":"success",path:t.payload.path,error_type:e.errorText},{material_size:t.payload.size,is_official_task:t.common_data.post_channel===W.iu.Open?0:1,task_id:t.payload.targetedActivityId,material_id:e.resourceId,material_subcategory:Q(t.effect_type),effect_type_id:t.payload.categoryId,effect_type_title:t.payload.categoryName}),e.error?(0,T.RF)(`${a} effects publish failed`,e.error,{id:t.payload.localId}):(0,T.c6)(`${a} effects publish success`,{id:t.payload.localId,resourceId:e.resourceId})}}function ee(){const e=function(){const e=(0,w.fv)((()=>({uploadConfigService:new Z.w,materialList:[],scrollAreaRef:(0,u.createRef)(),effectsPostConfigMap:{[P.Ab.Special]:new X(P.Ab.Special),[P.Ab.FaceSpecial]:new X(P.Ab.FaceSpecial),[P.Ab.VideoAnimation]:new X(P.Ab.VideoAnimation),[P.Ab.Transition]:new X(P.Ab.Transition)},get hasMaterials(){return this.materialList.length>0},selectedId:null,get selectedMaterial(){return e.selectedId?e.getMaterial(e.selectedId):null},get isAllReady(){return e.materialList.length>0},addMaterials(t){t.length&&(e.materialList=[...e.materialList,...t],e.materialList.length===t.length&&(e.selectedId=t[0].payload.localId))},getMaterial:t=>{var a;return null!==(a=e.materialList.find((e=>{var a;return(null===(a=e.payload)||void 0===a?void 0:a.localId)===t})))&&void 0!==a?a:null},selectMaterial(t){e.selectedId=t,e.selectedMaterial&&(e.selectedMaterial.payload.hasEverSelected=!0)},updateThumbnailSrc(e,t){e.payload.thumbImg=t},updateUnmetRequirements(e,t){e.payload.unmetRequirements=t,e.payload.hasCheckedRequirements=!0},makeInitForm:({payload:e,title:t,format:a,is_vip:l,effect_type:i,md5:o})=>{var r;return{effect_type:i,common_data:{title:t,description:"",tags:[],source:W.r0.UserPostPc,is_original:!1,is_business:!1,web_extra:"",icon:{image_uri:"",width:y,height:b},format:a,file:{size:null!==(r=e.size)&&void 0!==r?r:0,file_uri:"",file_md5:o},md5:o},is_vip:l,payload:{hasEverSelected:!1,itemId:void 0,unmetRequirements:[],hasCheckedRequirements:!1,localId:"",thumbImg:"",size:0,path:"",error:"",temporary:{UploadCover:"",Thumbnail:"",UploadEffect:""},coverUpdating:!1,coverImgUrls:{fadeInUrl:""},duration:0,...e}}},updateFormState(e,t){Object.assign(e,t)},updateUploadResp(e,{fileUri:t,imgUri:a}){t&&e.common_data.file&&(e.common_data.file.file_uri=t),a&&(e.common_data.icon.image_uri=a)},reimportMaterial(t,a){const l=e.materialList.findIndex((e=>e.payload.localId===t));-1!==l&&(e.materialList[l]=a)},removeMaterial(t){e.materialList=e.materialList.filter((e=>e.payload.localId!==t.payload.localId)),J.cancelEffectUpload({id:t.payload.localId})},applyAuthSettingsToAll:({isOriginal:t,isBusiness:a,isVip:l})=>{e.materialList.forEach((e=>{e.is_vip=Boolean(l),e.common_data.is_original=Boolean(t),e.common_data.is_business=Boolean(a)}))},applyCommonDataToAll:t=>{e.materialList.forEach((e=>{e.common_data={...e.common_data,...t}}))},applyPayloadDataToAll:t=>{e.materialList.forEach((e=>{e.payload={...e.payload,...t}}))},dragInsert(t,a){const l=e.materialList.splice(t,1),i=t>a?a+1:a;e.materialList.splice(i,0,...l)},get isReadyToPublish(){return e.materialList.every((e=>{var t;return 0===(null===(t=e.payload.unmetRequirements)||void 0===t?void 0:t.length)&&this.getIsInfoComplete(e)}))},get uploadStats(){let t=0,a=0,l=0;return e.materialList.forEach((e=>{var i,o;"UploadFailed"!==e.payload.failedType?(null===(i=e.common_data.icon)||void 0===i?void 0:i.image_uri)&&(null===(o=e.common_data.file)||void 0===o?void 0:o.file_uri)?t+=1:l+=1:a+=1})),{pending:l,succeeded:t,failed:a}},getIsInfoComplete(e){const{title:t,tags:a,post_channel:l}=e.common_data,{categoryId:i,targetedActivityId:o}=e.payload,r=this.effectsPostConfigMap[e.effect_type],{mustPaidAuth:n}=r.authConfig;{const r=l===W.iu.Open||l===W.iu.Targeted&&Boolean(o),s=n&&e.is_vip||!n;return Boolean(t&&(null==a?void 0:a.length)&&e.payload.thumbImg&&i&&r&&s)}},collectLogData:()=>e.materialList.map((e=>{const t=(0,L.Z)(e.payload,"thumbImg");return{...e,payload:t}})),handleFilePickerResp(t){const a=H.$.isEnableAuthorization;return t.effects.map((t=>{const l=C(t.path,t.size),i=(0,Y.YB)(t.path,{maxLength:this.effectsPostConfigMap[t.effect_type].resourceCommonConfig.maxTitleLen||f}),o={EffectFile:t.temporaryId,EffectImg:t.temporaryId,Thumbnail:t.temporaryId};return e.makeInitForm({effect_type:t.effect_type,payload:{localId:t.id,duration:Math.round(1e3*t.duration),...(0,q.Z)(t,["size","path","error"]),...l,temporary:o,failedType:"importFailed"},title:i,format:l.fileType,is_vip:a,md5:t.md5})}))},async refreshUploadConfigsIfNeeded(t){await e.uploadConfigService.refreshUploadConfigsIfNeeded({when:t,logPrefix:"[EffectStore]"})},async openEffectPicker({maxTotalCount:t,maxCount:a,minCount:l}){await e.refreshUploadConfigsIfNeeded("openEffectFilePicker");const i=await J.openEffectFilePicker({...await e.uploadConfigService.getUploadConfigs("openEffectPicker"),...g,minCount:l,maxCount:a,maxTotalCount:t}),o=e.handleFilePickerResp(i);e.addMaterials(o)},async reimportEffectFilePicker({maxTotalCount:t,maxCount:a,minCount:l,oldId:i}){await e.refreshUploadConfigsIfNeeded("openEffectFilePicker");const o=await J.openEffectFilePicker({...await e.uploadConfigService.getUploadConfigs("openEffectPicker"),...g,minCount:l,maxCount:a,maxTotalCount:t,multiple:!1}),r=e.handleFilePickerResp(o);r[0]&&(e.reimportMaterial(i,r[0]),J.cancelEffectUpload({id:i}))},async uploadDroppedEffectFiles({maxTotalCount:t,maxCount:a,minCount:l}){await e.refreshUploadConfigsIfNeeded("uploadDroppedEffectFiles");const i=await J.uploadDroppedEffectFiles({...await e.uploadConfigService.getUploadConfigs("uploadDroppedEffectFiles"),...g,minCount:l,maxCount:a,maxTotalCount:t}),o=e.handleFilePickerResp(i);e.addMaterials(o)},async setEffectCoverImage(t){const a=e.getMaterial(t.payload.localId);if(!a)return;const l=(0,$.V)("single");return a.payload.coverUpdating=!0,a.payload.temporary.Thumbnail=l,"updateCoverFailed"===a.payload.failedType&&(a.payload.failedType=void 0),J.setEffectCoverImage({id:t.payload.localId,fadeInUrl:t.payload.coverImgUrls.fadeInUrl,fadeOutUrl:t.payload.coverImgUrls.fadeOutUrl,imageWidth:y,imageHeight:b,temporaryId:l})},async retryUpdateCover(e){return e.payload.failedType=void 0,this.setEffectCoverImage(e)},async retryUpload(t){if(!t.length)return;const a=t.map((e=>e.payload.localId));return a.forEach((t=>{const a=e.getMaterial(t);a&&(a.payload.failedType=void 0)})),J.openEffectFilePicker({...await e.uploadConfigService.getUploadConfigs("openEffectPicker"),...g,minCount:1,maxCount:t.length,maxTotalCount:t.length,retryUploadIds:a})}})));return e}(),t=function(e){const t=(0,w.fv)((()=>({isImportLoading:!1,hideImportLoadingTimer:new A.B,notifyImportLoadingFinish:null,showImportLoading:async()=>{t.isImportLoading=!0,await Promise.race([new Promise((e=>t.notifyImportLoadingFinish=e)),t.hideImportLoadingTimer.timeout(E)]),(0,x.z)((()=>{t.isImportLoading=!1}))},finishImportLoadingFinishIfNeeded:()=>{t.isImportLoading&&t.notifyImportLoadingFinish&&(t.notifyImportLoadingFinish(),t.notifyImportLoadingFinish=null)},destroy:()=>{t.hideImportLoadingTimer.cancel()}})));return(0,u.useEffect)((()=>{const a=(0,x.EH)((()=>{e.isAllReady&&t.finishImportLoadingFinishIfNeeded()}));return()=>{a()}}),[]),t}(e),a=new k.l,l=new K({itemType:P.Ab.LocalEffects}),i=(0,N.G)({watch:()=>o.isAllUploaded}),o=(0,w.fv)((()=>({uploadConfigService:new Z.w,formApi:null,setFormApi:e=>{o.formApi=e},isPublishing:!1,sendLogServ:l,authorSignService:new M.I({signScene:B.d.BusinessArtist}),authFileUploadServiceManager:new j.r({}),performanceTimingCollector:(0,V.uY)(),setIsPublishing:(0,x.aD)((e=>o.isPublishing=e)),mainFormLayoutAfterLoading:"uploadArea",startPublishTime:0,get mainFormLayout(){return t.isImportLoading?"loading":"uploadArea"===o.mainFormLayoutAfterLoading&&S.appModel.isInitFailed?"error":0===o.materialListStore.materialList.length?"uploadArea":o.mainFormLayoutAfterLoading},pubServ:new F.Z,get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1}},get maxTotalCount(){return 10},get isImportDisabled(){return e.materialList.length>=10},get needConfirmModalOnClose(){return e.materialList.length>0},materialListStore:e,importLoadingStore:t,getImportMinMaxCount(){const t=e.materialList.length;return{minCount:1,maxCount:Math.max(0,o.maxTotalCount-t),maxTotalCount:o.maxTotalCount}},get isAllReadyPublish(){return e.materialList.length&&e.isReadyToPublish},handleLoading(){o.materialListStore.materialList.length&&"uploadArea"===o.mainFormLayoutAfterLoading&&(t.showImportLoading(),o.mainFormLayoutAfterLoading="mainForm")},openEffectPicker(){a.lock(v,(async()=>{l.sendUploadActionLog(o),await e.openEffectPicker({...o.getImportMinMaxCount()}),o.handleLoading()}))},uploadDroppedEffectFiles(){a.lock(v,(async()=>{l.sendUploadActionLog(o),await e.uploadDroppedEffectFiles({...o.getImportMinMaxCount()}),o.handleLoading()}))},reimport(t){a.lock(v,(async()=>{await e.reimportEffectFilePicker({...o.getImportMinMaxCount(),oldId:t.payload.localId}),o.handleLoading()}))},get isAllUploaded(){const{pending:e,failed:t}=o.materialListStore.uploadStats;return!e&&!t},sendUploadProgressModalShowErrorLog(){const e=o.materialListStore.materialList.filter((e=>"UploadFailed"===e.payload.failedType)).map((e=>({error_report:e.payload.error})));l.sendMaterialPublishErrorLog(e)},async retryUpload(){const e=o.materialListStore.materialList.filter((e=>"UploadFailed"===e.payload.failedType));return o.materialListStore.retryUpload(e)},isAllUploadedWatcher:i,asyncFormData(){var t;const a=null===(t=o.formApi)||void 0===t?void 0:t.getValues(),l=o.materialListStore.selectedMaterial;l&&a&&e.updateFormState(l,{is_vip:a.is_vip||!1,common_data:{...l.common_data,title:a.common_data.title||"",description:a.common_data.description,post_channel:a.common_data.post_channel,tags:a.common_data.tags||[],is_original:a.common_data.is_original||!1,is_business:a.common_data.is_business||!1}})},async uploadAndPublish(t){this.startPublishTime=performance.now(),o.asyncFormData(),l.sendPageActionLog({action:"publish",material_cnt:e.materialList.length}),o.isAllUploaded||(await o.retryUpload(),await J.uploadEffectCoverImage({ids:e.materialList.map((e=>e.payload.localId))}),null==t||t.show(),await o.isAllUploadedWatcher.start());try{await o.publishImpl()}finally{null==t||t.hide()}},async publishImpl(){try{o.setIsPublishing(!0);const t=e.materialList.map((e=>{const t=(0,U.pn)({isVip:e.is_vip,isBusiness:e.common_data.is_business,authFiles:o.authFileUploadServiceManager.getUploadedFiles(e.payload.localId)}),{categoryId:a,targetedActivityId:i,duration:r}=e.payload,{post_channel:n}=e.common_data;return{id:e.payload.localId,req:{...(0,L.Z)(e,["payload"]),...t.root,common_data:{...e.common_data,...t.commonData,post_channel:n===W.iu.Targeted?`${W.iu.Targeted}_${i}`:n,web_extra:JSON.stringify({choose_category_id:[a],targeted_id:i})},biz_extra:JSON.stringify({effect_duration:r})},onResult:a=>{l.sendMaterialPublishLog({publishResult:a,effect:{...e,...t.root},logPrefix:"[SingleStore]"})}}}));(0,T.c6)("[SingleStore] effects publish start",{ids:t.map((e=>e.id))});const a=(await o.pubServ.batchPublish(t)).map((e=>e.resource_id));(0,T.c6)("[SingleStore] effects publish done",{resourceIdList:a}),this.sendLogServ.sendMaterialPublishPageResultLog({status:"success",time:Math.round(performance.now()-this.startPublishTime),material_cnt:a.length,material_id:a.join(",")}),await o.pubServ.pollUntilAllInEffectList({ids:a.slice(-F.f),types:[P.Ab.Special,P.Ab.FaceSpecial,P.Ab.VideoAnimation,P.Ab.Transition]}),(0,T.c6)("[SingleStore] effects poll done"),I.FN.success(p.I18n.t("pc_filter_release_successful")),(0,R.ZM)({effect_type:P.Ab.Special}),setTimeout((()=>(0,R.Nt)({item_type:P.Ab.Special})),1e3)}catch(a){var t;this.sendLogServ.sendMaterialPublishPageResultLog({status:"fail",error_type:null!==(t=null==a?void 0:a.message)&&void 0!==t?t:`publish error: ${JSON.stringify(a)}`,time:Math.round(performance.now()-this.startPublishTime),material_cnt:e.materialList.length,material_id:""}),I.FN.error(p.I18n.t("pc_sticker_release_failed_retry_web")),(0,T.RF)("Effects [SingleStore] publish fail",a)}finally{o.setIsPublishing(!1)}},handleEffectFileProcessResult(t){const a=e.getMaterial(t.id);if(a){if(t.type===z.Thumbnail){if(!(t.temporaryId===a.payload.temporary[z.Thumbnail]))return}if("Success"===t.result)switch(t.type){case z.Thumbnail:const{base64:l}=t;e.updateFormState(a,{payload:{...a.payload,thumbImg:`data:;base64,${l}`}});break;case z.UploadEffect:e.updateUploadResp(a,{fileUri:t.uri});break;case z.UploadCover:e.updateUploadResp(a,{imgUri:t.uri});break;default:return}else switch(t.type){case z.Thumbnail:e.updateFormState(a,{payload:{...a.payload,failedType:"updateCoverFailed"}});break;case z.UploadEffect:case z.UploadCover:e.updateFormState(a,{payload:{...a.payload,failedType:"UploadFailed"}});break;default:return}t.type===z.Thumbnail&&e.updateFormState(a,{payload:{...a.payload,coverUpdating:!1}})}}})));return(0,D.u)({watch:()=>o.needConfirmModalOnClose}),(0,u.useEffect)((()=>{window.store=o,window.toJS=x.ZN;const e=J.registerEffectFileProcessResultEvent(o.handleEffectFileProcessResult);return o.authorSignService.init(),o.performanceTimingCollector.addRenderTiming(V.Pk),()=>{e(),t.destroy()}}),[]),o}const te=(0,u.createContext)(null),ae=()=>(0,u.useContext)(te);var le=a(11527);const ie=(0,l.Pi)((({className:e})=>{var t,a;const l=function(){const{t:e}=(0,i.$)(),t={link:{text:e("cc_pc_material_visual_effect_publish_guidance_linked_web"),src:"https://bytedance.sg.larkoffice.com/docx/LfCWds6fLoPI3PxTpxJl9iA4gsT?open_in_browser=true"}};return(0,u.useMemo)((()=>{return[{key:d.File,title:e("cc_pc_material_visual_effect_publish_guidance_web"),...t,instructions:(a=d.File,Object.entries(h[a]).map((([e,t])=>({key:e,title:t}))))}];var a}),[])}(),o=ae(),r=o.materialListStore.selectedMaterial;return(0,le.jsx)(n.v,{className:e,groups:l,initGroup:d.File,activeGroup:d.File,resetExpandedGroupKey:null!==(t=null==r||null===(a=r.payload)||void 0===a?void 0:a.localId)&&void 0!==t?t:null,getStatus:e=>{var t;return r?null!==(t=r.payload)&&void 0!==t&&null!==(t=t.unmetRequirements)&&void 0!==t&&t.includes(e.key)?"error":"success":"init"},onClickGroupLink:()=>{o.sendLogServ.sendPageActionLog({action:"click_doc_guide"})}})}));var oe=a(74502),re=a(36775);const ne=(0,l.Pi)((({className:e})=>{const t=ae(),{t:a}=(0,i.$)(),l=(0,u.useRef)(null),o=(0,u.useMemo)((()=>t.materialListStore.materialList.length),[t.materialListStore.materialList]),r=(0,u.useMemo)((()=>t.isAllReadyPublish),[t.isAllReadyPublish]);return(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(oe.Z,{className:e,leftText:a("pc_sticker_import_zero_to_hundred_web",{X:o,Y:t.maxTotalCount}),isPublishDisabled:!r,isPublishing:t.isPublishing,needConfirmModalOnClose:t.needConfirmModalOnClose,onPublish:()=>t.uploadAndPublish(l.current),onCancel:()=>{(0,R.Nt)(),t.sendLogServ.sendPageActionLog({action:"cancel"})}}),(0,le.jsx)(re.q,{ref:l,uploadStats:t.materialListStore.uploadStats,onRetryUpload:t.retryUpload,onCancel:()=>{t.isAllUploadedWatcher.stop(),t.sendLogServ.sendMaterialPublishPageResultLog({status:"cancel",time:Math.round(performance.now()-t.startPublishTime),material_cnt:t.materialListStore.materialList.length,material_id:""})},onShowUploadFail:t.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:t.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var se,ce,de,ue,me,pe=a(74083),fe=a(82725),_e=a(84875),he=a.n(_e),ge=a(74474);function ve(){return ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},ve.apply(this,arguments)}const ye=e=>u.createElement("svg",ve({xmlns:"http://www.w3.org/2000/svg",width:30,height:30,fill:"none",viewBox:"0 0 30 30"},e),se||(se=u.createElement("path",{stroke:"#CCC",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 23.5H7.5a1 1 0 0 1-1-1v-15a1 1 0 0 1 1-1h15a1 1 0 0 1 1 1V15"})),ce||(ce=u.createElement("path",{fill:"#CCC",fillRule:"evenodd",d:"M17.8 11.457a2 2 0 0 0 1.513-2.942 2 2 0 1 1-1.513 2.943Z",clipRule:"evenodd"})),de||(de=u.createElement("path",{fill:"#CCC",d:"M14.358 15.392a.764.764 0 0 1 .99-.991l1.381.508a.78.78 0 0 0 .742-.103l1.137-.858c.521-.393 1.29.01 1.287.675l-.004 1.452a.83.83 0 0 0 .355.678l1.212.85c.555.39.438 1.23-.195 1.409l-1.384.388a.75.75 0 0 0-.522.522l-.388 1.383c-.178.634-1.02.75-1.409.196l-.85-1.212a.83.83 0 0 0-.678-.355l-1.452.005c-.665.002-1.068-.767-.675-1.288l.858-1.137a.78.78 0 0 0 .103-.742l-.508-1.38Z"})),ue||(ue=u.createElement("rect",{width:2,height:4,x:20.186,y:21.643,fill:"#CCC",rx:1,transform:"rotate(-45 20.186 21.643)"})),me||(me=u.createElement("path",{stroke:"#CCC",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6.5 18.67 11 14l1.5 1"})));var be,Ce,Le,we,xe,Ie;function Se(){return Se=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},Se.apply(this,arguments)}const Ae=e=>u.createElement("svg",Se({xmlns:"http://www.w3.org/2000/svg",width:30,height:30,fill:"none",viewBox:"0 0 30 30"},e),be||(be=u.createElement("path",{stroke:"#fff",strokeOpacity:.8,strokeWidth:1.5,d:"M7.886 9.4a4.163 4.163 0 0 0-1.038 3.853l1.086 4.507a7.75 7.75 0 1 0 15.069-3.632l-1.087-4.507a4.163 4.163 0 0 0-2.679-2.957l-.394-.137A10.148 10.148 0 0 0 8.174 9.1l-.288.301Z"})),Ce||(Ce=u.createElement("mask",{id:"faceSpecial_svg__a",fill:"#fff"},u.createElement("path",{fillRule:"evenodd",d:"M11.067 14.184a.586.586 0 0 1-.195-.807l.49-.8a.235.235 0 0 0-.078-.323l-.8-.49a.586.586 0 0 1 .612-1l1.5.918c.277.169.364.53.195.806l-.918 1.501a.586.586 0 0 1-.806.194Z",clipRule:"evenodd"}),u.createElement("path",{d:"M15.994 9.483a.352.352 0 0 1 .616-.149l.408.5c.075.091.19.14.308.127l.641-.066a.352.352 0 0 1 .332.54l-.349.542a.352.352 0 0 0-.026.333l.261.59a.352.352 0 0 1-.411.482l-.623-.164a.352.352 0 0 0-.325.078l-.48.43a.352.352 0 0 1-.586-.242l-.036-.643a.352.352 0 0 0-.175-.285l-.557-.323a.352.352 0 0 1 .049-.633l.6-.233a.352.352 0 0 0 .217-.254l.136-.63Z"}),u.createElement("path",{fillRule:"evenodd",d:"M12.957 17.222c-.238-.01-.421.208-.323.424a2.1 2.1 0 0 0 1.078 1.056 3.92 3.92 0 0 0 4.551-1.096 2.1 2.1 0 0 0 .48-1.432c-.012-.237-.274-.347-.481-.23a9.932 9.932 0 0 1-5.305 1.278Zm-.777-1.206a.867.867 0 0 0-.903.9 3.266 3.266 0 0 0 1.971 2.864 5.093 5.093 0 0 0 5.92-1.427c.797-.965.976-2.31.45-3.447a.867.867 0 0 0-1.214-.39l-.72.407a8.76 8.76 0 0 1-4.678 1.127l-.826-.034Z",clipRule:"evenodd"}))),Le||(Le=u.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M11.067 14.184a.586.586 0 0 1-.195-.807l.49-.8a.235.235 0 0 0-.078-.323l-.8-.49a.586.586 0 0 1 .612-1l1.5.918c.277.169.364.53.195.806l-.918 1.501a.586.586 0 0 1-.806.194Z",clipRule:"evenodd"})),we||(we=u.createElement("path",{fill:"#fff",d:"M15.994 9.483a.352.352 0 0 1 .616-.149l.408.5c.075.091.19.14.308.127l.641-.066a.352.352 0 0 1 .332.54l-.349.542a.352.352 0 0 0-.026.333l.261.59a.352.352 0 0 1-.411.482l-.623-.164a.352.352 0 0 0-.325.078l-.48.43a.352.352 0 0 1-.586-.242l-.036-.643a.352.352 0 0 0-.175-.285l-.557-.323a.352.352 0 0 1 .049-.633l.6-.233a.352.352 0 0 0 .217-.254l.136-.63Z"})),xe||(xe=u.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M12.957 17.222c-.238-.01-.421.208-.323.424a2.1 2.1 0 0 0 1.078 1.056 3.92 3.92 0 0 0 4.551-1.096 2.1 2.1 0 0 0 .48-1.432c-.012-.237-.274-.347-.481-.23a9.932 9.932 0 0 1-5.305 1.278Zm-.777-1.206a.867.867 0 0 0-.903.9 3.266 3.266 0 0 0 1.971 2.864 5.093 5.093 0 0 0 5.92-1.427c.797-.965.976-2.31.45-3.447a.867.867 0 0 0-1.214-.39l-.72.407a8.76 8.76 0 0 1-4.678 1.127l-.826-.034Z",clipRule:"evenodd"})),Ie||(Ie=u.createElement("path",{fill:"#fff",fillOpacity:.8,d:"m10.872 13.377.853.522-.853-.522Zm-.388-1.612.521-.854-.521.854Zm.612-1.001-.522.853.522-.853Zm1.5.918-.521.853.522-.853Zm.195.806.853.522-.853-.522Zm-.918 1.501-.853-.522.853.522Zm-.511-1.412-.853-.522.853.522Zm-.078-.323-.522.853.522-.853Zm4.358-1.887-.362-.932.362.932Zm.216-.254-.977-.21.977.21Zm-.866 1.12-.502.865.502-.865Zm.049-.633.362.932-.362-.932Zm.683 1.24.998-.055-.998.056Zm-.175-.284.502-.865-.502.865Zm.797 1.17.668.745-.668-.745Zm-.586-.242-.998.056.998-.056Zm1.39-.266.256-.967-.255.967Zm-.324.078-.668-.744.668.744Zm1.36-.397.914-.404-.915.404Zm-.412.483-.255.967.255-.967Zm.176-1.405.841.542-.84-.542Zm-.026.333-.914.405.914-.405Zm.043-1.415.103.995-.103-.995Zm.332.54-.84-.541.84.541Zm-1.281-.602-.775.633.775-.633Zm.308.128-.102-.995.102.995Zm-.716-.627.775-.632-.775.632Zm-.616.149.977.21-.977-.21Zm-2.282 9.22.396-.919-.396.919Zm4.551-1.097-.77-.637.77.637Zm-.001-1.662.492.87-.492-.87Zm-5.305 1.278.041-.999-.041 1Zm-1.68-.306-1 .04 1-.04Zm.903-.9.042-1-.042 1Zm1.068 3.764-.396.918.396-.918Zm5.92-1.427.77.637-.77-.637Zm.45-3.447-.908.42.908-.42Zm-1.214-.39.492.87-.492-.87Zm-.72.407-.492-.87.492.87Zm-4.678 1.127-.042 1 .042-1Zm5.736.124-.999.045 1-.045Zm-6.108 1.472.91-.415-.91.415Zm-2.615-4.79a1.586 1.586 0 0 0 .526 2.18l1.043-1.706c.195.12.257.374.137.569l-1.706-1.043Zm.49-.801-.49.8 1.706 1.044.49-.8-1.706-1.044Zm-.547.563.8.49 1.044-1.707-.8-.49-1.044 1.707Zm-.526-2.181a1.586 1.586 0 0 0 .526 2.18l1.043-1.706c.195.12.257.374.137.57l-1.706-1.044Zm2.181-.526a1.586 1.586 0 0 0-2.18.526l1.706 1.043a.414.414 0 0 1-.57.137l1.044-1.706Zm1.501.918-1.5-.918-1.044 1.706 1.5.918 1.044-1.706Zm.526 2.181a1.586 1.586 0 0 0-.526-2.181l-1.043 1.706a.414.414 0 0 1-.137-.569l1.706 1.044Zm-.918 1.501.918-1.501-1.706-1.043-.918 1.5 1.706 1.044Zm-2.181.526a1.586 1.586 0 0 0 2.181-.526l-1.706-1.043a.413.413 0 0 1 .568-.138l-1.043 1.707Zm1.67-1.939a1.235 1.235 0 0 0-.41-1.697l-1.043 1.706a.765.765 0 0 1-.253-1.052l1.706 1.043Zm3.62-3.132.408.5 1.55-1.265-.408-.499-1.55 1.264Zm1.594.99.641-.066-.205-1.99-.641.066.205 1.99Zm.03-1.062-.35.542 1.682 1.083.349-.542-1.681-1.083Zm-.449 1.821.261.59 1.829-.81-.261-.59-1.829.81Zm1.02-.3-.624-.164-.51 1.934.623.164.51-1.934Zm-1.872.137-.48.43 1.336 1.489.48-.43-1.336-1.49Zm.6.876-.036-.643-1.997.112.037.643 1.997-.112Zm-.707-1.737-.558-.323-1.003 1.73.557.323 1.004-1.73Zm-.648.841.6-.233-.723-1.864-.6.233.723 1.864Zm1.433-1.21.135-.63-1.955-.419-.135.63 1.955.42Zm-.833.977c.425-.164.738-.531.833-.976l-1.955-.42a.648.648 0 0 1 .399-.468l.723 1.864Zm-.51-.931a.648.648 0 0 1-.09 1.164l-.724-1.864c-1.057.41-1.17 1.86-.189 2.43l1.003-1.73Zm1.23 1.417a1.352 1.352 0 0 0-.672-1.094l-1.003 1.73a.648.648 0 0 1-.322-.524l1.996-.112Zm-1.044.197a.648.648 0 0 1 1.08.446l-1.997.112c.063 1.132 1.408 1.688 2.252.93l-1.335-1.488Zm1.727-.731a1.352 1.352 0 0 0-1.248.3l1.336 1.49a.648.648 0 0 1-.599.143l.511-1.933Zm-.135 1.053a.648.648 0 0 1 .758-.889l-.51 1.934c1.096.29 2.04-.818 1.58-1.854l-1.828.81Zm-.161-1.868a1.352 1.352 0 0 0-.1 1.28l1.829-.81c.088.199.07.43-.048.613l-1.681-1.083Zm.96.454a.648.648 0 0 1-.611-.996l1.681 1.083c.614-.953-.147-2.193-1.275-2.077l.205 1.99Zm-1.827-.424c.288.352.733.536 1.186.49l-.205-1.99a.648.648 0 0 1 .569.235l-1.55 1.265Zm1.142-1.764c-.717-.879-2.131-.538-2.37.571l1.956.42a.648.648 0 0 1-1.136.273l1.55-1.264Zm-3.277 9.082a1.1 1.1 0 0 1-.564-.553l-1.82.83a3.1 3.1 0 0 0 1.592 1.56l.792-1.837Zm3.385-.815a2.92 2.92 0 0 1-3.385.815l-.792 1.837a4.92 4.92 0 0 0 5.718-1.378l-1.541-1.274Zm.25-.75a1.1 1.1 0 0 1-.25.75l1.541 1.274a3.1 3.1 0 0 0 .707-2.113l-1.998.09Zm-4.828 2.002c2.04.086 4.062-.402 5.84-1.407l-.986-1.74a8.932 8.932 0 0 1-4.77 1.15l-.084 1.997Zm-.639-1.344a.133.133 0 0 1-.138.138l.084-1.998a1.867 1.867 0 0 0-1.944 1.938l1.998-.078Zm1.368 1.984a2.266 2.266 0 0 1-1.368-1.984l-1.998.078a4.266 4.266 0 0 0 2.574 3.743l.792-1.837Zm4.753-1.145a4.092 4.092 0 0 1-4.753 1.145l-.792 1.837a6.092 6.092 0 0 0 7.086-1.708l-1.541-1.274Zm.313-2.39a2.266 2.266 0 0 1-.313 2.39l1.541 1.274a4.266 4.266 0 0 0 .587-4.504l-1.815.84Zm.186.06a.133.133 0 0 1-.186-.06l1.815-.84a1.867 1.867 0 0 0-2.614-.84l.985 1.74Zm-.72.407.72-.407-.985-1.74-.72.406.986 1.741Zm-5.212 1.256a9.758 9.758 0 0 0 5.213-1.256l-.985-1.74a7.758 7.758 0 0 1-4.145.998l-.083 1.998Zm-.826-.034.826.034.083-1.998-.825-.034-.084 1.998Zm7.603-.886a1.28 1.28 0 0 0-.748-1.112 1.346 1.346 0 0 0-1.224.056l.985 1.741a.654.654 0 0 1-.596.021.72.72 0 0 1-.415-.616l1.998-.09Zm-6.197 1.102a.72.72 0 0 1-.09.738.654.654 0 0 1-.54.252L13 16.223a1.346 1.346 0 0 0-1.115.507 1.28 1.28 0 0 0-.16 1.331l1.82-.83Z",mask:"url(#faceSpecial_svg__a)"})));a.p;var Ee;function Ze(){return Ze=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},Ze.apply(this,arguments)}const ke=e=>u.createElement("svg",Ze({xmlns:"http://www.w3.org/2000/svg",width:30,height:30,fill:"none",viewBox:"0 0 30 30"},e),Ee||(Ee=u.createElement("path",{fill:"#fff",fillOpacity:.8,fillRule:"evenodd",d:"M7.5 8.5h14.3v13.282H7.5V8.5ZM6 7h17.3v16.282H6V7Zm10.655 8-2.905 1.756v-3.512L16.655 15Zm-3.544-3.75a.862.862 0 0 0-.861.862v5.776a.863.863 0 0 0 1.307.738l4.777-2.888a.862.862 0 0 0 0-1.476l-4.777-2.888a.86.86 0 0 0-.446-.124Z",clipRule:"evenodd"})));var Pe;function Fe(){return Fe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},Fe.apply(this,arguments)}const Te=e=>u.createElement("svg",Fe({xmlns:"http://www.w3.org/2000/svg",width:30,height:30,fill:"none",viewBox:"0 0 30 30"},e),Pe||(Pe=u.createElement("path",{stroke:"#D4D4D4",strokeLinejoin:"bevel",strokeWidth:1.6,d:"M7 21.625 24 7v14.625L7 7v14.625Z",clipRule:"evenodd"})));var Me=a(36983),je=a(69836),Ue=a(49749),Ne=a(17843);const Re="root-dTVjo3",Oe="statusBar-s3NSaI",ze="contextMenuItem-AyAlEH",Be="coverIcon-_65uTe",De=(0,l.Pi)((({className:e,material:t,isSelected:a,onClick:l,onReimport:o,onRemove:r,effectType:n,isInfoComplete:s,onRetryUpdateCover:c})=>{var u;const{t:m}=(0,i.$)(),{common_data:p}=t,{coverUpdating:f}=t.payload,_=t.payload.thumbImg,g=Boolean(null===(u=t.payload)||void 0===u||null===(u=u.unmetRequirements)||void 0===u?void 0:u.length),v="updateCoverFailed"===t.payload.failedType,y=g||v,{handleContextMenu:b}=(0,Ne.D)({content:(0,le.jsx)(Ue.m,{items:[{key:"retryUpdateCover",render:({key:e,className:a})=>Boolean(v)&&(0,le.jsx)("div",{className:he()(a,ze),onClick:()=>c(t),children:m("cc_pc_material_visual_effect_publish_cover_retry_web")},e)},{key:"reimport",render:({key:e,className:a})=>Boolean(y)&&(0,le.jsx)("div",{className:he()(a,ze),onClick:()=>o(t),children:m("pc_stickers_release_again_web")},e)},{key:"remove",render:({key:e,className:a})=>(0,le.jsx)("div",{className:he()(a,ze),onClick:()=>r(t),children:m("pc_stickers_release_delete_web")},e)}]})});return(0,le.jsxs)("div",{className:he()(e,Re),onClick:()=>{var e;l(null===(e=t.payload)||void 0===e?void 0:e.localId)},children:[(0,le.jsx)(Me.Y,{src:f?"":t.payload.thumbImg,customRenderIcon:(()=>{if(!_&&!f)return()=>{switch(n){case P.Ab.Special:return(0,le.jsx)(ye,{className:Be});case P.Ab.FaceSpecial:return(0,le.jsx)(Ae,{className:Be});case P.Ab.VideoAnimation:return(0,le.jsx)(ke,{className:Be});case P.Ab.Transition:return(0,le.jsx)(Te,{className:Be});default:return null}}})(),isSelected:a,isInvalid:Boolean(y),size:80,onContextMenu:e=>{var a;b(e),l(null===(a=t.payload)||void 0===a?void 0:a.localId)}}),(0,le.jsx)(je.ir,{className:Oe,loading:f,loadingText:m("cc_pc_material_visual_effect_publish_cover_fail_updating_web"),invalid:y,errorToolip:g?null===(C=t.payload)||void 0===C||null===(C=C.unmetRequirements)||void 0===C?void 0:C.map((e=>{const t=h[d.File][e];return t?(0,le.jsx)("div",{children:t},e):null})):v?m("cc_pc_material_visual_effect_publish_cover_fail_web"):null,isInfoComplete:s,title:p.title})]});var C})),Ve="root-tZNHZs",We="container-x9pyNI",qe="cardDragWrapper-szN40I",$e="card-DcrvQZ",Je="hover-right-YTbO59",He="hover-left-C7z4sq",Ye=(0,l.Pi)((()=>{const e=ae(),{materialListStore:t}=e,a=(0,u.useCallback)((e=>{t.selectedId!==e.payload.localId&&t.selectMaterial(e.payload.localId)}),[t.selectMaterial]),l=(0,u.useCallback)(((a,l)=>{var i;return(0,le.jsx)(De,{className:he()($e,{[Je]:"right"===l,[He]:"left"===l}),material:a,onClick:e.materialListStore.selectMaterial,isSelected:e.materialListStore.selectedId===a.payload.localId,onRemove:e.materialListStore.removeMaterial,onReimport:e.reimport,effectType:a.effect_type,isInfoComplete:t.getIsInfoComplete(a),onRetryUpdateCover:t.retryUpdateCover},null===(i=a.payload)||void 0===i?void 0:i.localId)}),[e.reimport,e.materialListStore.selectMaterial,e.materialListStore.removeMaterial,e.materialListStore.selectedId]);return(0,le.jsx)("div",{className:Ve,children:(0,le.jsx)("div",{className:We,children:(0,le.jsx)(ge.y,{list:t.materialList,renderCard:l,onMoveCard:t.dragInsert,className:qe,getId:e=>e.payload.localId,scrollAreaRef:e.materialListStore.scrollAreaRef,onCardClick:a})})})}));var Ge=a(73622),Xe=a(91285),Qe=(a(11036),a(93668)),Ke=a(84997),et=a(17941);const tt="root-HoHMo9",at="disabled-VOcU3h",lt="help-Q9jnn3",it=(0,I.Q2)((e=>{const{t}=(0,i.$)(),{value:a,onChange:l,sendLogService:o,disabledTooltip:r,tooltip:n,...s}=e,{className:c,disabled:d}=s,u=Qe.YW.AuthorAgreement,{showModal:m,showModalWithoutReview:p}=(0,Qe.ZP)({handleBtnText:t("pc_template_authorize_confirm_web"),closeIcon:!0,protocol:u,needReview:!0,onOk:()=>{(0,et.F)(u),null==l||l(!0),o.sendSubscriptionStatementLog({action:"confirm",entry_from:"checkbox"}),o.sendClickSubscriptionCheckboxLog(!0)}}),{handleMouseEnter:f}=(0,Ke.w)({cursor:"not-allowed",content:r}),{handleMouseEnter:_}=(0,Ke.w)({content:n}),{handleMouseOver:h}=(0,Ke.S)({checkIsTarget:e=>null!==e.closest(".semi-checkbox-addon")}),g=he()(s.className);return(0,le.jsxs)("div",{className:he()(tt,d&&at,c),onMouseEnter:e=>{d&&r?f(e):n&&_(e)},onMouseOver:d&&r?void 0:h,children:[(0,le.jsx)(I.XZ,{...s,className:g,checked:a,onChange:e=>{const t=Boolean(e.target.checked);if(t&&!(0,et.K)(u))return m(),o.sendSubscriptionStatementLog({action:"show",entry_from:"checkbox"}),void o.sendPageActionLog({action:"choose_subscription_authorize"});o.sendClickSubscriptionCheckboxLog(t),null==l||l(t)},children:t("cc_pc_material_visual_effect_publish_authorize_desc_web")}),(0,le.jsx)(Ge.r,{className:lt,onClick:()=>{p(),o.sendSubscriptionStatementLog({action:"show",entry_from:"question_mark"}),o.sendPageActionLog({action:"click_subscription_detail"})}})]})}));var ot=a(45033);const rt="authGroup-Yuaspf";var nt=a(40249);const st=e=>{const{t}=(0,i.$)(),{className:a,boxClassName:l,title:o,children:r,onClickUseAll:n,hiddenFieldLabel:s=!1,required:c=!1}=e;return(0,le.jsxs)("div",{className:he()(nt.Z.root,a),children:[!s&&(0,le.jsxs)("div",{className:nt.Z.fieldLabel,children:[(0,le.jsx)("div",{className:he()({[nt.Z.showRequired]:c}),children:null!=o?o:t("pc_template_authorize_settings_web")}),n&&(0,le.jsx)("span",{className:nt.Z.useAll,onClick:n,children:t("pc_material_release_apply_all")})]}),(0,le.jsx)("div",{className:he()(nt.Z.box,l),children:r})]})};var ct,dt=a(2237),ut=a(89556);function mt(){return mt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},mt.apply(this,arguments)}const pt=e=>u.createElement("svg",mt({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none","aria-hidden":"true",viewBox:"0 0 24 24"},e),ct||(ct=u.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M21.352 4.265a1.5 1.5 0 0 1 .383 2.087l-10 14.5a1.5 1.5 0 0 1-2.334.169l-6.5-7a1.5 1.5 0 0 1 2.198-2.042l5.228 5.63 8.938-12.96a1.5 1.5 0 0 1 2.087-.384Z",clipRule:"evenodd"}))),ft="root-gly6Qn",_t="link-pZCc56",ht="selectWrapper-PYDCrg",gt="activitySelect-pwnL0y",vt=e=>{const{t}=(0,i.$)(),{value:a,onChange:l,taskList:o,loading:r,viewMoreUrl:n,onOrientationViewMoreClick:s}=e,[c,d]=(0,ut.Z)(void 0,{dimension:"width"}),u=e=>{var t;null==l||l({postChannel:null!==(t=null==a?void 0:a.postChannel)&&void 0!==t?t:W.iu.Targeted,activityId:e})};return(0,le.jsxs)("div",{className:ft,children:[(0,le.jsxs)(I.FX,{type:"card",value:null==a?void 0:a.postChannel,onChange:e=>{null==l||l({postChannel:e.target.value})},direction:"horizontal",name:"material-publish-group-pureCard",children:[(0,le.jsx)(I.Y8,{value:W.iu.Targeted,extra:(0,le.jsxs)("div",{style:{height:"100%"},children:[(0,le.jsx)("div",{children:t("cc_pc_material_visual_effect_publish_creation_type_event_desc_web")}),(0,le.jsx)("span",{className:_t,onClick:e=>{null==s||s(),e.preventDefault(),(0,R.Yo)({url:n})},children:t("cc_pc_material_visual_effect_publish_creation_type_event_detail_web")})]}),children:t("cc_pc_material_visual_effect_publish_creation_type_event_web")}),(0,le.jsx)(I.Y8,{value:W.iu.Open,extra:(0,le.jsx)("div",{style:{height:"100%"},children:(0,le.jsx)("div",{children:t("cc_pc_material_visual_effect_publish_creation_type_free_desc_web")})}),children:t("cc_pc_material_visual_effect_publish_creation_type_free_web")})]}),(0,le.jsx)("div",{className:ht,ref:c,onClick:()=>{const e=document.getElementById("formAreaWrapper");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},children:(null==a?void 0:a.postChannel)===W.iu.Targeted&&(0,le.jsx)(I.Ph,{maxHeight:180,value:null==a?void 0:a.activityId,loading:r,placeholder:t("cc_pc_material_visual_effect_publish_creation_type_event_select_web"),className:gt,optionList:o,renderOptionItem:t=>{var a;const{label:l,desc:i,value:o,onClick:r}=t,n=o===(null===(a=e.value)||void 0===a?void 0:a.activityId);return(0,le.jsxs)("div",{className:"custom-select-option",onClick:e=>{null==r||r(e),null==u||u(o)},style:{maxWidth:d.width-12},children:[n&&(0,le.jsx)(pt,{className:"checkedIcon"}),!n&&(0,le.jsx)("div",{className:"placeholder"}),l]})}})})]})};var yt=a(28747);const bt="root-gQdqRP",Ct="rootCategory-gHMpjw",Lt="secondCategoryWrapper-UM_jLd",wt="secondCategory-t3M31B",xt=e=>{const{value:t,onChange:a,categories:l,loading:o,effectType:r}=e,n=(0,u.useRef)(""),[s,c]=(0,ut.Z)(void 0,{dimension:"width"}),{handleMouseEnter:d,destroyTooltip:m}=(0,Ke.w)({content:n.current}),{t:p}=(0,i.$)(),{handleMouseEnter:f}=(0,Ke.S)();return(0,le.jsxs)("div",{className:bt,children:[(0,le.jsx)("div",{className:Ct,onMouseEnter:f,children:(()=>{switch(r){case P.Ab.Special:return p("cc_pc_material_visual_effect_type_video_effect_web");case P.Ab.FaceSpecial:return p("cc_pc_material_visual_effect_type_body_effect_web");case P.Ab.Transition:return p("cc_pc_material_visual_effect_type_transition_web");case P.Ab.VideoAnimation:return p("cc_pc_material_visual_effect_type_animation_web");default:return""}})()}),(0,le.jsx)("div",{className:Lt,ref:s,children:(0,le.jsx)(I.Ph,{value:t,loading:o,className:wt,placeholder:p("cc_pc_material_visual_effect_type_category_web"),optionList:l.map(((e,t)=>({value:e.id,label:e.name,desc:e.desc,key:t,fadeInUrl:e.fade_in_url,fadeOutUrl:e.fade_out_url}))),renderOptionItem:t=>{const{label:l,desc:i,value:o,onClick:r,fadeInUrl:s,fadeOutUrl:u}=t,p=o===e.value;return(0,le.jsxs)("div",{className:"custom-select-option",onMouseEnter:e=>((e,t)=>{t&&(n.current=t,d(e))})(e,i),onClick:e=>{null==r||r(e),null==a||a({categoryId:o,categoryName:l,fadeInUrl:s,fadeOutUrl:u}),n.current="",m()},style:{maxWidth:c.width-12},children:[p&&(0,le.jsx)(pt,{className:"checkedIcon"}),!p&&(0,le.jsx)("div",{className:"placeholder"}),l]})}})})]})},It="root-KVaL4a",St="coverWrapper-IJ2U5k",At="box-l32ETe",Et="img-UsMa71",Zt="label-iZB0vG",kt="useAll-euWGNE",Pt="initialCover-TMGtxi",Ft="coverDesc-c6sUQG",Tt="titleLabel-DBP9RC",Mt="titleName-aHymLh",jt="titleIcon-kLKwkO",Ut="input-oQfVTZ",Nt="icon-WX0oFX",Rt="publishDirectionUseAll-z6m7mf",{Label:Ot}=I.Form,zt=(0,l.Pi)((({material:e,materialListStore:t,formApi:a,authProps:l,sendLogServ:o})=>{var r,n,s;const{t:c}=(0,i.$)(),{payload:d,effect_type:m}=e,{coverUpdating:p,categoryId:_,targetedActivityId:h}=d,{effectsPostConfigMap:g}=t,{authConfig:v,resourceCommonConfig:y}=g[e.effect_type],{mustPaidAuth:b}=v,C=y.maxTitleLen||f,{value:L}=(0,I.tL)("common_data.title"),{value:w}=(0,I.tL)("common_data.post_channel"),[x,S]=(0,u.useState)({}),[A,E]=(0,u.useState)({});(0,u.useLayoutEffect)((()=>(null==a||a.reset(),null==a||a.setValues(e,{isOverride:!0}),()=>{const l=null==a?void 0:a.getValues();l&&t.updateFormState(e,{is_vip:l.is_vip||!1,common_data:{...e.common_data,title:l.common_data.title||"",post_channel:l.common_data.post_channel,description:l.common_data.description,tags:l.common_data.tags,is_original:l.common_data.is_original||!1,is_business:l.common_data.is_business||!1}})})),[e]),(0,u.useEffect)((()=>{x[m]||async function(e){return(await(0,W.ip)({effect_type:e})).tasks.map((e=>({label:e.title,value:e.task_id})))}(m).then((e=>{S((t=>({...t,[m]:e})))})),A[m]||async function(e){return(await(0,W.kM)({effect_type:e})).categories}(m).then((e=>{E((t=>({...t,[m]:e})))}))}),[m]),(0,u.useEffect)((()=>{H.$.isEnableAuthorization&&k(!0)}),[H.$.isEnableAuthorization]);const{getDisplayLength:Z}=(0,ot._)(),k=l=>{t.updateFormState(e,{is_vip:l}),null==a||a.setValue("is_vip",l)},P=(e,t)=>(0,le.jsxs)("div",{className:Tt,children:[(0,le.jsx)("span",{className:Mt,children:e}),(0,le.jsx)(I.u,{autoAdjustOverflow:!0,content:t,position:"right",showArrow:!1,trigger:"hover",children:(0,le.jsx)("span",{children:(0,le.jsx)(Ge.r,{className:jt})})})]});return(0,le.jsxs)("div",{className:It,children:[(0,le.jsx)("div",{className:St,children:(0,le.jsxs)("div",{className:At,children:[p?(0,le.jsx)(dt.t,{className:Nt,iconWidth:28}):d.thumbImg?(0,le.jsx)("img",{className:Et,src:d.thumbImg}):(0,le.jsx)("div",{className:Pt,children:c("cc_pc_material_visual_effect_publish_preview_note_web")}),(0,le.jsx)("div",{className:Ft,children:c("cc_pc_material_visual_effect_publish_preview_bottom_web")})]})}),(0,le.jsx)(Xe.l,{fieldClassName:Ut,label:P(c("cc_pc_material_visual_effect_publish_name_web"),c("cc_pc_material_visual_effect_publish_name_hover_web")),field:"common_data.title",maxLength:C,placeholder:c("pc_stickers_release_xy_name_web",{X:1,Y:Z(C)}),allowEnter:!1,rules:[{required:!0,message:""}],onChange:a=>((a,l)=>{t.updateFormState(e,{common_data:{...e.common_data,[l]:a}})})(a,"title")}),(0,le.jsxs)("div",{className:Zt,children:[(0,le.jsx)(Ot,{required:!0,text:P(c("cc_pc_material_visual_effect_type_web"),c("cc_pc_material_visual_effect_type_hover_web"))}),(0,le.jsx)(xt,{effectType:m,value:_,onChange:a=>{_?o.sendPageActionLog({action:"change_effect_category"}):o.sendPageActionLog({action:"choose_effect_category"}),e.payload.coverImgUrls={fadeInUrl:a.fadeInUrl,fadeOutUrl:a.fadeOutUrl},e.payload.categoryId=a.categoryId,e.payload.categoryName=a.categoryName,t.setEffectCoverImage(e)},categories:null!==(r=A[m])&&void 0!==r?r:[],loading:!(null!==(n=A[m])&&void 0!==n&&n.length)})]}),(0,le.jsxs)("div",{className:Zt,children:[(0,le.jsx)(yt.u,{fieldClassName:Ut,label:c("pc_stickers_release_tag_set_web"),placeholder:c("cc_pc_material_visual_effect_tag_grey_web"),max:10,field:"common_data.tags",onChange:l=>{const i={...e.common_data,tags:l};t.updateFormState(e,{common_data:i}),null==a||a.setValue("common_data",i)},itemType:m,recommendConfig:{title:L},rules:[{required:!0,message:""}],onRecentTagSelect:()=>{o.sendPageActionLog({action:"click_lastest_hashtag"})},disableRecommend:!0}),(0,le.jsx)("span",{className:kt,onClick:()=>{o.sendPageActionLog({action:"apply_hashtag_to_all"});const e=null==a?void 0:a.getValues();e&&t.applyCommonDataToAll({tags:e.common_data.tags})},children:c("pc_material_release_apply_all")})]}),(0,le.jsxs)("div",{className:Zt,children:[(0,le.jsx)(Ot,{required:!0,text:c("cc_pc_material_visual_effect_publish_creation_type_web")}),(0,le.jsx)(vt,{value:{postChannel:w,activityId:h},onChange:l=>{const i={...e.common_data,post_channel:l.postChannel};t.updateFormState(e,{common_data:i}),null==a||a.setValue("common_data",i),e.payload.targetedActivityId=l.activityId},taskList:x[m]||[],loading:!(null!==(s=x[m])&&void 0!==s&&s.length),viewMoreUrl:"https://bytedance.sg.larkoffice.com/docx/LFfKdQUOOogNLExPM4zl0nXGgsi?open_in_browser=true",onOrientationViewMoreClick:()=>{o.sendPageActionLog({action:"click_more_official_task"})}}),(0,le.jsx)("span",{className:Rt,onClick:()=>{o.sendPageActionLog({action:"apply_publish_type_to_all"});const e=null==a?void 0:a.getValues();e&&(t.applyCommonDataToAll({post_channel:e.common_data.post_channel}),t.applyPayloadDataToAll({targetedActivityId:h}))},children:c("pc_material_release_apply_all")})]}),!1,l&&(0,le.jsx)(st,{onClickUseAll:()=>{o.sendPageActionLog({action:"authorize_apply_to_all "});const e=null==a?void 0:a.getValues();e&&t.applyAuthSettingsToAll({isVip:e.is_vip,isOriginal:e.common_data.is_original,isBusiness:e.common_data.is_business})},required:b,title:c("cc_pc_material_visual_effect_publish_authorization_web"),children:(0,le.jsx)("div",{className:rt,children:(0,le.jsx)(it,{noLabel:!0,field:"is_vip",disabled:H.$.isEnableAuthorization,disabledTooltip:c("cc_pc_material_visual_effect_publish_authorized_hover_web"),tooltip:b?c("cc_pc_material_visual_effect_publish_authorize_hover_web"):"",sendLogService:o,onChange:e=>{e&&o.sendPageActionLog({action:"choose_subscription_authorize"}),k(e)}})})})]})})),Bt=(0,l.Pi)((({className:e})=>{const t=ae(),{t:a}=(0,i.$)(),l=(0,u.useCallback)((()=>t.materialListStore.selectedMaterial&&(0,le.jsx)(zt,{material:t.materialListStore.selectedMaterial,materialListStore:t.materialListStore,formApi:t.formApi,authProps:(0,q.Z)(t,"authorSignService","authFileUploadServiceManager"),sendLogServ:t.sendLogServ})),[t.materialListStore.selectedMaterial,t.materialListStore,t.formApi]);return(0,o.pg)(t),(0,pe.O)({className:e,layout:t.mainFormLayout,uploadAreaProps:{titleForUploadArea:a("pc_sticker_release_drag_web"),titleForMainForm:a("pc_stickers_release_drag_in_web"),subTitle:a("cc_pc_material_visual_effect_publish_guidance_zip_web"),draggingTitle:a("pc_sticker_release_mouse_web"),disabled:t.isImportDisabled,disabledTooltip:"",onClick:t.openEffectPicker,onDrop:t.uploadDroppedEffectFiles},setFormApi:t.setFormApi,renderImportArea:e=>(0,le.jsxs)(le.Fragment,{children:[e,(0,le.jsx)(Ye,{})]}),renderFormArea:l,scrollAreaRef:t.materialListStore.scrollAreaRef,onRetry:fe.cb})}));var Dt=a(65546);const Vt="page-gReLnA",Wt="content-zqASBO",qt="requirement-cAMPWF",$t="mainForm-cORglw",Jt="footer-rHRMuw",Ht=(0,l.Pi)((()=>{const e=ee(),{t}=(0,i.$)();return(0,r.F)({title:t("cc_pc_material_visual_effect_publish_title_web"),pid:"effects-publish-single"}),(0,Dt.d)(),(0,o.t9)(e.sendLogServ),(0,le.jsx)(te.Provider,{value:e,children:(0,le.jsxs)("div",{className:Vt,children:[(0,le.jsxs)("div",{className:Wt,children:[(0,le.jsx)(ie,{className:qt}),(0,le.jsx)(Bt,{className:$t})]}),(0,le.jsx)(ne,{className:Jt})]})})}))},74235:(e,t,a)=>{a.d(t,{YB:()=>o,xB:()=>i});var l=a(86439);function i(e){const{len:t,i18n:a}=e,[l]=(a.language||"").split("-");return"zh"===l?Math.floor(t/2):t}function o(e,t){const a=e.split(/[\\/]/g).pop().replace(/\.\w+?$/g,"");return(0,l.aF)(a,null==t?void 0:t.maxLength)}}}]);