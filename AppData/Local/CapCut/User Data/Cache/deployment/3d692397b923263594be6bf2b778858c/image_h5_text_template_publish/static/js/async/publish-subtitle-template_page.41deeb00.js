"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[294],{71212:(e,t,i)=>{i.d(t,{i:()=>l});var a=i(5455),s=i(37953);const l=(0,a.Z)(s.Z);l.Option=s.Z.Option,l.OptGroup=s.Z.OptGroup},78367:(e,t,i)=>{i.d(t,{Z:()=>l});var a=i(50959),s=i(19503);function l(){return(0,a.useContext)(s.mC)}},84736:(e,t,i)=>{i.d(t,{EG:()=>d.Z,Ex:()=>c.Z,FN:()=>m.Z,Form:()=>f.Z,II:()=>n.Z,Kx:()=>o.Z,Lt:()=>r.Z,Q2:()=>h.Z,Vp:()=>p.Z,XQ:()=>_.Z,XZ:()=>s.ZP,ih:()=>b.i,u:()=>g.Z,u_:()=>l.Z,yC:()=>u.Z,z8:()=>v.z,zx:()=>a.Z});i(32913);var a=i(99891),s=i(76021),l=i(15194),r=i(89270),n=i(55550),o=i(88161),c=i(63522),u=i(48611),p=i(40996),d=i(83335),m=i(23997),g=i(11643),f=i(60679),_=i(78367),h=i(5455),b=i(71212),v=i(96194)},56576:(e,t,i)=>{i.d(t,{Z:()=>o});i(50959);var a=i(84875),s=i.n(a),l=i(84736),r=i(48240),n=i(11527);const o=({className:e,value:t,selected:i,disabled:a,onClick:o})=>(0,n.jsx)(l.Vp,{className:s()(e,r.Z.tag,i&&r.Z.selected,a&&r.Z.disabled),color:i?"cyan":void 0,onClick:()=>null==o?void 0:o(t),children:t},t)},6068:(e,t,i)=>{i.d(t,{Z:()=>u});var a=i(50959),s=i(84875),l=i.n(s),r=i(84736),n=i(56576),o=i(70498),c=i(11527);const u=({className:e,title:t,loading:i,loadingText:s,value:u,options:p,onSelect:d})=>{const m=(0,a.useCallback)((e=>u.includes(e)),[u]),g=(0,a.useMemo)((()=>p.filter((e=>!u.includes(e)))),[u,p]);return 0===g.length?null:(0,c.jsxs)("div",{className:l()([o.Z.block,e]),children:[(0,c.jsx)("p",{className:o.Z.title,children:t}),(0,c.jsx)("div",{className:o.Z.content,children:i?(0,c.jsxs)("div",{className:o.Z.loading,children:[(0,c.jsx)("span",{className:o.Z.text,children:s}),(0,c.jsx)(r.yC,{size:"small"})]}):g.map((e=>(0,c.jsx)(n.Z,{selected:m(e),value:e,onClick:()=>d(e)},e)))})]})}},85471:(e,t,i)=>{i.d(t,{Z:()=>u});var a=i(50959),s=i(23479),l=i(45599),r=i(25807),n=i(69905),o=i(6068),c=i(11527);const u=(0,s.Pi)((({value:e,onSelect:t})=>{const[i,s]=(0,a.useState)([]),{t:u}=(0,l.$)();return(0,a.useEffect)((()=>{const e=(0,n.cF)(n.Qt.TagEachUser,r.$.userInfo.uid).get();s(e)}),[r.$.userInfo.uid,e]),(0,c.jsx)(o.Z,{title:u("pc_recently_used_web"),value:e,options:i,onSelect:t})}))},12890:(e,t,i)=>{var a=i(50959),s=i(23479),l=i(26800),r=i(3298),n=i(45599),o=i(6068),c=i(94435),u=i(11527);(0,s.Pi)((({title:e,uri:t,value:i,itemType:s,onSelect:p})=>{const[d,m]=(0,a.useState)([]),[g,f]=(0,a.useState)([]),[_,h]=(0,a.useState)(!1),b=(0,a.useRef)({selfConfigTagsReady:{}}),{t:v}=(0,n.$)(),T=(0,a.useMemo)((()=>[...g,...d]),[d,g]),S=(0,l.Z)((e=>{const{title:t,uri:i}=e;return t?b.current.cvid&&b.current.uri===i?{cvid:b.current.cvid,title:t}:i?{image_uri:i,title:t}:null:null})),y=(0,a.useCallback)((async()=>{try{h(!0);const i=S({title:e,uri:t});await Promise.all([i&&(0,c.Uz)(i).then((e=>{f(e.cv_tags),b.current.cvid=e.cvid,i.image_uri&&(b.current.uri=i.image_uri)})),!b.current.selfConfigTagsReady[s]&&(0,c.On)({effect_type:s}).then((e=>{m(e.rec_tags),b.current.selfConfigTagsReady[s]=!0}))])}finally{h(!1)}}),[e,t,s]);return(0,r.Z)(y,500,[y]),(0,a.useEffect)((()=>{y()}),[s]),(0,u.jsx)(o.Z,{title:v("recommend_signature_web"),loading:_,loadingText:v("loading_web"),value:i,options:T,onSelect:p})}))},95968:(e,t,i)=>{i.d(t,{u:()=>y});var a=i(50959),s=i(10422),l=i(84736),r=i(26800),n=i(3298),o=i(45599),c=i(23479),u=i(25807),p=i(69905),d=i(60251),m=i(8129),g=i(86439),f=i(94435),_=i(16743),h=i(85471),b=(i(12890),i(56576)),v=i(9006),T=i(11527);const S=(0,c.Pi)((({recommendConfig:e,value:t=[],itemType:i,disabled:c,disableRecommend:S,disableLatest:y,onChange:x,placeholder:w,max:F=15,temporaryId:Z,ignoreAddTagOnBlurSelector:L,onRecentTagSelect:C})=>{const P=(0,a.useRef)(!1),[I,k]=(0,a.useState)(""),[U,j]=(0,a.useState)(""),A=(0,a.useRef)(!1),N=A.current?U:I,[D,O]=(0,a.useState)([]),[R,E]=(0,a.useState)([]),{t:M}=(0,o.$)(),B=e=>(0,p.cF)(p.Qt.TagEachUser,u.$.userInfo.uid).set("add",[e]),z=(0,r.Z)((e=>{E(I?e:[])}));(0,n.Z)((async()=>{if(!i||!I)return;const e=await(0,f.EO)({query:I,count:10}),t=(null==e?void 0:e.sug_tags)||[];z(t)}),500,[I,i]),(0,a.useEffect)((()=>{I||E([])}),[I]);const $=(0,a.useCallback)((e=>{if(F&&e.length>F)return l.FN.error(M("pc_stickers_release_max_tag_web",{X:F})),void(null==x||x(e.slice(0,F)));null==x||x(e)}),[x]),V=(0,r.Z)((e=>{t.includes(e)||$([...t,e])})),H=(0,a.useMemo)((()=>new d.l),[]),G=(0,r.Z)((async e=>{const i=await H.lock("",(async()=>{if(t.includes(e))return!0;let i=!1;try{const t=await(0,f._K)({words:e,scene:f.Xb.Tag});i=!1===(null==t?void 0:t.is_hit)}catch(a){return(0,m.RF)("[TagSelect] call checkAntiDirt failed",a,{tag:e}),l.FN.error(M("pc_tag_retry_web")),!1}return i?(V(e),!0):((0,m.c6)("[TagSelect] checkAntiDirt not passed",{tag:e}),l.FN.error(M("pc_tag_illegal_fail_web")),!1)}));return null!=i&&i})),q=(0,r.Z)((e=>{if(0===e.length)return;const i=t.filter((t=>!e.includes(t)));$(i)})),W=(0,a.useRef)(null),{saveSelectionIfNeeded:J}=(0,_.u)({getInputElem:()=>{var e;return null===(e=W.current)||void 0===e?void 0:e.inputRef.current}}),X=e=>{const t=(0,g.aF)(e,30);J(t),k(t)},Q=(0,r.Z)((e=>{X(""),t.includes(e)?q([e]):(V(e),B(e))})),K=e=>{const t=D.includes(e);O(t?D.filter((t=>t!==e)):[...D,e])},Y=(0,r.Z)((()=>{q(D),O([])})),ee=(0,r.Z)((()=>W.current&&W.current.inputRef.current&&W.current.tagInputRef.current?{tagInput:W.current,tagInputElem:W.current.tagInputRef.current,inputElem:W.current.inputRef.current}:null)),te=(0,r.Z)((e=>{const t=ee();return!!(t&&e&&e instanceof Element)&&e.closest(".semi-tagInput")===t.tagInputElem})),ie=(0,r.Z)((e=>!!(e&&e instanceof Element)&&null!==e.closest(".semi-tag"))),ae=(0,r.Z)((e=>{const t=e.target,i=ee();if(!i||!te(t))return;const{tagInput:a,tagInputElem:s,inputElem:l}=i,{selectionStart:r,selectionEnd:n}=l;return D.length>0&&ie(t)?(Y(),null==l||l.setSelectionRange(0,0),void a.focus()):void 0})),se=(0,r.Z)((e=>{const t=e.target;ee()&&te(t)&&ie(t)&&(te(e.relatedTarget)&&ie(e.relatedTarget)||O([]))}));(0,a.useEffect)((()=>{const e=e=>{"Delete"===e.code||"Backspace"===e.code?(P.current=!0,ae(e)):P.current=!1};return window.addEventListener("keydown",e,!0),window.addEventListener("blur",se,!0),()=>{window.removeEventListener("keydown",e,!0),window.removeEventListener("blur",se,!0)}}),[]);const le=(0,r.Z)((e=>{e.replace(/ {1,}/g,"")===I.replace(/ {1,}/g,"")&&X("")})),re=async e=>{const[t]=e;Promise.resolve().then((()=>X(I)));const i=t.replace(/ {1,}/g,"");if(0===i.length)return;await G(i)&&(B(i),le(I))},ne=async e=>{if(A.current)return void j(e);const t=e.replace(/ {1,}$/,""),i=t.replace(/ {1,}/g,"");if(X(t),t===e||!t||P.current)return;await G(i)&&(B(i),le(I))};(0,a.useEffect)((()=>{var e;const t=null===(e=W.current)||void 0===e?void 0:e.inputRef.current;if(!t)return;const i=()=>{A.current=!0,j(t.value)},a=()=>(0,s.unstable_batchedUpdates)((()=>{A.current=!1,j(""),ne(t.value)}));return t.addEventListener("compositionstart",i),t.addEventListener("compositionend",a),()=>{t.removeEventListener("compositionstart",i),t.removeEventListener("compositionend",a)}}),[]);(0,a.useEffect)((()=>{Z&&k("")}),[Z]);return(0,T.jsxs)("div",{className:v.Z.tagSelect,children:[(0,T.jsx)(l.Lt,{position:"bottomLeft",trigger:"focus",className:v.Z.suggestListDropdown,style:{maxHeight:200,overflow:"scroll"},render:(0,T.jsx)(l.Lt.Menu,{children:R.map((e=>(0,T.jsx)(l.Lt.Item,{className:v.Z.dropItem,onClick:()=>Q(e),children:e},e)))}),children:(0,T.jsx)(l.EG,{ref:W,inputValue:N,onInputChange:ne,value:t,placeholder:w,renderTagItem:(e,t,i)=>(0,T.jsx)(b.Z,{value:e,selected:D.includes(e),disabled:c,onClick:K},e),onAdd:re,onBlur:e=>{if(e.relatedTarget&&e.relatedTarget instanceof Element){const t=[`.${v.Z.suggestListDropdown}`,L].filter((e=>e)).join(",");if(null!==e.relatedTarget.closest(t)||ie(e.relatedTarget))return}re([I])},disabled:c})}),!1,!c&&!y&&(0,T.jsx)(h.Z,{value:t,onSelect:e=>{Q(e),null==C||C()}})]})})),y=(0,l.Q2)(S)},67078:(e,t,i)=>{i.d(t,{$X:()=>r,pn:()=>s,sR:()=>l});var a=i(94435);function s({isVip:e,isBusiness:t,authFiles:i}){var s;const l=null!==(s=null==i?void 0:i.map((({uri:e})=>({uri:e}))))&&void 0!==s?s:[];return{root:{is_vip:!1,copyright:{copyright_info:[{scene:a.$x.Vip,auth_status:e?a.U9.Authorized:a.U9.Unauthorized,third_party_agreements:[]},{scene:a.$x.Business,auth_status:t?a.U9.Authorized:a.U9.Unauthorized,third_party_agreements:t?l:[]}]}},commonData:{is_business:!1,is_original:Boolean(e||t)}}}function l(e){const{isOriginal:t=!1,isVip:i=!1,isBusiness:a=!1,authFiles:l}=e;const{root:r}=s({isVip:i,isBusiness:a,authFiles:l});return{copyright:r.copyright}}function r(e,t){return Boolean(null==e?void 0:e.copyright_info.some((e=>e.scene===t&&e.auth_status===a.U9.Authorized)))}},9679:(e,t,i)=>{i.d(t,{$v:()=>u,Ad:()=>m,DV:()=>o,S4:()=>p,SB:()=>f,Sj:()=>c,_4:()=>g,ce:()=>d,iL:()=>r,j2:()=>n});var a=i(17095);function s(e){return void 0===e?e:String(Math.round(e/1024))}function l(e){const{material_category:t,material_type:i,collection_detail:a}=e;return{material_category:t,material_type:i,...a&&"collection"===i&&{collection_detail:a}}}function r(e){const{action:t,extra:i={},material_cnt:s}=e;(0,a.g)({eventName:"personal_page_material_publish_page_action",params:{action:t,material_cnt:s,...l(e),...i}})}function n(e){const{error_report:t,upload_status:i,time:r,isCompressed:n,sizeBeforeCompress:o,sizeAfterCompress:c,resolutionBeforeCompress:u,resolutionAfterCompress:p,extra:d={}}=e;(0,a.g)({eventName:"personal_page_material_upload_status",params:{...l(e),error_report:t,upload_status:i,time:r,is_compressed:n?1:0,...n&&{material_size_before_compress:s(o),material_size_after_compress:s(c),material_resolution_before_compress:u,material_resolution_after_compress:p},...d}})}function o(e){const{error_report:t}=e;(0,a.g)({eventName:"personal_page_material_import_error_report",params:{...l(e),error_report:t}})}function c(e){if(0===e.length)return;const t=function(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,i])=>{const a=i||"";t[e]=t[e]?`${t[e]},${a}`:a}))})),t}(e),i=new Set(t.material_type.split(","));1===i.size&&(t.material_type=i.values().next().value),(0,a.g)({eventName:"personal_page_material_publish_error_report",params:t})}function u(e){const{status:t,material_type:i,material_category:l,title:r,description:n,isOriginal:o,tags:c,material_format:u,material_size:p,resolution:d,error_type:m,cover_type:g,time:f,extra:_={},authorize_range:h,isVipAuthorized:b,isBusinessAuthorized:v,is_official_task:T,task_id:S,material_id:y,material_subcategory:x,effect_type_title:w,effect_type_id:F}=e;return(0,a.g)({eventName:"personal_page_material_publish_status",params:{status:t,material_type:i,material_category:l,material_title:r,material_introduction:n,is_original:o?"1":"0",hashtag:c.join(","),material_format:u,material_size:s(p),resolution:d,authorize_range:h,is_official_task:T,task_id:S,material_id:y,material_subcategory:x,effect_type_title:w,effect_type_id:F,..."fail"===t&&{error_type:m},cover_type:g,time:f,is_subscription_authorized:b?1:0,is_commercial_authorized:v?1:0,..._}})}function p(e){return(0,a.g)({eventName:"personal_page_material_publish_page_result",params:e})}function d(e){const{action:t,material_category:i,material_type:s,entry_from:l}=e;return(0,a.g)({eventName:"ugc_material_subscription_original_statment",params:{action:t,material_category:i,material_type:s,entry_from:l}})}function m(e){const{action:t,material_category:i,material_type:s,entry_from:l,hasCopyrightAuthorization:r}=e;return(0,a.g)({eventName:"ugc_material_commercial_original_statment",params:{action:t,material_category:i,material_type:s,entry_from:l,..."boolean"==typeof r&&{has_copyright_authorization:r?"1":"0"}}})}function g(e){const{action:t,page_type:i,material_category:s,material_type:l,button_name:r}=e;return(0,a.g)({eventName:"ugc_material_creator_sign_agreement",params:{action:t,page_type:i,material_category:s,material_type:l,...r&&{button_name:r}}})}function f(e){const{caption_template_cnt:t,captionAnimationIds:i=[],text_template_cnt:s,material_type:l,text_special_effect_cnt:r}=e;return(0,a.g)({eventName:"material_tool_click_publish_confirm",params:{caption_template_cnt:t,caption_animation_id:i.join(","),text_template_cnt:s,material_type:l,text_special_effect_cnt:r}})}},48823:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Ae});var a=i(23479),s=i(45599),l=i(50959),r=i(9608),n=i(11527);const o=(0,a.Pi)((e=>{const{className:t}=e,{t:i}=(0,s.$)(),a=(0,l.useMemo)((()=>[{key:"subtitleTemplate",title:i("pc_subtitle_template_description_web"),instructions:[{key:"",title:i("pc_subtitle_template_effect_release_web")}]}]),[]),o=(0,l.useMemo)((()=>()=>"init"),[]);return(0,n.jsx)(r.v,{className:t,groups:a,initGroup:"subtitleTemplate",activeGroup:"subtitleTemplate",resetExpandedGroupKey:"subtitleTemplate",getStatus:o})}));var c=i(26800),u=i(12390),p=i(17641),d=i(84875),m=i.n(d),g=i(36983),f=i(69836),_=i(23073),h=i(66589),b=i(97311),v=i(28706),T=i(45735),S=i(17941),y=i(21919),x=i(42983);function w(e){const{id:t,resourceId:i,isMultiLang:a}=e,s=e.languages.map(((e,t)=>function(e,t){const{lang:i,resourceId:a,templateZipData:s}=e,{coverFile:l,extraJson:r}=s.template;return{lang:i,resourceId:a,templateZipData:s,cover:(0,v.B4)({src:t.needSrc?(0,b.y8)(l):"",file:l}),staticFrame:(0,v.wt)({}),file:(0,h.LO)({...(0,v.Dz)({}),previewTime:0,extraJson:r},{extraJson:h.LO.ref}),publishType:a?"update":"create"}}(e,{needSrc:!0})));return(0,h.LO)({id:t,resourceId:a?i:s[0].resourceId,title:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:(0,S.K)(y.YW.OriginalForSubscription),isHighPriority:!1,isMultiLang:a,languages:s,onlineData:{isOriginal:!1,isVip:!1,isBusiness:!1,resourceId:i,langResourceIds:[],langResourceIdMap:{}}},{onlineData:h.LO.ref})}function F(e){return Boolean(e.title&&e.tags.length&&e.languages[0].staticFrame.src)}function Z(e){return e.languages[0]}const L="root-yJbCk1",C="statusBar-p1WeHS",P=(0,a.Pi)((e=>{const{className:t,subtitleTemplate:i,isSelected:a,onClick:s}=e,l=Z(i),r=!l.staticFrame.src;return(0,n.jsxs)("div",{className:m()(L,t),onClick:()=>{s(i)},children:[(0,n.jsx)(g.Y,{src:r?"":l.cover.src,isInvalid:!1,isSelected:a,size:80,onContextMenu:e=>{e.preventDefault(),s(i)}}),(0,n.jsx)(f.ir,{className:C,loading:r,invalid:!1,errorToolip:"",isInfoComplete:F(i),title:i.title})]})}));var I=i(61022),k=i(84736),U=i(94435),j=i(31086),A=i(8129),N=i(57609),D=i(2514),O=i(539),R=i(46309),E=i(3718),M=i(39486),B=i(86156),z=i(54847),$=i(82725),V=i(86324),H=i(1946);var G=i(35686),q=i(21130),W=i(25807),J=i(84677),X=i(79668),Q=i(2555),K=i(18370),Y=i(74575),ee=i(33372),te=i(9679);function ie(){const e=(0,O.G)({watch:()=>n.isAllUploaded}),t=(0,O.G)({watch:()=>n.isDepUploaded&&!n.isAllUploadedWatcher.isPromptingConfirmToCancel}),i=(0,Y.e)({watch:()=>n.subtitleTemplateList.materials.every((e=>e.languages.every((e=>e.staticFrame.src))))}),a=(0,l.useMemo)((()=>new M.w),[]),{t:r}=(0,s.$)(),n=(0,I.fv)((()=>({formApi:null,setFormApi:e=>{n.formApi=e},performanceTimingCollector:(0,K.uY)(),initOp:new B.q({fetchFirstPage:async()=>{z.appModel.isInited||await(0,$.cb)({throwOnError:!0}),n.performanceTimingCollector.addTiming("initFullAppInfoDone");const e=[],t=[],i=[await n.makeInitSubtitleTemplate(e,t)];n.performanceTimingCollector.addTiming("initSubtitleTemplateDone"),(0,A.c6)("[SingleStore] make init flowerText sticker start");const a=e.map((e=>(0,ee.Sv)(e))),s=t.map((e=>(0,ee.wu)(e)));return()=>{n.subtitleTemplateList.replaceByMap(i,(e=>e)),n.flowerTextList.replaceByMap(a,(e=>e)),n.stickers=s;const e=n.subtitleTemplateList.materials[0];n.subtitleTemplateList.select(e),n.initStaticFrame(n.subtitleTemplateList.materials),n.initUploadFiles(),n.performanceTimingCollector.addSetStateTiming(K.Pk)}},slardarErrorLog:(e,t)=>{(0,A.RF)(`[SingleStore] ${e} failed`,t),n.performanceTimingCollector.addSetStateTiming(K.Pk,{scene:"initFailed"})}}),async makeInitSubtitleTemplate(e,t){const i=[],a=(0,H.V)("subtitle-template");(0,A.c6)("[SingleStore] makeInitSubtitleTemplate start",{id:a});const s="en",l=new V.v({id:`${s}-${a}`,effectType:x.Ab.SubtitleTemplate,fetchZipBase64:async()=>{const{zipData:e}=await(0,R.ae)();return e}});await l.init(),i.push({lang:s,resourceId:"",templateZipData:l});for(const r of l.flowerTexts){const t=r.id;e.push({groupId:t,subFlowerTexts:[{lang:s,data:r}]})}for(const r of l.stickers)t.some((e=>e.id===r.id))||t.push(r);return(0,A.c6)("[SingleStore] makeInitSubtitleTemplate done",{id:a}),w({id:a,isMultiLang:!1,resourceId:"",languages:i})},get mainFormLayout(){const{fetchStatus:e}=n.initOp;return e.isFailed?"error":e.hasFetched?"mainForm":"loading"},get needConfirmModalOnClose(){return!0},get field(){return{canBusiness:W.$.permissions.includes(W.v.EffectSetBusiness),canVip:W.$.permissions.includes(W.v.EffectSetVip),canHighPrio:W.$.permissions.includes(W.v.EffectHighPrio)}},pubService:new j.Z,sendLogService:new q.D5({itemType:x.Ab.SubtitleTemplate}),authorSignService:new N.I({signScene:E.d.BusinessArtist}),authFileUploadServiceManager:new D.r({}),isAllUploadedWatcher:e,fileOp:new v.N0({uploadConfigService:a}),subtitleTemplateList:new G.T({}),flowerTextList:new G.T({}),stickers:[],init(){n.initOp.initFetchFirstPage(null)},retryInit(){n.initOp.retryFetchFirstPage()},selectSubtitleTemplateCard(e){n.saveCurrentForm(),n.subtitleTemplateList.select(e),n.flowerTextList.select(null)},selectFlowerTextCard(e){n.saveCurrentForm(),n.flowerTextList.select(e),n.subtitleTemplateList.select(null)},initSubtitleTemplateForm(e){var t;null===(t=n.formApi)||void 0===t||t.setValues({subtitleTemplate:{title:e.title,tags:[...e.tags],isOriginal:e.isOriginal,isVip:e.isVip,isBusiness:e.isBusiness,isHighPriority:e.isHighPriority}})},saveSubtitleTemplateForm(e){var t;const i=null===(t=n.formApi)||void 0===t?void 0:t.getValues().subtitleTemplate;i&&(0,J.L)(e,{title:i.title||"",tags:i.tags,isOriginal:i.isOriginal||!1,isVip:i.isVip||!1,isBusiness:i.isBusiness||!1,isHighPriority:i.isHighPriority||!1})},initFlowerTextForm(e){var t;null===(t=n.formApi)||void 0===t||t.setValues({flowerText:{title:e.title,tags:[...e.tags]}})},applyTagsToAll(e){n.flowerTextList.updateAll((t=>{t.tags=[...e]}))},saveFlowerTextForm(e){var t;const i=null===(t=n.formApi)||void 0===t?void 0:t.getValues().flowerText;i&&(0,J.L)(e,{title:i.title||"",tags:i.tags})},saveCurrentForm(){n.subtitleTemplateList.selected?n.saveSubtitleTemplateForm(n.subtitleTemplateList.selected):n.flowerTextList.selected&&n.saveFlowerTextForm(n.flowerTextList.selected)},initStaticFrameTimer:new Q.B,async initStaticFrame(e){for(const t of e){const{id:e,languages:i}=t;for(let a=0;a<i.length;a+=1){const s=i[a];await n.fileOp.initStaticFrame({id:`${s.lang}-${e}`,getInitIndex:()=>0===a?null:t.languages[0].staticFrame.index,staticFrame:s.staticFrame,templateZipData:s.templateZipData}),await n.initStaticFrameTimer.timeout(100)}}},async initUploadFiles(){try{await a.getUploadConfigs("initUploadFiles")}catch{}for(const e of n.subtitleTemplateList.materials)n.initUploadSubtitleTemplateFiles(e);(0,ee.er)(n.fileOp,{flowerTexts:n.flowerTextList.materials,stickers:n.stickers})},initUploadSubtitleTemplateFiles(e){for(const t of e.languages)n.fileOp.initUploadCover({getCover:()=>t.cover,getInitValues:()=>({id:(0,H.V)("subtitle-template-cover")})})},async retryUpload(){n.depPublishStatus.isCanceled=!1;try{await a.getUploadConfigs("retryUploadFiles")}catch{n.depPublishStatus.isFailed=!0}for(const e of n.subtitleTemplateList.materials)for(const t of e.languages)n.fileOp.retryUpload(t.cover,t.staticFrame,t.file);(0,ee.Id)(n.fileOp,{flowerTexts:n.flowerTextList.materials,stickers:n.stickers})},handleUploadCancel(){t.stop(),i.stop(),n.isAllUploadedWatcher.stop(),n.depPublishStatus.isCanceled=!0},async initUploadStaticFrame(e){await i.start();for(const t of e.languages)n.fileOp.initUploadCover({getCover:()=>t.staticFrame,getInitValues:()=>({id:(0,H.V)("subtitle-template-static-frame"),file:new File([(0,b.Jr)(t.staticFrame.src)],"icon.png",{type:"image/png"})})})},handleStaticFrameChange(e,t){for(const i of e.languages)n.fileOp.updateStaticFrame(i.staticFrame,t)},async publishDeps(){const{subtitleTemplateList:e,flowerTextList:t,stickers:i}=n,a=e.materials[0],s=(0,_.Z)(a,"isVip","isBusiness","isOriginal","isHighPriority"),l=(0,ee.Kl)(t.materials,s),r=(0,ee.Rd)(i,{...s,getTitle:(e,t)=>{const i=String(t+1).padStart(2,"0");return`${a.title}-${i}`}}),o=await n.pubService.batchPublish([...l,...r]),c=(0,ee.Wl)({flowerTexts:n.flowerTextList.materials,stickers:n.stickers}),u=o.map((e=>e.resource_id));return(0,A.c6)("[SingleStore] deps publish success",{resourceIdList:u,depResourceIdMap:c}),{depResourceIdMap:c}},clearSubtitleTemplateZip(){n.fileOp.templateZipCacheMap.clear();for(const e of n.subtitleTemplateList.materials)for(const t of e.languages)n.fileOp.saveTemplateZipCache(e.id,t.lang,t.file)},async initUploadSubtitleTemplateZip(e,t){const{subtitleTemplateList:i}=n;for(const a of i.materials)for(const i of a.languages){const{lang:s,staticFrame:l,templateZipData:r}=i;if(await n.fileOp.initUploadTemplateZip({id:a.id,lang:s,zipFile:i.file,staticFrame:l,templateZipData:r,depResourceIdMap:e,checkIsCanceled:()=>t.isCanceled}),t.isCanceled)return}},depPublishStatus:{isFailed:!1,isCanceled:!1,isDone:!1},async startUploadAndPublishDeps(e){try{for(const e of n.subtitleTemplateList.materials)n.initUploadStaticFrame(e);await t.start();const{depResourceIdMap:i}=await n.publishDeps();if(e.isCanceled)return;await n.initUploadSubtitleTemplateZip(i,e),(0,h.z)((()=>{e.isDone=!0}))}catch(i){(0,h.z)((()=>{e.isFailed=!0})),(0,A.RF)("[SingleStore] startUploadAndPublishDeps failed",i)}},get depUploadStats(){const e={pending:0,succeeded:0,failed:0};for(const t of n.flowerTextList.materials)for(const i of t.subFlowerTexts)(0,v.r)(e,i.cover,i.file);for(const t of n.stickers)(0,v.r)(e,t.cover);return e},get isDepUploaded(){const{pending:e,failed:t}=n.depUploadStats;return!e&&!t},get uploadStats(){const e={uninited:0,...n.depUploadStats};for(const a of n.subtitleTemplateList.materials)for(const t of a.languages)(0,v.r)(e,t.cover,t.staticFrame,t.file);const{isFailed:t,isDone:i}=n.depPublishStatus;return t?e.failed+=1:i?e.succeeded+=1:e.pending+=1,e},get isAllUploaded(){const{pending:e,failed:t}=n.uploadStats;return!e&&!t},get isReadyToPublish(){const{subtitleTemplateList:e,flowerTextList:t}=n;return e.length>0&&e.materials.every((e=>F(e)))&&t.materials.every((e=>(0,ee.QX)(e)))&&!n.isPublishSucceeded},async uploadAndPublish(e){n.saveCurrentForm(),n.sendMaterialToolClickPublishLog(),n.retryUploadAndPublishDeps(),null==e||e.show(),await n.isAllUploadedWatcher.start();try{await n.publish()}finally{null==e||e.hide()}},async retryUploadAndPublishDeps(){n.clearSubtitleTemplateZip(),n.depPublishStatus={isFailed:!1,isCanceled:!1,isDone:!1};const{depPublishStatus:e}=n;await n.retryUpload(),n.startUploadAndPublishDeps(e)},isPublishing:!1,isPublishSucceeded:!1,async publish(){n.isPublishing=!0;try{await n.publishImpl()}catch(e){return k.FN.error(r("pc_sticker_release_failed_retry_web")),(0,h.z)((()=>{n.isPublishing=!1})),void(0,A.RF)("[SingleStore] publish failed",e)}(0,h.z)((()=>{n.isPublishing=!1,n.isPublishSucceeded=!0})),k.FN.info({content:r("pc_subtitle_template_release_successful_check_web",{num:n.subtitleTemplateList.length}),textMaxWidth:"80vw"}),(0,A.c6)("[SingleStore] publish success"),setTimeout((()=>(0,R.gk)({showHomePage:!0})),3e3)},async publishImpl(){const e=n.subtitleTemplateList.materials.map((e=>{const{isMultiLang:t}=e,{authFileUploadServiceManager:i}=n;return e.languages.map((a=>{const s=`${a.lang}-${e.id}`,l=function(e,t){const i=Z(e),a={...(0,_.Z)(e,["title","tags","isHighPriority","isVip","isBusiness","isOriginal"]),...(0,_.Z)(i,"cover","staticFrame","file"),authFiles:t.authFileUploadServiceManager.getUploadedFiles(e.id),baseSource:t.baseSource};return"update"===i.publishType?(0,T.xo)({id:i.resourceId,onlineData:e.onlineData,...a}):(0,T.Ob)({effectType:x.Ab.SubtitleTemplate,templateZipData:i.templateZipData,extraJson:i.file.extraJson,...a})}(e,{authFileUploadServiceManager:i,baseSource:"new_caption_template_tool"===z.appModel.appInfo.currentScene?U.r0.UserPostPcNewTool:U.r0.UserPostPc});return{id:s,req:l,onResult:(0,h.aD)((({req:i,resourceId:l,error:r,errorText:o,time:c})=>{n.sendLogService.sendMaterialPublishStatusLog({time:c,status:r?"fail":"success",error_type:o,publishParams:i,path:""}),r?(0,A.RF)(`[SingleStore] single publish failed {${s}}`,r):(a.resourceId=l,t||(e.resourceId=l),(0,A.c6)(`[SingleStore] single publish success {${s}}`,{resourceId:l}))})),onUpdateResult:(0,h.aD)((({req:e,resourceId:t,error:i,errorText:a,time:l})=>{i?(0,A.RF)(`[SingleStore] single update failed {${s}}`,i):(0,A.c6)(`[SingleStore] single update success {${s}}`,{resourceId:t})}))}}))})).flat();(0,A.c6)("[SingleStore] single publish start",{resourceIdList:e.map((e=>e.id))});const t=(await n.pubService.batchPublish(e)).map((e=>e.resource_id));(0,A.c6)("[SingleStore] single publish done",{resourceIdList:t});n.subtitleTemplateList.materials.some((e=>!e.onlineData.resourceId))?(await n.pubService.pollUntilAllInEffectList({ids:t.slice(-j.f),types:[x.Ab.SubtitleTemplate]}),(0,A.c6)("[SingleStore] poll done")):(0,A.c6)("[SingleStore] no need to poll")},async sendMaterialToolClickPublishLog(){const{subtitleTemplateList:e}=n,t=e.materials.map((e=>{var t;const i=e.languages[0].templateZipData.template.captionAnimationJson;return null!==(t=null==i?void 0:i.caption_animation.map((e=>e.resource_id)).filter((e=>Boolean(e))))&&void 0!==t?t:[]}));(0,A.c6)("[SingleStore] sendMaterialToolClickPublishConfirm",{caption_template_cnt:e.length,captionAnimationIds:t.flat()}),(0,te.SB)({caption_template_cnt:e.length,captionAnimationIds:t.flat(),material_type:"single"})},collectLogData(){const e=["id","uri","isUploadFailed"],t=n.subtitleTemplateList.materials.map((t=>({...(0,_.Z)(t,"id","resourceId","isMultiLang"),languages:t.languages.map((t=>({...(0,_.Z)(t,"lang","resourceId"),cover:(0,_.Z)(t.cover,e),staticFrame:(0,_.Z)(t.staticFrame,[...e,"index"]),file:(0,_.Z)(t.file,e),extraJson:t.file.extraJson})))}))),i=n.flowerTextList.materials.map((t=>({...(0,_.Z)(t,"id","isDepMaterial","sdkVersion"),subFlowerTexts:t.subFlowerTexts.map((t=>({...(0,_.Z)(t,"id","lang","resourceId"),cover:(0,_.Z)(t.cover,e),file:(0,_.Z)(t.file,e)})))}))),a=n.stickers.map((t=>({...(0,_.Z)(t,"id","resourceId","isDepMaterial","isSequence"),cover:(0,_.Z)(t.cover,e)}))),s={subtitleTemplates:t,subtitleTemplateCount:t.length,flowerTexts:i,stickers:a,isReadyToPublish:n.isReadyToPublish,depPublishStatus:{...n.depPublishStatus},uploadStats:{...n.uploadStats}};(0,A.c6)("[SingleStore] collectLogData",s)}})));return(0,X.L)({watch:()=>{n.uploadStats,n.isReadyToPublish},collect:n.collectLogData}),(0,l.useEffect)((()=>(window.store=n,n.init(),n.authorSignService.init(),()=>{n.initStaticFrameTimer.cancel()})),[]),n}const ae=(0,l.createContext)(null),se=()=>(0,l.useContext)(ae);var le=i(73008);const re=(0,a.Pi)((e=>{const{className:t}=e,i=se();return(0,n.jsx)("div",{className:m()(le.Z.root,t),children:(0,n.jsx)("div",{className:le.Z.container,children:i.subtitleTemplateList.materials.map(((e,t)=>(0,n.jsx)(P,{className:le.Z.card,subtitleTemplate:e,isSelected:i.subtitleTemplateList.selectedId===e.id,onClick:i.selectSubtitleTemplateCard},e.id)))})})}));var ne=i(89563);const oe=(0,a.Pi)((e=>{const{className:t}=e,i=se();return(0,n.jsx)("div",{className:m()(le.Z.root,t),children:(0,n.jsx)("div",{className:le.Z.container,children:i.flowerTextList.materials.map(((e,t)=>(0,n.jsx)(ne.M,{className:le.Z.card,flowerText:e,isSelected:i.flowerTextList.selectedId===e.id,onClick:i.selectFlowerTextCard},e.id)))})})}));var ce=i(70252),ue=i(95968),pe=i(37991),de=i(25577),me=(i(74408),i(76199)),ge=i(6858),fe=i(45033),_e=i(53803),he=i(56130);const be="root-pUimlh",ve="cover-UHqwrX",Te="selectStaticFrame-QFz5WO",Se="titleField-ln4TF0",ye="businessCheckbox-GzKVjp",xe="highPriorityWrapper-mVBX2P",we=(0,a.Pi)((e=>{const{subtitleTemplate:t}=e,{t:i}=(0,s.$)(),a=se();(0,l.useLayoutEffect)((()=>a.initSubtitleTemplateForm(t)),[]);const{getDisplayLength:r}=(0,fe._)(),o=Z(t),{openFramePicker:c}=(0,pe.v)(),u=(0,Y.e)({watch:()=>Z(t).staticFrame.list.length>0}),p=Boolean(t.onlineData.resourceId);return(0,n.jsxs)("div",{className:be,children:[(0,n.jsx)(g.Y,{className:ve,src:o.staticFrame.src,isInvalid:!1,isSelected:!1,size:128}),(0,n.jsx)("div",{className:Te,onClick:()=>{c({onOK:e=>a.handleStaticFrameChange(t,e),fetchData:async()=>{await u.start();const{list:e,index:t}=o.staticFrame;return{list:e,index:t}}})},children:i("pc_stickers_release_cover_edit_web")}),(0,n.jsx)(ce.l,{fieldClassName:Se,label:i("pc_text_template_name_n_web"),field:"subtitleTemplate.title",maxLength:40,allowEnter:!1,placeholder:i("pc_stickers_release_xy_name_web",{X:1,Y:r(40)}),rules:[{required:!0,message:""}],onChange:(0,h.aD)((e=>t.title=e))}),(0,n.jsx)(ue.u,{label:(0,n.jsx)("div",{className:he.Z.labelHeader,children:(0,n.jsx)(k.Form.Label,{required:!0,children:i("pc_text_template_tag_settings_web")})}),placeholder:i("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"subtitleTemplate.tags",itemType:x.Ab.SubtitleTemplate,recommendConfig:{title:t.title,uri:o.cover.uri},ignoreAddTagOnBlurSelector:`.${he.Z.applyToAll}`,onChange:(0,h.aD)((e=>t.tags=e))}),!1,(0,n.jsx)(de.Z,{children:(0,n.jsxs)("div",{className:_e.Z.authGroup,children:[(0,n.jsx)(de._,{text:i("pc_template_authorize_range_web")}),(0,n.jsxs)("div",{className:_e.Z.right,children:[(0,n.jsx)(me.l,{noLabel:!0,field:"subtitleTemplate.isVip",sendLogService:a.sendLogService}),(0,n.jsx)(ge.R,{fieldClassName:ye,noLabel:!0,field:"subtitleTemplate.isBusiness",vipField:"subtitleTemplate.isVip",authorSignService:a.authorSignService,getAuthFileUploadService:()=>a.authFileUploadServiceManager.ensure(t.id),sendLogService:a.sendLogService})]})]})}),a.field.canHighPrio&&(0,n.jsx)(de.Z,{className:xe,hiddenFieldLabel:!0,children:(0,n.jsxs)("div",{className:_e.Z.authGroup,children:[(0,n.jsx)(de._,{text:i("pc_text_template_release_settings_web")}),(0,n.jsx)("div",{className:_e.Z.right,children:(0,n.jsx)(k.z8,{noLabel:!0,field:"subtitleTemplate.isHighPriority",disabled:p,children:i("pc_text_template_release_priority_web")})})]})})]})}));var Fe=i(88370);const Ze="topSectionHeader-FDUHM7",Le=(0,a.Pi)((e=>{const{className:t}=e,i=se(),{t:a}=(0,s.$)(),r=(0,c.Z)((()=>{})),o=(0,l.useRef)(null);return(0,u.O)({className:t,layout:i.mainFormLayout,uploadAreaProps:{titleForUploadArea:"",titleForMainForm:a("pc_subtitle_template_add_web"),subTitle:"",draggingTitle:"",draggingDisabled:!0,disabled:!0,disabledTooltip:"",onClick:r,onDrop:r},setFormApi:i.setFormApi,renderImportArea:e=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.S,{className:Ze,title:a("pc_subtitle_template_web",{X:i.subtitleTemplateList.length})}),(0,n.jsx)(re,{}),i.flowerTextList.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.S,{title:a("pc_subtitle_effect_web",{X:i.flowerTextList.length})}),(0,n.jsx)(oe,{})]})]}),renderFormArea:()=>i.subtitleTemplateList.selected?(0,n.jsx)(we,{subtitleTemplate:i.subtitleTemplateList.selected},i.subtitleTemplateList.selectedId):i.flowerTextList.selected?(0,n.jsx)(Fe.p,{flowerText:i.flowerTextList.selected,initFlowerTextForm:i.initFlowerTextForm,applyTagsToAll:i.applyTagsToAll,maxTitleLength:40},i.flowerTextList.selectedId):null,scrollAreaRef:o,onRetry:i.retryInit})}));var Ce=i(38803),Pe=i(36775);const Ie=(0,a.Pi)((e=>{const{className:t}=e,i=se(),{t:a}=(0,s.$)(),r=(0,l.useRef)(null);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Ce.P,{className:t,leftText:"",isPublishDisabled:!i.isReadyToPublish,isPublishing:i.isPublishing,needConfirmModalOnClose:i.needConfirmModalOnClose,onPublish:()=>{i.uploadAndPublish(r.current)},onCancel:()=>(0,R.gk)({showHomePage:!1})}),(0,n.jsx)(Pe.q,{ref:r,uploadStats:i.uploadStats,onRetryUpload:i.retryUploadAndPublishDeps,onCancel:i.handleUploadCancel,onShowUploadFail:()=>{},onPromptConfirmToCancel:i.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var ke=i(12904),Ue=i(65546),je=i(89100);const Ae=(0,a.Pi)((e=>{const t=ie(),{t:i}=(0,s.$)();return(0,ke.F)({title:i("pc_subtitle_template_item_release_web"),pid:"publish-subtitle-template-single"}),(0,Ue.d)(),(0,n.jsx)(ae.Provider,{value:t,children:(0,n.jsxs)("div",{className:je.Z.page,children:[(0,n.jsxs)("div",{className:je.Z.content,children:[(0,n.jsx)(o,{className:je.Z.instruction}),(0,n.jsx)(Le,{className:je.Z.mainForm})]}),(0,n.jsx)(Ie,{className:je.Z.footer})]})})}))},97311:(e,t,i)=>{i.d(t,{C3:()=>n,Jr:()=>l,lm:()=>o,y8:()=>r});var a=i(96706),s=i.n(a);const l=(e,t="image/png")=>{let i=e;e.startsWith("data:")&&(i=e.split(",")[1]);const a=atob(i),s=new Array(a.length);for(let r=0;r<a.length;r++)s[r]=a.charCodeAt(r);const l=new Uint8Array(s);return new Blob([l],{type:t})},r=e=>URL.createObjectURL(e);const n=async e=>{const t=await e.arrayBuffer(),i=new Uint8Array(t);return s()(i)},o=e=>e.toLowerCase().split(".").pop()},48240:(e,t,i)=>{i.d(t,{Z:()=>a});const a={tag:"tag-ZaY7YS",selected:"selected-umR1Vs",disabled:"disabled-A37DzB"}},70498:(e,t,i)=>{i.d(t,{Z:()=>a});const a={block:"block-smxiey",title:"title-aqS4Cg",content:"content-IyBLdN",loading:"loading-QuFv_G",text:"text-ukrQOj"}},9006:(e,t,i)=>{i.d(t,{Z:()=>a});const a={tagSelect:"tagSelect-KEPqcU",dropItem:"dropItem-bpnHuZ",suggestListDropdown:"suggestListDropdown-fV0lMc"}}}]);