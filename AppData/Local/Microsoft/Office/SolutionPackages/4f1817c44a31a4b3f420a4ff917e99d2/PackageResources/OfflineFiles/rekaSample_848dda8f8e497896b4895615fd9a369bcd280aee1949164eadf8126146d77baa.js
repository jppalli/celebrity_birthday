var TypeScriptModule=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=486)}({159:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CustomTypeRegistry=void 0;var n=r(371),i=function(){function e(){this.typeInfos={},this.typeInfosCache=[],this.externalTypes={}}return e.prototype.constuctor=function(e){void 0===e&&(e=!1),this.throwOnError=e},e.prototype.registerTypeInfos=function(e){if(-1===this.typeInfosCache.indexOf(e)){this.typeInfosCache.push(e);for(var t=0,r=Object.keys(e);t<r.length;t++){var n=r[t],i=this.typeInfos[n];i?i!==e[n]&&this.handleError("There are two definitions of the same namespace and interface: ".concat(n)):this.typeInfos[n]=e[n]}}},e.prototype.getTypeInfo=function(e){var t=this.typeInfos[e];if(t)return t;this.handleError('CustomTypeInfo "'.concat(e,'" not registered as a custom types.'))},e.prototype.registerExternalTypeInfos=function(e){for(var t=0,r=Object.keys(e);t<r.length;t++){var n=r[t];this.externalTypes[n]?this.handleError('The external type "'.concat(n,'" is already defined.')):this.externalTypes[n]=e[n]}},e.prototype.getExternalType=function(e){return this.externalTypes[e]},e.prototype.getExternalTypeInfos=function(){return this.externalTypes},e.prototype.validateParsedObj=function(e,t){for(var r=0,i=Object.keys(t);r<i.length;r++){var o=i[r];e[o]=(0,n.verifyType)(this,e[o],t[o])}return e},e.prototype.setThrowOnError=function(e){this.throwOnError=e},e.prototype.handleError=function(e){if(this.throwOnError)throw new Error(e)},e}();t.CustomTypeRegistry=new i},160:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerClasses=t.registerServiceInstance=t.registerClass=t.RekaServiceRegistry=t.RekaInstance=void 0;var n=r(373),i=r(374);function o(e){t.RekaServiceRegistry.registerService({serviceInfo:e.ServiceInfo,factory:function(){return new e}})}function s(e){t.RekaServiceRegistry.registerService({serviceInfo:e.ServiceInfo,factory:function(){return e}})}function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.forEach((function(e){return o(e)}))}t.RekaInstance=new n.CRekaInstance(a,s),t.RekaServiceRegistry=new i.CRekaServiceRegistry(t.RekaInstance),t.registerClass=o,t.registerServiceInstance=s,t.registerClasses=a},161:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventImpl=void 0;var n=function(){function e(e){this.event=e}return e.prototype.unsubscribe=function(){this.event.unsubscribe(this)},e}(),i=function(){function e(e){this.listenerUpdate=e,this.handlers=new Map,this.hasListener=!1}return e.prototype.subscribe=function(e){var t=new n(this);return this.handlers.set(t,e),this.hasListener||this.sendUpdate(!0),t},e.prototype.unsubscribe=function(e){this.handlers.delete(e),this.hasListener&&0===this.handlers.size&&this.sendUpdate(!1)},e.prototype.unsubscribeAll=function(){this.handlers.clear(),this.hasListener&&this.sendUpdate(!1)},e.prototype.trigger=function(e){this.handlers.forEach((function(t,r){return t(e,r)}))},e.prototype.sendUpdate=function(e){this.hasListener=e,this.listenerUpdate(e)},e}();t.EventImpl=i},371:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.verifyType=void 0;var n=r(372);function i(e,t){t&&e.handleError("Type of property does not match type in CustomTypes definition.")}function o(e,t,r,i){for(var o=0,s=Object.keys(t);o<s.length;o++){var a=s[o],c=r[a];if(c){var v=(0,n.readPropertyInfo)(c)[1];t[a]=u(e,t[a],v,i)}else a.startsWith("$")||e.handleError('Property "'.concat(a,'" does not exist in CustomType definition.'))}return t}function s(e,t,r){for(var n=0,i=Object.keys(t);n<i.length;n++){var o=i[n];t[o]=u(e,t[o],r)}return t}function a(e,t,r,i){if(!r)return e.handleError("Unable to generate default value for unregistered type."),t;for(var o=0,s=Object.keys(r);o<s.length;o++){var a=s[o],u=(0,n.readPropertyInfo)(r[a]),v=u[0],f=u[1];if((t.hasOwnProperty(a)||!v)&&void 0===t[a]){var p=c(e,void 0,f,i);void 0!==p&&(t[a]=p)}}return t}function c(e,t,r,n,i){if(void 0===n&&(n=!1),void 0===i&&(i=!1),!n&&!i&&null==t)if("string"==typeof r)switch(r){case"$string":return"";case"$number":return 0;case"$boolean":return!1;case"$any":return;default:return a(e,t={},e.getTypeInfo(r),n)}else{var o=r[0],s=r[1];switch(o){case"$array":return[];case"$indexer":return{};case"$union":return a(e,t={},e.getTypeInfo(s[0]),n)}}return null!=t?t:void 0}function u(e,t,r,n){if(void 0===n&&(n=!1),null!=t)if("string"==typeof r)switch(r){case"$string":i(e,"string"!=typeof t);break;case"$number":i(e,"number"!=typeof t);break;case"$boolean":i(e,"boolean"!=typeof t);break;case"$any":if("object"==typeof t)for(var v=0,f=Object.keys(t);v<f.length;v++){var p=f[v];t[p]=u(e,t[p],r,n)}break;default:var d=e.getTypeInfo(r);return d?(o(e,t,d,n),a(e,t,d,n)):t}else{var y=r[0],h=r[1];switch(y){case"$array":var l=Array.isArray(t);return i(e,!l),l?s(e,t,h):t;case"$indexer":var g=!("object"==typeof t&&Array.isArray(t)||"object"!=typeof t);return i(e,!g),g?s(e,t,h):t;case"$union":var b=function(e,t,r,n){for(var i=0,o=Object.keys(r);i<o.length;i++){var s=o[i],a=!0,c=e.getTypeInfo(r[s]);if(c){for(var u=0,v=Object.keys(t);u<v.length;u++){if(!c[v[u]]){a=!1;break}}if(a)return c}}}(e,t,h);return b?(o(e,t,b,n),a(e,t,b,n)):(e.handleError("Json object is not assignable to any custom type in union."),t);case"$optional":return u(e,t,h),c(e,t,r,n,!0);case"$external":if("object"==typeof t){t=u(e,t,"$any",n);var m=e.getExternalType(h);if(m&&m.parse)return m.parse(t)}}}else t=c(e,t,r,n);return t}t.verifyType=u},372:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readPropertyInfo=void 0,t.readPropertyInfo=function(e){return Array.isArray(e)&&2===e.length&&"opt-field"===e[0]?[!0,e[1]]:[!1,e]}},373:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CRekaInstance=void 0;var n=function(){function e(e,t){this.services={},this.factories={},this.nextNativePromiseId=0,this.nativePromises={},this.nativeBridge=void 0,this.registerClasses=e,this.registerServiceInstanceImpl=t}return e.prototype.initBridge=function(e,t){this.nativeBridge=e,this.registerClasses.apply(this,t),this.nativeBridge.invokeNative({serviceName:"$RekaBridge",methodName:"init",value:"",promiseId:0})},e.prototype.getConstantJson=function(e,t){this.verifyNativeBridgePresent();var r=this.nativeBridge.RekaConstants;if(void 0!==r){var n=r[e];if(void 0!==n){var i=n[t];if(void 0!==i)return i}}throw new Error('Reka native service "'.concat(e,'" must be registered before accessing it\'s constant property "').concat(t,'".')+" This error also happens when the service implementation does not use the generated code from the correct (usually the latest) version of Reka service definition.")},e.prototype.InvokeNative=function(e,t,r){this.verifyNativeBridgePresent(),this.nativeBridge.invokeNative({serviceName:e,methodName:t,value:r,promiseId:0})},e.prototype.InvokeNativeAndReturn=function(e,t,r){var n=this;return new Promise((function(i,o){var s=++n.nextNativePromiseId;n.nativePromises[s]={onSuccess:function(e){return i(e)},onFailure:function(e){return o(e)}},n.nativeBridge?n.nativeBridge.invokeNative({serviceName:e,methodName:t,value:r,promiseId:s}):o("Native bridge is not initialized.")}))},e.prototype.RegisterService=function(e,t){this.factories[e]=t},e.prototype.registerServiceInstance=function(e){this.registerServiceInstanceImpl(e)},e.prototype.invokeJavaScript=function(e){var t=this,r=e.serviceName,n=void 0===r?"":r,i=e.methodName,o=void 0===i?"":i,s=e.value,a=void 0===s?"":s,c=e.promiseId,u=void 0===c?0:c;if("$RekaBridge"===n)return this.invokeJavaScriptBridge(o,a,u);var v=(this.services[n]||(this.services[n]=this.factories[n]())).Invoke(o,a);this.nativeBridge&&v&&v.then&&v.then((function(e){return t.invokeNativeBridge("onSuccess",e,u)}),(function(e){return t.invokeNativeBridge("onFailure",e,u)}))},e.prototype.invokeNativeBridge=function(e,t,r){this.nativeBridge.invokeNative({serviceName:"$RekaBridge",methodName:e,value:t,promiseId:r})},e.prototype.invokeJavaScriptBridge=function(e,t,r){var n=this.nativePromises[r];n&&(delete this.nativePromises[r],n[e](t))},e.prototype.verifyNativeBridgePresent=function(){if(!this.nativeBridge)throw new Error("Native bridge is not initialized.")},e}();t.CRekaInstance=n},374:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CRekaServiceRegistry=t.stringifyJson=t.parseJson=void 0;var n=r(159),i=r(161);function o(e,t){var r=e?JSON.parse(e):[];if(Array.isArray(r))return t?n.CustomTypeRegistry.validateParsedObj(r,t):r;throw new Error("Everything should be an array")}function s(e,t){if("object"==typeof t)for(var r=n.CustomTypeRegistry.getExternalTypeInfos(),i=0,o=Object.keys(r);i<o.length;i++){var s=r[o[i]];if(t instanceof s.typeConstructor){s.stringify&&(t=s.stringify(t));break}}return t}function a(e){if(Array.isArray(e))return 0===e.length?"":JSON.stringify(e,s);throw new Error("Everything should be an array")}function c(e){var t,r,n;if("string"!=typeof e){switch(e[0]){case"FireAndForgetMethod":return[(t=e)[0],void 0,t[1]];case"ReturnsPromiseMethod":return[(r=e)[0],[r[1]],r[2]];case"Event":case"Constant":return[(n=e)[0],[n[1]],void 0]}}return[e,void 0,void 0]}t.parseJson=o,t.stringifyJson=a;var u=function(){function e(e,t){this.service=e,this.methodInfos=t}return e.prototype.Invoke=function(e,t){var r,n,i=c(this.methodInfos[e])[2];try{n=o(t,i)}catch(r){throw new Error("Reka service invocation failed: JSON payload (length=".concat(t.length,") for ").concat(e," is invalid.\nInner exception: ").concat(r.stack))}var s=(r=this.service)[e].apply(r,n);if(s&&s.then)return s.then((function(e){return a([e])}))},e}(),v=function(){function e(e,t){this.service=e,this.methodInfos=t}return e.prototype.Invoke=function(e,t){var r,n=c(this.methodInfos[e])[1];try{r=o(t,n)}catch(r){throw new Error("Reka native service invocation failed: JSON payload (length=".concat(t.length,") for ").concat(e," is invalid.\nInner exception: ").concat(r.stack))}this.service[e].trigger(r[0])},e}(),f=function(){function e(e){this.nativeServices={},this.rekaInstance=e}return e.prototype.registerService=function(e){var t=e.serviceInfo,r=t[0],n=t[1],i=e.factory;this.rekaInstance.RegisterService(r,(function(){return new u(i(),n)}))},e.prototype.getNativeService=function(e){var t=this,r=e[0],n=e[1],s=this.nativeServices[r];if(!s){this.nativeServices[r]=s={};for(var u=!1,f={},p=function(e){var v=c(n[e]),p=v[0],d=v[1];switch(p){case"ReturnsPromiseMethod":s[e]=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return t.rekaInstance.InvokeNativeAndReturn(r,e,a(n)).then((function(e){return o(e,d)[0]}))};break;case"FireAndForgetMethod":s[e]=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return t.rekaInstance.InvokeNative(r,e,a(n))};break;case"Event":s[e]=new i.EventImpl((function(t){t&&s.eventSubscribed(e)})),u=!0;break;case"Constant":Object.defineProperty(s,e,{configurable:!1,enumerable:!0,get:function(){return void 0===f[e]&&(f[e]=o(t.rekaInstance.getConstantJson(r,e),d)[0]),f[e]}})}},d=0,y=Object.keys(n);d<y.length;d++){p(y[d])}u&&(s.eventSubscribed=function(e){t.rekaInstance.InvokeNative("$RekaBridge","createService",r)},this.rekaInstance.RegisterService(r,(function(){return new v(s,n)})))}return s},e}();t.CRekaServiceRegistry=f},486:function(e,t,r){"use strict";r.r(t),r.d(t,"RekaSampleJSServiceImpl",(function(){return v})),r.d(t,"testReka",(function(){return f}));var n=r(88),i=window.OfficeFirstParty,o=null==i?void 0:i.PrivateApi,s=function(){function e(){this.RekaConstants={}}return e.prototype.invokeNative=function(e){o.execute(JSON.stringify(e))},e}();var a=["Experimentation::RekaSampleService",{usePromise:["ReturnsPromiseMethod","$string",["$string"]],useAsyncPromise:["ReturnsPromiseMethod","$string",["$string"]],useJSService:["FireAndForgetMethod",["$string"]],useOnDataEvent:["FireAndForgetMethod",["$string"]],addValues:["ReturnsPromiseMethod","$number",["$number","$number"]],onData:["Event","$string"]}],c=["Experimentation::RekaSampleJSService",{handleMessage:["FireAndForgetMethod",["$string"]]}],u={RekaSampleService:n.RekaServiceRegistry.getNativeService(a)},v=function(){function e(){}return e.prototype.handleMessage=function(e){log("result3: "+e)},e.ServiceInfo=c,e}();function f(){u.RekaSampleService.usePromise("test1").then((function(e){return log("result1: "+e)})),u.RekaSampleService.useAsyncPromise("test2").then((function(e){return log("result2: "+e)})),u.RekaSampleService.useJSService("test3"),u.RekaSampleService.onData.subscribe((function(e,t){log("result4: "+e),t.unsubscribe()})),u.RekaSampleService.useOnDataEvent("test4"),u.RekaSampleService.addValues(42,12).then((function(e){return log("42 + 12 = "+e)}))}window.test_reka=f,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!o)throw"OfficeFirstParty.PrivateApi is not found";n.RekaInstance.initBridge(new s,e),o.onPrivateEvent((function(e){return n.RekaInstance.invokeJavaScript(JSON.parse(e))}))}(v)},88:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataServiceRegistry=t.DataServiceManager=t.EventImpl=t.registerClasses=t.RekaServiceRegistry=t.RekaInstance=t.CustomTypeRegistry=void 0;var n=r(159);Object.defineProperty(t,"CustomTypeRegistry",{enumerable:!0,get:function(){return n.CustomTypeRegistry}});var i=r(160);Object.defineProperty(t,"RekaInstance",{enumerable:!0,get:function(){return i.RekaInstance}}),Object.defineProperty(t,"RekaServiceRegistry",{enumerable:!0,get:function(){return i.RekaServiceRegistry}}),Object.defineProperty(t,"registerClasses",{enumerable:!0,get:function(){return i.registerClasses}});var o=r(161);Object.defineProperty(t,"EventImpl",{enumerable:!0,get:function(){return o.EventImpl}});var s=r(160);Object.defineProperty(t,"DataServiceManager",{enumerable:!0,get:function(){return s.RekaInstance}}),Object.defineProperty(t,"DataServiceRegistry",{enumerable:!0,get:function(){return s.RekaServiceRegistry}})}});
//# sourceMappingURL=rekaSample.js.map