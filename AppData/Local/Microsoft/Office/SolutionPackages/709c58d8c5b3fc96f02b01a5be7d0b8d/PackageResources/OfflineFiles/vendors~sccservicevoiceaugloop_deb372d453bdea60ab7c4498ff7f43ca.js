"use strict";(self.webpackChunkTypeScriptModule=self.webpackChunkTypeScriptModule||[]).push([[1565],{72109:(i,e,t)=>{t.r(e),t.d(e,{LiveRecordingSessionProvider:()=>I,MicrophoneUtilityService:()=>y,VoiceAugloopService:()=>S,VoiceInputTimer:()=>A,VoiceServiceProducer:()=>f});var n=t(79490),o=t(53683),s=t(18532),r=t(92546),c=t(50625),a=t(3034),l=t(11397);class u{constructor(){}static getInstance(){return u.instance||(u.instance=new u),u.instance}setALSession(i){this.alSession=i}getALSession(){return this.alSession}}const h=3,d=5e3;function v(i){return new Promise(((e,t)=>{setTimeout((()=>{e()}),i)}))}var p=t(58651);o.A.dictationSettings={dictationLanguage:"en-US",useAutoPunctuation:"Intelligent",useCorrections:"true",properties:{"SpeechContext-PhraseOutput.interimResults.resultType":"Hypothesis",setFeature:"emailplm,offtrt,copilot",Profanity:"masked","SpeechConfig-Context.DataCollection.Mode":"0"}};class S{constructor(i,e,t){this.speechToTextClient=null,this.voiceSession=null,this.isVoiceSessionActive=!1,this.closeConnectionPromise=null,this.locale=null,this.attempt=0,this.fdSpeechClientObserver={onSpeechSessionStarted:i=>(0,n.__awaiter)(this,void 0,void 0,(function*(){try{null!=i&&p.log("Transcription speech session ID: ",i.speechSessionId)}catch(i){this.onError(i)}})),onSpeechSessionStopped:()=>{this.speechEventEmitter.emit("SpeechSessionStopped")},onFinalText:i=>this.OnFinalResult(i),onFragmentText:i=>this.OnPartialResult(i),onSpeechRecognitionStarted:()=>{},onError:i=>{if(-1==(null==i?void 0:i.toString().indexOf("ErrorAugloopActivateAnnotations"))||this.attempt>=3)try{if(i===s.J.ErrorAudioCaptureAsync||i===s.J.ErrorAudioDevicesNotFoundError||i===s.J.ErrorAudioNotReadableError||i===s.J.ErrorAudioPermissionDeniedError)return;const e=new Error("IAugloopSpeechObserverDecorator.onError: ");this.onError(e)}catch(i){this.onError(i)}},onSpeechEnd:()=>{},onEventUpdate:i=>{},showDictationWarning:()=>{},onWarning:i=>{},showPermissionPrompt:()=>{}},this.locale=t,this.onError=i=>{throw i},this.onAudioBuffer=i=>{},this.initPromise=this.PerformInitializeConnection(),this.speechEventEmitter=new l.EventEmitter,this.onTranscriptText=i,this.onTranscriptPartialText=e,o.A.dictationSettings.dictationLanguage=this.locale}PerformInitializeConnection(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){var i;yield this.InitializeSpeechToTextClient(),this.voiceSession=new r.Jv(void 0,this.fdSpeechClientObserver,!0,void 0,void 0,a.A.Dictation,null===(i=u.getInstance())||void 0===i?void 0:i.getALSession())}))}SetAudioBufferCallback(i){this.onAudioBuffer=i}SetErrorCallback(i){this.onError=i}InitializeConnection(i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.attempt=0,this.locale=i,this.initPromise}))}StartMicrophone(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.ResumeConnection()}))}ResumeConnection(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(this.isVoiceSessionActive)return Promise.resolve();if(yield this.initPromise,this.isVoiceSessionActive=!0,null==this.locale)throw new Error("Reached resume connection without a locale. Did we really initilize AugloopRealTimeTranscriptionConnection?");o.A.dictationSettings.dictationLanguage=this.locale,yield this.voiceSession.startVoiceSessionFromMicrophoneInput((i=>this.OnAudioBufferCallback(i)),null,null)}))}PauseConnection(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!this.isVoiceSessionActive)return Promise.resolve();yield this.initPromise,this.isVoiceSessionActive=!1,yield this.voiceSession.stopMicrophoneInputAsync(),yield this.voiceSession.stopVoiceSession()}))}CloseConnection(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return null!=this.closeConnectionPromise||(this.closeConnectionPromise=new Promise(((i,e)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){try{this.voiceSession&&(this.voiceSession.endVoiceSession(),this.voiceSession.endVoiceSession(),yield this.WaitForSessionEnd()),this.speechToTextClient&&(yield this.speechToTextClient.uninitializeAsync()),this.closeConnectionPromise=null,i()}catch(i){e(i)}}))))),this.closeConnectionPromise}))}WaitForSessionEnd(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=new Promise(((i,e)=>{setTimeout((()=>{try{this.voiceSession&&this.voiceSession.endVoiceSession(),i()}catch(i){e(i)}}),3e4)})),e=new Promise(((i,e)=>{try{this.speechEventEmitter.once("SpeechSessionStopped",i)}catch(i){e(i)}}));yield Promise.race([i,e])}))}OnFinalResult(i){try{const e=this.locale;if(null==i||null==i)return;const t=i.get(e);p.log("transcript text "+t),this.onTranscriptText(t)}catch(i){this.onError(i)}}OnPartialResult(i){try{const e=this.locale;if(null==i||null==i)return;const t=i.get(e);p.log("RECOGNIZED: "+t),this.onTranscriptPartialText(""+t)}catch(i){this.onError(i)}}InitializeSpeechToTextClient(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){null!=this.closeConnectionPromise&&(yield this.closeConnectionPromise),this.speechToTextClient=new c.mp(void 0,this.fdSpeechClientObserver,!0,!0,!0,a.A.Dictation,u.getInstance().getALSession());let i=0;do{i>0&&(yield v(d)),this.attempt++,yield this.speechToTextClient.initializeAsync([c.qW.PartialResult,c.qW.FinalResult])}while(!this.speechToTextClient.initialized&&i++<h)}))}OnAudioBufferCallback(i){this.onAudioBuffer(i)}}class f{static createInstance(i,e,t){null==this.instance&&(this.instance=new S(i,e,t))}static GetInstance(){return this.instance}static destroyInstance(){null!=this.instance&&(this.instance.CloseConnection(),this.instance=null)}}f.instance=null;var C,m=t(58651);class _{constructor(i,e){var t,n;this.voiceAugloopService=i,null===(t=this.voiceAugloopService)||void 0===t||t.SetErrorCallback(e),null===(n=this.voiceAugloopService)||void 0===n||n.SetAudioBufferCallback((i=>this.OnAudioBufferCallback(i)))}Initialize(i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){var e;yield null===(e=this.voiceAugloopService)||void 0===e?void 0:e.InitializeConnection(i)}))}StartMicrophone(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){var i;return null===(i=this.voiceAugloopService)||void 0===i?void 0:i.StartMicrophone()}))}Pause(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){var i;return null===(i=this.voiceAugloopService)||void 0===i?void 0:i.PauseConnection()}))}Resume(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){var i;return null===(i=this.voiceAugloopService)||void 0===i?void 0:i.ResumeConnection()}))}Close(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){var i,e;return yield null===(i=this.voiceAugloopService)||void 0===i?void 0:i.PauseConnection(),null===(e=this.voiceAugloopService)||void 0===e?void 0:e.CloseConnection()}))}OnAudioBufferCallback(i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){m.log("DevLog: OnAudioBufferCallback")}))}}class I{static GetInstance(){return null==this.instance&&(this.instance=new _(f.GetInstance(),(i=>{}))),this.instance}static destroyInstance(){null!=this.instance&&(this.instance.Close(),this.instance=null)}}I.instance=null,function(i){i[i.Completed=0]="Completed",i[i.Canceled=1]="Canceled"}(C||(C={}));class w{constructor(i){this.isCanceled=!1,this.tasks=i}ExecuteTaskListSequentially(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(this.isCanceled)return{status:C.Canceled};let i=null;if(this.tasks)for(const e of this.tasks)try{if(i=yield e(i),this.isCanceled)return{status:C.Canceled}}catch(i){if(this.isCanceled)return{status:C.Canceled};throw i}return{status:C.Completed,result:i}}))}Cancel(){this.isCanceled=!0}}var g=t(58651);class A{static getInstance(){return A._instance||(A._instance=new A),A._instance}startVoiceInputTimer(i,e){this.timerId&&clearTimeout(this.timerId),this.timerId=setTimeout((()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){yield I.GetInstance().Pause(),e(!1),g.log("Voice input timed out")}))),i)}stopVoiceInputTimer(){this.timerId&&clearTimeout(this.timerId)}}class y{constructor(i){this.destroyVoiceInputConnection=()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){f.destroyInstance(),I.destroyInstance()})),u.getInstance().setALSession(i)}static getInstance(i){return y.instance||(y.instance=new y(i)),y.instance}initializeVoiceInputConnection(i,e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(f.createInstance(e,t,i),null==f.GetInstance())throw new Error("Voice connection is null");const o=new w([()=>I.GetInstance().Initialize(i)]);var s;yield(s=o,(0,n.__awaiter)(void 0,void 0,void 0,(function*(){return yield null==s?void 0:s.ExecuteTaskListSequentially()})))}))}pauseRecordingSession(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){yield I.GetInstance().Pause()}))}resumeRecordingSession(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){yield I.GetInstance().Resume()}))}pauseMicInput(i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){yield I.GetInstance().Pause(),i(!1)}))}pauseMicInputAndStopTimer(i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){null!=f.GetInstance()&&(yield this.pauseMicInput(i),this.stopVoiceTimer())}))}stopVoiceTimer(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){A.getInstance().stopVoiceInputTimer()}))}startVoiceInputTimer(i,e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){null!=f.GetInstance()&&A.getInstance().startVoiceInputTimer(i,e)}))}}}}]);
//# sourceMappingURL=vendors~sccservicevoiceaugloop.js.map