"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[84807],{61687:(e,t,n)=>{n.r(t),n.d(t,{WhiteboardLoopComponent:()=>F,loopExport:()=>S});var r=n(65043),o=n(75368),i=n(57833),a=n(9580),s=n(38954);const c=n.p+"static/media/whiteboardIcon.ea1dce1be83f9d980f32d1c08d0f0fa4.svg";var u=n(19813),l=n(97950),d=n(2977),f=function(e){var t=e.iframeRef,n=e.srcUrl,o=e.onLoad,i=e.title;return r.createElement("iframe",{sandbox:"allow-scripts allow-same-origin allow-popups allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-presentation",ref:t,src:n,onLoad:o,title:null!==i&&void 0!==i?i:u.pU,style:{width:"100%",height:"100%",border:"none"}})},p=function(){function e(e,t,n){var r=this;this.iframeOrigin=t,this.runtimeId=n,this.window=e.contentWindow,window.addEventListener("message",function(e){var t;e.data&&"serialized_method_call"===e.data.type&&(r.runtimeId&&e.data.runtimeId&&r.runtimeId!==e.data.runtimeId||null===(t=r.messageHandler)||void 0===t||t.call(r,e.data.data))})}return e.prototype.send=function(e){var t={type:"serialized_method_response",data:e};this.window.postMessage(t,this.iframeOrigin)},e.prototype.setOnMessageReceived=function(e){this.messageHandler=e},e}(),h=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((r=r.apply(e,t||[])).next())})},y=function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"===typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(c){s=[6,c],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},b=function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},m=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};var v=n(27284),g=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),w=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((r=r.apply(e,t||[])).next())})},P=function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"===typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(c){s=[6,c],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},C=function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},F=function(e){function t(t,n){var i=e.call(this)||this;i.providers=n,i.hostKeyboardShortcuts=[],i.giveFocus=function(){return i.setFocus()},i.isComponentFocused=function(){return i.hasFocus()},i.setHostComponentFocusable=function(e){i._hostComponentFocusable=e},i.userActivityEventHandler=function(e){i.emit("userActivity")},i.moveFocusToHost=function(){i.FocusableV2.emit("moveFocusToHost"),i._hostComponentFocusable&&i._hostComponentFocusable.ComponentFocusable.giveFocus()};var a=t.creationData;return a&&a.dataType===o.kW&&(i.existingUrl=a.data.url,i.initializedUrlPromise=Promise.resolve(i.existingUrl)),i.iframeRef=r.createRef(),i.isFocused=!1,i.runtimeId=window.crypto.randomUUID(),i}return g(t,e),Object.defineProperty(t.prototype,"KeyboardShortcutEmitter",{get:function(){return this},enumerable:!1,configurable:!0}),t.prototype.setShortcuts=function(e){this.hostKeyboardShortcuts=e},Object.defineProperty(t.prototype,"RenderStageEmitter",{get:function(){return this},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ComponentFocusable",{get:function(){return this},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"UserActivityProvider",{get:function(){return this},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ComponentProperties",{get:function(){return this},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return u.pU},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iconUrl",{get:function(){return c},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"experienceType",{get:function(){return"Collaborative"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ComponentTelemetryMetadata",{get:function(){return this},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"entityName",{get:function(){return u.tG},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"LoopComponentUrl",{get:function(){return this},enumerable:!1,configurable:!0}),t.prototype.getLoopComponentUrl=function(){return w(this,void 0,void 0,function(){return P(this,function(e){return[2,this.initializedUrlPromise]})})},Object.defineProperty(t.prototype,"Disposable",{get:function(){return this},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){return w(this,void 0,void 0,function(){return P(this,function(e){return this.urlMessageHandler&&window.removeEventListener("message",this.urlMessageHandler),[2]})})},Object.defineProperty(t.prototype,"HTMLViewable",{get:function(){return this},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"HTMLView",{get:function(){return this},enumerable:!1,configurable:!0}),t.prototype.getView=function(){return w(this,void 0,void 0,function(){return P(this,function(e){return[2,this.HTMLView]})})},t.prototype.render=function(e,t){return w(this,void 0,void 0,function(){var t,n,o,s,c,u,v,g,w,C,F=this;return P(this,function(P){switch(P.label){case 0:return t=(0,i.p)("visualReady",this),n=(0,i.p)("fullUIReady",this),t.start(),n.start(),this.iframeReadyPromise=new Promise(function(e,n){var r=function(n){n.data&&"iframe_ready"===n.data.type&&(n.data.runtimeId&&n.data.runtimeId!=F.runtimeId||(F.iframeReadyMessageHandler&&(window.removeEventListener("message",F.iframeReadyMessageHandler),F.iframeReadyMessageHandler=void 0,t.end()),e()))};F.iframeReadyMessageHandler=r,window.addEventListener("message",r)}),this.setupHostingElementSize(e),o=this,[4,this.getDependencyPromise()];case 1:return o.dependencies=P.sent(),s=this.getWhiteboardOrigin(null===(w=this.dependencies.settingsProvider)||void 0===w?void 0:w.audience),c=s.originUrl,u=s.whiteboardRing,(v=null===(C=this.existingUrl)||void 0===C?void 0:C.toString())||this.setupUrlInitializationPromise(),g=!1,window.addEventListener("message",function(e){var t,r=e.data,o=r.type,i=r.message;if("board-rendered"===o&&n.end(),"keyPress"===o)if("ctrlF6"===i){var s=new KeyboardEvent("keydown",{key:"F6",code:"F6",ctrlKey:!0,bubbles:!0,cancelable:!0}),c=null===(t=F.hostKeyboardShortcuts)||void 0===t?void 0:t.find(function(e){return(0,a.X)(s,e)}),u=null===c||void 0===c?void 0:c.handler;u&&u(s)}else"escape"===i&&F.moveFocusToHost();"userActivity"!==o||g||(F.userActivityEventHandler(i),g=!0)}),function(e,t,n,o,i,a,s,c){var u=this;function v(e){var t=(new TextEncoder).encode(e),n=btoa(String.fromCharCode.apply(String,m([],b(t),!1)));return encodeURIComponent(n)}var g=a?v(a):void 0,w=v(window.location.origin),P=null!==s&&void 0!==s?s:"https://whiteboard.office.com",C=c?"ring=".concat(c):"",F="".concat(P,"/fluid-embedded-iframe").concat(g?"/".concat(g):"","?parent_origin=").concat(w,"&").concat(C,"&runtimeId=").concat(o);l.render(r.createElement(f,{iframeRef:t,srcUrl:F,onLoad:function(e){return h(u,void 0,void 0,function(){var t,r,a;return y(this,function(s){switch(s.label){case 0:return t=e.currentTarget,[4,i];case 1:return s.sent(),r=(0,d.C)(n,new p(t,P,o)),a={type:"iframe_initialization",initializationParams:{serializedHostDependencies:r}},t.contentWindow.postMessage(a,P),[2]}})})}}),e)}(e,this.iframeRef,{tokenProvider:this.dependencies.tokenProvider,userContext:this.dependencies.userContext,odspFileInfo:this.dependencies.odspFileInfo,whiteboardMessageProvider:this.dependencies.whiteboardMessageProvider,whiteboardConfiguration:this.dependencies.whiteboardConfiguration,telemetryConfig:this.dependencies.telemetryConfig,internationalizationContext:this.dependencies.internationalizationContext,hostCapabilitiesProvider:this.dependencies.hostCapabilitiesProvider},this.runtimeId,this.iframeReadyPromise,v,c,u),[2]}})})},Object.defineProperty(t.prototype,"FocusableV2",{get:function(){return this},enumerable:!1,configurable:!0}),t.prototype.setFocus=function(e){return this.iframeRef.current&&this.iframeRef.current.contentWindow&&(this.iframeRef.current.contentWindow.focus(),this.isFocused=!0),this.isFocused},t.prototype.hasFocus=function(){return this.isFocused},t.prototype.setupHostingElementSize=function(e){e.clientHeight?e.clientHeight<u.ZJ&&(e.style.height="".concat(u.ZJ,"px")):e.style.height="".concat(u.Yr,"px")},t.prototype.getDependencyPromise=function(){return w(this,void 0,void 0,function(){var e,t,n,r,o,i,a,s,c,u,l,d;return P(this,function(f){switch(f.label){case 0:if(!(e=this.providers))throw Error("Missing dependency providers");return[4,Promise.all([e.TokenProvider,e.UserContext,e.SettingsProvider,e.LoopTrustedTypesPolicy,e.OdspFileInfo,e.WhiteboardMessageProvider,e.WhiteboardConfiguration,e.TelemetryConfig,e.InternationalizationContext,e.HostCapabilitiesProvider])];case 1:return t=C.apply(void 0,[f.sent(),10]),n=t[0],r=t[1],o=t[2],i=t[3],a=t[4],s=t[5],c=t[6],u=t[7],l=t[8],d=t[9],[2,{tokenProvider:n,userContext:r,settingsProvider:o,loopTrustedTypesPolicy:i,odspFileInfo:a,whiteboardMessageProvider:s,whiteboardConfiguration:c,telemetryConfig:u,internationalizationContext:l,hostCapabilitiesProvider:d}]}})})},t.prototype.setupUrlInitializationPromise=function(){var e=this;this.initializedUrlPromise=new Promise(function(t,n){var r=!1,o=function(i){if(i.data&&"component_url_initialization"===i.data.type&&(!i.data.runtimeId||i.data.runtimeId==e.runtimeId)&&!r){r=!0;var a=i.data.urlInitializationParams.url;if(!a)return void n(new Error("Failed to initialize Whiteboard component with URL"));window.removeEventListener("message",o),e.urlMessageHandler=void 0,t(new URL(a))}};e.urlMessageHandler=o,window.addEventListener("message",o)})},t.prototype.getWhiteboardOrigin=function(e){var t="whiteboardEnvironmentOverride",n="embedWhiteboardRing",r=null!==e&&void 0!==e?e:"Prod";"Local"!==e&&"Development"!==e||(r="Staging"),localStorage[t]&&["Staging","Prod","Development"].includes(localStorage[t])&&(r=localStorage[t]);var o=this.whiteboardOriginForEnvironment(r),i=this.whiteboardRingForEnvironment(r);return localStorage[n]&&["canary","preview","public","latest"].includes(localStorage[n])&&(i=localStorage[n]),{originUrl:o,whiteboardRing:i}},t.prototype.whiteboardOriginForEnvironment=function(e){switch(e){case"Local":case"Development":return"https://dev.whiteboard.microsoft.com";case"Staging":case"Dogfood":return"https://app.int.whiteboard.microsoft.com";case"DoD":return"https://whiteboard.apps.mil";case"USNat":return"https://whiteboard.eaglex.ic.gov";case"USSec":return"https://whiteboard.microsoft.scloud";default:return"https://whiteboard.office.com"}},t.prototype.whiteboardRingForEnvironment=function(e){switch(e){case"Development":case"Staging":case"Dogfood":return"latest";default:return}},t}(v.EventEmitter),S=new s.p(F,{TokenProvider:"TokenProvider",UserContext:"UserContext",SettingsProvider:"SettingsProvider",LoopTrustedTypesPolicy:"LoopTrustedTypesPolicy",OdspFileInfo:"OdspFileInfo",WhiteboardMessageProvider:"WhiteboardMessageProvider",WhiteboardConfiguration:"WhiteboardConfiguration",TelemetryConfig:"TelemetryConfig",InternationalizationContext:"InternationalizationContext",HostCapabilitiesProvider:"HostCapabilitiesProvider"})}}]);
//# sourceMappingURL=whiteboard-loop-component.f1a18832.chunk.js.map