/*! For license information please see FluidDocumentServiceFactoryContainer.285bf148.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[97160],{30636:(e,t,r)=>{var i,o;r.d(t,{N:()=>o,V:()=>i}),function(e){e.organization="organization",e.users="users",e.anonymous="anonymous",e.default="default"}(i||(i={})),function(e){e.view="view",e.edit="edit"}(o||(o={}))},67866:(e,t,r)=>{r.r(t),r.d(t,{OdspFluidDocumentServiceFactory:()=>w});var i=r(27051),o=r(47373),n=r(60835),s=r(48680),a=r(8088),d=r(48219),c=r(70530);var l=r(92756),u=r(30636),v=r(33788),h=r(29018),g=r(72376),f=r(40635),m=r(74405);class w{get FluidDocumentServiceFactoryProvider(){return this}get Disposable(){return this}dispose(){}get documentServiceFactory(){var e;const t=null===(e=this.hostFluidDocumentServiceFactory)||void 0===e?void 0:e.documentServiceFactory;if(t)return t;throw new Error("Host did not provide an IDocumentServiceFactory")}get getCreateDocumentRequest(){return async e=>{var t,r,s,a,d,c;let l,u;const w=null!==(t=null===(r=this.userContext)||void 0===r?void 0:r.user.upn)&&void 0!==t?t:"",P=null!==(s=null===(a=this.userContext)||void 0===a?void 0:a.displayName)&&void 0!==s?s:"",k=null!==(d=null===(c=this.userContext)||void 0===c?void 0:c.user.id)&&void 0!==d?d:"";try{var U;if(!this.tokenProvider)throw new Error("TokenProvider is not provided");if(!w&&!k)throw new Error("User info is not provided");if(l=this.containerStorageLocationCache.get(this.hostingResolvedUrl.id),l||(l=await async function(e,t){const r=await(0,n.OF)(t,e.siteUrl,e.driveId,e.itemId);return null===r||void 0===r?void 0:r.parentReference}(this.hostingResolvedUrl,this.tokenProvider),l&&this.containerStorageLocationCache.set(this.hostingResolvedUrl.id,l)),!l)throw new Error("Failed to get container storage location");return u=await(async(e,t,r,o,n)=>{const s="CheckDocumentAccess",a=v.m.start(s,o);try{var d;const c=(0,h.$)(t.siteUrl),l={getToken:e=>{if(e){const o=(0,i.A)((0,i.A)({},e),{},{siteUrl:t.siteUrl,driveId:t.driveId,itemId:t.itemId});return r.getToken(["".concat(c,"/files.readwrite.all")],o)}throw Error("Options must be specified")},url:"".concat(c,"/_api/v2.1/drives/").concat(t.driveId,"/items/").concat(t.itemId,"/oneDrive.checkAccess"),tenantId:n,requestInit:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:[{email:e.userPrincipalName,objectId:e.id}]})},retryPolicy:g._9,tokenPolicy:(0,g.N$)(r,!1)},u=o?await(0,f.g)((0,i.A)((0,i.A)({},l),{},{logger:o,nameForLogging:s,getAdditionalProps:async(e,t)=>(0,m.u)(e)})):await(0,f.y)(l),v=await u.result.json();return a.setResult(!0),null===v||void 0===v||null===(d=v.value)||void 0===d||null===(d=d[0])||void 0===d?void 0:d.canWrite}catch(c){throw a.setResult(!1,{errorType:"CheckDocumentAccessError"}),c}})({userPrincipalName:w,name:P,id:k},{siteUrl:l.sharepointIds.siteUrl,driveId:l.driveId,itemId:l.id},this.tokenProvider,this.logger,null===(U=this.userContext)||void 0===U?void 0:U.user.tenantId),u?y(e,{driveId:l.driveId,siteUrl:l.sharepointIds.siteUrl,filePath:p(l.path)},this.settingsProvider):I(e,this.tokenProvider,this.settingsProvider,this.logger)}catch(C){return this.logger&&(0,o.hO)(this.logger,{eventName:"getCreateDocumentRequest"},C),I(e,this.tokenProvider,this.settingsProvider,this.logger)}}}constructor(e,t,r,i){this.hostingResolvedUrl=t,this.containerStorageLocationCache=r,this.logger=i,this.hostFluidDocumentServiceFactory=e.hostDocumentServiceFactory,this.settingsProvider=e.settingsProvider,this.tokenProvider=e.tokenProvider,this.userContext=e.userContext}}function p(e){const t=e.indexOf(":/");if(t<=0)throw new Error("Failed to get path for file creation");return e.slice(t+2)}function y(e,t,r){const o=(0,s.AU)("createAeroLink",!1,r)?void 0:{scope:u.V.organization,role:u.N.edit},n=function(e,t,r,i,o,n){const s=(0,c.wF)(o);return{url:"".concat(e,"?driveId=").concat(encodeURIComponent(t),"&path=").concat(encodeURIComponent(r)).concat(n?"&containerPackageName=".concat((0,c.nb)(n)):"").concat(s?"&".concat(s):""),headers:{[d.U.createNew]:{fileName:i}}}}(t.siteUrl,t.driveId,t.filePath,e,o);return n.headers=(0,i.A)((0,i.A)({},n.headers),{},{[l.d.cache]:!1}),Promise.resolve(n)}async function I(e,t,r,o){const n=await async function(e,t){if(!e)throw new Error("TokenProvider is undefined");if(!t)throw new Error("Logger is undefined");const r=await(0,a.FX)(e,t,"Production");if(!r)throw new Error("UserOneDriveInfo is undefined");return{siteUrl:r.url,driveId:r.driveId}}(t,o);return y(e,(0,i.A)((0,i.A)({},n),{},{filePath:"Loop"}),r)}}}]);
//# sourceMappingURL=FluidDocumentServiceFactoryContainer.285bf148.chunk.js.map