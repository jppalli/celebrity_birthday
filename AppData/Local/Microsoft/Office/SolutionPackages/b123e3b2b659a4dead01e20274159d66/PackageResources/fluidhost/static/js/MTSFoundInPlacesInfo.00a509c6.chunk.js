"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[35848],{30946:(e,t,r)=>{function n(e){const t=btoa(e);return t.replace(/(\+|\/|\=)/g,e=>{if("+"===e)return"-";if("/"===e)return"_";if("="===e)return"";throw new TypeError("Unexpected match ".concat(e," encountered in urlEncodeBase64String. Only +/= are to be replaced."))})}r.d(t,{A7:()=>o,x7:()=>s});var i=r(60835);async function o(e,t,r){const{siteUrl:n,driveId:o,fileId:a}=t,d=await(0,i.sN)(e,n,o,a,r);if(!d)throw new Error("Failed to fetch file sharepoint ids");return s(d,a)}function s(e,t){const{siteId:r,webId:i,listId:o}=e;return"SPO_".concat(n("".concat(r,",").concat(i,",").concat(o)),"_").concat(t)}},37097:(e,t,r)=>{r.d(t,{cC:()=>u,dm:()=>p});var n=r(27051),i=r(33788),o=r(29018),s=r(25969),a=r(72376),d=r(40635),c=r(74405),l=r(30946);async function u(e,t,r,u,p,m){let h=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const g="GetFilePreviewMetadataResponse",f=i.m.start(g,p),I=(0,o.$)(t),v={getToken:i=>{if(i){const o=(0,n.A)((0,n.A)({},i),{},{siteUrl:t,driveId:r,itemId:u});return e.getToken((0,s.K)(I),o)}throw Error("Options must be specified")},url:"".concat(I,"/_api/v2.0/drives/").concat(r,"/items/").concat(u,"?$select=lastModifiedDateTime,lastModifiedBy,name,title,alternateFileIconUrl").concat(h?",sharepointIds":""),tenantId:m,requestInit:{method:"GET"},retryPolicy:a._9,tokenPolicy:(0,a.N$)(e)},w=p?(0,d.g)((0,n.A)((0,n.A)({},v),{},{logger:p,nameForLogging:g,doNotLogOnSuccess:!0,getAdditionalProps:async e=>(0,c.u)(e)})):(0,d.y)(v);let y;try{y=(await w).result,f.setResult(!0)}catch(k){return void f.setResult(!1,void 0,k)}if(y.ok)try{const e=await y.json();return{lastModified:{dateTime:new Date(e.lastModifiedDateTime),user:e.lastModifiedBy.user.displayName||e.lastModifiedBy.user.email},title:e.title||e.name.substring(0,e.name.lastIndexOf(".")),pageIcon:e.alternateFileIconUrl,pageCover:e.pageCover,spoId:h?(0,l.x7)(e.sharepointIds,u):void 0}}catch(k){f.setResult(!1,void 0,k)}else try{const e=await y.json();return{statusCode:y.status,errorMessage:"".concat(e.error.code).concat(e.error.innerError?" (".concat(e.error.innerError,")"):"",": ").concat(e.error.message)}}catch(k){f.setResult(!1,void 0,k)}}function p(e){return void 0===e||"errorMessage"in e}},42103:(e,t,r)=>{r.r(t),r.d(t,{MTSFoundInPlacesInfo:()=>W});var n=r(27051),i=r(99671),o=r(83125),s=r(33788),a=r(48680),d=r(46624);const c=r(47373).hO;var l=r(37097),u=r(53948),p=r(2953),m=r(53383);function h(e){let t="Prod";if(e)switch(e.audience){case"Development":t="Development";break;case"Staging":t="Staging";break;case"Dogfood":t="Dogfood";break;case"Preview":t="Preview";break;case"Production":default:t="Prod";break;case"GCC":t="Gcc";break;case"GCC-High":t="GccHigh";break;case"DoD":t="DoD"}return t}async function g(e){const{backlink:t,logger:r,settingsProvider:n,tokenProvider:i}=e,o=(0,u.f1)(t.page_id),s=await(0,l.cC)(i,"https://".concat(o.siteDomain),o.driveId,o.itemId,r);if((0,l.dm)(s))return;const a=function(e,t,r){const n={u:e,r:!1},i={w:t?{u:(0,u.xo)(t),r:!1}:void 0,p:n},o=(0,p.M8)(i),s=h(r),a=(0,m.qh)(s,"v2");return"".concat(a).concat(o)}((0,u.xo)(t.page_id),t.workspace_id,n);return{icon:s.pageIcon,title:s.title,url:a}}var f=r(30946),I=r(17107),v=r(17601),w=r(40635),y=r(76899),k=r(46507),P=r(51238);async function U(e){const{existingFileInfo:t,documentPodId:r,tokenProvider:i}=e,o=t?await(0,f.A7)(i,t):"",s="fileId=".concat(null!==r&&void 0!==r?r:o);return await _((0,n.A)((0,n.A)({},e),{},{urlParams:s,subErrorName:"FluidLoopComponent"}))}async function _(e){const{settingsProvider:t,subErrorName:r,userContext:n,logger:i,tokenProvider:o,urlParams:s}=e,a=t?t.audience:"Production",d=(0,k.l)(a),l=(0,I.O)(a),u="".concat(d,"/recommended/api/beta/loop/sharedlocations?").concat(s),p=E(u,o,t),m=b(t),h=i&&n?await(0,v.k)({url:u,requestInit:m,scopes:l,retryPolicy:I.B,logger:i,nameForLogging:"MTSFoundInPlaces",user:n.user,tokenProvider:o}):await(0,w.y)(p);return await h.result.json().then(e=>{if(x(e))return e;throw new Error("Invalid MTS response")}).catch(e=>{i&&c(i,{eventName:"MtsApiJsonParsingError",subErrorName:r},e)})}const b=e=>{var t;return{method:"GET",headers:{"Client-Request-Id":(0,P.A)(),"X-Office-Application":"300","X-Office-AudienceGroup":null!==(t=null===e||void 0===e?void 0:e.audience)&&void 0!==t?t:"","X-Office-Platform":(0,y.Fr)()?"Mobile":"Web"}}},E=(e,t,r)=>({getToken:e=>{if(e){const n=r?r.audience:"Production",i=(0,I.O)(n);return t.getToken(i,e)}throw Error("Options must be specified")},url:e,requestInit:b(r),retryPolicy:I.B}),x=e=>"object"===typeof e&&null!==e&&e.hasOwnProperty("sharing_history")&&Array.isArray(e.sharing_history),A=0,T=1,M=2,C=3,R=4,F=5,O=6,D=7;function N(e,t){switch(e){case void 0:case A:return{host:"Outlook",location:"Email"};case T:return{host:"Teams",location:"Chat"};case M:return{host:"Outlook",location:"Calendar"};case C:return{host:"Teams",location:"Channel"};case R:case F:return{host:"Loop",location:"Workspace"};case O:switch(t){case"Word":return{host:"Word",location:"other"};case"Whiteboard":return{host:"Whiteboard",location:"other"};case"Fluid":return{host:"Loop",location:"Page"};default:return{host:"other",location:"other"}}case D:return{host:"Loop",location:"Page"};default:return{host:"other",location:"other"}}}var L=r(13379);var S=r(60980),j=r(78010),G=r(45296);async function q(e,t,r){var n;if(void 0===t)return;let i;if("string"===typeof t){const n=await async function(e,t,r){try{return await(0,S.j)(e,t,r)}catch(n){return}}(t,e,r);i=n?{odspItem:{siteUrl:n.siteUrl,driveId:n.driveId,itemId:n.itemId},fileName:n.fileName}:void 0}else{const n=await async function(e,t,r){try{const n=r?await(0,j.N)(e,t,r):void 0;return null===n||void 0===n?void 0:n.name}catch(n){return}}(t,e,r);i={odspItem:t,fileName:n}}if(void 0===(null===(n=i)||void 0===n?void 0:n.odspItem))return;const o=function(e){const t=e.fileName,r=e.odspItem;if(void 0===t||!B(t))return;const n={siteDomain:new URL(r.siteUrl).hostname,driveId:r.driveId,itemId:r.itemId};return(0,u.an)(n)}(i);return{odspItem:i.odspItem,podId:o}}const B=e=>{const t=(0,G.Q)(e).toLowerCase();return"loop"===t||"fluid"===t};class W{constructor(e,t,r,n){this.tokenProvider=e,this.settingsProvider=t,this.logger=r,this.userContext=n,this.logger&&(this.logger=new o.p("MTSFoundInPlacesInfo",this.logger))}get FoundInPlacesInfo(){return this}async getFoundInPlaces(e){const t=s.m.start("GetFoundInPlaces",this.logger);try{var r;let o;try{o=(0,i.Mh)(new URL(e))}catch(n){throw new Error("InvalidComponentUrlError")}const s=await q(this.tokenProvider,null!==o&&void 0!==o?o:e,this.logger),a=await this.getMTSFoundInPlacesResponse(this.tokenProvider,null!==(r=null===s||void 0===s?void 0:s.odspItem)&&void 0!==r?r:e,this.logger,null===s||void 0===s?void 0:s.podId),d=await this.transformMTSResponse(null!==a&&void 0!==a?a:{},null===s||void 0===s?void 0:s.odspItem);return t.setResult(!0),d}catch(n){return t.setResult(!1,{errorType:"GetFoundInPlacesFailed",isUserImpacting:!0},n),{places:[]}}}async getMTSFoundInPlacesResponse(e,t,r,i){const o=r||this.logger,s={tokenProvider:e,logger:o,settingsProvider:this.settingsProvider,userContext:this.userContext};let a;return i?a=await U((0,n.A)((0,n.A)({},s),{},{documentPodId:i})):"string"===typeof t?a=await async function(e){const{documentUrl:t}=e,r="externalUrl=".concat(t);return await _((0,n.A)((0,n.A)({},e),{},{urlParams:r,subErrorName:"FluidNonLoopComponent"}))}((0,n.A)((0,n.A)({},s),{},{documentUrl:t})):t&&(a=await U((0,n.A)((0,n.A)({},s),{},{existingFileInfo:{siteUrl:t.siteUrl,driveId:t.driveId,fileId:t.itemId}}))),void 0===a&&o&&c(o,{eventName:"MtsApiResponseUndefinedError"}),a}async transformMTSResponse(e,t){if(void 0===e.sharing_history)return{places:[]};const r=e.sharing_history.map(async e=>{let r;if(function(e){return(e.sharing_medium===R||e.sharing_medium===F)&&e.hasOwnProperty("workspace")}(e)){const{host:n,location:i}=N(e.sharing_medium),{title:o,url:s}=function(e,t,r){const{title:n,mfs_info:i}=e,o=i.pod_id,s=(0,u.f1)(o),a=h(r);return{title:n,url:t?(0,L.a)({page:{siteOrigin:t.siteUrl,driveId:t.driveId,itemId:t.itemId},pageWorkspaceContext:{driveId:s.driveId,itemId:s.itemId}},a):void 0}}(e.workspace,t);r={host:n,location:i,subject:o,url:s}}else if(function(e){return e.sharing_medium===O&&e.hasOwnProperty("file")}(e)){const{host:t,location:n}=N(e.sharing_medium,e.file.type),{title:i}=e.file;r={host:t,location:n,subject:i,url:e.sharing_reference_url}}else if(function(e){return e.sharing_medium===D&&e.hasOwnProperty("backlink")}(e)&&this.includeBacklinksInList()){const{host:t,location:n}=N(e.sharing_medium),i=await g({backlink:e.backlink,tokenProvider:this.tokenProvider,logger:this.logger});r=i?{host:t,location:n,subject:i.title,url:i.url,icon:i.icon}:void 0}else if(function(e){return(e.sharing_medium===A||e.sharing_medium===M||e.sharing_medium===T||e.sharing_medium===C||void 0===e.sharing_medium)&&e.hasOwnProperty("sharing_reference_url")}(e)){var n,i,o,s,a;const{host:t,location:d}=N(e.sharing_medium);r={host:t,location:d,subject:e.teams_name&&e.teams_channel_name?"".concat(e.teams_name," / ").concat(e.teams_channel_name):null!==(n=e.subject)&&void 0!==n?n:"",createdDate:e.shared_time?new Date(e.shared_time):void 0,url:e.sharing_reference_url,author:{name:null!==(i=null===(o=e.sharer)||void 0===o?void 0:o.display_name)&&void 0!==i?i:"",email:null===(s=e.sharer)||void 0===s?void 0:s.smtp},collaborators:null===(a=e.participants)||void 0===a?void 0:a.map(e=>({name:e.display_name,email:e.smtp}))}}return r});return{places:(await Promise.all(r)).filter(e=>void 0!==e)}}includeBacklinksInList(){var e;if(void 0===this.settingsProvider)return!1;let t=(0,a.AU)("loopApp.sharelinkBacklinkUXConvergence",!1,this.settingsProvider);return(null===(e=this.userContext)||void 0===e?void 0:e.user.tenantId)===d.DR&&(t=t&&(0,a.AU)("loopApp.msabacklinks",!1,this.settingsProvider)),t}}},60980:(e,t,r)=>{r.d(t,{j:()=>m});var n=r(27051),i=r(40635),o=r(74405),s=r(25969),a=r(72376),d=r(78796),c=r(18206),l=r(46624);const u=["files.readwrite.all"],p="https://graph.microsoft.com/v1.0";async function m(e,t,r){var m,h;const g=new URL(e),f=g.origin,I="Consumer"===t.identityType&&f===d.W,v=btoa(g.toString()).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,""),w=I?p:"".concat(f,"/_api/v2.0"),y={getToken:e=>{if(e){const r=(0,n.A)((0,n.A)({},e),{},{siteUrl:f});return t.getToken(I?u:(0,s.K)(f),I?e:r)}throw Error("Options must be specified")},url:"".concat(w,"/shares/u!").concat(v,"/driveItem?select=id,name,parentReference,sharepointIds,package,folder,lastModifiedDateTime"),requestInit:{method:"GET",headers:{Prefer:"redeemSharingLink"}},retryPolicy:I?c.XM:a._9,tokenPolicy:I?void 0:(0,a.N$)(t)},k=r?(0,i.g)((0,n.A)((0,n.A)({},y),{},{logger:r,nameForLogging:"getOdspItemWithSharepointIdsFromLink",doNotLogOnSuccess:!0,getAdditionalProps:async(e,t)=>(0,o.u)(e)})):(0,i.y)(y),P=await(await k).result.json();if(I)return function(e,t){if(!e.id)throw new Error("Unexpected response: missing id");if(!e.parentReference.driveId)throw new Error("Unexpected response: missing driveId");if(!e.name)throw new Error("Unexpected response: missing name");return{itemId:e.id,driveId:e.parentReference.driveId,siteUrl:t,fileName:e.name,listId:"",listItemId:"",siteId:"",webId:"",listItemUniqueId:"",tenantId:l.DR,title:"",package:e.package,folder:e.folder,lastModifiedDateTime:(null===e||void 0===e?void 0:e.lastModifiedDateTime)||void 0}}(P,f);if(null===(m=P.sharepointIds)||void 0===m||!m.siteUrl)throw new Error("Unexpected response: missing sharepointIds.siteUrl");if(null===(h=P.parentReference)||void 0===h||!h.driveId)throw new Error("Unexpected response: missing parentReference.driveId");if(!P.id)throw new Error("Unexpected response: missing id");return function(e){if("object"!==typeof e)throw new Error("Unexpected response");if(!e.id)throw new Error("Unexpected response: missing id");if(!e.parentReference.driveId)throw new Error("Unexpected response: missing driveId");if(!e.name)throw new Error("Unexpected response: missing name");const{sharepointIds:t}=e;if(!t)throw new Error("Unexpected response: missing sharepointIds");const{listId:r,listItemId:n,siteId:i,webId:o,siteUrl:s,listItemUniqueId:a,tenantId:d}=t;if("string"!==typeof r)throw new Error("Unexpected response: missing sharepointIds.listId");if("string"!==typeof n)throw new Error("Unexpected response: missing sharepointIds.listItemId");if("string"!==typeof i)throw new Error("Unexpected response: missing sharepointIds.siteId");if("string"!==typeof o)throw new Error("Unexpected response: missing sharepointIds.webId");if("string"!==typeof s)throw new Error("Unexpected response: missing sharepointIds.siteUrl");if("string"!==typeof a)throw new Error("Unexpected response: missing sharepointIds.listItemUniqueId");if("string"!==typeof d)throw new Error("Unexpected response: missing sharepointIds.tenantId");return{driveId:e.parentReference.driveId,siteUrl:s,itemId:e.id,listId:r,listItemId:n,siteId:i,webId:o,listItemUniqueId:a,tenantId:d,fileName:e.name,title:e.title,package:e.package,folder:e.folder,lastModifiedDateTime:(null===e||void 0===e?void 0:e.lastModifiedDateTime)||void 0}}(P)}}}]);
//# sourceMappingURL=MTSFoundInPlacesInfo.00a509c6.chunk.js.map