"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[8010],{38664:(s,e,t)=>{t.r(e),t.d(e,{PermissionsModule:()=>d});var i=t(58355),r=t(81576),n=t(69632),o=t(64805),a=t(54320),c=t.n(a),l=t(74844),u=t(98502),h=t(82841);class d extends o.J{get name(){return"PermissionsModule"}async fetchContainerPermissionsAsync(s){var e;this.loggers.traceLogger.logTrace(507897048,l.k.Verbose,"Batch Fetch Container Permissions [permissionsToFetch=".concat(s,"]"));const t=await this.webApiProviders.taskService(),r=[];for(const i of s){const{containerId:s,publicationId:e}=i;this.stores.permissionsStore.arePermissionsMissingOrExpired(s,e)&&r.push(t.getContainerPermissionsAsync({containerId:s,publicationId:e}))}if(0===r.length)return Promise.resolve([]);const n=await Promise.allSettled(r),o=[];let a;if(n.forEach(s=>{if("fulfilled"===s.status&&null!=s.value)o.push({containerId:s.value.containerId,publicationId:s.value.publicationId,containerPermissions:s.value.containerPermissions,expiry:s.value.expiry});else if("rejected"===s.status){var e,t,i,r;a=s;const n=null!==(e=null===(t=a.reason)||void 0===t||null===(t=t.response)||void 0===t?void 0:t.status)&&void 0!==e?e:0,o=null!==(i=null===(r=a.reason)||void 0===r||null===(r=r.response)||void 0===r?void 0:r.statusText)&&void 0!==i?i:"";this.loggers.traceLogger.logTrace(507897047,l.k.Warning,"Fetch Container Permissions Failed [statusCode=".concat(n,"][statusText=").concat(o,"]"))}}),!c()(o))return this.dispatcher.dispatchAction(new i.D(o)),this.loggers.traceLogger.logTrace(507897046,l.k.Verbose,"Batch Fetch Container Permissions Success [permissionsToFetch=".concat(s,"]")),o;const d=(null===(e=a)||void 0===e?void 0:e.reason)||u.g.generateAjaxClientError(null);return this.loggers.traceLogger.logTrace(507897045,l.k.Warning,"Batch Fetch Container Permissions Failed ".concat((0,h.s8)(d))),Promise.reject(d)}async fetchTaskPermissionsAsync(s){this.loggers.traceLogger.logTrace(507897044,l.k.Verbose,"Batch Fetch Task Permissions [equivalenceSetIds=".concat(s,"]"));const e=await this.webApiProviders.taskService(),t=[],i=[];for(const r of s)this.stores.permissionsStore.areTaskPermissionsMissingOrExpired(r)&&(t.push(e.getTaskPermissionsAsync({equivalenceSetId:r})),i.push(r));if(0===t.length)return[];const o=await Promise.allSettled(t),a=[],c=[];let d;if(o.forEach((s,e)=>{if("fulfilled"===s.status&&null!=s.value)a.push({equivalenceSetId:s.value.equivalenceSetId,taskPermissions:s.value.taskPermissions,expiry:s.value.expiry});else if("rejected"===s.status){var t,r,n,o;c.push(i[e]),d=s;const a=null!==(t=null===(r=d.reason)||void 0===r||null===(r=r.response)||void 0===r?void 0:r.status)&&void 0!==t?t:0,u=null!==(n=null===(o=d.reason)||void 0===o||null===(o=o.response)||void 0===o?void 0:o.statusText)&&void 0!==n?n:"";this.loggers.traceLogger.logTrace(507897043,l.k.Warning,"Fetch Task Permissions Failed [statusCode=".concat(a,"][statusText=").concat(u,"]"))}}),c.length>0&&this.dispatcher.dispatchAction(new r.R(c)),a.length>0&&this.dispatcher.dispatchAction(new n.f(a)),null==d)return this.loggers.traceLogger.logTrace(507897042,l.k.Verbose,"Batch Fetch Task Permissions Success [equivalenceSetIds=".concat(s,"]")),a;{const s=d.reason||u.g.generateAjaxClientError(null);return this.loggers.traceLogger.logTrace(507897041,l.k.Warning,"Batch Fetch Task Permissions Failed: ".concat((0,h.s8)(s))),Promise.reject(s)}}}},58355:(s,e,t)=>{t.d(e,{D:()=>o});var i=t(75992),r=t(86178),n=t.n(r);class o extends i.r{loggingData(){let s=0;for(const e of this.permissionsSets)e.expiry.isBefore(n()())&&s++;return{numPermissionsFetched:this.permissionsSets.length.toString(),numExpiredPermissionsFetched:s.toString()}}constructor(s){if(super(o.actionType),this.permissionsSets=s,this.permissionsSets.length<1)throw new Error("Permissions set has less than 1 entry")}}o.actionType="PLW_BATCH_GET_CONTAINER_PERMISSIONS_SUCCEEDED"},64805:(s,e,t)=>{t.d(e,{J:()=>r});class i{get clientSettings(){return this.clientSettingsProvider()}constructor(s,e,t){this.dispatcher=s,this.clientSettingsProvider=e,this.loggers=t}}class r extends i{getCurrentViewIds(){const s=this.stores.appContextStore.getCurrentViewId();return s?[s]:void 0}constructor(s,e,t,i,r){super(s,i,r),this.webApiProviders=e,this.stores=t}}},69632:(s,e,t)=>{t.d(e,{f:()=>o});var i=t(75992),r=t(86178),n=t.n(r);class o extends i.r{loggingData(){let s=0;for(const e of this.taskPermissionsSets)e.expiry.isBefore(n()())&&s++;return{numTaskPermissionsFetched:this.taskPermissionsSets.length.toString(),numTaskExpiredPermissionsFetched:s.toString()}}constructor(s){if(super(o.actionType),this.taskPermissionsSets=s,this.taskPermissionsSets.length<1)throw new Error("Task Permissions set has less than 1 entry")}}o.actionType="PLW_BATCH_GET_TASK_PERMISSIONS_SUCCEEDED"},81576:(s,e,t)=>{t.d(e,{R:()=>r});var i=t(75992);class r extends i.r{constructor(s){super(r.actionType),this.rejectedEquivalenceSetIds=s}}r.actionType="PLW_BATCH_GET_TASK_PERMISSIONS_FAILED"}}]);
//# sourceMappingURL=permissionmodule.b85c0ef2.chunk.js.map