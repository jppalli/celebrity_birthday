"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[41380],{9821:(e,t,a)=>{a.d(t,{B:()=>n});var s=a(12358),i=a.n(s),r=a(34167),n=function(){function e(){}return e.copyToClipboard=function(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select();var a=document.execCommand("copy");return document.body.removeChild(t),a},e.copyPrettifiedLinkToClipboard=function(e,t){var a=document.createElement("a");a.href=t,a.style.all="initial",a.innerText=e,document.body.appendChild(a);var s=document.createRange();s.selectNode(a);var n=window.getSelection();null===n||void 0===n||n.removeAllRanges(),null===n||void 0===n||n.addRange(s),a.oncopy=function(a){var s,n,o="<a href="+t+' style="all: initial;">'+i()(e)+"</a>";null===(s=a.clipboardData)||void 0===s||s.setData("text/plain",t);var l=new r.tR;l.inputString=o,null===(n=a.clipboardData)||void 0===n||n.setData("text/html",r.xC.sanitize(l)),a.preventDefault()};var o=document.execCommand("copy");return document.body.removeChild(a),o},e}()},12891:(e,t,a)=>{a.r(t),a.d(t,{TaskActionCreator:()=>ze});var s=a(27051),i=a(23835),r=a(7574),n=a(27197),o=a(24367),l=a(75992);class d extends l.r{constructor(e,t,a){super(e),this.actionId=t,this.inverseCallback=a}}class c extends d{loggingData(){return{id:this.deletedTaskEntitySet.id}}constructor(e,t){super(c.actionType,c.actionType+e.id,t),this.deletedTaskEntitySet=e}}c.actionType="PLW_DELETE_TASK_UNDO";class u extends l.r{constructor(e){super(u.undoAction),this.actionId=e}}u.undoAction="UNDO_ACTION";var g=a(32084),h=a(72438),p=a(36591),k=a(38752),v=a(95783),m=a(74844),T=a(78332),f=a(64226),y=a(96891),S=a(27916),w=a(23918),F=a(14983),P=a(91675),C=a(16698),I=a(98990),D=a.n(I),A=a(55491),b=a.n(A),M=a(69108),E=a.n(M),x=function(){function e(){this.taskAttachmentType=F.Er.Other,this.specificType=null,this.videoUrlParseResult={canPlay:!1,embedUrl:"",provider:"Unknown"}}return e.prototype.build=function(){return new B(this)},e.prototype.fromDriveItem=function(e,t){return this.taskAttachmentType=t.fileType,this.taskAttachmentType===F.Er.Other&&e&&(this.specificType=this.getSpecificType(e),this.videoUrlParseResult=C.W.TryParseVideoUrl(e)),this},e.prototype.fromFileName=function(e){var t=F.Er.Other,a=null,s=e.lastIndexOf(".");if(s>-1){var i=e.slice(s+1).toLowerCase();b()(P.t,function(e,a){D()(e,function(e){return e.toLowerCase()===i})&&(t=B.getTaskAttachmentTypeFromString(a))}),E()(F.ig,i)>=0&&(a=i)}return this.specificType=a,this.taskAttachmentType=t,this},e.prototype.withPropertyBag=function(e){return this.taskAttachmentType=e.taskAttachmentType||this.taskAttachmentType,this.specificType=e.specificType||this.specificType,this.taskAttachmentType===F.Er.Other&&e.url&&(null==this.specificType&&(this.specificType=this.getSpecificType(e.url)),this.videoUrlParseResult=C.W.TryParseVideoUrl(e.url)),this},e.prototype.ofDriveItemType=function(e){return this.taskAttachmentType=e,this},e.prototype.getSpecificType=function(e){var t=e.slice((e.lastIndexOf(".")-1>>>0)+2).split(/\#|\?|\&|\s/g);return t.length>0&&E()(F.ig,t[0].toLowerCase())>=0?t[0]:null},e}(),B=function(){function e(e){this.taskAttachmentType=e.taskAttachmentType,this.specificType=e.specificType,this.videoUrlParseResult=e.videoUrlParseResult}return Object.defineProperty(e,"builder",{get:function(){return new x},enumerable:!1,configurable:!0}),e.getTaskAttachmentTypeFromString=function(e){return F.Er[e]?F.Er[e]:F.Er.Other},e}(),O=a(65818),L=a(94772),U=a(95952),R=a(91181),H=a(87952),N=a(82025),G=a(18647),j=a(60653),W=a(71964),V=a(52274),_=a(80708),q=a(39589),X=a(23312),Y=a(40468),Z=a(8403),K=a(56128),z=a(34717),$=a(32561),J=a(97139),Q=a(64696),ee=a(17776),te=a(62687),ae=a(70252),se=a(34648),ie=a(30275),re=a(26566),ne=a(97498);const oe=a.p+"static/media/wl_completion_sound.13a69e47a3545eb5ac81.mp3";var le=a(56434),de=a.n(le),ce=a(50723),ue=a.n(ce),ge=a(40840),he=a.n(ge),pe=a(54320),ke=a.n(pe),ve=a(19853),me=a.n(ve),Te=a(56641),fe=a.n(Te),ye=a(10871),Se=a.n(ye),we=a(28673),Fe=a.n(we),Pe=a(92394),Ce=a.n(Pe),Ie=a(56707),De=a.n(Ie),Ae=a(9821),be=a(79537),Me=a(88880),Ee=a(86053),xe=a(80347),Be=a(9962),Oe=a(39156),Le=a(98424),Ue=a(91246),Re=a(33268),He=a(70776),Ne=a(67271),Ge=a(7670),je=a(98502),We=a(49728),Ve=a(82841);const _e=16,qe="$%@#";function Xe(e){const t=function(e){try{const t=function(e){return t=atob(e.replace(/ /g,"")),t.split("").map(e=>e.charCodeAt(0));var t}(e=e.replace(/_/g,"/").replace(/-/g,"+")),a=Ye(t.slice(0,_e)),s=Ye(t.slice(_e,32));let i=function(e,t){if(null===e||void 0===e||0===e.length)return e;let a=e.length;for(;--a>=0&&!(t.indexOf(e.charAt(a))<0););return e.substr(0,a+1)}(function(e){let t="";for(let a=0;a<e.length;++a)t+=String.fromCharCode(e[a]);return t}(t.slice(32)),".");const r={},n=i.split(qe);if(n.length>1){i=n[0];for(let e=1;e<n.length;e++){const t=n[e].split("=");t&&2===t.length&&(r[t[0]]=t[1])}}return{orgId:a,ownerId:s,tableId:i,moreInfo:r}}catch(t){return{orgId:null,ownerId:null,tableId:null,moreInfo:null}}}(e);let a=!1,s="0";return t.moreInfo&&("g"===t.moreInfo.t&&(a=!0),t.moreInfo.c&&(s=t.moreInfo.c)),{orgId:t.orgId,ownerId:t.ownerId,tableId:t.tableId,isGroupOwner:a,containerId:s}}function Ye(e){if(16!==e.length)return"";let t=function(e){let t="",a="";for(let s=0;s<e.length;s++)a=e[s].toString(16),a=1===a.length?"0"+a:a,t+=a;return t}([].concat(e.slice(0,4).reverse(),e.slice(4,6).reverse(),e.slice(6,8).reverse(),e.slice(8)));return t=t.slice(0,8)+"-"+t.slice(8,12)+"-"+t.slice(12,16)+"-"+t.slice(16,20)+"-"+t.slice(20),t}var Ze=a(45795),Ke=a(21382);class ze extends p.C{get name(){return y.M.TaskActionCreator}async addFormResponseToTask(e,t,a){const s=this.entityStoreSet.taskStore.getTaskDetails(e);if(null==s||null===t)return;const i=de()(s.forms);i[a]=s.forms[a].setProperty("formResponse",t);const r=s.setProperty("forms",i);this.updateTaskDetails(s,r)}async fetchTasksForPlan(e,t,a){const s=await this.logicModuleProviders.planModule(),i=await this.logicModuleProviders.notificationModule();s.fetchPlanAsync(e).then(async()=>{(await this.logicModuleProviders.taskModule()).fetchPlanTasksAsync(e,t).then(async e=>{if(!a)return;const t=[];e.data.Results.forEach(e=>{e.task.getReferencedUserIds().forEach(e=>{-1===t.indexOf(e)&&t.push(e)})});(await this.logicModuleProviders.userModule()).fetchUsersAsync(t)},t=>{i.handleRequestFailures(t,[v.t3.Forbidden],[v.t3.NotFound],f.fc.GetTasksForPlanError,e)})},t=>{i.handleRequestFailures(t,[v.t3.Forbidden],[v.t3.NotFound],f.fc.GetPlanError,e)})}async fetchTaskEntityGroup(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=await this.logicModuleProviders.taskModule(),r=await this.logicModuleProviders.notificationModule();s.fetchTaskAsync(e,t).then(async e=>{(await this.logicModuleProviders.userModule()).fetchUsersAsync(e.task.getReferencedUserIds()).catch(()=>{});const t=e.taskDetails;null!=t&&this.fetchPlanAndContainerBasedDependenciesForTask(e.task,t)}).catch(t=>{if(!(t.error instanceof V.U)&&!a){var s,o;const a=null===(s=t.response)||void 0===s?void 0:s.status,l=null===(o=t.response)||void 0===o?void 0:o.statusText;if(a===v.t3.NotFound){const t=this.entityStoreSet.taskStore.getTask(e);t?(this.dispatcher.dispatchAction(new n.o(_.F.builder.withTask(t).build(),!0)),this.dispatcher.dispatchAction(new i.i(f.fc.TaskNotFoundError,a,l,e,[t.title],void 0,l))):this.dispatcher.dispatchAction(new i.i(f.fc.UnknownTaskNotFoundError,a,l,e,void 0,void 0,l))}else r.handleRequestFailures(t,[],[v.t3.Forbidden],f.fc.GetTaskDetailsError,e)}})}fetchReferencePreviewForTask(e){const t=this.entityStoreSet.taskStore.getTask(e),a=this.entityStoreSet.taskStore.getTaskDetails(e);if(null!==t&&void 0!==t&&t.hasPreview()&&null!=a){var s;const e=null!==(s=null===a||void 0===a?void 0:a.getTaskPreviewReference())&&void 0!==s?s:null;null!=e&&this.ensureTaskReferencePreviewThumbnail(a,e)}}async fetchFormResponseForTask(e,t){let a=null;try{const s=await this.logicModuleProviders.driveItemModule(),i=await s.fetchFormResponse(e,t);if(({ownerId:a}=Xe(i.formId)),!a)return void this.loggers.traceLogger.logTrace(507573833,m.k.Error,"fetchFormResponseForTask - ownerId is null [TaskId=".concat(e,"][FormId=").concat(t,"]"));const r=await this.logicModuleProviders.containerModule(),n=await r.fetchContainer({externalId:null!==a&&void 0!==a?a:"",containerType:O.K.Group},!0);if(!n.unifiedGroupDetails)return void this.loggers.traceLogger.logTrace(507576733,m.k.Error,"fetchFormResponseForTask - unifiedGroupDetails is null [TaskId=".concat(e,"][FormId=").concat(t,"][GroupId=").concat(n.unifiedGroup.id,"]"));s.fetchTaskFormResponseThumbnails(i,n.unifiedGroupDetails)}catch(s){const i=s;this.loggers.traceLogger.logTrace(507576732,m.k.Error,"fetchFormResponseForTask - Failed [TaskId=".concat(e,"][FormId=").concat(t,"][GroupId=").concat(a,"] ").concat((0,Ve.s8)(i)))}}fetchApprovalDetailsForTask(e){this.fetchApprovalDetailsForTaskAsync(e).catch(()=>{})}createTask(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.createTaskAsync(e,void 0,t).catch(()=>{})}createApproval(e,t){this.createApprovalAsync(e,t).catch(()=>{})}copyTask(e,t){this.copyTaskAsync(e,t).catch(e=>{this.loggers.traceLogger.logTrace(507639451,m.k.Error,"Error copying task ".concat((0,Ve.LB)(e)))})}async copyLinkToTask(e){var t;const a=this.entityStoreSet.taskStore.getTask(e);if(this.loggers.usageLogger.logData(this.name,y.M.TaskLinkCopied,{taskCreationSourceType:null!==(t=null===a||void 0===a?void 0:a.taskCreationSourceType)&&void 0!==t?t:""}),null!=this.shareDeepLinkCallback)this.shareDeepLinkCallback(e);else if(null==a)this.loggers.traceLogger.logTrace(507880145,m.k.Error,"copyLinkToTask - task not in store [TaskId=".concat(e,"]"));else{const t=await this.logicModuleProviders.linksModule().catch(()=>null);if(!t)return void this.loggers.traceLogger.logTrace(507531868,m.k.Error,"copyLinkToTask - failed to get LinksModule");let s=t.generateDeepLink(a.planId,e);if(s||(s=Re.wS.generateEntityLink(a,f._n.TaskLink,f.rl.Link,new Date)),s){const t=Ke.G(Ee.p.Strings.Common_PrefixForSmartUrl,Ee.p.Strings.SharedComponents_PlannerAppShortTitle,a.title);if(Ae.B.copyPrettifiedLinkToClipboard(t,s)){const t=new U.N(e,a.title,s);this.dispatcher.dispatchAction(new o.Z(t))}}else this.loggers.traceLogger.logTrace(507561547,m.k.Error,"copyLinkToTask - generated taskLink is null")}}async moveTask(e,t){const a=this.entityStoreSet.taskStore.getTask(e),i=await this.logicModuleProviders.notificationModule();if(null==a)return void i.showErrorInternal(f.fc.MoveTaskError,void 0,void 0,t.plan.id);const r=_.F.builder.withTask(a).withFormatData(this.entityStoreSet.taskStore.getTaskboardTaskFormatting(a.id)||void 0).build();(await this.logicModuleProviders.planModule()).fetchPlanAsync(t.plan.id,!0).then(i=>{this.ensureBucket(t.bucketId,t.plan.id).then(async n=>{t=(0,s.A)((0,s.A)({},t),{},{bucketId:n?n.id:null});const o=await this.logicModuleProviders.taskModule();o.fetchTaskAsync(e).then(()=>{o.fetchPlanTasksAsync(t.plan.id).then(()=>{const e={bucketId:n?n.id:null,plan:t.plan,moveToDifferentContainer:t.moveToDifferentContainer};let s,o,l,d=a.getCloneForMove(e);const c=this.entityStoreSet.viewStore.getCurrentTaskGroupingState(te.t.Plan);switch(c){case T.Yc.Progress:s=this.calculateProgressFormattingForCopyOrMove(a,r.taskFormatData,d);break;case T.Yc.Assignee:o=this.calculateAssignedToFormattingForCopyOrMove(a,r.taskFormatData,d);break;case T.Yc.Bucket:l=this.calculateBucketFormattingForCopyOrMove(a,r.taskFormatData,d);break;case T.Yc.Plan:if(!this.entityStoreSet.appContextStore.getFlights().EnableFixedSortForAtmViews){const e=this.calculateAssigneePriorityForCopyOrMove(a,d);d=d.setProperty("assigneePriority",e)}break;case T.Yc.DueDate:case T.Yc.Category:case T.Yc.Priority:case T.Yc.None:break;default:return void be.f.unreachableCase(c,e=>{this.loggers.traceLogger.logTrace(507880144,m.k.Error,e)})}const u=q._.builder.withPropertyBag({assignedBoardFormat:o,bucketBoardFormat:l,progressBoardFormat:s}).build(),g=r.getCloneForMove(e,u);this.logMoveTask(a,i,t),this.updateTask(_.F.builder.withTask(a).build(),g)})})})},e=>{this.loggers.traceLogger.logTrace(507639450,m.k.Error,"Error loading plan for move task ".concat((0,Ve.LB)(e))),i.showErrorInternal(f.fc.MoveTaskError,void 0,void 0,t.plan.id)})}assignTask(e){var t,a;const{userId:s,originalTask:i,updatedTask:r,elementToFocusOnDismiss:n,onAssignSuccess:o}=e,{planStore:l,userStore:d,taskStore:c,permissionsStore:u,containerStore:g,appContextStore:p}=this.entityStoreSet,k=i.planId,v=l.getPlan(k);if(null==v)return void this.loggers.traceLogger.logTrace(507880143,m.k.Error,"assignTask - plan not in store [planId=".concat(k,"]"));const T={planId:k,assigneeId:s},f=e;let S;if(!0===e.addNewMember)S=this.addNewMembersToContainer([s],v.container);else if(!0===f.shareFile){if(null==f.vroomId)return;S=this.shareDriveItem(f.vroomId,[s])}const w=null!==(t=l.getContainerIdForPlan(k))&&void 0!==t?t:"",F=(null!==(a=d.getContainerUsers(w))&&void 0!==a?a:[]).map(e=>e.id),P=g.getContainer(w),C=F.indexOf(s)>-1,I=s===p.getCurrentUserId(),D=P&&u.getContainerPermissions(P),A=null===D||void 0===D?void 0:D.canViewMembers;if(null!=S||I||A&&C||(()=>{var e;const t=null!==(e=c.getTasksForPlan(k))&&void 0!==e?e:[];return!!(0,We.bN)(t)[s]})()){null===o||void 0===o||o(),this.loggers.usageLogger.logData(this.name,y.M.AssignTaskSuccessful,T);var b;if(Ue.o.isPlexTempId(i.id))return void(null===(b=S)||void 0===b||b.catch(()=>{}));const e=_.F.builder.withTask(i).build(),t=_.F.builder.withTask(r).build();return void this.updateTaskAsync(e,t,void 0,S).catch(()=>{})}const M=u.canAccessPlanViaSharedContainers(v.sharedWithContainers);return A&&!C?(this.dispatcher.dispatchAction(new h.o({dialogType:ne.h.AssignTaskWarning,userId:s,taskId:i.id,planId:k,assignerHasSharedContainerAccess:M,elementToFocusOnDismiss:n,onAssignSuccess:o})),void this.loggers.usageLogger.logData(this.name,y.M.AssignTaskBlockedByAddNonMember,T)):M?(this.dispatcher.dispatchAction(new h.o({dialogType:ne.h.ShareFileWarning,userId:s,taskId:i.id,planId:k,elementToFocusOnDismiss:n,onAssignSuccess:o})),void this.loggers.usageLogger.logData(this.name,y.M.AssignTaskBlockedByShareFile,T)):void 0}deleteTask(e,t){this.deleteTaskAsync(e,t).catch(()=>{})}deleteTaskSeries(e){this.deleteTaskSeriesAsync(e).catch(()=>{})}cancelApproval(e){this.cancelApprovalAsync(e).catch(()=>{})}updateApprovalStatus(e,t,a){this.updateApprovalStatusAsync(e,t,a).catch(()=>{})}async undeleteTask(e){const t=await this.logicModuleProviders.taskModule(),a=await this.logicModuleProviders.notificationModule();t.undeleteTaskAsync(e).then(e=>{const t=Re.wS.generateEntityLink(e.task,f._n.TaskLink,f.rl.Link,new Date);this.dispatcher.dispatchAction(new o.Z(new W.f(e.task.title,t)))},t=>{if(!(t.error instanceof V.U)){var s,i,r;const n=null===(s=t.response)||void 0===s?void 0:s.status,o=null===(i=t.response)||void 0===i?void 0:i.statusText;(null===(r=t.error)||void 0===r?void 0:r.name)===S.Zg?a.showInfoInternal(f.fc.PlanConvertingInfo):a.showErrorInternal(f.fc.UndeleteTaskError,n,o,e.id,t.response,[e.task.title])}})}updateTask(e,t){this.updateTaskAsync(e,t).catch(()=>{})}updateTaskDetails(e,t){this.updateTaskDetailsInternal(e,t).catch(()=>{})}ensureTaskReferencePreviewThumbnail(e,t){null!=this.entityStoreSet.taskStore.getTask(e.id)?this.fetchTaskContainer(e.id).then(async a=>{if(a.containerType!==O.K.Group)return;const s=a;if(s.unifiedGroupDetails){(await this.logicModuleProviders.driveItemModule()).fetchTaskReferenceThumbnails(e,s.unifiedGroupDetails,[t])}}).catch(e=>{this.loggers.traceLogger.logTrace(507880141,m.k.Warning,"ensureTaskReferencePreviewThumbnail - fetchTaskContainer Failed ".concat((0,Ve.s8)(e)))}):this.loggers.traceLogger.logTrace(507880142,m.k.Error,"ensureTaskReferencePreviewThumbnail - task not in store [TaskId=".concat(e.id,"]"))}async convertSuggestionToAttachment(e,t){var a;const s=this.entityStoreSet.taskStore.getTaskDetails(e),i=await this.logicModuleProviders.notificationModule();if(null==s)return;let r,n=t.webUrl||t.url;try{n=encodeURI(decodeURIComponent(n))}catch(h){return this.loggers.traceLogger.logTrace(507880140,m.k.Error,"Error encoding suggestion url for attachment [TaskId=".concat(e,"]")),void i.showErrorInternal(f.fc.ConvertSuggestionToAttachmentError,void 0,void 0,e)}const l=t.fileName.length>X.o.AliasMaxLength?t.fileName.substring(0,X.o.AliasMaxLength):t.fileName,d=w.Y.GetFileType(n);r=X.o.builder.withPropertyBag({url:n,alias:l,taskAttachmentType:B.builder.ofDriveItemType(d).build()}).build();if(Fe()(null!==(a=s.references)&&void 0!==a?a:{}).indexOf(r.url)>-1)return void this.loggers.traceLogger.logTrace(507880139,m.k.Warning,"Suggestion already exists as attachment [TaskId=".concat(e,"][SuggestionId=").concat(t.uniqueId,"]"));let c;const u=s.getReferenceWithLowestPriority();let g;g=null!=u?Le.O.generateOrderHintBetween(null,u.previewPriority):Le.O.generateOrderHintBetween(null,null),r=r.setProperty("previewPriority",g),c=s.addAttachment(r),c.previewType===se.X.Automatic&&(c=c.setProperty("previewType",se.X.Reference)),this.loggers.usageLogger.logData(this.name,y.M.FileSuggestionToAttachment),this.updateTaskDetailsInternal(s,c).then(()=>{const e=new G.e(t.fileName);this.dispatcher.dispatchAction(new o.Z(e))}).catch(()=>{}),this.ensureTaskReferencePreviewThumbnail(c,r)}logMoveTask(e,t,a){var s,i;const r=this.entityStoreSet.planStore.getPlan(e.planId),n=this.entityStoreSet.planStore.getPlanDetails(e.planId),o=null!=r&&null!=n?Y.T.getFirstDisplayableContextString(r,n):"",l=null!=t.planDetails?Y.T.getFirstDisplayableContextString(t.plan,t.planDetails):"";this.loggers.usageLogger.logData(this.name,"MoveTask",{originalTaskId:e.id,sourcePlanId:e.planId,targetPlanId:a.plan.id,sourceBucketId:null!==(s=e.bucketId)&&void 0!==s?s:"",targetBucketId:null!==(i=a.bucketId)&&void 0!==i?i:"",sourcePlanDisplayAs:o,targetPlanDisplayAs:l})}async fetchApprovalDetailsForTaskAsync(e){const t=await this.logicModuleProviders.taskModule();await t.fetchTaskApprovalDetailsAsync(e)}async createApprovalAsync(e,t){(await this.logicModuleProviders.taskModule()).createTaskApprovalAsync(e,t).catch(()=>{})}async cancelApprovalAsync(e){return(await this.logicModuleProviders.taskModule()).cancelApprovalAsync(e).catch(()=>{})}async updateApprovalStatusAsync(e,t,a){return(await this.logicModuleProviders.taskModule()).updateTaskApprovalAsync(e,t,a).catch(()=>{})}updateTaskDetailsInternal(e,t){const a=this.entityStoreSet.taskStore.getTask(e.id);if(null==a)throw new Be.m("originalTask","taskStore");const s=_.F.builder.withPropertyBag({task:a,taskDetails:e}).build(),i=_.F.builder.withPropertyBag({task:a,taskDetails:t}).build();return this.updateTaskAsync(s,i)}fetchPlanAndContainerBasedDependenciesForTask(e,t){this.fetchTaskContainer(e.id).then(async e=>{if(e.containerType===O.K.Group){const a=e,s=De()(t.references);if(a.unifiedGroupDetails&&s.length>0){(await this.logicModuleProviders.driveItemModule()).fetchTaskReferenceThumbnails(t,a.unifiedGroupDetails,s)}}}).catch(e=>{this.loggers.traceLogger.logTrace(507880138,m.k.Warning,"fetchPlanAndContainerBasedDependenciesForTask - fetchTaskContainer Failed ".concat((0,Ve.s8)(e)))})}async fetchTaskContainer(e){const t=this.entityStoreSet.taskStore.getTask(e);if(null==t){const e="fetchTaskContainer called for an uncached task";return this.loggers.traceLogger.logTrace(507880137,m.k.Warning,e),Promise.reject(je.g.generateAjaxClientError(null,e))}return(await this.logicModuleProviders.planModule()).fetchPlanAsync(t.planId).then(async e=>(await this.logicModuleProviders.containerModule()).fetchContainer(e.plan.container,!0).catch(e=>(this.loggers.traceLogger.logTrace(507880136,m.k.Warning,"fetchTaskContainer - fetchContainer Failed ".concat((0,Ve.s8)(e))),Promise.reject(e)))).catch(e=>(this.loggers.traceLogger.logTrace(507880135,m.k.Warning,"fetchTaskContainer - fetchPlanAsync Failed ".concat((0,Ve.s8)(e))),Promise.reject(e)))}async shareDriveItem(e,t){try{const a=await this.logicModuleProviders.driveItemModule();await a.shareDriveItemAsync(e,t)}catch(a){const t=a;return(await this.logicModuleProviders.notificationModule()).handleRequestFailures(t,[v.t3.NotImplemented],[v.t3.Forbidden,v.t3.NotFound],f.fc.ShareDriveItemError,e),Promise.reject(t)}}async addNewMembersToContainer(e,t){const a=await this.logicModuleProviders.containerModule(),s=await this.logicModuleProviders.notificationModule();return a.addUsersToContainerAsync(t,e).then(()=>{},t=>{if(!(t.error instanceof V.U)){var a,i,r;const n=null===(a=t.response)||void 0===a?void 0:a.status,o=null===(i=t.response)||void 0===i?void 0:i.statusText;(null===(r=t.error)||void 0===r?void 0:r.name)===S.Zg?s.showInfoInternal(f.fc.PlanConvertingInfo):n===v.t3.NotImplemented?this.loggers.traceLogger.logTrace(507880134,m.k.Error,"addUsersToGroup - Not Implemented"):s.showErrorInternal(f.fc.AddUsersToGroupError,n,o,e.length.toString(),t.response)}return Promise.reject(t)})}async generateTaskActivityFeed(e,t){if(null!=t.task){const a=t.task.planId;if(null==a)return;const s=this.entityStoreSet.planStore.getPlanDetails(a);if(null==s){(await this.logicModuleProviders.planModule()).fetchPlanAsync(a).then(a=>{if(null==a.planDetails)return void this.dispatcher.dispatchAction(new r.j(null,"","planDetails wasn't returned by fetchPlanAsync"));const s=new Date,i=Re.wS.generateEntityLink(t.task,f._n.Comment,f.rl.GroupMailbox,s),n=Re.wS.generateEntityLink(a.plan,f._n.Comment,f.rl.GroupMailbox,s),o=this.taskActivityFeedProvider.getTaskActivityFeed(e,t,a.planDetails.notifyWhen,a.plan,i,n);null!=o&&this.postActivityFeed(t.task,o)},()=>{})}else{const i=this.entityStoreSet.planStore.getPlan(a);if(null==i)this.loggers.traceLogger.logTrace(507880133,m.k.Error,"generateTaskActivityFeed - plan not found [PlanId=".concat(a,"]"));else{const a=new Date,r=Re.wS.generateEntityLink(t.task,f._n.Comment,f.rl.GroupMailbox,a),n=i?Re.wS.generateEntityLink(i,f._n.Comment,f.rl.GroupMailbox,a):"",o=this.taskActivityFeedProvider.getTaskActivityFeed(e,t,s.notifyWhen,i,r,n);null!=o&&this.postActivityFeed(t.task,o)}}}}async postActivityFeed(e,t){if(null==e.planId)return;const a=this.entityStoreSet.planStore.getContainerIdForPlan(e.planId);if(null==a)return;const s=e.conversationThreadId,i=await this.logicModuleProviders.unifiedGroupModule();if(null!=s)i.postReplyInGroupConversationThread(a,s,t,!0).catch(e=>{var t;(null===(t=e.response)||void 0===t?void 0:t.status)===v.t3.NotFound&&this.dispatcher.dispatchAction(new g.x(a,s))});else{const s=Ue.o.generate(),r=Me.i.getTaskCommentEmailSubject(e.title);i.createGroupConversationThread(a,s,t,e,r,!0).catch(()=>{})}}async ensureBucket(e,t){if(e===T.iR)return Promise.resolve(null);const a=await this.logicModuleProviders.bucketModule();if(null==e){const e=Z.f.builder.withPropertyBag({id:"",title:Ee.p.Strings.SharedComponents_DefaultBucketName,planId:t}).withLocallyUniqueId().build();return a.createBucketAsync(e)}{const s=await this.logicModuleProviders.notificationModule();return new Promise((i,r)=>{a.fetchBucketsForPlanAsync(t,!0).then(s=>{let n=null;if(s&&s.length>0){for(const t of s)if(t.id===e){n=t;break}n?i(n):(s.sort(He.k),i(s[0]))}else{const e=Z.f.builder.withPropertyBag({id:"",title:Ee.p.Strings.SharedComponents_DefaultBucketName,planId:t}).withLocallyUniqueId().build();a.createBucketAsync(e).then(e=>{i(e)},e=>{r(e)})}},e=>{const a=e;s.handleRequestFailures(a,[],[v.t3.Forbidden,v.t3.NotFound],f.fc.GetBucketsForPlanError,t),r(e)})})}}async copyTaskAsync(e,t){var a,i,r,n,o;try{const e=await this.logicModuleProviders.planModule();await e.fetchPlanAsync(t.plan.id,!0)}catch(C){const e=C;return(await this.logicModuleProviders.notificationModule()).handleRequestFailures(e,[],[v.t3.Forbidden,v.t3.NotFound],f.fc.GetPlanError,t.plan.id),Promise.reject(e)}const l=await this.ensureBucket(t.bucketId,t.plan.id);t=(0,s.A)((0,s.A)({},t),{},{bucketId:l?l.id:null});const d=await this.logicModuleProviders.taskModule(),c=await d.fetchTaskAsync(e);await d.fetchPlanTasksAsync(t.plan.id);const u=Ue.o.generate();let g,h,p=se.X.Automatic;switch(c.task.previewType){case se.X.NoPreview:p=se.X.NoPreview;break;case se.X.Reference:p=t.copyReferences?se.X.Reference:se.X.Automatic;break;case se.X.CheckList:p=t.copyChecklist?se.X.CheckList:se.X.Automatic;break;case se.X.Description:p=t.copyDescription?se.X.Description:se.X.Automatic}if(t.copyAssignments&&!ke()(c.task.assignments)){const e={};he()(c.task.assignments,(t,a)=>{e[a]=new K.I(t.assignedBy,t.assignedDate.toDate())}),g=e}t.copyRecurrence&&null!=(null===(a=c.task.recurrence)||void 0===a?void 0:a.schedule)&&(h=ie.G.builder.withRecurrenceSchedule(re.s.builder.withRecurrencePattern(de()(c.task.recurrence.schedule.pattern)).build().setRecurrenceRangeStartDate(c.task.dueDate)).build());let k=z.Y.builder.withPropertyBag({id:u,title:t.title,planId:t.plan.id,percentComplete:t.copyProgress?c.task.percentComplete:(0,Ne.BK)(L.$.NotStarted),bucketId:t.bucketId,dueDate:t.copyDates&&null!==(i=c.task.dueDate)&&void 0!==i?i:void 0,startDate:t.copyDates&&null!==(r=c.task.startDate)&&void 0!==r?r:void 0,assignments:g,appliedCategories:t.copyLabels?c.task.appliedCategories:void 0,previewType:p,priority:c.task.priority,numberOfActiveChecklistItems:t.copyChecklist?c.task.numberOfActiveChecklistItems:void 0,numberOfChecklistItems:t.copyChecklist?c.task.numberOfChecklistItems:void 0,numberOfReferences:t.copyReferences?c.task.numberOfReferences:void 0,recurrence:h}).build();if(!c.taskDetails)throw new Oe.n("ensuredTaskEntitySet.taskDetails");const m=c.taskDetails.getCopy(),y=$.U.builder.withPropertyBag({id:u,previewType:p,checklist:t.copyChecklist?m.checklist:void 0,description:t.copyDescription&&null!==(n=m.description)&&void 0!==n?n:void 0,notes:t.copyDescription&&m.notes&&null!==(o={content:m.notes.content,contentType:m.notes.contentType})&&void 0!==o?o:void 0,references:t.copyReferences?m.references:void 0}).build();let S=null,w=null,F=null;switch(this.entityStoreSet.viewStore.getCurrentTaskGroupingState(te.t.Plan)){case T.Yc.Progress:S=this.calculateProgressFormattingForCopyOrMove(c.task,c.taskFormatData,k,t);break;case T.Yc.Assignee:w=this.calculateAssignedToFormattingForCopyOrMove(c.task,c.taskFormatData,k,t);break;case T.Yc.Bucket:F=this.calculateBucketFormattingForCopyOrMove(c.task,c.taskFormatData,k);break;case T.Yc.Plan:if(!this.entityStoreSet.appContextStore.getFlights().EnableFixedSortForAtmViews){const e=this.calculateAssigneePriorityForCopyOrMove(c.task,k);k=k.setProperty("assigneePriority",e)}}const P=q._.builder.withPropertyBag({assignedBoardFormat:w||void 0,bucketBoardFormat:F||void 0,progressBoardFormat:S||void 0}).build();return this.createTaskAsync(_.F.builder.withTask(k).withDetails(y).withFormatData(P).build(),void 0,!0)}async createTaskAsync(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=await this.logicModuleProviders.taskModule();if(e.id&&null==e.taskDetails){const t=$.U.builder.withId(e.id).build();e=_.F.builder.forClone(e).withDetails(t).build()}const r=_.F.builder.withDetails(e.taskDetails).withTask(e.task).withFormatData(e.taskFormatData).build(),n=await this.logicModuleProviders.notificationModule();return i.createTaskAsync(r,t,(e,t)=>{var o,l;const d=null===(o=e.response)||void 0===o?void 0:o.status,c=null===(l=e.response)||void 0===l?void 0:l.statusText,u=()=>{var t;(null===(t=e.error)||void 0===t?void 0:t.name)===S.Zg?n.showInfoInternal(f.fc.PlanConvertingInfo):n.showErrorInternal(f.fc.CreateTaskError,d,c,void 0,e.response,[r.task.title])};if(d!==v.t3.BadRequest||s)t(),u();else try{i.fixTaskOrderHintPrecision(null,r,u,this.reorderTaskGroups.bind(this),(e,t,s)=>this.fixCreateTask(e,t,s,a),t)}catch(g){this.loggers.traceLogger.logTrace(507639449,m.k.Error,"createTaskAsync - fixTaskOrderHintPrecision failed ".concat((0,Ve.LB)(g))),t(),u()}}).then(e=>{if(a){const t=new R.g(e.task.id,e.task.title,Re.wS.generateEntityLink(e.task,f._n.TaskLink,f.rl.Link,new Date));this.dispatcher.dispatchAction(new o.Z(t))}else n.enqueueHiddenToastNotification("SharedComponents_CreateTaskToastTitle",[],r.task.title);this.loggers.usageLogger.logData(this.name,y.M.CreateTask,{isCopyOperation:String(a)});const t=Fe()(e.task.assignments);if(!ke()(t)){const a={planId:e.task.planId,assigneeIds:t.join(",")};this.loggers.usageLogger.logData(this.name,y.M.AssignTaskSuccessful,a)}const s=this.entityStoreSet.appContextStore.getCurrentUserId(),i=this.entityStoreSet.userStore.getUserDetailsById(s);return null!==i&&void 0!==i&&i.isUserAccessWithin24Hours()&&this.loggers.usageLogger.logData(this.name,y.M.CreateTaskIn24h,{isCopyOperation:String(a)}),this.generateTaskActivityFeed(null,e),e})}async deleteTaskAsync(e,t){const a=this.entityStoreSet.taskStore.getTask(e);if(null==a)throw this.loggers.usageLogger.logData(this.name,"deleteTask::task not in store",{taskId:e}),new Be.m("task","taskStore");try{var s,i;this.loggers.usageLogger.logData(this.name,y.M.DeleteTask);const r=await this.logicModuleProviders.taskModule(),n=await r.deleteTaskAsync(e,t),l=new c(n,()=>this.undeleteTask(n));this.dispatcher.dispatchAction(l);const d=new N.W(a.title,()=>{this.dispatcher.dispatchAction(new u(l.actionId))});this.dispatcher.dispatchAction(new o.Z(d)),null!==(s=a.recurrence)&&void 0!==s&&s.isActive()&&null!=(null===(i=n.task.recurrence)||void 0===i?void 0:i.nextInSeriesTaskId)&&this.fetchTaskEntityGroup(n.task.recurrence.nextInSeriesTaskId)}catch(d){const t=d,a=await this.logicModuleProviders.notificationModule();if(!(t.error instanceof V.U)){var r;if((null===(r=t.error)||void 0===r?void 0:r.name)===S.Zg)a.showInfoInternal(f.fc.PlanConvertingInfo);else{var n,l;const s=null===(n=t.response)||void 0===n?void 0:n.status,i=null===(l=t.response)||void 0===l?void 0:l.statusText;a.showErrorInternal(f.fc.DeleteTaskError,s,i,e,t.response)}}}}async deleteTaskSeriesAsync(e){const t=this.entityStoreSet.taskStore.getTask(e);if(null==t)throw new Be.m("task","taskStore");const a=_.F.builder.withTask(t).build(),s=t.setRecurrenceSchedule(null);let i=!1;try{const e=await this.logicModuleProviders.taskModule(),r=await e.updateTaskAsync(a,_.F.builder.withTask(s).build());i=!0,this.loggers.usageLogger.logData(this.name,y.M.DeleteTask),await e.deleteTaskAsync(r.task.id,r.task.itemVersion);const n=new H.N(t.title);this.dispatcher.dispatchAction(new o.Z(n))}catch(d){const t=d;if(!(t.error instanceof V.U)){var r;const a=await this.logicModuleProviders.notificationModule();if((null===(r=t.error)||void 0===r?void 0:r.name)===S.Zg)a.showInfoInternal(f.fc.PlanConvertingInfo);else{var n,l;const s=null===(n=t.response)||void 0===n?void 0:n.status,r=null===(l=t.response)||void 0===l?void 0:l.statusText,o=i?f.fc.DeleteRecurringTaskSeriesDeleteError:f.fc.DeleteRecurringTaskSeriesUpdateError;a.showErrorInternal(o,s,r,e,t.response)}}}}async updateTaskAsync(e,t){var a,s,r,n,l,d;let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3?arguments[3]:void 0;const g=await this.logicModuleProviders.taskModule();if(fe()(e,t,xe.lz.isEqualMomentCustomizer))return Promise.resolve(t);t.task.isComplete()&&!e.task.isComplete()&&k.B.clientType!==Ze.s.SharepointApp&&k.B.clientType!==Ze.s.Webpart&&this.taskCompletionSoundAudio.play();const h=e.task.getDiff(t.task),p=null!=e.taskDetails&&null!=t.taskDetails?e.taskDetails.getDiff(t.taskDetails):{},T=null!=(null===(a=e.taskFormatData)||void 0===a?void 0:a.assignmentBoardFormat)&&null!=(null===(s=t.taskFormatData)||void 0===s?void 0:s.assignmentBoardFormat)?e.taskFormatData.assignmentBoardFormat.getDiff(t.taskFormatData.assignmentBoardFormat):{},y=null!=(null===(r=e.taskFormatData)||void 0===r?void 0:r.bucketBoardFormat)&&null!=(null===(n=t.taskFormatData)||void 0===n?void 0:n.bucketBoardFormat)?e.taskFormatData.bucketBoardFormat.getDiff(t.taskFormatData.bucketBoardFormat):{},w=null!=(null===(l=e.taskFormatData)||void 0===l?void 0:l.progressBoardFormat)&&null!=(null===(d=t.taskFormatData)||void 0===d?void 0:d.progressBoardFormat)?e.taskFormatData.progressBoardFormat.getDiff(t.taskFormatData.progressBoardFormat):{};this.logUpdateTaskUsage(h,e.task,t.task),this.logUpdateTaskDetailsUsage(e.task,p,e.taskDetails,t.taskDetails),this.logUpdateTaskFormatsUsage(e.id,T,y,w);const F=await this.logicModuleProviders.notificationModule();return g.updateTaskAsync(e,t,u,(a,s)=>{var r,n,o,l;const d=null===(r=a.response)||void 0===r?void 0:r.status,u=null===(n=a.response)||void 0===n?void 0:n.statusText,h=null===(o=a.error)||void 0===o?void 0:o.name,p=()=>{h===S.Zg?F.showInfoInternal(f.fc.PlanConvertingInfo):F.showErrorInternal(f.fc.UpdateTaskError,d,u,e.id,a.response)},k=d===v.t3.PreconditionFailed&&"The ETag value is too old, the item must be read again."===(null===(l=a.error)||void 0===l?void 0:l.message);if(d===v.t3.Conflict||k)s(),g.fetchTaskAsync(e.id,!0).catch(e=>{this.loggers.traceLogger.logTrace(507880132,m.k.Warning,"UpdateTaskAsync - 409/412 Recovery - fetchTaskAsync Fail ".concat((0,Ve.s8)(e)))});else if(d!==v.t3.BadRequest||c)if(d===v.t3.NotFound){const t=e.task?e.task.title:"";this.dispatcher.dispatchAction(new i.i(f.fc.UpdateDeletedTaskInfo,d,u,e.id,[t]))}else s(),p();else try{g.fixTaskOrderHintPrecision(e,t,p,this.reorderTaskGroups.bind(this),this.fixUpdateTask.bind(this),s)}catch(T){this.loggers.traceLogger.logTrace(507639448,m.k.Error,"updateTaskAsync - fixTaskOrderHintPrecision failed ".concat((0,Ve.LB)(T))),s(),p()}}).then(a=>{var s,i;if(null!=e.task&&null!=a.task&&this.generateTaskActivityFeed(e,a),null!=e.task&&null!=t.task&&e.task.planId!==t.task.planId){const e=new j.c(t.task.id,t.task.title,Re.wS.generateEntityLink(t.task,f._n.TaskLink,f.rl.Link,new Date));this.dispatcher.dispatchAction(new o.Z(e))}else F.announceTaskUpdates(h,e.task),e.taskDetails&&F.announceTaskDetailsUpdates(p,e.taskDetails),F.announceTaskReorder(h,T,y,w,e,a.task.title);return null!==(s=e.task.recurrence)&&void 0!==s&&s.isActive()&&null!=(null===(i=a.task.recurrence)||void 0===i?void 0:i.nextInSeriesTaskId)&&this.fetchTaskEntityGroup(a.task.recurrence.nextInSeriesTaskId),a},t=>(this.loggers.traceLogger.logTrace(507880131,m.k.Info,"Task update failed - [TaskCreationSourceType=".concat(e.task.taskCreationSourceType,"]")),Promise.reject(t)))}logUpdateTaskUsage(e,t,a){if(!ke()(e)){const e=this.entityStoreSet.appContextStore.getCurrentUserId(),n=this.entityStoreSet.userStore.getUserDetailsById(e),o=!!n&&n.isUserAccessWithin24Hours();if(this.loggers.usageLogger.logData(this.name,y.M.TaskUpdated,{taskCreationSourceType:t.taskCreationSourceType}),o&&this.loggers.usageLogger.logData(this.name,y.M.TaskUpdatedIn24h,{taskCreationSourceType:t.taskCreationSourceType}),!me()(t.assignments,a.assignments)){const e=ue()(Fe()(a.assignments),e=>null==t.assignments[e]),i=ue()(Fe()(t.assignments),e=>null==a.assignments[e]),r=e.length,n=i.length;if(r>0||n>0){var s;const e=null!=(null===(s=this.entityStoreSet.planStore.getPlanDetails(a.planId))||void 0===s?void 0:s.background.overlayImage);this.loggers.usageLogger.logData(this.name,y.M.TaskAssigned,{newAssigmentsCount:String(r),removedAssignmentsCount:String(n),planHasBackground:String(e),taskCreationSourceType:t.taskCreationSourceType}),o&&this.loggers.usageLogger.logData(this.name,y.M.TaskAssignedIn24h,{newAssigmentsCount:String(r),removeAssignmentsCount:String(n),taskCreationSourceType:t.taskCreationSourceType})}}var i,r;if(t.percentComplete!==a.percentComplete&&(this.loggers.usageLogger.logData(this.name,y.M.TaskProgressChanged,{taskCreationSourceType:t.taskCreationSourceType}),(0,Ne.Fk)(a.percentComplete)===L.$.Complete&&this.loggers.usageLogger.logData(this.name,y.M.TaskCompleted,{taskCreationSourceType:t.taskCreationSourceType}),(0,Ne.Fk)(t.percentComplete)===L.$.Complete&&this.loggers.usageLogger.logData(this.name,y.M.TaskReactivated,{taskCreationSourceType:t.taskCreationSourceType})),me()(t.appliedCategories,a.appliedCategories)||(t.appliedCategories.length>a.appliedCategories.length?this.loggers.usageLogger.logData(this.name,y.M.RemoveLabelFromTask,{taskCreationSourceType:t.taskCreationSourceType}):t.appliedCategories.length<a.appliedCategories.length&&this.loggers.usageLogger.logData(this.name,y.M.AddLabelToTask,{taskCreationSourceType:t.taskCreationSourceType})),t.bucketId!==a.bucketId)this.loggers.usageLogger.logData(this.name,"TaskBucketUpdated",{sourceBucketId:null!==(i=t.bucketId)&&void 0!==i?i:"null",targetBucketId:null!==(r=a.bucketId)&&void 0!==r?r:"null",taskCreationSourceType:t.taskCreationSourceType});if(t.priority!==a.priority&&this.loggers.usageLogger.logData(this.name,"TaskPriorityUpdated",{taskCreationSourceType:t.taskCreationSourceType}),!me()(t.startDate,a.startDate)){let e="TaskStartDate";t.startDate?a.startDate?e+="Updated":e+="Removed":e+="Set",this.loggers.usageLogger.logData(this.name,e,{taskCreationSourceType:t.taskCreationSourceType})}if(!me()(t.dueDate,a.dueDate)){let e="TaskDueDate";t.dueDate?a.dueDate?e+="Updated":e+="Removed":e+="Set",this.loggers.usageLogger.logData(this.name,e,{taskCreationSourceType:t.taskCreationSourceType})}t.title!==a.title&&this.loggers.usageLogger.logData(this.name,"TaskTitleUpdated",{taskCreationSourceType:t.taskCreationSourceType}),fe()(t.recurrence,a.recurrence,xe.lz.isEqualMomentCustomizer)||this.loggers.usageLogger.logData(this.name,"TaskRecurrenceChanged",{taskCreationSourceType:t.taskCreationSourceType})}}logUpdateTaskDetailsUsage(e,t,a,s){if(!ke()(t)&&null!=a&&null!=s){var i;if(this.loggers.usageLogger.logData(this.name,y.M.TaskDetailsUpdated,{taskCreationSourceType:null!==(i=e.taskCreationSourceType)&&void 0!==i?i:""}),a.description!==s.description){let e;e=ke()(a.description)?"TaskNotesSet":ke()(s.description)?"TaskNotesRemoved":"TaskNotesUpdated",this.loggers.usageLogger.logData(this.name,e)}if(!me()(a.notes,s.notes)){var r,n;let e;e=ke()(null===(r=a.notes)||void 0===r?void 0:r.content)?"TaskRichNotesSet":ke()(null===(n=s.notes)||void 0===n?void 0:n.content)?"TaskRichNotesRemoved":"TaskRichNotesUpdated",this.loggers.usageLogger.logData(this.name,e)}if(!me()(a.checklist,s.checklist)){const e=ue()(Fe()(s.checklist),e=>null==a.checklist[e]),t=ue()(Fe()(a.checklist),e=>null==s.checklist[e]),i=e.length,r=t.length;(i>0||r>0)&&this.loggers.usageLogger.logData(this.name,"TaskChecklist",{newChecklistCount:String(i),removedChecklistCount:String(r)})}if(!me()(a.references,s.references)){const e=ue()(Fe()(s.references),e=>null==a.references[e]),t=ue()(Fe()(a.references),e=>null==s.references[e]),i=e.length,r=t.length;(i>0||r>0)&&this.loggers.usageLogger.logData(this.name,"TaskAttachments",{newAttachmentsCount:String(i),removedAttachmentsCount:String(r)})}if(t.previewType){let e;e=t.previewType===se.X.NoPreview?"TaskPreviewTypeRemoved":"TaskPreviewTypeSet",this.loggers.usageLogger.logData(this.name,e,{previewType:String(s.previewType)})}}}logUpdateTaskFormatsUsage(e,t,a,i){let r={};ke()(t)||(r=(0,s.A)((0,s.A)({},r),{},{assigneeOrderHintsFormat:String(!ke()(t.orderHintsByAssignee)),unassignedOrderHintFormat:String(!ke()(t.unassignedOrderHint))})),ke()(a)||(r=(0,s.A)((0,s.A)({},r),{},{bucketFormat:String(!0)})),ke()(i)||(r=(0,s.A)((0,s.A)({},r),{},{progressFormat:String(!0)})),ke()(r)||this.loggers.usageLogger.logData(this.name,"TaskFormatsUpdated",r)}reorderTaskGroups(e,t){const a=[];return b()(e,e=>{t?ke()(e.aboveTasks)||null==e.aboveTasks?a.push(Promise.resolve(e)):a.push(this.reorderTaskCard(e.aboveTasks,e)):ke()(e.belowTasks)||null==e.belowTasks?a.push(Promise.resolve(e)):a.push(this.reorderTaskCard(e.belowTasks,e))}),ke()(a)?Promise.resolve([]):Promise.allSettled(a).then(e=>{const t=[];let a=!1,s=null;return b()(e,e=>{"rejected"===e.status?(a=!0,s=e.reason):null==e.value?a=!0:t.push(e.value)}),a?Promise.reject(s):t})}fixCreateTask(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=t.taskFormatData;null!=i&&b()(a,e=>{i=e.setOrderHint(i,e.nextOrderHint,e.pivotValue)});const r=_.F.builder.withTask(t.task).withDetails(t.taskDetails).withFormatData(i).build();return new Promise((e,t)=>{this.createTaskAsync(r,void 0,s,!0).then(t=>{const s=[];b()(a,e=>{e.nextOrderHint=Le.O.generateOrderHintBetween(null!=t.taskFormatData?e.getOrderHint(t.taskFormatData,e.pivotValue):null,null),s.push(e)}),e(s)},e=>{t(e)})})}fixUpdateTask(e,t,a){if(null==e)return Promise.reject("originalTaskInfo is null!");let s=t.taskFormatData;null!=s&&b()(a,e=>{s=e.setOrderHint(s,e.nextOrderHint,e.pivotValue)});const i=_.F.builder.withTask(t.task).withDetails(t.taskDetails).withFormatData(s).build();return new Promise((t,s)=>{this.updateTaskAsync(e,i,!0).then(e=>{const s=[];b()(a,t=>{t.nextOrderHint=Le.O.generateOrderHintBetween(null!=e.taskFormatData?t.getOrderHint(e.taskFormatData,t.pivotValue):null,null),s.push(t)}),t(s)},e=>{s(e)})})}async reorderTaskCard(e,t){const a=await this.logicModuleProviders.taskModule();return new Promise((s,i)=>{const r=e.shift();if(null==r){const e="reorderTaskCard null task",t=new Response("Bad request",{status:v.t3.BadRequest,statusText:"Bad Request"});i(je.g.generateAjaxClientError(t,e))}else if(E()(this.inProgressTaskReorderIds,r.id)>-1)e.unshift(r),setTimeout(()=>{this.reorderTaskCard(e,t).then(e=>{s(e)},e=>{i(e)})},4e3);else{this.inProgressTaskReorderIds.push(r.id);const n=_.F.builder.withTask(r).withFormatData(this.entityStoreSet.taskStore.getTaskboardTaskFormatting(r.id)||void 0).build(),o=n.taskFormatData?t.setOrderHint(n.taskFormatData,t.nextOrderHint,t.pivotValue):n.taskFormatData;a.updateTaskAsync(n,_.F.builder.withTask(r).withFormatData(o).build()).then(a=>{Ce()(this.inProgressTaskReorderIds,r.id),t.nextOrderHint=Le.O.generateOrderHintBetween(a.taskFormatData?t.getOrderHint(a.taskFormatData,t.pivotValue):null,null),e.length>0?this.reorderTaskCard(e,t).then(e=>{s(e)},e=>{i(e)}):s(t)},e=>{if(Ce()(this.inProgressTaskReorderIds,r.id),!(e.error instanceof V.U)){var t;(null===(t=e.response)||void 0===t?void 0:t.status)===v.t3.Conflict&&this.fetchTaskEntityGroup(n.id,!0,!0)}i(e)})}})}calculateProgressFormattingForCopyOrMove(e,t,a,s){const i=this.entityStoreSet.taskStore.getTasksForPlan(a.planId)||[],r=Se()(this.entityStoreSet.taskStore.getTaskboardTaskFormattingForPlan(a.planId,ae.s.Progress),"id"),n=(0,Ge.py)(i,r,!0);let o,l=null,d=null,c=null;if(s&&!s.copyProgress){var u,g;const e=n.filter(e=>e.pivotValue===L.$.NotStarted)[0],t=null!==(u=null===e||void 0===e||null===(g=e.dataEntities)||void 0===g?void 0:g[0])&&void 0!==u?u:null;if(null!=t){var h;const e=this.entityStoreSet.taskStore.getTaskboardTaskFormatting(t.id);l=null!==(h=null===e||void 0===e?void 0:e.progressBoardFormat)&&void 0!==h?h:null}o=Le.O.generateOrderHintBetween(null,l?l.orderHint:null)}else{const s=n.filter(t=>t.pivotValue===(0,Ne.Fk)(e.percentComplete))[0];if(e.planId===a.planId){var p;if(null!==s&&void 0!==s&&s.dataEntities){const t=s.dataEntities.indexOf(e);if(t<s.dataEntities.length-1){var k;const e=s.dataEntities[t+1],a=this.entityStoreSet.taskStore.getTaskboardTaskFormatting(e.id);l=null!==(k=null===a||void 0===a?void 0:a.progressBoardFormat)&&void 0!==k?k:null}}d=null!==(p=null===t||void 0===t?void 0:t.progressBoardFormat)&&void 0!==p?p:null}else if(null!==s&&void 0!==s&&s.dataEntities&&s.dataEntities.length>0){var v;const e=s.dataEntities[0],t=this.entityStoreSet.taskStore.getTaskboardTaskFormatting(e.id);l=null!==(v=null===t||void 0===t?void 0:t.progressBoardFormat)&&void 0!==v?v:null}o=Le.O.generateOrderHintBetween(d?d.orderHint:null,l?l.orderHint:null)}return c=J.j.builder.withPropertyBag({id:a.id,orderHint:o}).build(),c}calculateAssignedToFormattingForCopyOrMove(e,t,a,s){const i=this.entityStoreSet.planStore.getPlan(a.planId),r=this.entityStoreSet.taskStore.getTasksForPlan(a.planId)||[],n=Se()(this.entityStoreSet.taskStore.getTaskboardTaskFormattingForPlan(a.planId,ae.s.AssignedTo),"id");let o;null==i?(this.loggers.traceLogger.logTrace(507880130,m.k.Error,"calculateAssignedToFormattingForCopyOrMove - no plan for task [TaskId=".concat(a.planId,"]")),o=""):o=i.container.externalId;const l=Se()(this.entityStoreSet.userStore.getContainerUsers(o),"id"),d=(0,Ge.Fy)(r,n,l,this.entityStoreSet.appContextStore.getCurrentUserId());let c=null,u=null,g=null;if(s&&!s.copyAssignments){var h,p;const e=d.filter(e=>null===e.pivotValue)[0],t=null!==(h=null===e||void 0===e||null===(p=e.dataEntities)||void 0===p?void 0:p[0])&&void 0!==h?h:null;if(null!=t){var k;const e=this.entityStoreSet.taskStore.getTaskboardTaskFormatting(t.id);c=null!==(k=null===e||void 0===e?void 0:e.assignmentBoardFormat)&&void 0!==k?k:null}const s=Le.O.generateOrderHintBetween(null,c?c.unassignedOrderHint:null);g=Q.x.builder.withPropertyBag({id:a.id,unassignedOrderHint:s}).build()}else if(ke()(e.getAssigneeIds())){const s=d.filter(e=>null===e.pivotValue)[0];if(e.planId===a.planId){var v;const a=null!==s&&void 0!==s&&s.dataEntities?s.dataEntities.indexOf(e):-1;if(null!==s&&void 0!==s&&s.dataEntities&&a<s.dataEntities.length-1){var T;const e=s.dataEntities[a+1],t=this.entityStoreSet.taskStore.getTaskboardTaskFormatting(e.id);c=null!==(T=null===t||void 0===t?void 0:t.assignmentBoardFormat)&&void 0!==T?T:null}u=null!==(v=null===t||void 0===t?void 0:t.assignmentBoardFormat)&&void 0!==v?v:null}else if(null!==s&&void 0!==s&&s.dataEntities&&s.dataEntities.length>0){var f;const e=s.dataEntities[0],t=this.entityStoreSet.taskStore.getTaskboardTaskFormatting(e.id);c=null!==(f=null===t||void 0===t?void 0:t.assignmentBoardFormat)&&void 0!==f?f:null}const i=Le.O.generateOrderHintBetween(u?u.unassignedOrderHint:null,c?c.unassignedOrderHint:null);g=Q.x.builder.withPropertyBag({id:a.id,unassignedOrderHint:i}).build()}else{const s={};b()(e.getAssigneeIds(),i=>{const r=d.filter(e=>e.pivotValue===i)[0];if(e.planId===a.planId){var n;const a=null!==r&&void 0!==r&&r.dataEntities?r.dataEntities.indexOf(e):-1;if(null!==r&&void 0!==r&&r.dataEntities&&a<r.dataEntities.length-1){var o;const e=r.dataEntities[a+1],t=this.entityStoreSet.taskStore.getTaskboardTaskFormatting(e.id);c=null!==(o=null===t||void 0===t?void 0:t.assignmentBoardFormat)&&void 0!==o?o:null}u=null!==(n=null===t||void 0===t?void 0:t.assignmentBoardFormat)&&void 0!==n?n:null}else if(null!==r&&void 0!==r&&r.dataEntities&&r.dataEntities.length>0){var l;const e=r.dataEntities[0],t=this.entityStoreSet.taskStore.getTaskboardTaskFormatting(e.id);c=null!==(l=null===t||void 0===t?void 0:t.assignmentBoardFormat)&&void 0!==l?l:null}s[i]=Le.O.generateOrderHintBetween(u?u.orderHintsByAssignee[i]:null,c?c.orderHintsByAssignee[i]:null)}),g=Q.x.builder.withPropertyBag({id:a.id,orderHintsByAssignee:s}).build()}return g}calculateBucketFormattingForCopyOrMove(e,t,a){var s;const i=this.entityStoreSet.taskStore.getTasksForPlan(a.planId)||[],r=Se()(this.entityStoreSet.taskStore.getTaskboardTaskFormattingForPlan(a.planId,ae.s.Bucket),"id");let n=null,o=null,l=null;const d=(0,Ge.M1)(i,r,null!==(s=this.entityStoreSet.bucketStore.getBucketsForPlan(a.planId))&&void 0!==s?s:[]).filter(e=>e.pivotValue===a.bucketId)[0];if(e.bucketId===a.bucketId){var c;const a=null!==d&&void 0!==d&&d.dataEntities?d.dataEntities.indexOf(e):-1;if(null!==d&&void 0!==d&&d.dataEntities&&a<d.dataEntities.length-1){var u;const e=d.dataEntities[a+1],t=this.entityStoreSet.taskStore.getTaskboardTaskFormatting(e.id);n=null!==(u=null===t||void 0===t?void 0:t.bucketBoardFormat)&&void 0!==u?u:null}o=null!==(c=null===t||void 0===t?void 0:t.bucketBoardFormat)&&void 0!==c?c:null}else if(null!==d&&void 0!==d&&d.dataEntities&&d.dataEntities.length>0){var g;const e=d.dataEntities[0],t=this.entityStoreSet.taskStore.getTaskboardTaskFormatting(e.id);n=null!==(g=null===t||void 0===t?void 0:t.bucketBoardFormat)&&void 0!==g?g:null}const h=Le.O.generateOrderHintBetween(o?o.orderHint:null,n?n.orderHint:null);return l=ee.g.builder.withPropertyBag({id:a.id,orderHint:h}).build(),l}calculateAssigneePriorityForCopyOrMove(e,t){const a=this.entityStoreSet.taskStore.getTasksForUser(k.B.currentUserId),s=a?a.filter(t=>e.isComplete()?t.isComplete():!t.isComplete()):[],i=s.map(e=>e.planId),r=(0,Ge.V2)(s,i,[],!1).filter(e=>e.pivotValue===t.planId)[0];let n=null,o=null;if(e.planId===t.planId){var l;const t=null!==r&&void 0!==r&&r.dataEntities?r.dataEntities.indexOf(e):-1;if(null!==r&&void 0!==r&&r.dataEntities&&t<r.dataEntities.length-1){var d;n=null!==(d=r.dataEntities[t+1].assigneePriority)&&void 0!==d?d:null}o=null!==(l=e.assigneePriority)&&void 0!==l?l:null}else if(null!==r&&void 0!==r&&r.dataEntities&&r.dataEntities.length>0){var c;n=null!==(c=r.dataEntities[0].assigneePriority)&&void 0!==c?c:null}return Le.O.generateOrderHintBetween(o,n)}constructor(e,t,a,s,i,r){super(e,t,a,k.B.clientSettings,i),this.taskActivityFeedProvider=s,this.inProgressTaskReorderIds=[],this.shareDeepLinkCallback=r,this.taskCompletionSoundAudio=new Audio(oe)}}},23918:(e,t,a)=>{a.d(t,{Y:()=>v});var s=a(91675),i=a(51171),r=a(57718),n=a(86178),o=a.n(n),l=a(14983),d=function(){function e(){this.id=r.cM(),this.name="",this.fileType=l.Er.Other,this.url="",this.modifiedDate=o()(),this.childCount=-1,this.itemPath="/drive/root:"}return e.prototype.build=function(){return new v(this)},e.prototype.withPropertyBag=function(e){return this.id=e.id||this.id,this.name=e.name||this.name,this.fileType=e.fileType||this.fileType,this.url=e.url||this.url,this.modifiedDate=e.modifiedDate||this.modifiedDate,this.childCount=void 0!==e.childCount?e.childCount:this.childCount,this.itemPath=e.itemPath||this.itemPath,this},e.prototype.withDefaultValues=function(){return this.withPropertyBag({id:"driveItemId",name:"Item1",fileType:l.Er.Other,url:"driveItemUrl",modifiedDate:o()(),itemPath:"/drive/root:",childCount:-1})},e.prototype.fromGraphDriveItemResource=function(e){return this.withPropertyBag({id:e.id,name:e.name,fileType:e.folder?l.Er.Other:e.package?v.GetType(e.package.type):v.GetFileType(e.name),url:e.webUrl,modifiedDate:o()(e.lastModifiedDateTime),childCount:e.folder?e.folder.childCount:-1,itemPath:e.parentReference.path})},e}(),c=a(98990),u=a.n(c),g=a(55491),h=a.n(g),p=a(54320),k=a.n(p),v=function(){function e(e){if(k()(e.id))throw new i.L("id");if(k()(e.name))throw new i.L("name");if(k()(e.url))throw new i.L("url");this.id=e.id,this.name=e.name,this.url=e.url,this.fileType=e.fileType,this.description=e.description,this.modifiedDate=e.modifiedDate,this.childCount=e.childCount,this.itemPath=e.itemPath}return Object.defineProperty(e,"builder",{get:function(){return new d},enumerable:!1,configurable:!0}),e.GetType=function(e){switch(e.toLowerCase()){case"excel":return l.Er.Excel;case"onenote":return l.Er.OneNote;case"pdf":return l.Er.Pdf;case"powerpoint":return l.Er.PowerPoint;case"project":return l.Er.Project;case"visio":return l.Er.Visio;case"word":return l.Er.Word;case"loop":return l.Er.Loop;default:return l.Er.Other}},e.GetFileType=function(t){var a=l.Er.Other,i=t.slice(t.lastIndexOf(".")+1);return h()(s.t,function(t,s){u()(t,function(e){return e.toLowerCase()===i.toLowerCase()})&&(a=e.GetType(s))}),a},e}()},27916:(e,t,a)=>{var s,i,r,n,o;a.d(t,{Zg:()=>l}),function(e){e[e.OK=0]="OK",e[e.ContainsDefaultReservedWords=1]="ContainsDefaultReservedWords",e[e.MissingPrefixSuffix=2]="MissingPrefixSuffix",e[e.ContainsCustomBlockedWords=3]="ContainsCustomBlockedWords",e[e.ContainsMSStandardBlockedWords=4]="ContainsMSStandardBlockedWords",e[e.MailNicknameNotOK=5]="MailNicknameNotOK",e[e.Unknown=6]="Unknown"}(s||(s={})),function(e){e.Forbidden="Forbidden",e.NotFound="NotFound",e.CreatePlanForGroupFailed="CreatePlanForGroupFailed",e.MaximumPlansOwnedByUserReached="MaximumPlansOwnedByUserReached",e.UnknownError="UnknownError"}(i||(i={})),function(e){e.Offline="Offline"}(r||(r={})),function(e){e.DynamicImportError="DynamicImportError"}(n||(n={})),function(e){e.MaximumProjectsOwnedByUser="MaximumProjectsOwnedByUser",e.MaximumProjectsSharedWithUser="MaximumProjectsSharedWithUser",e.MaximumTasksCreatedByUser="MaximumTasksCreatedByUser",e.MaximumTasksAssignedToUser="MaximumTasksAssignedToUser",e.MaximumTasksInProject="MaximumTasksInProject",e.MaximumActiveTasksInProject="MaximumActiveTasksInProject",e.MaximumBucketsInProject="MaximumBucketsInProject",e.MaximumUsersSharedWithProject="MaximumUsersSharedWithProject",e.MaximumReferencesOnTask=" MaximumReferencesOnTask",e.MaximumChecklistItemsOnTask="MaximumChecklistItemsOnTask",e.MaximumAssigneesInTasks="MaximumAssigneesInTasks",e.MaximumFavoritePlansForUser="MaximumFavoriteProjectsForUser",e.MaximumRecentPlansForUser="MaximumRecentProjectsForUser",e.MaximumContextsOnPlan="MaximumContextsOnPlan"}(o||(o={}));const l="ArchivedEntityCanNotBeUpdated"},36591:(e,t,a)=>{a.d(t,{C:()=>s});class s{constructor(e,t,a,s,i){this.dispatcher=e,this.logicModuleProviders=t,this.entityStoreSet=a,this.clientSettings=s,this.loggers=i}}},39156:(e,t,a)=>{a.d(t,{n:()=>s});class s extends Error{constructor(e){super(),Object.setPrototypeOf(this,s.prototype),this.message="".concat(e," should not be null"),this.name="NullReferenceError"}}},57718:(e,t,a)=>{function s(e){for(var t="";t.length<e;){var a=16*Math.random();t+=(a|=0).toString(16)}return t}a.d(t,{cM:()=>i});function i(){var e=[];e.push(s(8)),e.push(s(4));var t="4"+s(3);e.push(t);var a=s(4),i=parseInt(a[0],16);return i&=3,a=(i|=8).toString(16)+a.substr(1),e.push(a),e.push(s(12)),e.join("-")}},70776:(e,t,a)=>{a.d(t,{k:()=>i});var s=a(28730);function i(e,t){return s.l.compareByOrderHint(t,e,e=>e?e.orderHint:null)}},91675:(e,t,a)=>{a.d(t,{t:()=>s});var s={Word:["docx","docm","doc","dotx","dotm"],Excel:["xlsx","xlsm","xlsb","xltx","xltm","xls","xlam","xla","xlw","xml"],PowerPoint:["pptx","pptm","ppt","potx","potm","pot","thmx","pps","ppsx","ppsm","ppsam","ppa"],OneNote:["one"],Project:["mpp","mpt","mpd"],Visio:["vsdx","vsd","vsdm","vssx","vssm","vstx","vstm"],Pdf:["pdf"],Loop:["loop","fluid"]}}}]);
//# sourceMappingURL=taskac.806788d9.chunk.js.map