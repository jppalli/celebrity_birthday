(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[37308],{9376:(t,e,a)=>{var s=a(64416);t.exports=function(t){return t&&t.length?s(t):[]}},16701:(t,e,a)=>{"use strict";a.d(e,{Gx:()=>i,_6:()=>l,mW:()=>s});var s,r=a(94772),o=a(72866),n=a(67271);!function(t){t.DueDate="DueDate",t.Priority="Priority",t.Progress="Progress",t.Label="Label",t.Bucket="Bucket",t.Assignment="Assignment"}(s||(s={}));const i={DueDate:"dueDate",Priority:"priority",Progress:"percentComplete",Label:"appliedCategories",Bucket:"bucketId",Assignment:"assignments"},l=new o.d("percentComplete",[(0,n.BK)(r.$.NotStarted),(0,n.BK)(r.$.InProgress)])},25588:(t,e,a)=>{"use strict";var s;a.d(e,{s:()=>s}),function(t){t.TeamsTab="teamsTab",t.SharePointPage="sharePointPage",t.MeetingNotes="meetingNotes",t.LoopPage="loopPage",t.Other="other"}(s||(s={}))},27197:(t,e,a)=>{"use strict";a.d(e,{o:()=>r});var s=a(75992);class r extends s.r{loggingData(){return{id:this.deletedTaskEntitySet.id,isSystemGenerated:String(this.isSystemGenerated)}}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(r.actionType),this.deletedTaskEntitySet=t,this.isSystemGenerated=e}}r.actionType="PLW_DELETE_TASK_SUCCEEDED"},29274:(t,e,a)=>{"use strict";a.d(e,{S:()=>o});var s=a(75992),r=function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])},t(e,a)};return function(e,a){function s(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}(),o=function(t){function e(a,s,r){var o=t.call(this,e.type)||this;return o.name=a,o.id=s,o.additionalData=r,o}return r(e,t),e.prototype.loggingData=function(){return{name:this.name,id:this.id}},e.type="BEGIN_TRANSACTION",e}(s.r)},30210:(t,e,a)=>{"use strict";a.d(e,{Z:()=>k,g:()=>v});var s=a(25588),r=a(54320),o=a.n(r),n=a(32520),i=a.n(n),l=a(57273),c=a.n(l),d=a(87424),u=a.n(d),g=a(45795),p=a(78332),h=a(67053);function k(t,e){if(!t||o()(t.contexts)||!e)return!1;const a=Object.keys(t.contexts);return-1!==i()(a,t=>{const a=e.contextDetails[t];return null!=a&&a.displayAs===s.s.MeetingNotes})}function v(t,e){if(o()(t))return null;const a=c()(t,(t,a)=>{switch(e){case g.s.Teams:return h.c.isTeamsPlannerClientEntraAppId(t.ownerAppId);case g.s.SharepointApp:return h.c.isSharepointAppId(t.ownerAppId);case g.s.Plex:return t.ownerAppId===p.uc.PlannerWeb;case void 0:return h.c.isTeamsPlannerClientEntraAppId(t.ownerAppId)||h.c.isSharepointAppId(t.ownerAppId)||t.ownerAppId===p.uc.PlannerWeb;default:throw new Error("Invalid client type specified [ClientType=".concat(e,"]"))}}),s=Object.keys(a);return o()(s)?null:u()(s,[t=>a[t].createdDate])[0]}},39227:(t,e,a)=>{"use strict";a.r(e),a.d(e,{TaskModule:()=>ft});var s=a(27051),r=a(79757),o=a(69292),n=a(41788),i=a(73322),l=a(48475),c=a(40164),d=a(45721),u=a(23359),g=a(90506),p=a(27197),h=a(28571),k=a(96693),v=a(96020),T=a(31316),m=a(713),f=a(73624),F=a(83574),y=a(89469),w=a(69252),A=a(48537),D=a(449),I=a(14e3),b=a(75992);class S extends b.r{loggingData(){return{id:this.failedTaskId}}constructor(t){super(S.actionType),this.failedTaskId=t}}S.actionType="PLW_REORDER_TASKS";class P extends b.r{loggingData(){return{id:this.failedTaskId}}constructor(t){super(P.actionType),this.failedTaskId=t}}P.actionType="PLW_REORDER_TASKS_SUCCEEDED";class C extends b.r{loggingData(){return{id:this.failedTaskId,reorderPhase:this.reorderPhase}}constructor(t,e){super(C.actionType),this.failedTaskId=t,this.reorderPhase=e}}C.actionType="PLW_REORDER_TASKS_FAILED";var E=a(79799),x=a(59393),O=a(40699),_=a(66061),B=a(95783),L=a(78332),V=a(45795),R=a(38752),j=a(64805);class U extends Error{constructor(t){super(),this.errorMessage=t,this.message=t||"",this.name="ParseContextKeyError"}}U.DOUBLE_ENCODED_CONTEXTKEY="The Context Key is double encoded";var H=a(9962),W=a(52274),N=a(32561),K=a(80708),M=a(39589),G=a(70252),q=a(74844),Y=a(65818),X=a(14740),J=a.n(X),Z=a(32520),$=a.n(Z),Q=a(55491),z=a.n(Q),tt=a(54320),et=a.n(tt),at=a(10871),st=a.n(at),rt=a(33411),ot=a.n(rt),nt=a(35640),it=a.n(nt),lt=a(91246),ct=a(67271),dt=a(7670),ut=a(98424),gt=a(98502),pt=a(54439),ht=a(82841),kt=a(21382),vt=a(86053),Tt=a(30210);class mt{static parseChannelIdFromTeamsContextKey(t){if(""===t)throw new U("Context key cannot be empty");const e=decodeURIComponent(t);if(decodeURIComponent(e)!==e)throw new U(U.DOUBLE_ENCODED_CONTEXTKEY);const a=e.split("#"),s=parseInt(a[0],10);if(isNaN(s)||2!==a.length||a[1].length<=s)throw new U("Invalid context key: ".concat(e));return a[1].slice(s)}static findDuplicateTeamsContextKeys(t,e){const a=[];for(const o in t){const e=t[o];e.ownerAppId!==L.uc.MSTeamsWeb&&e.ownerAppId!==L.uc.MSTeamsDesktop||a.push(o)}if(a.length<2)return[];const s={},r=[];for(const o of a){const t="#",a=o.split(t),n=parseInt(a[0],10);if(isNaN(n)||2!==a.length||a[1].length<=n){e.logTrace(507778444,q.k.Warning,"Invalid context encountered when deduping Teams contexts. [contextKey=".concat(o,"]"));continue}const i=a[1].slice(n),l=36;null==s[i]?s[i]={teamIdLength:n,contextKey:o}:s[i].teamIdLength===l?(r.push(s[i].contextKey),s[i]={teamIdLength:n,contextKey:o}):r.push(o)}return r}}class ft extends j.J{get name(){return"TaskModule"}async createTaskAsync(t,e,a){this.loggers.traceLogger.logTrace(507897177,q.k.Verbose,"Create task [TaskId=".concat(t.id,"]"));const s=t.id+"_createTask";pt.j.beginTransaction(this.dispatcher,{name:"createTask",transactionId:s,action:new r.M(t)},this.loggers.logHandler);const i=e=>{var a,r,n,i;pt.j.completeTransactionWithError(this.dispatcher,{transactionId:s,errorMessage:"",action:new o.N(t,e.response,null!==(a=null===(r=e.response)||void 0===r?void 0:r.statusText)&&void 0!==a?a:"",null!==(n=null===(i=e.error)||void 0===i?void 0:i.message)&&void 0!==n?n:"")})};if(e)try{await e}catch(l){const e=l;return this.loggers.traceLogger.logTrace(507897176,q.k.Warning,"Create task - Dependent promise fail [TaskId=".concat(t.id,"]").concat((0,ht.s8)(e))),i(e),Promise.reject(e)}try{const e=await this.webApiProviders.taskService(),a=await e.createTaskAsync({newTaskEntitySet:t});return this.loggers.traceLogger.logTrace(507897175,q.k.Verbose,"Create task - Success [TaskId=".concat(t.id,"]")),pt.j.completeTransaction(this.dispatcher,{transactionId:s,action:new n.r(a,t.task.id),additionalData:a.task}),a}catch(l){const e=l;return this.loggers.traceLogger.logTrace(507897174,q.k.Warning,"Create task - Fail [TaskId=".concat(t.id,"]").concat((0,ht.s8)(e))),e.error instanceof W.U||null==a?i(e):a(e,()=>i(e)),Promise.reject(e)}}async createTaskApprovalAsync(t,e){var a,s,r,o;const n=this.stores.taskStore.getTask(t),c=kt.G(vt.p.Strings.AddApprover_TaskEditorWrapper_SendApprovalRequest_Title,null===n||void 0===n?void 0:n.title),d=kt.G(vt.p.Strings.AddApprover_TaskEditorWrapper_SendApprovalRequest_AttachmentName,null===n||void 0===n?void 0:n.title);let u=null,g="",p=null;if(n){const e=this.stores.planStore.getPlan(n.planId);if(e){var h;const a=e.container.externalId,s=null!=a?this.stores.containerStore.getContainer(a):null,r=(null===s||void 0===s?void 0:s.containerType)===Y.K.Group?s:null;u=null!==(h=null===r||void 0===r?void 0:r.unifiedGroup)&&void 0!==h?h:null;try{if(p=(0,Tt.g)(e.contexts,V.s.Teams),!p)throw new Error("Plan context key cannot be null or empty");g=mt.parseChannelIdFromTeamsContextKey(p)}catch(I){const a="Failed to parse channel id from teams plan context key [TaskId=".concat(t,"][PlanId=").concat(e.id,"][ContextKey=").concat(p,"][Error=").concat(I,"]");if(!(p&&e.contexts[p]&&I instanceof U))return this.loggers.traceLogger.logTrace(507122386,q.k.Warning,"Create task approval - ".concat(a)),Promise.reject(gt.g.generateAjaxClientError(null,a));var k,v,T;this.loggers.traceLogger.logTrace(507122387,q.k.Warning,I.message,{PlanId:e.id,ContextKey:p,CreatedDateTime:null!==(k=null===(v=e.contexts[p].createdDate)||void 0===v?void 0:v.toISOString())&&void 0!==k?k:"",OwnerAppId:null!==(T=e.contexts[p].ownerAppId)&&void 0!==T?T:""});try{if(I.message!==U.DOUBLE_ENCODED_CONTEXTKEY)throw I;p=decodeURIComponent(p),g=mt.parseChannelIdFromTeamsContextKey(p)}catch(I){return this.loggers.traceLogger.logTrace(507122388,q.k.Warning,"Create task approval - ".concat(a,"[RetryError=").concat(I,"]")),Promise.reject(gt.g.generateAjaxClientError(null,a))}}}}this.dispatcher.dispatchAction(new i.Z(t));const m=null!==(a=null===(s=u)||void 0===s?void 0:s.id)&&void 0!==a?a:"",f=null!==(r=null===(o=u)||void 0===o?void 0:o.displayName)&&void 0!==r?r:"",F=kt.G(vt.p.Strings.AddApprover_TaskEditorWrapper_SendApprovalRequest_Details,f);try{const a={taskId:t,approverIds:e,rosterContext:{teamId:m,channelId:g},title:c,attachmentName:d,details:F};if(this.shouldUseRetailService()&&this.webApiProviders.retailService){const e=await this.webApiProviders.retailService(),s=await e.createApprovalAsync(a);return this.loggers.traceLogger.logTrace(507790346,q.k.Verbose,"Create task approval - Success [TaskId=".concat(t,", CreatedApprovalId=").concat(s,"]")),{approvalId:s}}{const e=await this.webApiProviders.taskService(),s=await e.createApproval(a);return this.loggers.traceLogger.logTrace(507270737,q.k.Verbose,"Create task approval - Success [TaskId=".concat(t,", CreatedApprovalId=").concat(s,"]")),s}}catch(I){var y,w,A,D;const e=I;return this.loggers.traceLogger.logTrace(507790345,q.k.Warning,"Create task approval - Fail [TaskId=".concat(t,"] ").concat((0,ht.s8)(e))),this.dispatcher.dispatchAction(new l.C(e.response,null!==(y=null===(w=e.response)||void 0===w?void 0:w.statusText)&&void 0!==y?y:"",null!==(A=null===(D=e.error)||void 0===D?void 0:D.message)&&void 0!==A?A:"",t)),Promise.reject(e)}}async updateTaskAsync(t,e,a,s){var r,o,n,i,l,g;this.loggers.traceLogger.logTrace(507897173,q.k.Verbose,"Update task [TaskId=".concat(t.id,"]"));const p=e.id+"_updateTask",h=lt.o.generate(),k=t.task.getDiff(e.task),v=null!=t.taskDetails&&null!=e.taskDetails?t.taskDetails.getDiff(e.taskDetails):{},T=null!=(null===(r=t.taskFormatData)||void 0===r?void 0:r.assignmentBoardFormat)&&null!=(null===(o=e.taskFormatData)||void 0===o?void 0:o.assignmentBoardFormat)?t.taskFormatData.assignmentBoardFormat.getDiff(e.taskFormatData.assignmentBoardFormat):{},m=null!=(null===(n=t.taskFormatData)||void 0===n?void 0:n.bucketBoardFormat)&&null!=(null===(i=e.taskFormatData)||void 0===i?void 0:i.bucketBoardFormat)?t.taskFormatData.bucketBoardFormat.getDiff(e.taskFormatData.bucketBoardFormat):{},f=null!=(null===(l=t.taskFormatData)||void 0===l?void 0:l.progressBoardFormat)&&null!=(null===(g=e.taskFormatData)||void 0===g?void 0:g.progressBoardFormat)?t.taskFormatData.progressBoardFormat.getDiff(e.taskFormatData.progressBoardFormat):{};pt.j.beginTransaction(this.dispatcher,{name:"updateTask",transactionId:p,action:new c.f(t,e,h)},this.loggers.logHandler);const F=t=>{let e=t.originalTaskEntitySet.task,a=t.updatedTaskEntitySet.task;const s=this.stores.taskStore.getTaskWithoutPendingUpdates(t.originalTaskEntitySet.id),r=null!=s&&null!=e&&null!=a;if(!et()(k)||r){if(null==s)throw gt.g.generateAjaxClientError(null,new H.m("taskWithoutPending","taskStore"));e=s,a=e.applyDiffs(k)}let o=t.originalTaskEntitySet.taskDetails,n=t.updatedTaskEntitySet.taskDetails;if(null!=t.originalTaskEntitySet.taskDetails&&null!=t.updatedTaskEntitySet.taskDetails&&!et()(v)){const e=this.stores.taskStore.getTaskDetailsWithoutPendingUpdates(t.originalTaskEntitySet.id);if(null==e)throw gt.g.generateAjaxClientError(null,new H.m("detailsWithoutPending","taskStore"));o=e,n=o.applyDiffs(v)}let i=t.originalTaskEntitySet.taskFormatData,l=t.updatedTaskEntitySet.taskFormatData;if(null!=t.originalTaskEntitySet.taskFormatData&&null!=t.updatedTaskEntitySet.taskFormatData){const e=this.stores.taskStore.getTaskboardTaskFormattingWithoutPendingUpdates(t.originalTaskEntitySet.id);let a=null,s=null;null==t.originalTaskEntitySet.taskFormatData.assignmentBoardFormat||null==t.updatedTaskEntitySet.taskFormatData.assignmentBoardFormat||null==(null===e||void 0===e?void 0:e.assignmentBoardFormat)||et()(T)||(a=e.assignmentBoardFormat,s=a.applyDiffs(T));let r=null,o=null;null==t.originalTaskEntitySet.taskFormatData.bucketBoardFormat||null==t.updatedTaskEntitySet.taskFormatData.bucketBoardFormat||null==(null===e||void 0===e?void 0:e.bucketBoardFormat)||et()(m)||(r=e.bucketBoardFormat,o=r.applyDiffs(m));let n=null,c=null;null==t.originalTaskEntitySet.taskFormatData.progressBoardFormat||null==t.updatedTaskEntitySet.taskFormatData.progressBoardFormat||null==(null===e||void 0===e?void 0:e.progressBoardFormat)||et()(f)||(n=e.progressBoardFormat,c=n.applyDiffs(f)),(a||r||n)&&(i=M._.builder.withPropertyBag({assignedBoardFormat:a||void 0,bucketBoardFormat:r||void 0,progressBoardFormat:n||void 0}).build()),(s||o||c)&&(l=M._.builder.withPropertyBag({assignedBoardFormat:s||void 0,bucketBoardFormat:o||void 0,progressBoardFormat:c||void 0}).build())}return{originalTaskEntitySet:K.F.builder.withTask(e).withDetails(o).withFormatData(i).build(),updatedTaskEntitySet:K.F.builder.withTask(a).withDetails(n).withFormatData(l).build()}},y=a=>{var s,r,o,n;pt.j.completeTransactionWithError(this.dispatcher,{transactionId:p,errorMessage:"",action:new d.K(t,e,h,a.response,null!==(s=null===(r=a.response)||void 0===r?void 0:r.statusText)&&void 0!==s?s:"",null!==(o=null===(n=a.error)||void 0===n?void 0:n.message)&&void 0!==o?o:"")})};if(a)try{await a}catch(w){const e=w;return this.loggers.traceLogger.logTrace(507897172,q.k.Warning,"Update task - Dependent promise fail [TaskId=".concat(t.id,"]").concat((0,ht.s8)(e))),y(e),Promise.reject(e)}try{const a=await this.webApiProviders.taskService(),s=await a.updateTaskAsync({originalTaskEntitySet:t,updatedTaskEntitySet:e},F);return this.loggers.traceLogger.logTrace(507897171,q.k.Verbose,"Update task - Success [TaskId=".concat(t.id,"]")),pt.j.completeTransaction(this.dispatcher,{transactionId:p,action:new u.U(t,s,h)}),s}catch(w){this.loggers.traceLogger.logTrace(507897170,q.k.Warning,"Update task - Fail [TaskId=".concat(t.id,"]").concat((0,ht.LB)(w)));const e=w;return e.error instanceof W.U||null==s?y(e):s(e,()=>y(e)),Promise.reject(e)}}async deleteTaskAsync(t,e){this.loggers.traceLogger.logTrace(507897169,q.k.Verbose,"DeleteTask [TaskId=".concat(t,"][Version=").concat(e,"]"));const a=this.stores.taskStore.getTask(t);if(null==a)throw gt.g.generateAjaxClientError(null,new H.m("task","taskStore"));this.dispatcher.dispatchAction(new g.N(K.F.builder.withTask(a).build()));try{const a=await this.webApiProviders.taskService(),s=await a.deleteTaskAsync({taskId:t,itemVersion:e});return this.loggers.traceLogger.logTrace(507897168,q.k.Verbose,"DeleteTask - Success [TaskId=".concat(t,"][Version=").concat(e,"]")),this.dispatcher.dispatchAction(new p.o(s)),s}catch(i){var s,r,o,n;const l=i;return this.loggers.traceLogger.logTrace(507897167,q.k.Warning,"DeleteTask - Fail [TaskId=".concat(t,"][Version=").concat(e,"] ").concat((0,ht.s8)(l))),this.dispatcher.dispatchAction(new h.a(K.F.builder.withTask(a).build(),l.response,null!==(s=null===(r=l.response)||void 0===r?void 0:r.statusText)&&void 0!==s?s:"",null!==(o=null===(n=l.error)||void 0===n?void 0:n.message)&&void 0!==o?o:"")),Promise.reject(l)}}async undeleteTaskAsync(t){this.loggers.traceLogger.logTrace(507897166,q.k.Verbose,"Undelete task [TaskId=".concat(t.id,"]")),this.dispatcher.dispatchAction(new k.G(t));try{const e=await this.webApiProviders.taskService(),a=await e.undeleteTaskAsync({taskId:t.id,itemVersion:t.task.itemVersion});return this.loggers.traceLogger.logTrace(507897165,q.k.Verbose,"Undelete task - Success [TaskId=".concat(t.id,"]")),this.dispatcher.dispatchAction(new v.N(a)),a}catch(o){var e,a,s,r;const n=o;return this.loggers.traceLogger.logTrace(507897164,q.k.Warning,"Undelete task - Fail [TaskId=".concat(t.id,"]").concat((0,ht.s8)(n))),this.dispatcher.dispatchAction(new T.f(t,n.response,null!==(e=null===(a=n.response)||void 0===a?void 0:a.statusText)&&void 0!==e?e:"",null!==(s=null===(r=n.error)||void 0===r?void 0:r.message)&&void 0!==s?s:"")),Promise.reject(n)}}async fetchTaskAsync(t,e,a){this.loggers.traceLogger.logTrace(507897163,q.k.Verbose,"Fetching Task [TaskId=".concat(t,"][Force=").concat(null!==e&&void 0!==e&&e,"]"));const s=this.stores.taskStore.getTask(t),r=this.stores.taskStore.getTaskDetails(t),o=this.stores.taskStore.getTaskboardTaskFormatting(t);if(!e&&s&&r&&o&&o.assignmentBoardFormat&&o.bucketBoardFormat&&o.progressBoardFormat)return Promise.resolve(K.F.builder.withTask(s).withDetails(r).withFormatData(o).build());let n,i;e||(n=t=>{const e=this.stores.taskStore.getTask(t.taskId),a=this.stores.taskStore.getTaskDetails(t.taskId),s=this.stores.taskStore.getTaskboardTaskFormatting(t.taskId);return null==e||null==a||null==s||null==s.assignmentBoardFormat||null==s.bucketBoardFormat||null==s.progressBoardFormat?null:K.F.builder.withTask(e).withDetails(a).withFormatData(s).build()},i=this.getCurrentViewIds());const l=t+L.Ek.FetchTask;pt.j.beginTransaction(this.dispatcher,{name:"fetchTask",transactionId:l},this.loggers.logHandler);try{const s=await this.webApiProviders.taskService(),r=await s.getTaskEntitySetAsync({taskId:t},n,i,a);return this.loggers.traceLogger.logTrace(507897162,q.k.Verbose,"Fetching Task - Success [TaskId=".concat(t,"][Force=").concat(null!==e&&void 0!==e&&e,"][taskCreationSourceType=").concat(r.task.taskCreationSourceType,"]")),pt.j.completeTransaction(this.dispatcher,{transactionId:l,action:new m.U(r)}),r}catch(c){const a=c;return this.loggers.traceLogger.logTrace(507897161,q.k.Warning,"Fetching Task - Fail [TaskId=".concat(t,"][Force=").concat(null!==e&&void 0!==e&&e,"]").concat((0,ht.s8)(a))),pt.j.completeTransactionWithError(this.dispatcher,{transactionId:l,errorMessage:"",additionalData:null!=a.response?{statusCode:a.response.status}:void 0}),Promise.reject(a)}}async fetchPlanTasksAsync(t,e){this.loggers.traceLogger.logTrace(507897160,q.k.Verbose,"Fetching Plan Tasks [PlanId=".concat(t,"][Force=").concat(null!==e&&void 0!==e&&e,"]"));const a=[];try{const s=await this.fetchPlanTasksRecursiveAsync(t,a,void 0,e);return this.loggers.traceLogger.logTrace(507897159,q.k.Verbose,"Fetching Plan Tasks - Success [PlanId=".concat(t,"][Force=").concat(null!==e&&void 0!==e&&e,"]")),s}catch(s){const a=s;return this.loggers.traceLogger.logTrace(507897158,q.k.Warning,"Fetching Plan Tasks - Fail [PlanId=".concat(t,"][Force=").concat(null!==e&&void 0!==e&&e,"]").concat((0,ht.s8)(a))),Promise.reject(a)}}async fetchTasksAssignedToUserAsync(t){this.loggers.traceLogger.logTrace(507897157,q.k.Verbose,"Fetching My Tasks");const e=[];try{const a=await this.fetchTasksAssignedToUserRecursiveAsync(t,void 0,e);return this.loggers.traceLogger.logTrace(507897156,q.k.Info,"Fetching User Assigned Tasks - Success"),a}catch(a){const t=a;return this.loggers.traceLogger.logTrace(507897155,q.k.Warning,"Fetching User Assigned Tasks - Fail ".concat((0,ht.s8)(t))),Promise.reject(t)}}async fetchTaskApprovalDetailsAsync(t){this.loggers.traceLogger.logTrace(507897154,q.k.Verbose,"Fetching Task Approval Details"),this.dispatcher.dispatchAction(new f.n(t));try{if(this.shouldUseRetailService()&&this.webApiProviders.retailService){const e=await this.webApiProviders.retailService(),a=await e.getApprovalDetailsAsync({taskId:t});return this.loggers.traceLogger.logTrace(507897153,q.k.Verbose,"Fetching Task Approval Details - Success"),this.dispatcher.dispatchAction(new F.j(t,a)),{properties:a,name:""}}{const e=await this.webApiProviders.taskService(),a=await e.getApprovalDetailsAsync({taskId:t});return this.loggers.traceLogger.logTrace(507275287,q.k.Verbose,"Fetching Task Approval Details - Success"),this.dispatcher.dispatchAction(new F.j(t,a.properties)),a}}catch(o){var e,a,s,r;const n=o;return this.loggers.traceLogger.logTrace(507897152,q.k.Warning,"Fetching Task Approval Details - Fail ".concat((0,ht.s8)(n))),this.dispatcher.dispatchAction(new y.E(n.response,null!==(e=null===(a=n.response)||void 0===a?void 0:a.statusText)&&void 0!==e?e:"",null!==(s=null===(r=n.error)||void 0===r?void 0:r.message)&&void 0!==s?s:"",t)),Promise.reject(n)}}async cancelApprovalAsync(t){this.loggers.traceLogger.logTrace(507790350,q.k.Verbose,"Canceling Approval"),this.dispatcher.dispatchAction(new w.x(t));try{if(this.shouldUseRetailService()&&this.webApiProviders.retailService){const e=await this.webApiProviders.retailService();await e.cancelApprovalAsync({taskId:t})}else{const e=await this.webApiProviders.taskService();await e.cancelApproval({taskId:t})}this.loggers.traceLogger.logTrace(507639747,q.k.Verbose,"Canceling Approval - Success")}catch(o){var e,a,s,r;const n=o;return this.loggers.traceLogger.logTrace(507790349,q.k.Warning,"Canceling Approval - Fail ".concat((0,ht.s8)(n))),this.dispatcher.dispatchAction(new A.W(n.response,null!==(e=null===(a=n.response)||void 0===a?void 0:a.statusText)&&void 0!==e?e:"",null!==(s=null===(r=n.error)||void 0===r?void 0:r.message)&&void 0!==s?s:"",t)),Promise.reject(n)}}async updateTaskApprovalAsync(t,e,a){this.loggers.traceLogger.logTrace(507790348,q.k.Verbose,"Updating task approval status"),this.dispatcher.dispatchAction(new D.O(t));try{const s={taskId:t,response:e,comments:a};if(this.shouldUseRetailService()&&this.webApiProviders.retailService){const t=await this.webApiProviders.retailService();await t.updateApprovalAsync(s)}else{const t=await this.webApiProviders.taskService();await t.updateApproval(s)}this.loggers.traceLogger.logTrace(507639746,q.k.Verbose,"Updating task approval status - Success")}catch(i){var s,r,o,n;const e=i;return this.loggers.traceLogger.logTrace(507790347,q.k.Warning,"Updating task approval status - Fail ".concat((0,ht.s8)(e))),this.dispatcher.dispatchAction(new I.L(e.response,null!==(s=null===(r=e.response)||void 0===r?void 0:r.statusText)&&void 0!==s?s:"",null!==(o=null===(n=e.error)||void 0===n?void 0:n.message)&&void 0!==o?o:"",t)),Promise.reject(e)}}fixTaskOrderHintPrecision(t,e,a,s,r,o){var n,i,l;this.loggers.traceLogger.logTrace(507635296,q.k.Info,"FixTaskOrderHintPrecision [TaskId=".concat(e.id,"]"));const c=null==e.task?this.stores.taskStore.getTask(e.id):e.task,d=null!=c?this.stores.planStore.getPlan(c.planId):null,u=null!=c?this.stores.taskStore.getTasksForPlan(c.planId):null;if(null==e||null==e.taskFormatData||null!=t&&null==t.taskFormatData||null==c||null==d||null==u||et()(u))return this.loggers.traceLogger.logTrace(507635295,q.k.Info,"FixTaskOrderHintPrecision - Invalid data [TaskId=".concat(e.id,"]")),o(),void a();const g=st()(this.stores.userStore.getContainerUsers(d.container.externalId),"id"),p=[];if(null==t&&null!=e.taskFormatData.assignmentBoardFormat||null!=(null===t||void 0===t||null===(n=t.taskFormatData)||void 0===n?void 0:n.assignmentBoardFormat)&&null!=e.taskFormatData.assignmentBoardFormat){const a=st()(this.stores.taskStore.getTaskboardTaskFormattingForPlan(c.planId,G.s.AssignedTo),"id"),s=this.filterTaskGroupsByCompletion((0,dt.Fy)(u,a,g,this.stores.appContextStore.getCurrentUserId()),c.isComplete());z()(s,a=>{var s;const r=e.taskFormatData?M._.getAssignedToOrderHint(e.taskFormatData,a.pivotValue):null;null==r||et()(a.pivotValue)&&0!==it()(null===(s=e.taskFormatData)||void 0===s||null===(s=s.assignmentBoardFormat)||void 0===s?void 0:s.orderHintsByAssignee)||null!=t&&(t.taskFormatData?M._.getAssignedToOrderHint(t.taskFormatData,a.pivotValue):null)===r||p.push(this.getTaskGroupReorderData(a,e.id,M._.getAssignedToOrderHint,M._.setAssignedToOrderHint))})}if(null==t&&null!=e.taskFormatData.bucketBoardFormat||null!=(null===t||void 0===t||null===(i=t.taskFormatData)||void 0===i?void 0:i.bucketBoardFormat)&&null!=e.taskFormatData.bucketBoardFormat&&(null===t||void 0===t?void 0:t.taskFormatData.bucketBoardFormat.orderHint)!==e.taskFormatData.bucketBoardFormat.orderHint){const t=st()(this.stores.taskStore.getTaskboardTaskFormattingForPlan(c.planId,G.s.Bucket),"id"),a=this.filterTaskGroupsByCompletion((0,dt.M1)(u,t,c.bucketId?J()([this.stores.bucketStore.getBucket(c.bucketId)]):[]).filter(t=>null!=t.pivotValue),c.isComplete());a.length>0&&p.push(this.getTaskGroupReorderData(a[0],e.id,M._.getBucketOrderHint,M._.setBucketOrderHint))}if(null==t&&null!=e.taskFormatData.progressBoardFormat||null!=(null===t||void 0===t||null===(l=t.taskFormatData)||void 0===l?void 0:l.progressBoardFormat)&&null!=e.taskFormatData.progressBoardFormat&&(null===t||void 0===t?void 0:t.taskFormatData.progressBoardFormat.orderHint)!==e.taskFormatData.progressBoardFormat.orderHint){const t=st()(this.stores.taskStore.getTaskboardTaskFormattingForPlan(c.planId,G.s.Progress),"id"),a=(0,dt.py)(u,t);z()(a,t=>{t.pivotValue===(0,ct.Fk)(c.percentComplete)&&p.push(this.getTaskGroupReorderData(t,e.id,M._.getProgressOrderHint,M._.setProgressOrderHint))})}const h=this.hasInternalOrderHints(e);if(h&&(e=this.fixInternalOrderHintPrecision(e)),et()(p)&&!h)return this.loggers.traceLogger.logTrace(507635294,q.k.Verbose,"FixTaskOrderHintPrecision - No updates needed [TaskId=".concat(e.id,"]")),o(),void a();this.dispatcher.dispatchAction(new S(c.id)),s(p,!0).then(n=>{this.loggers.traceLogger.logTrace(507897123,q.k.Verbose,"FixTaskOrderHintPrecision - Reordered above groups [TaskId=".concat(e.id,"]")),o(),r(t,e,n).then(t=>{this.loggers.traceLogger.logTrace(507897122,q.k.Verbose,"FixTaskOrderHintPrecision - Fixed task [TaskId=".concat(e.id,"][taskCreationSourceType=").concat(c.taskCreationSourceType,"]")),s(t,!1).then(()=>{this.loggers.traceLogger.logTrace(507897121,q.k.Verbose,"FixTaskOrderHintPrecision - Reordered bottom groups [TaskId=".concat(e.id,"]")),this.dispatcher.dispatchAction(new P(c.id))},()=>{this.loggers.traceLogger.logTrace(507897120,q.k.Verbose,"FixTaskOrderHintPrecision - Failed to reorder bottom groups [TaskId=".concat(e.id,"]")),this.dispatcher.dispatchAction(new C(c.id,"Reorder below tasks"))})},()=>{this.loggers.traceLogger.logTrace(507897119,q.k.Info,"FixTaskOrderHintPrecision - Failed to fix task [TaskId=".concat(e.id,"][taskCreationSourceType=").concat(c.taskCreationSourceType,"]")),a(),this.dispatcher.dispatchAction(new C(c.id,"Fix task"))})},()=>{this.loggers.traceLogger.logTrace(507897118,q.k.Verbose,"FixTaskOrderHintPrecision - Failed to reorder above groups [TaskId=".concat(e.id,"]")),o(),a(),this.dispatcher.dispatchAction(new C(c.id,"Reorder above tasks"))})}async fetchPlanTasksRecursiveAsync(t,e,a,r){let o=t=>{if(null!=t.nextContinuationToken)return null;const e=this.stores.taskStore.getTasksForPlan(t.planId);if(et()(e))return null;const a=ot()(e,t=>{const e=this.stores.taskStore.getTaskDetails(t.id),a=this.stores.taskStore.getTaskboardTaskFormatting(t.id);return K.F.builder.withTask(t).withDetails(null!==e&&void 0!==e?e:void 0).withFormatData(null!==a&&void 0!==a?a:void 0).build()});return{xCorrelationId:"",statusCode:B.t3.OK,data:{NextContinuationToken:null,Results:a}}};const n=this.stores.planStore.getContainerIdForPlan(t);let i=this.getCurrentViewIds();r&&(o=void 0,i=void 0);try{const r=await this.webApiProviders.taskService(),l=await r.getTasksForPlanAsync({planId:t,nextContinuationToken:a},o,i);e.push(...l.data.Results);const c=new E.a(t,n,l.data.Results,l.data.NextContinuationToken,null==a,null!=l.data.NextContinuationToken?null:e.map(t=>t.id));return this.dispatcher.dispatchAction(c),null!=l.data.NextContinuationToken?this.fetchPlanTasksRecursiveAsync(t,e,l.data.NextContinuationToken):(0,s.A)((0,s.A)({},l),{},{data:(0,s.A)((0,s.A)({},l.data),{},{Results:e})})}catch(g){var l,c,d,u;const e=g;return this.dispatcher.dispatchAction(new x.q(e.response,null!==(l=null===(c=e.response)||void 0===c?void 0:c.statusText)&&void 0!==l?l:"",null!==(d=null===(u=e.error)||void 0===u?void 0:u.message)&&void 0!==d?d:"",t)),Promise.reject(e)}}async fetchTasksAssignedToUserRecursiveAsync(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=this.getCurrentViewIds();try{const o=await this.webApiProviders.taskService(),n=await o.getTasksAssignedToCurrentUserAsync({nextContinuationToken:e},r);return a.push(...n.data.Results),this.dispatcher.dispatchAction(new O.e(t,n.data.Results,n.data.NextContinuationToken,null==e)),null!=n.data.NextContinuationToken?this.fetchTasksAssignedToUserRecursiveAsync(t,n.data.NextContinuationToken,a):(0,s.A)((0,s.A)({},n),{},{data:(0,s.A)((0,s.A)({},n.data),{},{Results:a})})}catch(c){var o,n,i,l;const e=c;return this.dispatcher.dispatchAction(new _.y(e.response,null!==(o=null===(n=e.response)||void 0===n?void 0:n.statusText)&&void 0!==o?o:"",null!==(i=null===(l=e.error)||void 0===l?void 0:l.message)&&void 0!==i?i:"",t)),Promise.reject(e)}}filterTaskGroupsByCompletion(t,e){const a=[];return z()(t,t=>{const s={pivotValue:t.pivotValue,dataEntities:[],isOpen:t.isOpen};for(;t.dataEntities&&t.dataEntities.length>0;){const a=t.dataEntities.shift();a&&s.dataEntities&&a.isComplete()===e&&s.dataEntities.push(a)}a.push(s)}),a}getTaskGroupReorderData(t,e,a,s){const r=$()(t.dataEntities,t=>t.id===e),o={aboveTasks:null,belowTasks:null,nextOrderHint:ut.O.generateOrderHintBetween(null,null),pivotValue:t.pivotValue,getOrderHint:a,setOrderHint:s};return t.dataEntities&&r>0&&(o.aboveTasks=t.dataEntities.slice(0,r)),t.dataEntities&&r<t.dataEntities.length-1&&(o.belowTasks=t.dataEntities.slice(r+1)),o}hasInternalOrderHints(t){var e,a;return!et()(t.task.assignments)||!et()(null===(e=t.taskDetails)||void 0===e?void 0:e.checklist)||!et()(null===(a=t.taskDetails)||void 0===a?void 0:a.references)}fixInternalOrderHintPrecision(t){const e=K.F.builder.withTask(t.task).withDetails(t.taskDetails).withFormatData(t.taskFormatData);if(null!=t.task.assignments){const a=(t,e)=>ut.O.compareOrderHints(t.order,e.order),s=(t,e)=>t.setProperty("order",e);e.withTask(t.task.setProperty("assignments",this.fixCollectionOrder(t.task.assignments,a,s)))}if(null!=t.taskDetails){const a=N.U.builder.forClone(t.taskDetails);if(!et()(t.taskDetails.checklist)){const e=(t,e)=>ut.O.compareOrderHints(e.orderHint,t.orderHint),s=(t,e)=>t.setProperty("orderHint",e);a.checklist=this.fixCollectionOrder(t.taskDetails.checklist,e,s)}if(!et()(t.taskDetails.references)){const e=(t,e)=>ut.O.compareOrderHints(t.previewPriority,e.previewPriority),s=(t,e)=>t.setProperty("previewPriority",e);a.references=this.fixCollectionOrder(t.taskDetails.references,e,s)}e.taskDetails=a.build()}return e.build()}fixCollectionOrder(t,e,a){const s={};let r=[];z()(t,(t,e)=>r.push({key:e,value:t})),r=r.sort((t,a)=>e(t.value,a.value));let o=null;return z()(r,t=>{o=ut.O.generateOrderHintBetween(o,null),s[t.key]=a(t.value,o)}),s}shouldUseRetailService(){return R.B.isUnoContext&&!!this.webApiProviders.retailService}}},47204:(t,e,a)=>{"use strict";a.d(e,{Y:()=>o});var s=a(75992),r=function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])},t(e,a)};return function(e,a){function s(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}(),o=function(t){function e(a,s,r){var o=t.call(this,e.type)||this;return o.id=a,o.errorMessage=s,o.additionalData=r,o}return r(e,t),e.prototype.loggingData=function(){return{errorMessage:this.errorMessage,id:this.id}},e.type="TRANSACTION_FAILED",e}(s.r)},54439:(t,e,a)=>{"use strict";a.d(e,{j:()=>c});var s=a(29274),r=a(74427),o=a(57860),n=a(47204),i=a(74568),l=a(79947);class c{static beginTransaction(t,e,a){let{transactionId:r,name:o,logQos:n,action:l,additionalData:d}=e;if(!0===n){const t=new i.W({name:"Tx:"+o},a);c.qosEventsInFlight[r]=t}t.batchDispatchActions(new s.S(o,r,d),l)}static cancelTransaction(t,e){let{transactionId:a,action:s,additionalData:o}=e;const n=c.qosEventsInFlight[a];n&&(n.end({resultType:l.f.ExpectedFailure,extraData:o}),delete c.qosEventsInFlight[a]),t.batchDispatchActions(s,new r.D(a,o))}static completeTransaction(t,e){let{transactionId:a,action:s,additionalData:r}=e;const n=c.qosEventsInFlight[a];n&&(n.end({resultType:l.f.Success,extraData:r}),delete c.qosEventsInFlight[a]),t.batchDispatchActions(s,new o.M(a,r))}static completeTransactionWithBatch(t,e){let{transactionId:a,actions:s,additionalData:r}=e;const n=c.qosEventsInFlight[a];n&&(n.end({resultType:l.f.Success,extraData:r}),delete c.qosEventsInFlight[a]),t.batchDispatchActions(...s,new o.M(a,r))}static completeTransactionWithError(t,e){let{transactionId:a,errorMessage:s,action:r,additionalData:o}=e;const i=c.qosEventsInFlight[a];i&&(i.end({resultType:l.f.Failure,error:s,extraData:o}),delete c.qosEventsInFlight[a]),t.batchDispatchActions(r,new n.Y(a,s,o))}}c.qosEventsInFlight={}},57860:(t,e,a)=>{"use strict";a.d(e,{M:()=>o});var s=a(75992),r=function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])},t(e,a)};return function(e,a){function s(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}(),o=function(t){function e(a,s){var r=t.call(this,e.type)||this;return r.id=a,r.additionalData=s,r}return r(e,t),e.prototype.loggingData=function(){return{id:this.id}},e.type="TRANSACTION_SUCEEDED",e}(s.r)},64416:(t,e,a)=>{var s=a(18902),r=a(75866),o=a(41558),n=a(58114),i=a(68182),l=a(52074);t.exports=function(t,e,a){var c=-1,d=r,u=t.length,g=!0,p=[],h=p;if(a)g=!1,d=o;else if(u>=200){var k=e?null:i(t);if(k)return l(k);g=!1,d=n,h=new s}else h=e?[]:p;t:for(;++c<u;){var v=t[c],T=e?e(v):v;if(v=a||0!==v?v:0,g&&T===T){for(var m=h.length;m--;)if(h[m]===T)continue t;e&&h.push(T),p.push(v)}else d(h,T,a)||(h!==p&&h.push(T),p.push(v))}return p}},64805:(t,e,a)=>{"use strict";a.d(e,{J:()=>r});class s{get clientSettings(){return this.clientSettingsProvider()}constructor(t,e,a){this.dispatcher=t,this.clientSettingsProvider=e,this.loggers=a}}class r extends s{getCurrentViewIds(){const t=this.stores.appContextStore.getCurrentViewId();return t?[t]:void 0}constructor(t,e,a,s,r){super(t,s,r),this.webApiProviders=e,this.stores=a}}},68182:(t,e,a)=>{var s=a(72070),r=a(75713),o=a(52074),n=s&&1/o(new s([,-0]))[1]==1/0?function(t){return new s(t)}:r;t.exports=n},72866:(t,e,a)=>{"use strict";a.d(e,{S:()=>i,d:()=>l});var s=a(56434),r=a.n(s),o=a(54320),n=a.n(o);class i{get filterCount(){let t=0;return this.filters.forEach(e=>{t+=e.values.length}),t}getFieldFilterCount(t){const e=this.indexOfFilter(t);return e<0?0:this.filters[e].values.length}replaceFilter(t,e){const a=this.getClone(),s=a.filters.filter(e=>e.field===t);let r=a.filters;return n()(s)?r.push(e):r=a.filters.map(a=>a.field===t?e:a),new i(r)}removeFilter(t){const e=this.getClone(),a=e.indexOfFilter(t);return a>=0&&e.filters.splice(a,1),e}doesFilterValueExist(t,e){const a=this.indexOfFilter(t);return a>=0&&this.filters[a].values.indexOf(e)>=0}toggleFilterValue(t,e){return this.doesFilterValueExist(t,e)?this.removeFilterValue(t,e):this.addFilterValue(t,e)}addFilterValue(t,e){const a=this.getClone(),s=a.indexOfFilter(t);return s>=0?a.filters[s].values.push(e):a.filters.push(new l(t,[e])),a}removeFilterValue(t,e){const a=this.getClone(),s=a.indexOfFilter(t);if(s>=0){const t=a.filters[s].values.indexOf(e);t>=0&&a.filters[s].values.splice(t,1)}return 0===a.filters[s].values.length&&a.filters.splice(s,1),a}getClone(){return r()(this)}indexOfFilter(t){let e=-1;for(let a=0;a<this.filters.length;a++){this.filters[a].field===t&&(e=a)}return e}constructor(t){this.filters=[],null!=t&&(this.filters=t)}}class l{constructor(t,e){if(n()(e))throw new Error("InvalidArgumentException: values cannot be empty");this.field=t,this.values=e}}},74427:(t,e,a)=>{"use strict";a.d(e,{D:()=>o});var s=a(75992),r=function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])},t(e,a)};return function(e,a){function s(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}(),o=function(t){function e(a,s){var r=t.call(this,e.type)||this;return r.id=a,r.additionalData=s,r}return r(e,t),e.prototype.loggingData=function(){return{id:this.id}},e.type="CANCEL_TRANSACTION",e}(s.r)},75713:t=>{t.exports=function(){}}}]);
//# sourceMappingURL=taskmodule.9269ce0d.chunk.js.map