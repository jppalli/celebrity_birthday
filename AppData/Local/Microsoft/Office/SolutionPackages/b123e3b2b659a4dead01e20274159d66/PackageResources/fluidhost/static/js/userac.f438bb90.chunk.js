(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[9770],{2269:(e,t,r)=>{"use strict";r.r(t),r.d(t,{UserActionCreator:()=>_});var i=r(86178),n=r.n(i),s=r(49226),a=r(53672),o=r(24367),c=r(15507),l=r(28296),u=r(59923),d=r(50739),h=r(79558),p=r(91955),g=r(81332),m=r(36591),S=r(38629),P=r(38752),f=r(95783),v=r(64226),y=r(96891),T=r(77508),U=r(99908),w=r(81206),M=r(3854),C=r(27916),x=r(97498),b=r(52274),k=r(76171),I=r(86053);class j extends k.m{name(){return"ProjectTrialToast"}constructor(e,t,r){const i=I.p.Strings.Toasts_ProjectTrialAcquisitionSuccessful,n=t?I.p.Strings.Toasts_CopyPlanToProject:I.p.Strings.Toasts_OpenProject,s={mainContent:k.m.getMainContent(n,e,"".concat(i," - "),void 0,()=>null===r||void 0===r?void 0:r(this.id)),ariaAlertMessage:i,onDismiss:()=>{},projectLink:e,toastDataType:k.m.toastDataType};super(j.type,s),this.timeout=-1}}j.type="PROJECT_TRIAL_TOAST";var E=r(35375),L=r(63615),O=r(66878),A=r(67188),R=r(18113),F=r(74844),D=r(80493),B=r(21382),H=r(33268),W=r(22514);class _ extends m.C{get name(){return y.M.UserActionCreator}async fetchUsers(e,t){(await this.logicModuleProviders.userModule()).fetchUsersAsync(e,t).catch(e=>{})}async fetchUsersForContainer(e,t,r){const i=await this.logicModuleProviders.userModule(),n=await this.logicModuleProviders.notificationModule();i.fetchUsersForContainerAsync(e,t,r).catch(t=>n.handleRequestFailures(t,[],[f.t3.Forbidden,f.t3.NotFound],v.fc.GetGroupMembersError,e.externalId))}async fetchUsersWithKeyword(e){return(await this.logicModuleProviders.userModule()).fetchUsersWithKeyword(e)}async fetchUserPhoto(e){(await this.logicModuleProviders.userModule()).fetchUserPhotoAsync(e).catch(e=>{})}async fetchUserAccessibleSensitivityLabels(){(await this.logicModuleProviders.userModule()).fetchUserAccessibleSensitivityLabelsAsync().catch(e=>{})}async updateUserCulture(){const e=await this.logicModuleProviders.userModule(),t=[e.fetchUserAsync(P.B.currentUserId,!0),e.fetchCurrentUserDetailsAsync()];Promise.allSettled(t).then(e=>{if("fulfilled"!==e[0].status||"fulfilled"!==e[1].status)return;const t=e[0].value,r=e[1].value;if(null!=t&&null!=r&&null!=r.userData&&(null!=r.userData.settings||null!=t.preferredLanguage)&&(null==r.userData.settings||r.userData.settings.culture!==t.preferredLanguage)){const e=r.setUserCulture(t.preferredLanguage),i=null==t.preferredLanguage?"":t.preferredLanguage.toLowerCase();this.loggers.usageLogger.logData(this.name,"updateUserCulture",{mismatch:String(P.B.culture.toLowerCase()!==i)}),this.updateUserDetails(r,e)}})}async updateUserDetails(e,t){(await this.logicModuleProviders.userModule()).updateUserDetailsAsync(e,t).catch(e=>{})}updateUserTheme(e){this.dispatcher.dispatchAction(new c.k(e))}overrideProductLicense(e,t){this.dispatcher.dispatchAction(new l.n(e,t))}overrideProjectUpsellMode(e){this.dispatcher.dispatchAction(new d.i(e))}async addUsersToContainer(e,t){const r=await this.logicModuleProviders.containerModule(),i=await this.logicModuleProviders.notificationModule();r.addUsersToContainerAsync(t,e).then(void 0,t=>{if(!(t.error instanceof b.U)){var r,n,s;const a=null===(r=t.response)||void 0===r?void 0:r.status,o=null===(n=t.response)||void 0===n?void 0:n.statusText,c=null===(s=t.error)||void 0===s?void 0:s.name;a===f.t3.NotImplemented?this.loggers.traceLogger.logTrace(508069716,F.k.Error,"addUsersToGroup - Not Implemented"):c===C.Zg?i.showInfoInternal(v.fc.PlanConvertingInfo):i.showErrorInternal(v.fc.AddUsersToGroupError,a,o,e.length.toString(),t.response)}})}async removeUserFromContainer(e,t){const r=await this.logicModuleProviders.containerModule(),i=await this.logicModuleProviders.notificationModule();r.removeUserFromContainerAsync(t,e).then(void 0,t=>{if(!(t.error instanceof b.U)){var r;if((null===(r=t.error)||void 0===r?void 0:r.name)===C.Zg)i.showInfoInternal(v.fc.PlanConvertingInfo);else{var n,s;const r=null===(n=t.response)||void 0===n?void 0:n.status,a=null===(s=t.response)||void 0===s?void 0:s.statusText;i.showErrorInternal(v.fc.RemoveUserFromGroupError,r,a,e,t.response)}}})}async fetchCurrentUserLicenses(){const e=this.entityStoreSet.appContextStore.getCurrentUserId(),t=this.entityStoreSet.appContextStore.getFlights().EnforceLicenseCheck?R.Q.Priority1:R.Q.Priority5;(await this.logicModuleProviders.userModule()).fetchUserLicensesAsync(e,t).then(t=>{this.loggers.usageLogger.logData(this.name,y.M.GetUserLicenses,{tenantId:P.B.tenantId,userId:e,plannerLicenseStatus:t[U.b.Planner]})}).catch(e=>{})}async fetchCurrentUserProjectSubscriptionStatus(e){try{var t,r,i,s,a,o;const l=await this.logicModuleProviders.projectModule(),u=this.entityStoreSet.appContextStore.getFlights(),d=await l.fetchCurrentUserSubscriptionStatusV2(e),h=null===d||void 0===d?void 0:d.trialOffer,p=null===(t=d.highestTrialSubscription)||void 0===t?void 0:t.subscriptionStatus,g=p===S.gr.Disabled||p===S.gr.InGracePeriod||p===S.gr.Deprovisioned?y.M.SessionExpiredTrial:y.M.SessionShowsTryProject,m=null===h||void 0===h||null===(r=h.p3DepartmentalTrial)||void 0===r?void 0:r.eligibilityStatus,P=null===h||void 0===h||null===(i=h.p1DepartmentalTrial)||void 0===i?void 0:i.eligibilityStatus;if(h&&(m===S.RG.EligibleToRequestOnly?this.loggers.usageLogger.logData(this.name,"".concat(g,"-","P3-EligibleToRequestOnly")):m===S.RG.EligibleForSelfService?this.loggers.usageLogger.logData(this.name,"".concat(g,"-","P3-EligibleForSelfService")):P===S.RG.EligibleToRequestOnly?this.loggers.usageLogger.logData(this.name,"".concat(g,"-","P1-EligibleToRequestOnly")):P===S.RG.EligibleForSelfService&&this.loggers.usageLogger.logData(this.name,"".concat(g,"-","P1-EligibleForSelfService"))),!h&&(null===d||void 0===d||null===(s=d.highestTrialSubscription)||void 0===s?void 0:s.subscriptionType)===S.h3.Trial&&(null===d||void 0===d||null===(a=d.highestTrialSubscription)||void 0===a?void 0:a.subscriptionStatus)===S.gr.Active){var c;const e=n()(null===d||void 0===d||null===(c=d.highestTrialSubscription)||void 0===c?void 0:c.expiryDate).diff(n()(),"days");e>=0&&e<28&&W.q.logFloodgateActivity(M.zs,this.loggers.traceLogger),this.loggers.usageLogger.logData(this.name,y.M.SessionShowsGoToProject)}if(u.EnableProjectLandingPageCalls&&u.EnableImportPlanForProjectUsers){if((await l.fetchUserFeatureEntitlementsAsync()).premiumPlan.accessType===A.HX.readWrite){const e=await this.logicModuleProviders.tenantModule();await e.fetchHasProjectCogs()}}else if(d.hasLicense&&(null===(o=d.currentOrNextSubscription)||void 0===o?void 0:o.subscriptionType)===S.h3.Paid&&u.EnableImportPlanForProjectUsers){const e=await this.logicModuleProviders.tenantModule();await e.fetchHasProjectCogs()}}catch(l){}}clearProjectSubscriptionStatus(e){this.dispatcher.dispatchAction(new u.w(e))}async fetchCurrentUserProjectTrialOperationStatus(e){try{const t=await this.logicModuleProviders.projectModule();await t.fetchCurrentUserTrialOperationStatus(e)}catch(t){}}async startProjectTrialAndPlanImport(e,t){try{const r=await this.logicModuleProviders.projectModule();if(P.B.clientSettings.Flights.EnableAutoClaimPlanner){(await r.claimSubscription()).assignedProductSkuId&&await this.processImportToProject(e,t)}else{const i=this.entityStoreSet.userStore.p3TrialEligibilityStatus()===S.RG.EligibleForSelfService?S._H.P3_Departmental:S._H.P1_Departmental;await r.acquireTrialForCurrentUserV2(i),await this.processImportToProject(e,t)}}catch(r){}}async toggleUserFavoritePlanStatus(e){var t;const r=this.entityStoreSet.appContextStore.getCurrentUserId(),i=null===(t=this.entityStoreSet.userStore.getUserDetailsById(r))||void 0===t?void 0:t.favoritePlans;let n=!1;if(null!=(null===i||void 0===i?void 0:i.references)){n=null!=i.references[e.id];const t=n?i.removePlanReference(e.id):i.setPlanReference(e.id,E.j.builder.withPropertyBag({planTitle:e.title}).build());this.dispatcher.dispatchAction(new h.d(t))}}async updateUserFavoritePlans(e){this.dispatcher.dispatchAction(new h.d(L.H.builder.withPropertyBag({favoritePlanReferences:e}).build()))}async updateUserRecentPlans(e){this.dispatcher.dispatchAction(new p.E(O.E.builder.withPropertyBag({references:e}).build()))}async hidePreReleaseBusinessBanner(){this.dispatcher.dispatchAction(new g.H)}async processTrialOperationStatus(e,t,r,i,n){switch(e.operationStatus){case S.LH.Initialized:case S.LH.Pending:this.checkProjectTrialOperationStatusRecursive(t,r,i,n);break;case S.LH.Completed:await this.processImportToProject(i,n);case S.LH.Failed:}}async processImportToProject(e,t){const r=this.entityStoreSet.appContextStore.getExperiment(w.b.UpsellImportPlan)===w.b.UpsellImportPlan_treatment;let i=null;const n=this.entityStoreSet.appContextStore.getCurrentDialogData();if(n.dialogType===x.h.TryProjectDialog&&(i=r&&t?D.b.safelyOpenExternalUrl((0,H.lo)(t)):D.b.safelyOpenExternalUrl(this.generateProjectRedirectUrl(e),"_blank"),null==i&&this.loggers.traceLogger.logTrace(507581902,F.k.Info,"Project popup was blocked, showing a toast"),this.dispatcher.dispatchAction(new s.u(n))),null==i){let i;const n=e=>{this.dispatcher.dispatchAction(new a.n(e))};i=r&&t?new j((0,H.lo)(t),!0,n):new j(this.generateProjectRedirectUrl(e),!1,n),this.dispatcher.dispatchAction(new o.Z(i))}await this.fetchCurrentUserProjectSubscriptionStatus(!0)}async checkProjectTrialOperationStatusRecursive(e,t,r,i){if(!(t>=this.entityStoreSet.appContextStore.getECSSettings().ProjectTrialOperationStatus.RetryMaxCount))try{const n=await this.logicModuleProviders.projectModule();setTimeout(async()=>{try{const s=await n.fetchCurrentUserTrialOperationStatus(e);await this.processTrialOperationStatus(s,e,t+1,r,i)}catch(s){}},this.entityStoreSet.appContextStore.getECSSettings().ProjectTrialOperationStatus.RetryInterval)}catch(n){}}generateProjectRedirectUrl(e){switch(e){case T.b4.PlanTimelinePage:const e=this.entityStoreSet.appContextStore.getExperiment(w.b.UpsellTimelinePage);return e===w.b.UpsellTimelinePage_control||e===w.b.UpsellTimelinePage_treatment?B.G((0,H.sN)(),w.b.UpsellTimelinePage):(0,H.XY)();case T.b4.TryProjectDialog:case T.b4.PlanGridPage:default:return(0,H.XY)()}}constructor(e,t,r,i){super(e,t,r,P.B.clientSettings,i)}}},12358:(e,t,r)=>{var i=r(95694),n=r(41069),s=/[&<>"']/g,a=RegExp(s.source);e.exports=function(e){return(e=n(e))&&a.test(e)?e.replace(s,i):e}},27916:(e,t,r)=>{"use strict";var i,n,s,a,o;r.d(t,{Zg:()=>c}),function(e){e[e.OK=0]="OK",e[e.ContainsDefaultReservedWords=1]="ContainsDefaultReservedWords",e[e.MissingPrefixSuffix=2]="MissingPrefixSuffix",e[e.ContainsCustomBlockedWords=3]="ContainsCustomBlockedWords",e[e.ContainsMSStandardBlockedWords=4]="ContainsMSStandardBlockedWords",e[e.MailNicknameNotOK=5]="MailNicknameNotOK",e[e.Unknown=6]="Unknown"}(i||(i={})),function(e){e.Forbidden="Forbidden",e.NotFound="NotFound",e.CreatePlanForGroupFailed="CreatePlanForGroupFailed",e.MaximumPlansOwnedByUserReached="MaximumPlansOwnedByUserReached",e.UnknownError="UnknownError"}(n||(n={})),function(e){e.Offline="Offline"}(s||(s={})),function(e){e.DynamicImportError="DynamicImportError"}(a||(a={})),function(e){e.MaximumProjectsOwnedByUser="MaximumProjectsOwnedByUser",e.MaximumProjectsSharedWithUser="MaximumProjectsSharedWithUser",e.MaximumTasksCreatedByUser="MaximumTasksCreatedByUser",e.MaximumTasksAssignedToUser="MaximumTasksAssignedToUser",e.MaximumTasksInProject="MaximumTasksInProject",e.MaximumActiveTasksInProject="MaximumActiveTasksInProject",e.MaximumBucketsInProject="MaximumBucketsInProject",e.MaximumUsersSharedWithProject="MaximumUsersSharedWithProject",e.MaximumReferencesOnTask=" MaximumReferencesOnTask",e.MaximumChecklistItemsOnTask="MaximumChecklistItemsOnTask",e.MaximumAssigneesInTasks="MaximumAssigneesInTasks",e.MaximumFavoritePlansForUser="MaximumFavoriteProjectsForUser",e.MaximumRecentPlansForUser="MaximumRecentProjectsForUser",e.MaximumContextsOnPlan="MaximumContextsOnPlan"}(o||(o={}));const c="ArchivedEntityCanNotBeUpdated"},33268:(e,t,r)=>{"use strict";r.d(t,{XY:()=>f,lo:()=>P,sN:()=>v,wS:()=>S});var i=r(38752),n=r(8453),s=r(72761),a=r(40468),o=r(12358),c=r.n(o),l=r(54320),u=r.n(l),d=r(74844),h=r(74065),p=r.n(h),g=r(85855),m=r.n(g);class S{static getFavIconUrl(e){return"https://"+S.extractHostname(e)+"/favicon.ico"}static generateEntityHyperlink(e,t,r,i){switch(e.entityType){case s.I.Task:return this.generateTaskHyperLink(e,t,r,i);case s.I.Plan:return this.generatePlanHyperLink(e,t,r,i);default:throw new Error("NotSupportedException: entity.type")}}static generateEntityLink(e,t,r,i){switch(e.entityType){case s.I.Task:return this.generateTaskLink(e,t,r,i);case s.I.Plan:return this.generatePlanLink(e,t,r,i);default:throw new Error("NotSupportedException: entity.type")}}static generateOWAGroupEmailSettingsLink(e,t,r){if(u()(e))return r.logTrace(508047762,d.k.Warning,"Empty owa host. Hiding the whole owa link."),"";if(u()(t)||t.indexOf("@")<0||t.indexOf("@")!==t.lastIndexOf("@"))return"https://".concat(e);{const r=t.split("@")[0],i=t.split("@")[1];return"https://".concat(e,"/mail/group/").concat(i,"/").concat(r,"/action/EmailSettings")}}static extractHostname(e){let t="";return t=e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0],t=t.split(":")[0],t=t.split("?")[0],t=t.split("#")[0],t}static getPlanExternalUrl(e,t){var r;const i=null===(r=a.T.builder.withPlan(e).withDetails(t).build().getCreationContextInfo())||void 0===r?void 0:r.key;let n=null;var s;i&&(n=null!==(s=t.contextDetails[i].url)&&void 0!==s?s:null);return n}static generateTaskHyperLink(e,t,r,i){return'<a href="'+this.generateTaskLink(e,t,r,i)+'" target="_blank" rel="noopener noreferrer">'+c()(e.title)+"</a>"}static generatePlanHyperLink(e,t,r,i){return'<a href="'+this.generatePlanLink(e,t,r,i)+'" target="_blank" rel="noopener noreferrer">'+c()(e.title)+"</a>"}static generateTaskLink(e,t,r,s){var a,o,c;return(null===(a=e.creationSource.external)||void 0===a?void 0:a.contextScenarioId)===n.z.project&&null!==(o=e.creationSource.external)&&void 0!==o&&o.webUrl?null===(c=e.creationSource.external)||void 0===c?void 0:c.webUrl:this.generatePlannerLink("".concat(i.B.absoluteRedirectRoot,"/Home/Task/").concat(e.id),t,r,s)}static generatePlanLink(e,t,r,n){return this.generatePlannerLink("".concat(i.B.absoluteRedirectRoot,"/Home/PlanViews/").concat(e.id),t,r,n)}static generatePlannerLink(e,t,r,i){const n=621355968e9+1e4*i.getTime();return"".concat(e,"?Type=").concat(t,"&Channel=").concat(r,"&CreatedTime=").concat(n)}static getValidUrl(e){const t=S.formatUrlWithHttpUrlScheme(e);return S.validateUrl(t)}static formatUrlWithHttpUrlScheme(e){return S.getUrlScheme(e).toLowerCase()===S.httpScheme?S.ensureUrlScheme(e,S.httpScheme):S.ensureUrlScheme(e,S.httpsScheme)}static validateUrl(e){try{const t=new URL(e);if(!t.host||!t.hostname||!t.origin||"null"===t.origin||"http:"!==t.protocol&&"https:"!==t.protocol)return;return t.toString()}catch(t){return}}static getUrlScheme(e){const t=new RegExp("(.*)://.*","i").exec(e)||[];return p()(t)||""}static ensureUrlScheme(e,t){const r=t&&m()(t.split("://"));return"".concat(r,"://").concat(S.removeUrlScheme(e))}static removeUrlScheme(e){const t=new RegExp("(http(s)?(:)?(//)?)*(.*)","i").exec(e)||[];return p()(t)||""}static getQueryParamValue(e,t){return new URLSearchParams(new URL(e).search).get(t)}}function P(e){return"".concat(y(),"hubnew?importPlanId=").concat(e)}function f(){return"".concat(i.B.clientSettings.ECSSettings.ProjectServiceConfig.Hostname,"trialFRE#templates")}function v(){return"".concat(i.B.clientSettings.ECSSettings.ProjectServiceConfig.Hostname,"trialFRE#templates/{0}")}function y(){return"".concat(i.B.clientSettings.ECSSettings.ProjectServiceConfig.Hostname).concat(i.B.tenantDomain,"/").concat(i.B.culture,"#/")}S.httpScheme="http",S.httpsScheme="https"},36591:(e,t,r)=>{"use strict";r.d(t,{C:()=>i});class i{constructor(e,t,r,i,n){this.dispatcher=e,this.logicModuleProviders=t,this.entityStoreSet=r,this.clientSettings=i,this.loggers=n}}},53672:(e,t,r)=>{"use strict";r.d(t,{n:()=>n});var i=r(75992);class n extends i.r{loggingData(){return{toastId:this.toastId}}constructor(e){super(n.actionType),this.toastId=e}}n.actionType="DISMISS_TOAST_NOTIFICATION"},67188:(e,t,r)=>{"use strict";var i,n,s,a;r.d(t,{HX:()=>i,eN:()=>s}),function(e){e.noAccess="noAccess",e.readOnly="readOnly",e.restrictedReadWrite="restrictedReadWrite",e.readWrite="readWrite"}(i||(i={})),function(e){e.none="none",e.noModProjLicenseInTenant="noModProjLicenseInTenant",e.noRoadmapLicenseInTenant="noRoadmapLicenseInTenant",e.p1ProjectOnlineEssentials="p1ProjectOnlineEssentials"}(n||(n={})),function(e){e.basic="basic",e.basicPlus="basicPlus",e.standard="standard",e.professional="professional",e.premium="premium"}(s||(s={})),function(e){e.commercial="Commercial",e.commercialEducation="Commercial Education"}(a||(a={}));var o;!function(e){e.roadmap="roadmap",e.premiumPlan="premiumPlan",e.projectOnline="projectOnline",e.projectOperations="projectOperations"}(o||(o={}))},72037:e=>{e.exports=function(e){return function(t){return null==e?void 0:e[t]}}},76171:(e,t,r)=>{"use strict";r.d(t,{m:()=>s});var i=r(33183),n=r(65043);class s extends i.M{static getMainContent(e,t,r,i,s){return n.createElement("span",null,r,n.createElement("a",{href:t,target:"_blank",rel:"noopener noreferrer",onClick:s},e),i)}}s.toastDataType="LINK_TOAST_DATA"},85855:(e,t,r)=>{e.exports=r(96483)},95694:(e,t,r)=>{var i=r(72037)({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});e.exports=i},96483:e=>{e.exports=function(e){return e&&e.length?e[0]:void 0}}}]);
//# sourceMappingURL=userac.f438bb90.chunk.js.map