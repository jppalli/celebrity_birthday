"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[88652],{6766:(e,t,o)=>{o.d(t,{yO:()=>X,GB:()=>q,Ic:()=>G,_5:()=>W,LL:()=>M,tD:()=>j,iO:()=>z,zY:()=>R,zq:()=>F});var r=o(27051),n=o(70579),i=o(65043),s=o(84391),a=o(51238),l=o(4563),d=o(75460),p=o(29018),c=o(60835),h=o(8088),u=o(87416),m=o(53015),v=o(78632),g=o(74043),f=o(46212);const I=()=>null;var P=o(83545),y=o(48043),S=o(921);let C;const k=e=>o(97959)("./".concat(e,"/ShareServiceStrings.json"));function U(e){return function(e,t){var o;return(null===(o=C)||void 0===o?void 0:o.locale)!==t&&(C={locale:t,stringTablePromise:e(t).then(e=>(0,S.$)(e,t)).catch(e=>{throw C=void 0,e})}),C.stringTablePromise}(k,e)}var A=o(60257),N=o(33788),T=o(47373);function w(e,t,o,n,i,s,a){const l=function(e){switch(e){case g.n.default:return"DefaultShare";case g.n.copyLink:return"CopyLink";case g.n.atMention:return"AtMention";case g.n.addPeople:return"AddPeople";case g.n.linkSettings:return"LinkSettings";case g.n.manageAccess:return"ManageAccess";case g.n.notify:return"Notify";default:return"OtherShareMode"}}(t),d=N.m.start(P.Il.CompleteShare,e);(0,T.Ot)(e,{eventName:P.Sz.ShareDialogOpened,entrypoint:l,sharePointCorrelationId:s}),n.then(t=>{d.setResult(!0,(0,r.A)({shared:t,entrypoint:l,sharePointCorrelationId:s},a)),t&&(0,T.o4)(e,{eventName:P.ay.ShareDocument,entrypoint:l})}).catch(e=>{d.setResult(!1,(0,r.A)({entrypoint:l,sharePointCorrelationId:s,errorType:e.errorType||P.NN.UnknownShareError,spoError:e.spoError,spoErrorCategory:e.spoErrorCategory},a),e)});const p=N.m.start(P.Il.RenderShare,e);o.then(e=>{p.setResult(!0,(0,r.A)({rendered:e,entrypoint:l,sharePointCorrelationId:s},E(i,p.startTime)))}).catch(e=>{p.setResult(!1,(0,r.A)({entrypoint:l,sharePointCorrelationId:s,errorType:e.errorType||P.NN.UnknownShareError,spoError:e.spoError,spoErrorCategory:e.spoErrorCategory},E(i,p.startTime)),e)})}function E(e,t){return{payloadLoadStartTime:(0,A.q)(e.payloadLoadStartTime,t),payloadLoadEndTime:(0,A.q)(e.payloadLoadEndTime,t),payloadSendStartTime:(0,A.q)(e.payloadSendStartTime,t),sharePointLoadStartTime:(0,A.q)(e.sharePointLoadStartTime,t)}}const D=/^var\((--[\w-]+)(?:,.*)?\)$/;function L(e,t){if(t)return Object.fromEntries(Object.entries(t).map(t=>{let[o,r]=t;const n=o;let i=r;const s=D.exec(r);if(s){const[,t]=s;i=e().getPropertyValue(t)}return[n,i]}))}var b=o(99671);var x=o(32935);function O(e){return"Consumer"===e.identityType}function z(e){return!!O(e)||"Enterprise"!==e.identityType}function R(e){const t={},l={},p=new d.c,c=new d.c,{shareUXConfig:h,localization:u,logger:m,correlationId:S}=e,C=(null===h||void 0===h?void 0:h.shareMode)||g.n.default,k=S||(0,a.A)();m&&w(m,C,c,p,t,k,l);const A=(0,x.U)(e.settingsProvider);(0,v.t)(A,[c,p]).then(e=>{if(e){const e=new y.QW(P.NN.IframeLoadTimeoutError);j(c,p,e)}}).catch(()=>{});try{var N,T,E;t.payloadLoadStartTime=performance.now();let{theme:a,themeProperties:d,target:m}=null!==(N=null===h||void 0===h||null===(T=h.shareControl)||void 0===T?void 0:T.props)&&void 0!==N?N:{theme:void 0,themeProperties:void 0};!a&&d&&(a=(0,f.x)(d),h.shareControl.props.theme=a);const{shareControl:v,setFocusOnDismiss:g}=null!==h&&void 0!==h?h:{shareControl:void 0,setFocusOnDismiss:void 0};null!==v&&void 0!==v&&null!==(E=v.props)&&void 0!==E&&null!==(E=E.theme)&&void 0!==E&&E.palette&&(v.props.theme.palette.themeLighterAlt=v.props.theme.palette.neutralLighterAlt,v.props.theme.palette.themeLight=v.props.theme.palette.neutralLight,v.props.theme.palette.themeDarkAlt=v.props.theme.palette.neutralDark);const P=()=>{const e=l.odspShareCompletedReceived||!1;l.userDismissedShare=!e,function(e,t,o){e.resolve(o),t.resolve(o)}(c,p,e),null===g||void 0===g||g()},y=m||document.createElement("div"),S=(0,s.H)(y);if("Callout"===(null===v||void 0===v?void 0:v.type)){const s=i.lazy(()=>async function(e){const[t,i]=await Promise.all([U(e),Promise.all([o.e(72567),o.e(9444)]).then(o.bind(o,57864))]);return{default:e=>(0,n.jsx)(i.ShareCalloutRenderer,(0,r.A)({stringTable:t},e))}}(u.locale));S.render((0,n.jsx)(i.Suspense,{fallback:(0,n.jsx)(I,{}),children:(0,n.jsx)(s,{onRenderPromise:c,onCompletePromise:p,onDismissCallout:P,perfMarks:t,localization:u,calloutProps:v.props,showShareProps:(0,r.A)((0,r.A)({},e),{},{correlationId:k}),shareMode:C,shareTelemetryProps:l})}))}else{const s=i.lazy(()=>async function(e){const[t,i]=await Promise.all([U(e),Promise.all([o.e(46441),o.e(72567),o.e(94680)]).then(o.bind(o,50780))]);return{default:e=>(0,n.jsx)(i.ShareDialogRenderer,(0,r.A)({stringTable:t},e))}}(u.locale));S.render((0,n.jsx)(i.Suspense,{fallback:(0,n.jsx)(I,{}),children:(0,n.jsx)(s,{onRenderPromise:c,onCompletePromise:p,onDismissDialog:P,perfMarks:t,shareMode:C,localization:u,dialogProps:null===v||void 0===v?void 0:v.props,showShareProps:(0,r.A)((0,r.A)({},e),{},{correlationId:k}),shareTelemetryProps:l})}))}}catch(D){j(c,p,D)}return p}function F(e,t,o){const[r,n]=i.useState(new d.c);return i.useEffect(()=>{const r=document.createElement("div");document.body.append(r);const i=function(e,t){let o;const r=()=>(o||(o=getComputedStyle(e)),o);return{palette:L(r,t.palette),semanticColors:L(r,t.semanticColors)}}(r,t?(0,l.z)(e,t):e);r.remove(),n(async function(e,t){const{shareUXConfig:o,defaultRecipients:r,fileId:n,driveId:i,siteUrl:s,tenantId:a,tokenProvider:l,logger:d,dataStorePath:v,appName:f,containerPackageName:I,sharingContext:S,navPayloadOptions:C,correlationId:k,settingsProvider:U}=e,A=(null===o||void 0===o?void 0:o.shareMode)||g.n.default;if(!s||!i||!n)throw new y.QW(P.NN.GeneratePayloadError,"File information is missing");if("UnauthenticatedGuest"===l.identityType)throw new y.QW(P.NN.GeneratePayloadError,"UnauthenticatedGuest user is not allowed to use share functionality");const N=O(l),w=(0,p.$)(s),[E,D,L]=await Promise.all([null!==o&&void 0!==o&&o.fileName?(0,c.sN)(l,s,i,n,d,a).then(e=>({name:o.fileName,sharepointIds:e})):(0,c.OF)(l,s,i,n,d,a),l.getToken(["".concat(w,"/files.readwrite.all")],{tenantId:a,request:null}),N?Promise.resolve(""):(0,h.js)(l,U.audience,d)]);if(null===E||void 0===E||!E.name||!E.sharepointIds)throw new y.QW(P.NN.GeneratePayloadError,"Failed to fetch file info");const z=D.token,R=void 0!==v?{siteUrl:s,driveId:i,itemId:n,dataStorePath:v,appName:f,containerPackageName:I,context:S}:void 0,F=(0,x.D)(U),j=void 0!==R?function(e,t){const o=(0,b.kt)(e);if(t.includeFluidSignature)return o;const r=new URLSearchParams(atob(o));return r.delete("fluid"),btoa(r.toString())}(R,C||{includeFluidSignature:!0}):void 0;d&&(0,T.Ot)(d,{eventName:"ShareServiceConstructNavId",navIdLength:null===j||void 0===j?void 0:j.length,navIdDecodedLength:j?atob(j).length:void 0});const M={mode:A,authToken:z,clientId:"fluid",itemName:F?void 0:E.name,isFolder:!1,isODB:w.indexOf("".concat(u.p7,"."))>0,organizationName:(0,m.E)(L)?"":L,webAbsoluteUrl:s,correlationId:k,navId:j,listId:E.sharepointIds.listId,listItemId:E.sharepointIds.listItemId,theme:t};r&&(M.defaultRecipients=r,M.accessChecked=!0);return M}(o,i))},[e,t,o]),r}function j(e,t,o){e.reject(o),t.reject(o)}function M(e){return!!e&&"shareMode"in e}const G=320,X=500,q=92;function W(e){return Math.min(window.innerWidth,e)}},32935:(e,t,o)=>{o.d(t,{D:()=>i,U:()=>s});var r=o(48680);const n={dropItemNameFromPayload:"share.dropItemNameFromPayload",shareTimeout:"share.shareTimeoutInMs"};function i(e){return(0,r.AU)(n.dropItemNameFromPayload,!0,e)}function s(e){return(0,r.AU)(n.shareTimeout,45e3,e)}},48043:(e,t,o)=>{o.d(t,{QW:()=>r,yp:()=>n});class r extends Error{constructor(e,t,o,r){super(t||e),this.errorType=e,this.spoError=o,this.spoErrorCategory=r}}const n={Loading:"Loading",Loaded:"Loaded",Error:"Error"}},83545:(e,t,o)=>{o.d(t,{Il:()=>n,NN:()=>i,Sz:()=>s,ay:()=>r});const r={ShareDocument:"ShareDocument"},n={RenderShare:"RenderShare",CompleteShare:"CompleteShare"},i={GeneratePayloadError:"GeneratePayloadError",SpoShareError:"SpoShareError",SpoTimeoutError:"SpoTimeoutError",IframeLoadTimeoutError:"IframeLoadTimeoutError",UnknownShareError:"UnknownShareError",FluentUiError:"FluentUiError"},s={ShareDialogOpened:"ShareDialogOpened"}},88652:(e,t,o)=>{o.r(t),o.d(t,{SharepointShareService:()=>f});var r=o(27051),n=o(74043),i=o(52563),s=o(60835),a=o(47373);const l="GetDocumentInfoError",d=(e,t,o)=>{var r;if(!t)return o&&(0,a.Ot)(o,{eventName:l}),e;if(!(0,s.g2)(t)){const t=new Error("Invalid file information: ResolvedUrl is not of the expected ODSP type");return o&&(0,a.hO)(o,{eventName:l},t),e}return{driveId:t.driveId,siteUrl:t.siteUrl,itemId:t.itemId,containerPackageName:null===(r=t.codeHint)||void 0===r?void 0:r.containerPackageName}};var p=o(6766),c=o(33788),h=o(29018),u=o(72376),m=o(40635),v=o(74405);const g=async(e,t,o,n,i)=>{const s="CheckDocumentAccess",a=c.m.start(s,n);try{var l;const d=(0,h.$)(t.siteUrl),p={getToken:e=>{if(e){const n=(0,r.A)((0,r.A)({},e),{},{siteUrl:t.siteUrl,driveId:t.driveId,itemId:t.itemId});return o.getToken(["".concat(d,"/files.readwrite.all")],n)}throw Error("Options must be specified")},url:"".concat(d,"/_api/v2.1/drives/").concat(t.driveId,"/items/").concat(t.itemId,"/oneDrive.checkAccess"),tenantId:i,requestInit:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:[{email:e.userPrincipalName,objectId:e.id}]})},retryPolicy:u._9,tokenPolicy:(0,u.N$)(o,!1)},c=n?await(0,m.g)((0,r.A)((0,r.A)({},p),{},{logger:n,nameForLogging:s,getAdditionalProps:async(e,t)=>(0,v.u)(e)})):await(0,m.y)(p),g=await c.result.json();return a.setResult(!0),null===g||void 0===g||null===(l=g.value)||void 0===l||null===(l=l[0])||void 0===l?void 0:l.canWrite}catch(d){throw a.setResult(!1,{errorType:"CheckDocumentAccessError"}),d}};class f{constructor(e){this.props=e,this.localization="InternationalizationContext"in e.localization?function(e){let t;return{get locale(){var o;return(null===(o=t)||void 0===o?void 0:o.uiLocale)!==e.uiLocale&&(t={locale:(0,i.rv)(e.uiLocale),uiLocale:e.uiLocale}),t.locale},get localeDirection(){return e.defaultContentDirection}}}(e.localization):e.localization}get Disposable(){return this}dispose(){}get ShareService(){return this}async checkUserAccess(e){let{resolvedUrl:t,userPrincipalName:o}=e;const r=d(this.props.bootDocumentInfo,t,this.props.logger);return g({userPrincipalName:o,name:""},r,this.props.tokenProvider,this.props.logger,this.props.tenantId)}async grantPermissions(e){let{resolvedUrl:t,userPrincipalNames:o,uxConfiguration:i}=e;const s=d(this.props.bootDocumentInfo,t,this.props.logger),a=this.resolveShareUXConfig(i,{shareMode:n.n.atMention}),l=this.convertResolvedUrlToOdspUrlParts(this.props.bootDocumentInfo,t);return(0,p.zY)((0,r.A)((0,r.A)({tokenProvider:this.props.tokenProvider,logger:this.props.logger,settingsProvider:this.props.settingsProvider,localization:this.localization,defaultRecipients:o},s),{},{fileId:s.itemId,shareUXConfig:a,tenantId:this.props.tenantId,appName:this.props.appName,sharingContext:this.props.getFileContext?await this.props.getFileContext(l):void 0}))}async checkRecipientAccess(e){let{resolvedUrl:t,recipient:o}=e;const r=d(this.props.bootDocumentInfo,t,this.props.logger);return g(o,r,this.props.tokenProvider,this.props.logger,this.props.tenantId)}async grantRecipientsPermission(e){let{resolvedUrl:t,recipients:o,uxConfiguration:i}=e;const s=d(this.props.bootDocumentInfo,t,this.props.logger),a=this.resolveShareUXConfig(i,{shareMode:n.n.atMention}),l=o.map(e=>e.id?e.id:e.userPrincipalName),c=this.convertResolvedUrlToOdspUrlParts(this.props.bootDocumentInfo,t);return(0,p.zY)((0,r.A)((0,r.A)({tokenProvider:this.props.tokenProvider,logger:this.props.logger,settingsProvider:this.props.settingsProvider,localization:this.localization,defaultRecipients:l},s),{},{fileId:s.itemId,shareUXConfig:a,tenantId:this.props.tenantId,appName:this.props.appName,sharingContext:this.props.getFileContext?await this.props.getFileContext(c):void 0}))}async shareLink(e){let{resolvedUrl:t,componentPath:o,navPayloadOptions:i,uxConfiguration:s,sharingContext:a}=e;const l=this.convertResolvedUrlToOdspUrlParts(this.props.bootDocumentInfo,t),c=this.resolveShareUXConfig(s,{shareMode:n.n.copyLink}),h={tokenProvider:this.props.tokenProvider,logger:this.props.logger,settingsProvider:this.props.settingsProvider,localization:this.localization,shareUXConfig:c,tenantId:this.props.tenantId};if(void 0===o){const e=d(this.props.bootDocumentInfo,t,this.props.logger);return(0,p.zY)((0,r.A)((0,r.A)((0,r.A)({},h),e),{},{fileId:e.itemId}))}const u=this.getComponentLocator(o,t);return(0,p.zY)((0,r.A)((0,r.A)((0,r.A)({},h),u),{},{sharingContext:null!==a&&void 0!==a?a:this.props.getFileContext?await this.props.getFileContext(l,o):void 0,navPayloadOptions:i,fileId:u.itemId}))}async generateShareLink(e){let{odspUrlParts:t,containerPackageName:o,componentPath:i,navPayloadOptions:s,uxConfiguration:a,sharingContext:l}=e;const d=this.resolveShareUXConfig(a,{shareMode:n.n.copyLink}),c={tokenProvider:this.props.tokenProvider,logger:this.props.logger,settingsProvider:this.props.settingsProvider,localization:this.localization,shareUXConfig:d,tenantId:this.props.tenantId},h=t||{siteUrl:this.props.bootDocumentInfo.siteUrl,driveId:this.props.bootDocumentInfo.driveId,itemId:this.props.bootDocumentInfo.itemId},u=(0,r.A)({containerPackageName:o},h);if(void 0===i)return(0,p.zY)((0,r.A)((0,r.A)((0,r.A)({},c),u),{},{fileId:u.itemId}));const m=(0,r.A)((0,r.A)({},u),{},{dataStorePath:i,appName:this.props.appName});return(0,p.zY)((0,r.A)((0,r.A)((0,r.A)({navPayloadOptions:s,fileId:m.itemId},c),m),{},{sharingContext:null!==l&&void 0!==l?l:this.props.getFileContext?await this.props.getFileContext(h,i):void 0}))}async getPermissions(e){let{resolvedUrl:t}=e;return(async(e,t,o,n)=>{const i=c.m.start("GetPermissions",o);try{const s=(0,h.$)(e.siteUrl),a={getToken:o=>{if(o){const n=(0,r.A)((0,r.A)({},o),{},{siteUrl:e.siteUrl,driveId:e.driveId,itemId:e.itemId});return t.getToken(["".concat(s,"/files.readwrite.all")],n)}throw Error("Options must be specified")},url:"".concat(s,"/_api/v2.1/drives/").concat(e.driveId,"/items/").concat(e.itemId,"/permissions"),tenantId:n,requestInit:{method:"GET"},retryPolicy:u._9,tokenPolicy:(0,u.N$)(t)},l=o?await(0,m.g)((0,r.A)((0,r.A)({},a),{},{logger:o,nameForLogging:"GetPermissions",getAdditionalProps:async(e,t)=>(0,v.u)(e)})):await(0,m.y)(a),d=await l.result.json(),p=[],c={},g=[],f=e=>{if(e.email){const t={id:e.id,name:e.displayName,userPrincipalName:e.email};c[t.userPrincipalName]||(c[t.userPrincipalName]=t)}else g.push(e.displayName)};null!==d&&void 0!==d&&d.value&&d.value.map(e=>{if(e.grantedTo&&f(e.grantedTo.user),e.grantedToIdentities&&e.grantedToIdentities.map(e=>{f(e.user)}),e.link){const t={text:e.link.localizedDescription,scope:e.link.scope,type:e.link.type};e.link.webUrl&&(t.webUrl=e.link.webUrl),p.push(t)}});const I={personas:Object.values(c),links:p,groups:g};return i.setResult(!0),I}catch(s){throw i.setResult(!1,{errorType:"GetPermissionsError"},s),s}})(d(this.props.bootDocumentInfo,t,this.props.logger),this.props.tokenProvider,this.props.logger,this.props.tenantId)}getComponentLocator(e,t){const o=d(this.props.bootDocumentInfo,t,this.props.logger);return(0,r.A)((0,r.A)({},o),{},{dataStorePath:e,appName:this.props.appName})}resolveShareUXConfig(e,t){var o;const n=(0,p.LL)(e)?e:t;var i,s,a,l;null!==n&&void 0!==n&&null!==(o=n.shareControl)&&void 0!==o&&o.props&&(n.shareControl.props=(0,r.A)((0,r.A)({},n.shareControl.props),{},{target:null!==(i=null===(s=n.shareControl.props)||void 0===s?void 0:s.target)&&void 0!==i?i:null===(a=(l=this.props).getShareUXTargetElement)||void 0===a?void 0:a.call(l)}));return n}convertResolvedUrlToOdspUrlParts(e,t){return t&&(0,s.g2)(t)?{siteUrl:t.siteUrl,driveId:t.driveId,itemId:t.itemId}:{siteUrl:e.siteUrl,driveId:e.driveId,itemId:e.itemId}}}}}]);
//# sourceMappingURL=88652.4ac694e5.chunk.js.map