"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[4524],{22227:(e,t,r)=>{r.r(t),r.d(t,{MTSFoundInPlaces:()=>q});var i=r(27051),n=r(48680),o=r(46624),s=r(56993),a=r(37097),d=r(53948),c=r(2953),l=r(53383);function u(e){let t="Prod";if(e)switch(e.audience){case"Development":t="Development";break;case"Staging":t="Staging";break;case"Dogfood":t="Dogfood";break;case"Preview":t="Preview";break;default:t="Prod"}return t}async function p(e){const{backlink:t,logger:r,settingsProvider:i,tokenProvider:n}=e,o=(0,d.f1)(t.page_id),s=await(0,a.cC)(n,"https://".concat(o.siteDomain),o.driveId,o.itemId,r);if((0,a.dm)(s))return;const p=function(e,t,r){const i={u:e,r:!1},n={w:t?{u:(0,d.xo)(t),r:!1}:void 0,p:i},o=(0,c.M8)(n),s=u(r),a=(0,l.qh)(s,"v2");return"".concat(a).concat(o)}((0,d.xo)(t.page_id),t.workspace_id,i);return{icon:s.pageIcon,title:s.title,url:p}}var m=r(30946),h=r(17107),f=r(17601),g=r(40635),v=r(76899),I=r(46507),w=r(51238);async function y(e){const{existingFileInfo:t,documentPodId:r,tokenProvider:n}=e,o=t?await(0,m.A7)(n,t):"",s="fileId=".concat(null!==r&&void 0!==r?r:o);return await k((0,i.A)((0,i.A)({},e),{},{urlParams:s,subErrorName:"FluidLoopComponent"}))}async function k(e){const{settingsProvider:t,subErrorName:r,userContext:i,logger:n,tokenProvider:o,urlParams:a}=e,d=(0,I.l)(t.audience),c=(0,h.O)(t.audience),l="".concat(d,"/recommended/api/beta/loop/sharedlocations?").concat(a),u=U(l,o,t),p=P(t),m=n&&i?await(0,f.k)({url:l,requestInit:p,scopes:c,retryPolicy:h.B,logger:n,nameForLogging:"MTSFoundInPlaces",user:i.user,tokenProvider:o}):await(0,g.y)(u);return await m.result.json().then(e=>{if(_(e))return e;throw new Error("Invalid MTS response")}).catch(e=>{n&&(0,s.e)(n,{eventName:"MtsApiJsonParsingError",subErrorName:r},e)})}const P=e=>{var t;return{method:"GET",headers:{"Client-Request-Id":(0,w.A)(),"X-Office-Application":"300","X-Office-AudienceGroup":null!==(t=null===e||void 0===e?void 0:e.audience)&&void 0!==t?t:"","X-Office-Platform":(0,v.Fr)()?"Mobile":"Web"}}},U=(e,t,r)=>({getToken:e=>{if(e){const i=(0,h.O)(r.audience);return t.getToken(i,e)}throw Error("Options must be specified")},url:e,requestInit:P(r),retryPolicy:h.B}),_=e=>"object"===typeof e&&null!==e&&e.hasOwnProperty("sharing_history")&&Array.isArray(e.sharing_history),b=0,E=1,A=2,x=3,T=4,M=5,C=6,O=7;function R(e,t){switch(e){case void 0:case b:return{host:"Outlook",location:"Email"};case E:return{host:"Teams",location:"Chat"};case A:return{host:"Outlook",location:"Calendar"};case x:return{host:"Teams",location:"Channel"};case T:case M:return{host:"Loop",location:"Workspace"};case C:switch(t){case"Word":return{host:"Word",location:"other"};case"Whiteboard":return{host:"Whiteboard",location:"other"};case"Fluid":return{host:"Loop",location:"Page"};default:return{host:"other",location:"other"}}case O:return{host:"Loop",location:"Page"};default:return{host:"other",location:"other"}}}var N=r(13379);var F=r(60980),D=r(78010),L=r(45296);async function S(e,t,r){var i;if(void 0===t)return;let n;if("string"===typeof t){const i=await async function(e,t,r){try{return await(0,F.j)(e,t,r)}catch(i){return}}(t,e,r);n=i?{odspItem:{siteUrl:i.siteUrl,driveId:i.driveId,itemId:i.itemId},fileName:i.fileName}:void 0}else{const i=await async function(e,t,r){try{const i=r?await(0,D.N)(e,t,r):void 0;return null===i||void 0===i?void 0:i.name}catch(i){return}}(t,e,r);n={odspItem:t,fileName:i}}if(void 0===(null===(i=n)||void 0===i?void 0:i.odspItem))return;const o=function(e){const t=e.fileName,r=e.odspItem;if(void 0===t||!j(t))return;const i={siteDomain:new URL(r.siteUrl).hostname,driveId:r.driveId,itemId:r.itemId};return(0,d.an)(i)}(n);return{odspItem:n.odspItem,podId:o}}const j=e=>{const t=(0,L.Q)(e).toLowerCase();return"loop"===t||"fluid"===t};class q{constructor(e,t,r,i){this.tokenProvider=e,this.logger=t,this.settingsProvider=r,this.userContext=i}get foundInPlacesServicePromise(){return Promise.resolve(this)}async getFoundInPlaces(e){var t;let{settingsProvider:r,documentUrl:i,odspItem:n}=e;if(void 0===i&&void 0===n)return this.logger&&(0,s.e)(this.logger,{eventName:"MtsApiUrlUndefinedError"}),{places:[]};const o=this.settingsProvider||r,a=await S(this.tokenProvider,null!==n&&void 0!==n?n:i,this.logger),d=await this.getMTSFoundInPlacesResponse(this.tokenProvider,o,null!==(t=null===a||void 0===a?void 0:a.odspItem)&&void 0!==t?t:i,this.logger,null===a||void 0===a?void 0:a.podId);return await this.transformMTSResponse(null!==d&&void 0!==d?d:{},null===a||void 0===a?void 0:a.odspItem)}async getMTSFoundInPlacesResponse(e,t,r,n,o){const a=n||this.logger,d={tokenProvider:e,logger:a,settingsProvider:this.settingsProvider||t,userContext:this.userContext};let c;return o?c=await y((0,i.A)((0,i.A)({},d),{},{documentPodId:o})):"string"===typeof r?c=await async function(e){const{documentUrl:t}=e,r="externalUrl=".concat(t);return await k((0,i.A)((0,i.A)({},e),{},{urlParams:r,subErrorName:"FluidNonLoopComponent"}))}((0,i.A)((0,i.A)({},d),{},{documentUrl:r})):r&&(c=await y((0,i.A)((0,i.A)({},d),{},{existingFileInfo:{siteUrl:r.siteUrl,driveId:r.driveId,fileId:r.itemId}}))),void 0===c&&a&&(0,s.e)(a,{eventName:"MtsApiResponseUndefinedError"}),c}async transformMTSResponse(e,t){if(void 0===e.sharing_history)return{places:[]};const r=e.sharing_history.map(async e=>{let r;if(function(e){return(e.sharing_medium===T||e.sharing_medium===M)&&e.hasOwnProperty("workspace")}(e)){const{host:i,location:n}=R(e.sharing_medium),{title:o,url:s}=function(e,t,r){const{title:i,mfs_info:n}=e,o=n.pod_id,s=(0,d.f1)(o),a=u(r);return{title:i,url:t?(0,N.a)({page:{siteOrigin:t.siteUrl,driveId:t.driveId,itemId:t.itemId},pageWorkspaceContext:{driveId:s.driveId,itemId:s.itemId}},a):void 0}}(e.workspace,t);r={host:i,location:n,subject:o,url:s}}else if(function(e){return e.sharing_medium===C&&e.hasOwnProperty("file")}(e)){const{host:t,location:i}=R(e.sharing_medium,e.file.type),{title:n}=e.file;r={host:t,location:i,subject:n,url:e.sharing_reference_url}}else if(function(e){return e.sharing_medium===O&&e.hasOwnProperty("backlink")}(e)&&this.includeBacklinksInList()){const{host:t,location:i}=R(e.sharing_medium),n=await p({backlink:e.backlink,tokenProvider:this.tokenProvider,logger:this.logger});r=n?{host:t,location:i,subject:n.title,url:n.url,icon:n.icon}:void 0}else if(function(e){return(e.sharing_medium===b||e.sharing_medium===A||e.sharing_medium===E||e.sharing_medium===x||void 0===e.sharing_medium)&&e.hasOwnProperty("sharing_reference_url")}(e)){var i,n,o,s,a;const{host:t,location:d}=R(e.sharing_medium);r={host:t,location:d,subject:e.teams_name&&e.teams_channel_name?"".concat(e.teams_name," / ").concat(e.teams_channel_name):null!==(i=e.subject)&&void 0!==i?i:"",createdDate:e.shared_time?new Date(e.shared_time):void 0,url:e.sharing_reference_url,author:{name:null!==(n=null===(o=e.sharer)||void 0===o?void 0:o.display_name)&&void 0!==n?n:"",smtp:null===(s=e.sharer)||void 0===s?void 0:s.smtp},collaborators:null===(a=e.participants)||void 0===a?void 0:a.map(e=>({name:e.display_name,smtp:e.smtp}))}}return r});return{places:(await Promise.all(r)).filter(e=>void 0!==e)}}includeBacklinksInList(){var e;if(void 0===this.settingsProvider)return!1;let t=(0,n.AU)("loopApp.sharelinkBacklinkUXConvergence",!1,this.settingsProvider);return(null===(e=this.userContext)||void 0===e?void 0:e.user.tenantId)===o.DR&&(t=t&&(0,n.AU)("loopApp.msabacklinks",!1,this.settingsProvider)),t}}},30946:(e,t,r)=>{function i(e){const t=btoa(e);return t.replace(/(\+|\/|\=)/g,e=>{if("+"===e)return"-";if("/"===e)return"_";if("="===e)return"";throw new TypeError("Unexpected match ".concat(e," encountered in urlEncodeBase64String. Only +/= are to be replaced."))})}r.d(t,{A7:()=>o,x7:()=>s});var n=r(60835);async function o(e,t,r){const{siteUrl:i,driveId:o,fileId:a}=t,d=await(0,n.sN)(e,i,o,a,r);if(!d)throw new Error("Failed to fetch file sharepoint ids");return s(d,a)}function s(e,t){const{siteId:r,webId:n,listId:o}=e;return"SPO_".concat(i("".concat(r,",").concat(n,",").concat(o)),"_").concat(t)}},37097:(e,t,r)=>{r.d(t,{cC:()=>u,dm:()=>p});var i=r(27051),n=r(33788),o=r(29018),s=r(25969),a=r(72376),d=r(40635),c=r(74405),l=r(30946);async function u(e,t,r,u,p,m){let h=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const f="GetFilePreviewMetadataResponse",g=n.m.start(f,p),v=(0,o.$)(t),I={getToken:n=>{if(n){const o=(0,i.A)((0,i.A)({},n),{},{siteUrl:t,driveId:r,itemId:u});return e.getToken((0,s.K)(v),o)}throw Error("Options must be specified")},url:"".concat(v,"/_api/v2.0/drives/").concat(r,"/items/").concat(u,"?$select=lastModifiedDateTime,lastModifiedBy,name,title,alternateFileIconUrl").concat(h?",sharepointIds":""),tenantId:m,requestInit:{method:"GET"},retryPolicy:a._9,tokenPolicy:(0,a.N$)(e)},w=p?(0,d.g)((0,i.A)((0,i.A)({},I),{},{logger:p,nameForLogging:f,doNotLogOnSuccess:!0,getAdditionalProps:async e=>(0,c.u)(e)})):(0,d.y)(I);let y;try{y=(await w).result,g.setResult(!0)}catch(k){return void g.setResult(!1,void 0,k)}if(y.ok)try{const e=await y.json();return{lastModified:{dateTime:new Date(e.lastModifiedDateTime),user:e.lastModifiedBy.user.displayName||e.lastModifiedBy.user.email},title:e.title||e.name.substring(0,e.name.lastIndexOf(".")),pageIcon:e.alternateFileIconUrl,pageCover:e.pageCover,spoId:h?(0,l.x7)(e.sharepointIds,u):void 0}}catch(k){g.setResult(!1,void 0,k)}else try{const e=await y.json();return{statusCode:y.status,errorMessage:"".concat(e.error.code).concat(e.error.innerError?" (".concat(e.error.innerError,")"):"",": ").concat(e.error.message)}}catch(k){g.setResult(!1,void 0,k)}}function p(e){return void 0===e||"errorMessage"in e}},60980:(e,t,r)=>{r.d(t,{j:()=>m});var i=r(27051),n=r(40635),o=r(74405),s=r(25969),a=r(72376),d=r(78796),c=r(18206),l=r(46624);const u=["files.readwrite.all"],p="https://graph.microsoft.com/v1.0";async function m(e,t,r){var m,h;const f=new URL(e),g=f.origin,v="Consumer"===t.identityType&&g===d.W,I=btoa(f.toString()).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,""),w=v?p:"".concat(g,"/_api/v2.0"),y={getToken:e=>{if(e){const r=(0,i.A)((0,i.A)({},e),{},{siteUrl:g});return t.getToken(v?u:(0,s.K)(g),v?e:r)}throw Error("Options must be specified")},url:"".concat(w,"/shares/u!").concat(I,"/driveItem?select=id,name,parentReference,sharepointIds,package,folder,lastModifiedDateTime"),requestInit:{method:"GET",headers:{Prefer:"redeemSharingLink"}},retryPolicy:v?c.XM:a._9,tokenPolicy:v?void 0:(0,a.N$)(t)},k=r?(0,n.g)((0,i.A)((0,i.A)({},y),{},{logger:r,nameForLogging:"getOdspItemWithSharepointIdsFromLink",doNotLogOnSuccess:!0,getAdditionalProps:async(e,t)=>(0,o.u)(e)})):(0,n.y)(y),P=await(await k).result.json();if(v)return function(e,t){if(!e.id)throw new Error("Unexpected response: missing id");if(!e.parentReference.driveId)throw new Error("Unexpected response: missing driveId");if(!e.name)throw new Error("Unexpected response: missing name");return{itemId:e.id,driveId:e.parentReference.driveId,siteUrl:t,fileName:e.name,listId:"",listItemId:"",siteId:"",webId:"",listItemUniqueId:"",tenantId:l.DR,title:"",package:e.package,folder:e.folder,lastModifiedDateTime:(null===e||void 0===e?void 0:e.lastModifiedDateTime)||void 0}}(P,g);if(null===(m=P.sharepointIds)||void 0===m||!m.siteUrl)throw new Error("Unexpected response: missing sharepointIds.siteUrl");if(null===(h=P.parentReference)||void 0===h||!h.driveId)throw new Error("Unexpected response: missing parentReference.driveId");if(!P.id)throw new Error("Unexpected response: missing id");return function(e){if("object"!==typeof e)throw new Error("Unexpected response");if(!e.id)throw new Error("Unexpected response: missing id");if(!e.parentReference.driveId)throw new Error("Unexpected response: missing driveId");if(!e.name)throw new Error("Unexpected response: missing name");const{sharepointIds:t}=e;if(!t)throw new Error("Unexpected response: missing sharepointIds");const{listId:r,listItemId:i,siteId:n,webId:o,siteUrl:s,listItemUniqueId:a,tenantId:d}=t;if("string"!==typeof r)throw new Error("Unexpected response: missing sharepointIds.listId");if("string"!==typeof i)throw new Error("Unexpected response: missing sharepointIds.listItemId");if("string"!==typeof n)throw new Error("Unexpected response: missing sharepointIds.siteId");if("string"!==typeof o)throw new Error("Unexpected response: missing sharepointIds.webId");if("string"!==typeof s)throw new Error("Unexpected response: missing sharepointIds.siteUrl");if("string"!==typeof a)throw new Error("Unexpected response: missing sharepointIds.listItemUniqueId");if("string"!==typeof d)throw new Error("Unexpected response: missing sharepointIds.tenantId");return{driveId:e.parentReference.driveId,siteUrl:s,itemId:e.id,listId:r,listItemId:i,siteId:n,webId:o,listItemUniqueId:a,tenantId:d,fileName:e.name,title:e.title,package:e.package,folder:e.folder,lastModifiedDateTime:(null===e||void 0===e?void 0:e.lastModifiedDateTime)||void 0}}(P)}}}]);
//# sourceMappingURL=MTSFoundInPlaces.09881ff7.chunk.js.map