"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[59941],{93401:(a,e,t)=>{t.r(e),t.d(e,{handleAshaEvent:()=>F,initializeAshaForFluid:()=>x,shutdownAshaForFluid:()=>S,updateAshaAdditionalPartCEventDataFromTelemetryProperties:()=>D});var n=t(53986);const r={partAMetadata:{},ariaTenantPrefix:"",ariaHeartbeatTenantPrefix:"",isAshaEnabled:!1,isHeartbeatEventEnabled:!1,additionalPartCEventData:{},heartbeatIntervalMs:18e5,pillarIntervalMs:864e5,disabledAshaErrors:[],sendTelemetryEventCallback:()=>{}};var i=t(90589);const s={dataCategories:2,diagnosticLevel:110};let o=[],l=[];function d(){l=[];for(const a in r.additionalPartCEventData)l.push({name:a,dataType:0,value:r.additionalPartCEventData[a].toString()})}function v(a,e){T&&r.isAshaEnabled&&r.sendTelemetryEventCallback({eventName:a,eventContract:{name:"AshaPartAMetadata",dataFields:o},dataFields:[...e,...l],eventFlags:s})}const c=new Set;let u=0,E=0;function p(a){T&&r.isAshaEnabled&&(u=Date.now(),v("".concat(r.ariaTenantPrefix,".Asha.Pillars"),[(0,i.m9)("Pillars",a?a.toString():[...c].join(","))]))}function h(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.pillarIntervalMs;E=window.setTimeout(()=>{c.size>0&&p(),h()},a)}let b=0;function f(){T&&r.isAshaEnabled&&r.isHeartbeatEventEnabled&&0!==c.size&&v("".concat(r.ariaHeartbeatTenantPrefix,".Asha.Heartbeat"),[(0,i.m9)("Pillars",[...c].join(","))])}function m(){r.isHeartbeatEventEnabled&&0===b&&P()}function A(){0!==b&&(window.clearTimeout(b),b=0)}function P(){f(),b=window.setTimeout(()=>{P()},r.heartbeatIntervalMs)}let T=!1;function I(a){var e,t,n,i;return!!(!T&&a&&a.partAMetadata&&a.ariaTenantPrefix&&a.ariaHeartbeatTenantPrefix&&a.sendTelemetryEventCallback)&&(r.partAMetadata=a.partAMetadata,r.ariaTenantPrefix=a.ariaTenantPrefix,r.ariaHeartbeatTenantPrefix=a.ariaHeartbeatTenantPrefix,r.isAshaEnabled=a.isAshaEnabled,r.isHeartbeatEventEnabled=a.isHeartbeatEventEnabled,r.additionalPartCEventData=null!==(e=a.additionalPartCEventData)&&void 0!==e?e:r.additionalPartCEventData,r.heartbeatIntervalMs=null!==(t=a.heartbeatIntervalMs)&&void 0!==t?t:r.heartbeatIntervalMs,r.pillarIntervalMs=null!==(n=a.pillarIntervalMs)&&void 0!==n?n:r.pillarIntervalMs,r.disabledAshaErrors=null!==(i=a.disabledAshaErrors)&&void 0!==i?i:r.disabledAshaErrors,r.sendTelemetryEventCallback=a.sendTelemetryEventCallback,function(){o=[];for(const a in r.partAMetadata)o.push({name:a,dataType:0,value:r.partAMetadata[a].toString()})}(),d(),T=!0,!0)}function g(){T&&r.isAshaEnabled&&(!function(a){a?M():y();r.isAshaEnabled=a}(!1),function(a){a?m():A();r.isHeartbeatEventEnabled=a}(!1),T=!1)}function C(a){r.additionalPartCEventData&&function(a,e){const t=Object.keys(a),n=Object.keys(e);return t.length===n.length&&t.every(a=>a in e)&&t.every(t=>a[t]===e[t])}(r.additionalPartCEventData,a)||(r.additionalPartCEventData=Object.assign(Object.assign({},r.additionalPartCEventData),a),d(),f(),p())}function M(){T&&r.isAshaEnabled&&(m(),function(){if(0===E)if(0===u)h();else{const a=Date.now()-u;r.pillarIntervalMs&&a>=r.pillarIntervalMs||a<=0?(p(),h()):r.pillarIntervalMs&&h(r.pillarIntervalMs-a)}}())}function y(){A(),0!==E&&(window.clearTimeout(E),E=0)}const w=["errorName","veto","pillar","durationMs","inStaging","isIntentional","isInternal","isSessionEndingError","stack"],x=(a,e,t)=>{I({ariaHeartbeatTenantPrefix:a,ariaTenantPrefix:a,isAshaEnabled:!0,isHeartbeatEventEnabled:!0,sendTelemetryEventCallback:t,partAMetadata:{},additionalPartCEventData:L(e)})},S=g,D=a=>{C(L(a))},N=a=>{!function(a){if(!T||!r.isAshaEnabled||!a||c.has(a))return;const e=0===c.size;c.add(a),e?M():f(),p(a)}(a.props.pillar)},k=a=>{var e;e=a.props.pillar,T&&r.isAshaEnabled&&e&&c.has(e)&&(c.delete(e),p(e),f(),0===c.size&&y())},H=a=>{const{props:e}=a,{errorName:t,veto:i,pillar:s,durationMs:o,inStaging:l,isIntentional:d,isInternal:u,isSessionEndingError:E,stack:h}=e,b=(0,n.A)(e,w);C(L(b)),function(a){var e;if(!T||!r.isAshaEnabled||!a||!a.errorName)return;if(r.disabledAshaErrors)for(const n of r.disabledAshaErrors)if(n.vetoName){if(n.vetoName.toLowerCase()===a.veto.name.toLowerCase()&&n.errorName.toLowerCase()===a.errorName.toLowerCase())return}else if(n.errorName.toLowerCase()===a.errorName.toLowerCase())return;const t=[{name:"Pillar",dataType:0,value:a.veto.pillar},{name:"Veto",dataType:0,value:a.veto.name},{name:"InStaging",dataType:1,value:null===(e=a.inStaging)||void 0===e||e}];if(void 0!==a.isIntentional&&t.push({name:"IsIntentional",dataType:1,value:a.isIntentional}),void 0!==a.isInternal&&t.push({name:"IsInternal",dataType:1,value:a.isInternal}),void 0!==a.durationMs&&t.push({name:"DurationMs",dataType:3,value:a.durationMs}),void 0!==a.isSessionEndingError&&t.push({name:"IsSessionEndingError",dataType:1,value:a.isSessionEndingError}),void 0!==a.extendedProperties)for(const n in a.extendedProperties)t.push({name:"ExtendedProperties_".concat(n),dataType:0,value:a.extendedProperties[n].toString()});c.has(a.veto.pillar)?v("".concat(r.ariaTenantPrefix,".Asha.Error.").concat(a.errorName),t):(t.push({name:"Error",dataType:0,value:a.errorName}),t.push({name:"FailureReason",dataType:0,value:"Inactive Pillar"}),v("".concat(r.ariaTenantPrefix,".Asha.ApiError.DroppedErrors"),t)),a.isSessionEndingError&&(p(),g())}({errorName:t,veto:{name:i,pillar:s},durationMs:o,inStaging:l,isIntentional:d,isInternal:u,isSessionEndingError:E,extendedProperties:{stack:h}})},F=async a=>{const{props:e}=a;switch(e.eventName){case"AshaPillarAdd":return N(a);case"AshaPillarRemove":return k(a);case"AshaError":return H(a)}},j=["containerType","hostCorrelationId","hostName","hostScenarioName"],L=a=>{const e={};for(const t of j){const n=a[t];void 0!==n&&"object"!==typeof n&&(e[t]=n)}return e}}}]);
//# sourceMappingURL=AshaUtils.76734510.chunk.js.map