"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[10041],{514:(e,t,r)=>{r.d(t,{g:()=>n});var i=r(32512);class n extends i.v{constructor(e,t,r,i){super(n.actionType,t,r,i),this.bucket=e}}n.actionType="PLW_CREATE_BUCKET_FAILED"},1207:(e,t,r)=>{r.d(t,{z:()=>n});var i=r(75992);class n extends i.r{loggingData(){return{planId:this.planId,count:String(this.buckets.length)}}constructor(e,t){super(n.actionType),this.planId=e,this.buckets=t}}n.actionType="PLW_GET_BUCKETSFORPLAN_SUCCEEDED"},1623:(e,t,r)=>{r.d(t,{t:()=>n});var i=r(75992);class n extends i.r{loggingData(){return{localId:this.bucket.id}}constructor(e){super(n.actionType),this.bucket=e}}n.actionType="PLW_CREATE_BUCKET"},8403:(e,t,r)=>{r.d(t,{f:()=>y});var i=r(55491),n=r.n(i),o=r(42410),s=r(72761);class c{static fromResource(e){return new c(e.contextScenarioId,e.externalContextId,e.externalObjectId,e.ownerAppId)}toGraphSerializable(){return{contextScenarioId:this.contextScenarioId,externalContextId:this.externalContextId,externalObjectId:this.externalObjectId,ownerAppId:this.ownerAppId}}constructor(e,t,r,i){this.externalObjectId=r,this.externalContextId=t,this.contextScenarioId=e,this.ownerAppId=i}}class a{toGraphSerializable(){const e={};return this.external&&(e.external=this.external.toGraphSerializable()),e}constructor(e){null!=e.external&&(this.external=c.fromResource(e.external))}}var u=r(41740),d=r.n(u),l=r(91246);class g{build(){return new y(this)}newFromDifferentialUpdate(e){if(e.entityType!==s.I.Bucket)throw new Error("ArgumentException: invalid entity");const t=y.builder.withPropertyBag({id:e.id,itemVersion:e.itemVersion,planId:"",title:""}).build(),r=e.getCreateDiffData(),i=t.applyDiffs(r);return this.forClone(i)}forClone(e){var t;return this.withPropertyBag({id:e.id,itemVersion:e.itemVersion,title:e.title,planId:e.planId,orderHint:e.orderHint,creationSource:null!==(t=d()(e.creationSource))&&void 0!==t?t:new a({})})}fromWebResource(e){return this.withPropertyBag({id:e.Id,itemVersion:null!=e.ItemVersion?e.ItemVersion.toString():void 0,orderHint:e.OrderHint,planId:e.PlanId,title:e.Title,creationSource:e.creationSource?new a(e.creationSource):void 0})}fromGraphResource(e){return this.withPropertyBag({itemVersion:e["@odata.etag"],title:e.name,planId:e.planId||"",orderHint:e.orderHint,id:e.id,creationSource:e.creationSource?new a(e.creationSource):void 0})}withPropertyBag(e){return this.id=e.id,this.itemVersion=e.itemVersion||this.itemVersion,this.orderHint=e.orderHint||this.orderHint,this.planId=e.planId,this.title=e.title,this.creationSource=e.creationSource||this.creationSource,this}withLocallyUniqueId(){return this.id=l.o.generate(),this}getDiffDataFromWebResource(e,t){const r=new o.F;r.addMapping("Title","title"),r.addMapping("OrderHint","orderHint"),r.addMapping("PlanId","planId"),r.addMapping("creationSource","creationSource");const i={};return n()(e.Changes,e=>{const t=e.FieldName;switch(t){case"OrderHint":case"PlanId":case"Title":const n=r.getMappedClientKey(t);i[n]=r.translateValue(t,n,e.Value)}}),i}getDiffDataFromGraphResource(e,t){const r=new o.F;return r.addMapping("name","title"),r.addMapping("orderHint","orderHint"),r.addMapping("planId","planId"),r.addMapping("creationSource","creationSource"),r.translate(e)}withValidData(){return this.id=l.o.generate(),this.itemVersion="1",this.title="Test bucket",this.planId=l.o.generate(),this.orderHint=" !",this}constructor(){this.id=l.o.generate(),this.title="",this.planId=l.o.generate(),this.itemVersion="",this.orderHint=" !",this.creationSource=new a({})}}var h=r(88908),p=r(17002),k=r.n(p),b=r(54320),I=r.n(b),v=r(36777),B=r.n(v),T=r(679);class y extends h.W{static get builder(){return new g}get entityType(){return s.I.Bucket}toWebSerializable(){return{Id:this.id,ItemVersion:null!=this.itemVersion?parseInt(this.itemVersion,10):null,OrderHint:this.orderHint,PlanId:this.planId,Title:this.title,creationSource:this.creationSource.toGraphSerializable()}}toGraphSerializable(){const e=this.creationSource.toGraphSerializable();return{id:this.id,"@odata.etag":this.itemVersion,orderHint:this.orderHint,planId:this.planId,name:this.title,creationSource:I()(e)?void 0:e}}setProperty(e,t){if("id"===e||"itemVersion"===e||"planId"===e||"creationSource"===e)throw new Error("ReadOnlyException: "+e);const r=this.getClone();return r[e]=t,r}getDiff(e){return T.B.getDiff(this,e,T.B.getDiffMomentCustomizer)}applyDiffs(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(!k()(t,e=>null!=e))throw new Error("ArgumentException: diffs - Diffs array contains null elements");return t.length>0?B()(y.builder.build(),this,...t,T.B.applyDiffMomentCustomizer):this}applyDifferentialUpdate(e){if(e.id!==this.id)throw new Error("ArgumentException: update.id must match this.id");const t=e.getUpdateDiffData(this);return this.applyDiffs(t)}getClone(){return this.getCloneBuilder().build()}getCloneBuilder(){return y.builder.forClone(this)}constructor(e){super(e.id,e.itemVersion),this.orderHint=e.orderHint,this.planId=e.planId,this.title=e.title,this.creationSource=e.creationSource}}y.TitleMaxLength=256},15765:(e,t,r)=>{r.d(t,{V:()=>n});var i=r(32512);class n extends i.v{constructor(e,t,r,i){super(n.actionType,t,r,i),this.bucketId=e}}n.actionType="PLW_DELETE_BUCKET_FAILED"},23821:(e,t,r)=>{r.d(t,{z:()=>n});var i=r(75992);class n extends i.r{loggingData(){return{id:this.bucket.id,updateKey:this.updateKey}}constructor(e,t){super(n.actionType),this.bucket=e,this.updateKey=t}}n.actionType="PLW_UPDATE_BUCKET_SUCCEEDED"},25744:(e,t,r)=>{r.d(t,{e:()=>n});var i=r(75992);class n extends i.r{loggingData(){return{id:this.bucketId}}constructor(e){super(n.actionType),this.bucketId=e}}n.actionType="PLW_DELETE_BUCKET"},30220:(e,t,r)=>{r.r(t),r.d(t,{BucketModule:()=>P});var i=r(1207),n=r(32512);class o extends n.v{constructor(e,t,r){super(o.actionType,e,t,r)}}o.actionType="PLW_GET_BUCKETSFORPLAN_FAILED";var s=r(53734);class c extends n.v{constructor(e,t,r,i){super(c.actionType,e,t,r),this.bucketId=i}}c.actionType="PLW_GET_BUCKET_FAILED";var a=r(1623),u=r(79670),d=r(514),l=r(25744),g=r(38227),h=r(15765),p=r(87450),k=r(23821),b=r(46219),I=r(33287),v=r(96891),B=r(64805),T=r(74844),y=r(54320),w=r.n(y),E=r(9962),f=r(91246),S=r(98502),m=r(82841);class P extends B.J{get name(){return"BucketModule"}async fetchBucketsForPlanAsync(e,t){this.loggers.traceLogger.logTrace(507896991,T.k.Verbose,"Fetching Buckets For Plan [PlanId=".concat(e,"][Force=").concat(null!==t&&void 0!==t&&t,"]"));let r=e=>{const t=this.stores.bucketStore.getBucketsForPlan(e.planId);return w()(t)?null:t},n=this.getCurrentViewIds();t&&(r=void 0,n=void 0);try{const o=await this.webApiProviders.taskService(),s=await o.getBucketsForPlanAsync({planId:e},r,n);return this.dispatcher.dispatchAction(new i.z(e,s)),this.loggers.traceLogger.logTrace(507896990,T.k.Verbose,"Fetching Buckets For Plan - Success [PlanId=".concat(e,"][Force=").concat(null!==t&&void 0!==t&&t,"]")),s}catch(d){var s,c,a,u;const r=d;return this.dispatcher.dispatchAction(new o(r.response,null!==(s=null===(c=r.response)||void 0===c?void 0:c.statusText)&&void 0!==s?s:"",null!==(a=null===(u=r.error)||void 0===u?void 0:u.message)&&void 0!==a?a:"")),this.loggers.traceLogger.logTrace(507896989,T.k.Warning,"Fetching Buckets For Plan - Fail [PlanId=".concat(e,"][Force=").concat(null!==t&&void 0!==t&&t,"]").concat((0,m.s8)(r))),Promise.reject(r)}}async fetchBucketAsync(e,t){this.loggers.traceLogger.logTrace(507896988,T.k.Verbose,"Fetching Bucket [BucketId=".concat(e,"][Force=").concat(null!==t&&void 0!==t&&t,"]"));let r=e=>this.stores.bucketStore.getBucket(e.bucketId),i=this.getCurrentViewIds();t&&(r=void 0,i=void 0);try{const n=await this.webApiProviders.taskService(),o=await n.getBucketAsync({bucketId:e},r,i);return this.dispatcher.dispatchAction(new s.g(o.bucket)),this.loggers.traceLogger.logTrace(507896987,T.k.Verbose,"Fetching Bucket - Success [BucketId=".concat(e,"][Force=").concat(null!==t&&void 0!==t&&t,"]")),o.bucket}catch(d){var n,o,a,u;const r=d;return this.dispatcher.dispatchAction(new c(r.response,null!==(n=null===(o=r.response)||void 0===o?void 0:o.statusText)&&void 0!==n?n:"",null!==(a=null===(u=r.error)||void 0===u?void 0:u.message)&&void 0!==a?a:"",e)),this.loggers.traceLogger.logTrace(507896986,T.k.Warning,"Fetching Bucket - Fail [BucketId=".concat(e,"][Force=").concat(null!==t&&void 0!==t&&t,"] ").concat((0,m.s8)(r))),Promise.reject(r)}}async createBucketAsync(e){if(this.loggers.traceLogger.logTrace(507896985,T.k.Verbose,"Creating Bucket [PlanId=".concat(e.planId,"]")),w()(e.title.trim())){const t="InvalidArgumentException: Whitespaces are not allowed";return this.loggers.traceLogger.logTrace(507896984,T.k.Warning,"Creating Bucket - Fail [PlanId=".concat(e.planId,"][Error=").concat(t,"]")),Promise.reject(S.g.generateAjaxClientError(null,t))}this.dispatcher.dispatchAction(new a.t(e));try{const t=await this.webApiProviders.taskService(),r=await t.createBucketAsync({bucketInfo:e});return this.dispatcher.dispatchAction(new u.G(r.bucket,e.id)),this.loggers.traceLogger.logTrace(507896983,T.k.Verbose,"Creating Bucket - Success [PlanId=".concat(e.planId,"]")),this.loggers.usageLogger.logData(this.name,v.M.CreateBucket),r.bucket}catch(o){var t,r,i,n;const s=o;return this.dispatcher.dispatchAction(new d.g(e,s.response,null!==(t=null===(r=s.response)||void 0===r?void 0:r.statusText)&&void 0!==t?t:"",null!==(i=null===(n=s.error)||void 0===n?void 0:n.message)&&void 0!==i?i:"")),this.loggers.traceLogger.logTrace(507896982,T.k.Warning,"Creating Bucket - Fail [PlanId=".concat(e.planId,"]").concat((0,m.s8)(s))),Promise.reject(s)}}async deleteBucketAsync(e,t){this.loggers.traceLogger.logTrace(507896981,T.k.Verbose,"Deleting Bucket [BucketId=".concat(e,"][Version=").concat(t,"]"));const r=this.stores.bucketStore.getBucket(e);if(this.dispatcher.dispatchAction(new l.e(e)),null==r)return Promise.resolve();try{const r=await this.webApiProviders.taskService();return await r.deleteBucketAsync({bucketId:e,itemVersion:t}),this.dispatcher.dispatchAction(new g.R(e)),void this.loggers.traceLogger.logTrace(507896980,T.k.Verbose,"Deleting Bucket - Success [BucketId=".concat(e,"][Version=").concat(t,"]"))}catch(c){var i,n,o,s;const r=c;return this.dispatcher.dispatchAction(new h.V(e,r.response,null!==(i=null===(n=r.response)||void 0===n?void 0:n.statusText)&&void 0!==i?i:"",null!==(o=null===(s=r.error)||void 0===s?void 0:s.message)&&void 0!==o?o:"")),this.loggers.traceLogger.logTrace(507896979,T.k.Warning,"Deleting Bucket - Failure [BucketId=".concat(e,"][Version=").concat(t,"]").concat((0,m.s8)(r))),Promise.reject(r)}}async updateBucketAsync(e,t){this.loggers.traceLogger.logTrace(507896978,T.k.Verbose,"Updating Bucket [BucketId=".concat(e.id,"]"));const r=e.getDiff(t);if(this.logUpdateBucketUsage(r),w()(r))return this.loggers.traceLogger.logTrace(507896977,T.k.Verbose,"Updating Bucket - Success No-op [BucketId=".concat(e.id,"]")),Promise.resolve(I.a.builder.withBucket(t).build());const i=f.o.generate();this.dispatcher.dispatchAction(new p.A(t,i));const n=t=>{const i=this.stores.bucketStore.getBucketWithoutPendingUpdates(t.originalBucket.id);if(null==i)throw this.loggers.traceLogger.logTrace(507896976,T.k.Warning,"Updating Bucket - Fail [BucketId=".concat(e.id,'][Error="Original bucket not found in store"]')),S.g.generateAjaxClientError(null,new E.m("originalStoreBucket","bucketStore"));const n=i.applyDiffs(r);return{originalBucket:i,updatedBucket:n}};try{const r=await this.webApiProviders.taskService(),o=await r.updateBucketAsync({originalBucket:e,updatedBucket:t},n);return this.dispatcher.dispatchAction(new k.z(o.bucket,i)),this.loggers.traceLogger.logTrace(507896975,T.k.Verbose,"Updating Bucket - Success [BucketId=".concat(e.id,"]")),o}catch(u){var o,s,c,a;const t=u;return this.dispatcher.dispatchAction(new b.T(e,i,t.response,null!==(o=null===(s=t.response)||void 0===s?void 0:s.statusText)&&void 0!==o?o:"",null!==(c=null===(a=t.error)||void 0===a?void 0:a.message)&&void 0!==c?c:"")),this.loggers.traceLogger.logTrace(507896974,T.k.Warning,"Updating Bucket - Fail [BucketId=".concat(e.id,"]").concat((0,m.s8)(t))),Promise.reject(t)}}logUpdateBucketUsage(e){e.title&&this.loggers.usageLogger.logData(v.M.BucketActionCreator,v.M.BucketTitleUpdated),e.orderHint&&this.loggers.usageLogger.logData(v.M.BucketActionCreator,v.M.BucketOrderHintUpdated)}}},33287:(e,t,r)=>{r.d(t,{a:()=>o});var i=r(8403);class n{build(){return new o(this)}fromBucketEntityGroupResource(e){return this.withPropertyBag({bucket:i.f.builder.fromWebResource(e.Bucket).build()})}fromGraphBucketResourceTypes(e){return this.withPropertyBag({bucket:i.f.builder.fromGraphResource(e).build()})}withPropertyBag(e){return this.bucket=e.bucket||this.bucket,this}withBucket(e){return this.bucket=e,this}withDefaultValues(){return this.withPropertyBag({bucket:i.f.builder.build()})}}class o{static get builder(){return new n}get id(){return this.bucket.id}toWebSerializable(){return{Bucket:this.bucket.toWebSerializable()}}constructor(e){this.bucket=e.bucket}}},38227:(e,t,r)=>{r.d(t,{R:()=>n});var i=r(75992);class n extends i.r{loggingData(){return{id:this.bucketId}}constructor(e){super(n.actionType),this.bucketId=e}}n.actionType="PLW_DELETE_BUCKET_SUCCEEDED"},46219:(e,t,r)=>{r.d(t,{T:()=>n});var i=r(32512);class n extends i.v{constructor(e,t,r,i,o){super(n.actionType,r,i,o),this.bucket=e,this.updateKey=t}}n.actionType="PLW_UPDATE_BUCKET_FAILED"},53734:(e,t,r)=>{r.d(t,{g:()=>n});var i=r(75992);class n extends i.r{loggingData(){return{id:this.bucket.id}}constructor(e){super(n.actionType),this.bucket=e}}n.actionType="PLW_GET_BUCKET_SUCCEEDED"},64805:(e,t,r)=>{r.d(t,{J:()=>n});class i{get clientSettings(){return this.clientSettingsProvider()}constructor(e,t,r){this.dispatcher=e,this.clientSettingsProvider=t,this.loggers=r}}class n extends i{getCurrentViewIds(){const e=this.stores.appContextStore.getCurrentViewId();return e?[e]:void 0}constructor(e,t,r,i,n){super(e,i,n),this.webApiProviders=t,this.stores=r}}},79670:(e,t,r)=>{r.d(t,{G:()=>n});var i=r(75992);class n extends i.r{loggingData(){return{localId:this.localId,id:this.bucket.id}}constructor(e,t){super(n.actionType),this.bucket=e,this.localId=t}}n.actionType="PLW_CREATE_BUCKET_SUCCEEDED"},87450:(e,t,r)=>{r.d(t,{A:()=>n});var i=r(75992);class n extends i.r{loggingData(){return{id:this.bucket.id,updateKey:this.updateKey}}constructor(e,t){super(n.actionType),this.bucket=e,this.updateKey=t}}n.actionType="PLW_UPDATE_BUCKET"}}]);
//# sourceMappingURL=bucketmodule.c0565441.chunk.js.map