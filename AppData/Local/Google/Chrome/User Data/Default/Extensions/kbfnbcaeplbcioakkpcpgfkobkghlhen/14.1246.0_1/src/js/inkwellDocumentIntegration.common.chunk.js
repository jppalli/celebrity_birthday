(self.webpackChunk=self.webpackChunk||[]).push([[5643],{53651:(e,t,i)=>{i.d(t,{v:()=>w});var n=i(92244),s=i(23031),r=i(78542),o=i(53380),c=i(90023),a=i(13391),l=i(32073),u=i(59179),d=i(20161),p=i(84714),g=i(47311),h=i(954),m=i(24666),f=i(94032),v=i(58303),b=i(63524);const x=i(4256).E0;class y{constructor(e){this._params=e,this._subscription=new l.w0,this._selection=a.h.create(null),this.selection=this._selection.view(),this._subscription.add(e.selectionOrCaretPosition.pipe(u.U((e=>v.WG(e))),d.w((e=>e?p.of(e):g.timer(x).pipe(u.U((()=>this._getCurrentSelection())),h.O(this._getCurrentSelection()),m.x())))).subscribe(f.wW(this._selection)))}_getCurrentSelection(){return(0,c.zG)(this._params.selectionService.getCurrentSelection(),b.Ey)}setSelection(e){this._params.selectionService.setSelection(e)}dispose(){this._subscription.unsubscribe()}}var _=i(55768),k=i(13866);class S{constructor(e){this._params=e,this.getDocumentText=()=>this._params.getCurrentTextMap().getRichText(),this.getDocumentGeometry=()=>{const e=k.i.getVisibleTextRange(this._params.getCurrentTextMap(),this._params.textFieldLayout,this._params.geometryProvider,this._params.geometryLayout),t=k.i.getTextFieldBoundingBox(this._params.textField,this._params.textFieldLayout);return e?{visibleTextRange:e,documentFrame:t}:{documentFrame:t}},this.getBoundingBoxesForTextRanges=e=>k.i.getBoundingBoxesForTextRanges(e,this._params.textField,this._params.originalTextField,this._params.doc,this._params.getCurrentTextMap(),this._params.textFieldLayout,this._params.geometryLayout,this._params.geometryProvider),this.setDocumentSelectedTextRange=e=>this._params.selectionService.setSelection(e),this.applyChangesToDocument=e=>{const t=(0,_.g)(e,!0);return this._params.replacementService.performBatchReplacements(t).then((t=>({changes:e,status:t})))}}}class w{constructor(e){var t;this._log=r.Y.create("ConnectorDependenciesImpl"),this._disposableList=[];const i=(0,n.Me)(e.textField);this.target={documentID:s.iy.create(),documentUrl:i.location.href,textField:e.textField,originalTextField:e.originalTextField},this.textRevisionManager=o.X.create(e.textObserver,e.createTextRevisionManager),this.selectionService=new y({selectionService:e.selectionService,selectionOrCaretPosition:e.selectionOrCaretPosition});const c=null!==(t=e.geometryLayout)&&void 0!==t?t:e.integrationLayout.createGeometryLayout();this.connectorHandler=new S({doc:i,replacementService:e.replacementService,textRevisionManager:this.textRevisionManager,geometryLayout:c,selectionService:this.selectionService,textField:e.textField,textFieldLayout:e.integrationLayout.textField,originalTextField:e.originalTextField,geometryProvider:e.geometryProvider,getCurrentTextMap:()=>e.textObserver.getCurrentTextMap()}),this._disposableList.push(this.selectionService)}dispose(){(0,s.jD)(this._disposableList,this._log)}}},13866:(e,t,i)=>{i.d(t,{i:()=>n});var n,s=i(90023),r=i(29116),o=i(27853),c=i(73953),a=i(23031),l=i(5270);!function(e){function t(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}function i(e){const t=e.rect.getCurrent();return{left:t.client.left,top:t.client.top,width:t.size.width,height:t.size.height}}function n(e){const t=e.visibleRect.getCurrent(),i=e.rect.getCurrent(),n=e.scroll.getCurrent(),s=(0,r.jg)(t,i);return s?(0,r.Li)(s,i,n):null}function u(e,t,i,n,s){var r;const c=n.create(e,t);return c?Array.from(null!==(r=n.getClientRects(c))&&void 0!==r?r:[]).filter((e=>e.height>0&&e.width>0)).map((e=>o.UL.setPosition(s.clientToRelative(e),e))).filter((e=>o.UL.contains(e,i))):[]}function d(e,t,i){return[[e.left,e.top+e.height],[e.left+e.width,e.top+e.height]].map((([e,i])=>t.elementFromPoint(e,i))).every((e=>i.some((t=>e===t||t.contains(e)))))}function p(e){return Object.fromEntries(Object.keys(e).map((e=>[e,[]])))}e.getZoomedBoundingBox=function(e,t){return{x:e.x*t,y:e.y*t,width:e.width*t,height:e.height*t}},e.getTextFieldBoundingBox=function(e,n){const s=i(n),r=(0,c.k6)(e);if(!r)return t(s);const a=o.UL.getIntersection(s,r);return t(a?{...a,top:s.top,height:s.height}:s)},e.getRelativeVisibleTextFieldRect=n,e.getVisibleRelativeRectsForTextRange=u,e.getVisibleTextRange=function(e,t,i,s){let r=null;const o=e.getPlainText(),c=n(t);if(!c||!o.length)return r;const a=s.getCurrentConversionContext();for(let t=0;t<o.length;t++){if(u({start:t,end:t+1},e,c,i,a).length>0)r={start:null===r?t:r.start,end:t+1};else if(r&&(0,l.qE)(o.substring(t,t+1)))break}return r},e.isRectElementOnDocumentTop=d,e.createEmptyBoundingBoxesForTextField=p,e.getBoundingBoxesForTextRanges=function(e,r,c,l,g,h,m,f){const v=n(h);if(!v)return p(e);const b=m.getCurrentConversionContext(),x=i(h),y=t(x),_=h.scroll.getCurrent(),k={left:x.left-_.left,top:x.top-_.top},S={left:y.x-_.left,top:y.y-_.top};return Object.fromEntries(Object.entries(e).map((([e,i])=>[e,u(i,g,v,f,b).filter((e=>d(o.UL.shift(e,k),l,[r,c].filter(a.fQ)))).map((e=>(0,s.zG)(o.UL.shift(e,S),t)))])))}}(n||(n={}))},53380:(e,t,i)=>{i.d(t,{X:()=>n});var n,s=i(90572),r=i(47903),o=i(38437);!function(e){e.create=function(e,t=r.n.create){const i=t({getTextSource:()=>e.getTextSource(),getCurrentTextMap:()=>e.getCurrentTextMap(),dispose:()=>e.dispose(),textMapChanged:e.textMapChanged,contentChanges:{async:e.contentChanges.async.pipe(s.h((e=>e.changes.length>0))),immediate:e.contentChanges.immediate.pipe(s.h((e=>e.changes.length>0)))}});return{revisionChanges:i.revisionChanges,getLatestVersionNumber:()=>o.Q.getRevisionNumber(i.getLatestRevision().id),dispose:()=>i.dispose()}}}(n||(n={}))},93895:(e,t,i)=>{i.r(t),i.d(t,{InkwellDocumentIntegrationImpl:()=>R});var n=i(92379),s=i(48546),r=i(32073),o=i(32734),c=i(20680),a=i(79256),l=i(50750),u=i(84308),d=i(90572),p=i(84178),g=i(20161),h=i(59179),m=i(24666),f=i(64271),v=i(84714),b=i(954),x=i(53651),y=i(93184);class _{constructor(e){this._shouldMeasure=e}rxMeasure(e,t){return this._shouldMeasure?y.d5.measure(this.callMeasure(e,t)):y.d5.doNothing}callMeasure(e,t){return i=>{if(this._shouldMeasure){const n=_._eventIndex++,s=performance.mark(`Ink_${e}${n}_start`);try{i()}finally{const i=performance.mark(`Ink_${e}${n}_end`),r=performance.measure(`Ink_${e}${n}_duration`,{start:s.name,end:i.name,detail:{devtools:{dataType:"track-entry",track:"Inkwell Extension",trackGroup:"Inkwell",color:"tertiary-dark",tooltipText:`Inkwell ${e}`}}});t&&t({eventName:e,start:s.startTime,end:i.startTime,duration:r.duration})}}else i()}}}_._eventIndex=0;var k=i(23031),S=i(25961),w=i(38437),C=i(78542),T=i(56054);class R{constructor(e){this._logger=C.Y.create(`Inkwell/${R.name}`),this._disposed=!1,this._subscriptions=new r.w0,this._disposables=[];const t=new _(e.measurePerformance),i=new x.v(e),n=e.inkwellPageDynamicService.getSingletonInstance(),g=this._getCAPIMessages(e.checkingService).pipe(o.B());let h=!0;const m=[];this._subscriptions.add(g.subscribe((e=>{h&&m.push(e)})));const f=c.z(a.P((()=>{const e=l.D([...m]);return h=!1,m.length=0,e})),g).pipe(t.rxMeasure("capiMessage")),v=u.a([(0,s.n)(e.checkingService.pipe(d.h(k.C_),p.q(1))),n]).pipe(t.rxMeasure("deps"));this._subscriptions.add(v.subscribe((([n,s])=>{this._disposables.push(s.connectDocument({connectorDependencies:i,capiMessages:f,checkingService:n,alertProcessor:e.alertProcessor,isFieldFocused:e.isFieldFocused,textFieldLayout:e.integrationLayout.textField,perf:t}))})))}getDecorationsUI(){return n.createElement("div",null)}dispose(e){this._disposed||(this._disposed=!0,(0,k.jD)(this._disposables,this._logger),this._subscriptions.unsubscribe())}_getCAPIMessages(e){return e.pipe(d.h(k.C_),g.w((e=>e.capiMessages.pipe(d.h((e=>"start"===e.action)),g.w((t=>{const i=t.sessionUuid,n=e.checkingRevisionInfo.pipe(h.U((e=>({kind:"capiTextRevision",sessionId:i,capiTextRevision:w.Q.getRevisionNumber(e.revision)}))),m.x(((e,t)=>e.capiTextRevision===t.capiTextRevision))),s=e.readyState.pipe(d.h((e=>e===S.kQ.disconnected)),h.U((()=>({kind:"capiDisconnected",sessionId:i}))));return f.T(c.z(v.of(t),e.capiMessages.pipe(d.h((e=>!T.j9.has(e.action))))).pipe(h.U((e=>({kind:"capiMessage",sessionId:i,message:e}))),b.O({kind:"capiConnected",sessionId:i})),n,s)}))))))}}},56054:(e,t,i)=>{i.d(t,{C2:()=>m,j9:()=>g,n7:()=>f,yU:()=>h});var n=i(64297),s=i(32073),r=i(50750),o=i(20161),c=i(8065),a=i(84714),l=i(59179),u=i(12518),d=i(78542),p=i(84042);const g=new Set(["sdui:add","sdui:update","sdui:remove"]);class h{constructor(e){this._params=e,this._log=d.Y.create(`Inkwell/${h.name}/dId[${this._params.documentID}]`),this._subs=new s.w0,this._subs.add(this._subscribeToCAPIMessages())}dispose(){this._subs.unsubscribe()}async sendCapiMessage(e){try{const t=await this._params.checkingService.sendMessage(e.message.action,e.message,!0)();if(u.nM(t))throw t.left}catch(e){this._log.error("Unexpected error calling checkingService.sendMessage",e)}}capiWebSocketOpened(e){return Promise.resolve()}capiWebSocketClosed(e){return Promise.resolve()}capiWebSocketMessage(e){return Promise.resolve()}capiWebSocketError(e){return Promise.resolve()}_subscribeToCAPIMessages(){return r.D(this._params.inkwellCapiAPI).pipe(o.w((e=>this._params.capiMessages.pipe(c.b((e=>"capiTextRevision"===e.kind?a.of(this._params.getTextRevision()).pipe(l.U((t=>({...e,documentTextRevision:t})))):a.of(e))),l.U((t=>({message:t,capiToInkwell:e}))))))).subscribe((({message:e,capiToInkwell:t})=>{switch(e.kind){case"capiConnected":this._logRejections((()=>t.capiConnected({sessionID:e.sessionId})),"Unexpected rejection from capiToInkwell.capiConnected");break;case"capiDisconnected":this._logRejections((()=>t.capiDisconnected({sessionID:e.sessionId})),"Unexpected rejection from capiToInkwell.capiDisconnected");break;case"capiTextRevision":this._logRejections((()=>t.capiTextRevision({sessionID:e.sessionId,documentRevision:e.documentTextRevision,capiRevision:e.capiTextRevision})),"Unexpected rejection from capiToInkwell.capiTextRevision");break;case"capiMessage":this._logRejections((()=>t.capiMessageReceived({sessionID:e.sessionId,message:e.message})),"Unexpected rejection from capiToInkwell.capiMessageReceived");break;default:(0,n.L0)(e)}}))}_logRejections(e,t){e().catch((e=>this._log.error(t,e)))}}function m(e,t){return{capiConnected:(0,p.i)(e,t.capiConnected),capiDisconnected:(0,p.i)(e,t.capiDisconnected),capiMessageReceived:(0,p.i)(e,t.capiMessageReceived),capiAlertRemoved:(0,p.i)(e,t.capiAlertRemoved),capiTextRevision:(0,p.i)(e,t.capiTextRevision),capiWebSocketCreate:(0,p.i)(e,t.capiWebSocketCreate),capiWebSocketClose:(0,p.i)(e,t.capiWebSocketClose),capiWebSocketConnect:(0,p.i)(e,t.capiWebSocketConnect),capiWebSocketSend:(0,p.i)(e,t.capiWebSocketSend)}}function f(e){return{sendCapiMessage:(0,p.O)((async t=>(await e(t)).sendCapiMessage)),capiWebSocketOpened:(0,p.O)((async t=>(await e(t)).capiWebSocketOpened)),capiWebSocketClosed:(0,p.O)((async t=>(await e(t)).capiWebSocketClosed)),capiWebSocketMessage:(0,p.O)((async t=>(await e(t)).capiWebSocketMessage)),capiWebSocketError:(0,p.O)((async t=>(await e(t)).capiWebSocketError))}}},84042:(e,t,i)=>{function n(e,t){return async i=>null===i?await t(null):await t({...i,documentID:e})}function s(e){return async t=>{const i=await e(t.documentID),n=await i(t);return{documentID:t.documentID,...n}}}i.d(t,{O:()=>s,i:()=>n})},99069:(e,t,i)=>{if(i.d(t,{Fb:()=>h,PF:()=>g,TY:()=>l,_V:()=>p,eg:()=>d,um:()=>a,yj:()=>u}),3075==i.j)var n=i(59179);if(3075==i.j)var s=i(24666);if(3075==i.j)var r=i(64297);if(3075==i.j)var o=i(20545);if(3075==i.j)var c=i(73953);var a,l,u;function d(e){if((0,c.uz)(e))return{mode:a.view};const t=(0,c.lW)(e);return t||((0,c.e$)(e)?{mode:a.noEditAccess}:{mode:a.edit})}!function(e){e.view="view",e.noEditAccess="noEditAccess",e.history="history",e.edit="edit"}(a||(a={})),function(e){e[e.ownDoc=0]="ownDoc",e[e.sharedDoc=1]="sharedDoc",e[e.noEditAccessDoc=2]="noEditAccessDoc"}(l||(l={})),function(e){e.read="read",e.write="write"}(u||(u={}));function p(e){return o.S.hz4.pipe((0,n.U)((()=>d(e))),(0,s.x)(((e,t)=>{return n=t,(i=e).mode===a.history&&n.mode===i.mode?i.subtype===n.subtype:i.mode===n.mode;var i,n})))}function g(e,t){return e?l.ownDoc:t?l.noEditAccessDoc:l.sharedDoc}function h(e,t,i,n){if(e.mode!==a.edit)return u.read;switch(t){case l.ownDoc:return u.write;case l.noEditAccessDoc:return u.read;case l.sharedDoc:return function(e,t,i){const n=!t&&!i;if(e.mode!==a.edit||n)return u.read;return u.write}(e,i,n);default:return(0,r.L0)(t)}}},73953:(e,t,i)=>{if(i.d(t,{LJ:()=>x,Nd:()=>u,Ov:()=>b,TW:()=>C,Ur:()=>d,Xs:()=>T,e$:()=>S,eg:()=>w,fN:()=>h,k6:()=>f,kh:()=>g,lW:()=>k,lz:()=>m,qg:()=>l,uj:()=>a,uz:()=>v}),3075==i.j)var n=i(8261);if(3075==i.j)var s=i(20182);if(3075==i.j)var r=i(14527);if(3075==i.j)var o=i(99069);var c=i(53305);function a(e){const t=(0,r.Cq)(e.querySelector(c.XG),"text buffer iframe");return(0,r.Cq)(t.nodeType===Node.ELEMENT_NODE&&"IFRAME"===t.tagName?t.contentDocument:void 0,"text buffer iframe document")}function l(e){const t=u(e);return{width:t?t.offsetWidth-t.clientWidth:0,height:t?t.offsetHeight-t.clientHeight:0}}function u(e){return e.querySelector(c.Wp)}function d(e,t,i){return t?function(e,t){if(t&&p(t))return t;const i=e.querySelectorAll(c.Qy);for(const e of i)if(p(e))return e;return null}(e,i):e.querySelector(c.Qy)}const p=e=>e.checkVisibility?e.checkVisibility():e.parentElement&&"none"!==e.parentElement.style.display;function g(e){return e.querySelectorAll(c.gH)}function h(e){return e.querySelector(c.gH)}function m(e){return Boolean(e.querySelector(c.gH))}function f(e){let t=e.querySelector(c.os);return t||(t=document.querySelector(c.gH)),t?t.getBoundingClientRect():null}const v=e=>!!e.querySelector(c.Lq);function b(e){return e.querySelector(c.$x)}function x(e){return null==e?void 0:e.querySelector(c.y1)}var y;!function(e){e.legacy="legacy",e.modern="modern"}(y||(y={}));const _=e=>"versionHistorySidebarWizSelector"===e.id||e.getBoundingClientRect().top>0?y.modern:y.legacy;function k(e){let t=e.querySelector(c.f);const i=(0,n.OB)().experimentClient.isGateEnabled(s.K.GDocsVersionHistorySidebarSelector);!t&&i&&(t=e.querySelector(c.q6));return!!t&&t.offsetHeight>0&&t.offsetWidth>0&&t?{mode:o.um.history,subtype:_(t)}:null}function S(e){return!!e.querySelector(`${c.jW}, ${c.F8}`)}function w(){const e=document.querySelector(c.d0),t=(null==e?void 0:e.classList.contains(c.uj))?"edit":void 0,i=(null==e?void 0:e.classList.contains(c._m))?"suggesting":void 0;return t||i||"other"}function C(e){return e.querySelector(c.QR)}function T(e){return e.querySelector(c.ij)}},53305:(e,t,i)=>{i.d(t,{$x:()=>o,F8:()=>f,Go:()=>s,Kt:()=>k,Lq:()=>u,QR:()=>I,Qy:()=>b,Vk:()=>S,Wp:()=>n,XG:()=>r,_m:()=>g,d0:()=>d,f:()=>a,gH:()=>v,gL:()=>w,ij:()=>R,j5:()=>_,jW:()=>m,l$:()=>h,lO:()=>T,os:()=>y,q6:()=>l,rx:()=>C,uj:()=>p,y1:()=>c,yw:()=>x});const n=".kix-appview-editor",s=".docos-input",r=".docs-texteventtarget-iframe",o=".kix-cursor",c=".kix-cursor-caret",a="#docs-revisions-sidebar",l="#docs-wiz-sidebar-placeholder",u='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',d="#docs-toolbar-mode-switcher",p="edit-mode",g="suggest-mode",h="titlebar-mode-indicator-container",m="#titlebar-mode-indicator-container .titlebar-request-access-button",f="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",v="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",b=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",x=".kix-page-paginated",y=".kix-page-paginated.canvas-first-page",_=".docs-horizontal-ruler",k=".docs-vertical-ruler",S="#fontSizeSelect input",w=".docs-ruler-background",C=".docs-ruler-background-inner",T=".docs-ruler-indent-first-line",R=".modal-dialog.docs-dialog .fatal-error-message",I='#docs-titlebar-share-client-button div[role="button"]'}}]);