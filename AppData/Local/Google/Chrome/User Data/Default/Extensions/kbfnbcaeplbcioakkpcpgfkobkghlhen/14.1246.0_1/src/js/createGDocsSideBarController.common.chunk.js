(self.webpackChunk=self.webpackChunk||[]).push([[7102],{89066:(e,t,i)=>{var s=i(14788),r="chrome-extension://__MSG_@@extension_id__/",n="moz-extension://__MSG_@@extension_id__/",a="safari-web-extension://__MSG_@@extension_id__/",o=self.GR_RESOURCE_ROOT||r,h=self.GR_RESOURCE_ROOT||n,l=self.GR_RESOURCE_ROOT||a;e.exports={__css:s.toString().replace(new RegExp(r,"g"),o).replace(new RegExp(n,"g"),h).replace(new RegExp(a,"g"),l),...s.locals}},78592:(e,t,i)=>{i.d(t,{Q:()=>u});var s=i(90023),r=i(72111),n=i(45178);class a extends n.sH{constructor(e){super(Boolean(e)?e:"Dropped"),this.name="DroppedError"}static isDroppedError(e){return e instanceof a}}class o extends n.sH{constructor(e){super(Boolean(e)?e:"Not Connected to WS"),this.name="NotConnectedError"}static isNotConnectedError(e){return e instanceof o}}var h=i(72106),l=i(73823);function c(e){return e().then(l.MH)}(0,s.MZ)(h.tS);function d(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function g(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),g(this,"_capiSDUIClient",void 0),g(this,"_log",void 0),this._capiSDUIClient=t,this._log=r.C8.Logging.getLogger("SDUIFeedbackServiceImpl")}var t,i,n;return t=e,(i=[{key:"sendUserAction",value:function(e,t){var i=this;this._log.debug("Sending user action",{componentId:e,userAction:t}),(0,s.zG)(this._capiSDUIClient.sendUserAction(e,t),c,(function(e){return e.catch((function(e){a.isDroppedError(e)?i._log.debug("Stopped listening for sendUserAction message acknowledge",e):o.isNotConnectedError(e)?i._log.warn("Failed to sendUserAction as CAPI was not connected",e):i._log.error("Failed to sendUserAction",e)}))}))}}])&&d(t.prototype,i),n&&d(t,n),e}()},22002:(e,t,i)=>{i.d(t,{t:()=>H});var s=i(90023),r=i(93380),n=i(23778),a=i(44970),o=i(99531),h=i(50887),l=i(47311),c=i(64297),d=i(12518),g=i(58303),u=i(59833),p=i(17572),_=i(49445),m=i(55768),v=i(57283),b=i(27853),S=i(54760),C=i(74822),y=i(90572),f=i(59179),w=i(954),x=i(52351),A=i(42008),k=i(78542);class E{constructor(){this._mapByHighlightId=new Map,this._mapByAlertId=new Map,this._highlightDataChanged=new C.x,this.highlightDataChanged=this._highlightDataChanged}getByHighlightId(e){return this._mapByHighlightId.get(e)}getByAlertId(e){const t=this._mapByAlertId.get(e)||new Set;return Array.from(t).map((e=>this._mapByHighlightId.get(e))).filter((e=>!!e))}get(e){return this._mapByHighlightId.get(e)}has(e){return this._mapByHighlightId.has(e)}set(e,t){this._mapByHighlightId.set(e,t);const i=this._mapByAlertId.get(t.alertId)||new Set;i.add(e),this._mapByAlertId.set(t.alertId,i),this._highlightDataChanged.next(e)}delete(e){const t=this._mapByHighlightId.get(e);if(t){const i=this._mapByAlertId.get(t.alertId);void 0!==i&&(i.delete(e),0===i.size&&this._mapByAlertId.delete(t.alertId)),this._mapByHighlightId.delete(e)}this._highlightDataChanged.next(e)}forEach(e){this._mapByHighlightId.forEach(e)}getHighlightDataObs(e){return this._highlightDataChanged.pipe(y.h((t=>t===e)),f.U((()=>this.getByHighlightId(e))),w.O(this.getByHighlightId(e)))}}class I{constructor(e,t,i,s,r=(()=>x.E9.zero),n=k.Y.create("DenaliHighlightsUpdater")){this._denaliHighlights=e,this._getFluidHighlights=t,this._getTextMap=i,this._getParentRect=s,this._getParentScroll=r,this._log=n}register(e,t,i,s){if(null!==e){if(this._denaliHighlights.has(e))return this.update(e,t,i,s);{const r=new S.Fd(e,t,this._getFluidHighlights(),this._getParentRect,this._getParentScroll),n={id:e,alertId:s.alertId,mark:r,visualization:i};this._denaliHighlights.set(e,n);const a=this._getTextMap().getPlainText();return this._getFluidHighlights().addHighlight(e,(0,A.rX)((0,A.mp)(r.range),a),s),n}}return null}remove(e){this._denaliHighlights.has(e)?(this._getFluidHighlights().removeHighlights([e]),this._denaliHighlights.delete(e)):this._log.warn(`can't remove mark #${e}, doesn't exist`)}update(e,t,i,s){const r=this._denaliHighlights.get(e);if(r){this._denaliHighlights.set(e,{...r,visualization:i});const n=this._getTextMap().getPlainText();return this._getFluidHighlights().updateHighlight(e,(0,A.rX)(t.meta.range(),n),s),r}return this._log.warn("cannot update not existing highlight",e),null}clearAll(){this._denaliHighlights.forEach((e=>{this._getFluidHighlights().removeHighlights([e.id])}))}}var B=i(5387),T=i(4256);class H{constructor(e,t,i,r,n,a,o=k.Y.create("DenaliViewAdapter"),c,u){this._highlights=e,this._textObserver=t,this._replacementService=i,this._layout=r,this._scroller=n,this._selectedHighlightsTracker=a,this._log=o,this._requestAwaitService=c,this._formattingService=u,this._subs=new h.w.Keeper,this._disposed=!1,this._highlightedAlertId=null,this._marks=new Map,this.markChangeApplied=new l.Subject,this._highlightsDataStore=new E,this._highlightUpdater=new I(this._highlightsDataStore,(()=>this._highlights),(()=>this._textObserver.getTextSource()),(()=>{const e=this._layout.textField.rect.getApproximate();return b.Pf.create({...e.client,...e.size})}),(()=>this._layout.textField.scroll.getApproximate())),this.highlightHoverProvider={getHoveredStateBehavior:e=>this._highlightsDataStore.getHighlightDataObs(e).pipe(l.map((e=>e&&e.visualization.type===S.sO.Change.VisualState.Type.highlighted?{[S.sO.Change.VisualState.Source.sidebar]:v.pc.hoveredNeedsAttention,[S.sO.Change.VisualState.Source.text]:v.pc.hovered,[S.sO.Change.VisualState.Source.api]:this._highlightedAlertId===e.alertId?v.pc.hovered:v.pc.none}[e.visualization.source]:v.pc.none)))},this._updateContentsBuffer=new l.Subject,this._flushUpdater=new l.Subject,this.getContents=(e,t)=>{if(this._log.trace(`getContents, ${String(e)}, ${String(t)}`),this._formattingService){const i=this._textObserver.getTextSource().getRichText();return _.RI.unsafeRes(void 0!==e?i.slice(e,void 0!==t?e+t:void 0):i)}{const i=void 0!==e?this.getText().slice(e,void 0!==t?e+t:void 0):this.getText();return _.RI.resFromText(i)}},this.changes=l.mergeStatic((0,s.zG)(_.RI.res(this.getContents().delta),d.g_((()=>l.EMPTY),(e=>l.of(e)))),this._textObserver.contentChanges.async.pipe(l.filter((e=>e.changes.length>0)),l.map((({deltaChange:e})=>e)))),this.activeMarks=new l.BehaviorSubject(g.YP),this.contentUpdated=new l.Subject,this.hoveredMarks=new l.BehaviorSubject(g.YP),this.textChangedAfterPaste=new l.Subject,this.activeWord=new l.BehaviorSubject(g.YP),this.clickedWord=new l.BehaviorSubject(g.YP),this.ongoingSelection=new l.BehaviorSubject(!1),this._log.info(`${H.name} created`),this._subs.push(this._subscribeToContentUpdates(),this._subscribeToSelectedHighlight(),this._trackFocusedAlert())}_trackFocusedAlert(){return this._highlightsDataStore.highlightDataChanged.pipe(l.map((e=>this._highlightsDataStore.getByHighlightId(e))),l.filter((e=>!!e))).subscribe((e=>{this._highlightedAlertId===e.alertId||e.visualization.type!==S.sO.Change.VisualState.Type.highlighted||e.visualization.source!==S.sO.Change.VisualState.Source.text&&e.visualization.source!==S.sO.Change.VisualState.Source.sidebar?e.alertId===this._highlightedAlertId&&e.visualization.type===S.sO.Change.VisualState.Type.visible&&(this._highlightedAlertId=null,this._log.trace(`Mark ${e.id} unfocused - alertId ${e.alertId}`)):(this._highlightedAlertId=e.alertId,this._log.trace(`Mark ${e.id} focused - alertId ${e.alertId}`))}))}pushChanges(e,t){this._log.trace("pushChanges",{change:e,source:t}),_.RI.isFlush(e)?this._flushUpdater.next(void 0):_.RI.isReset(e)?this._log.warn("Got unknown reset"):this._updateContents(e.delta,t)}getText(){return this._log.trace("getText"),this._formattingService?(0,B.l)(this._textObserver.getTextSource().getRichText(),""):this._textObserver.getTextSource().getPlainText()}getTextLength(){return this._log.trace("getTextLength"),this.getText().length}flushChanges(){this._log.trace("flushChanges")}getCursor(){return this._log.trace("getCursor"),n.Y1.empty}get contentRect(){throw this._log.trace("contentRect"),Error("not implemented")}setCursor(e,t,i){return this._log.trace("setCursor",{_index:e,_length:t,_source:i}),d.F2(void 0)}getLastPossibleCursorPosition(){return this._log.trace("getLastPossibleCursorPosition"),0}_doMarkAction(e){const t=v.y$.Id.createFromMark(e.id),i=e.meta.capiAlertId;switch(e.action){case a.v.Change.ActionType.create:{const s=this._highlightUpdater.register(t,e,e.meta.visualState,{alertId:i,highlightId:t,highlightColor:e.meta.highlightColor,highlightDisplayFormat:e.meta.highlightDisplayFormat,highlightDisappearOnHoverDelay:e.meta.highlightDisappearOnHoverDelay,highlightLiveliness:null}),r=(null==s?void 0:s.mark)||null;return r&&this._marks.set(r.id,r),r}case a.v.Change.ActionType.update:{const s=this._highlightUpdater.update(t,e,e.meta.visualState,{alertId:i,highlightId:t,highlightColor:e.meta.highlightColor,highlightDisplayFormat:e.meta.highlightDisplayFormat,highlightDisappearOnHoverDelay:e.meta.highlightDisappearOnHoverDelay,highlightLiveliness:null}),r=(null==s?void 0:s.mark)||null;return r&&this._marks.set(r.id,r),r}case a.v.Change.ActionType.remove:return this._highlightUpdater.remove(t),this._marks.delete(e.id),null;default:(0,c.vE)(e)}}changeMarks(e){return this._disposed?(this._log.debug("changeMarks called after disposed, returning empty result"),a.v.Change.Result.getEmpty()):(this._log.trace("changeMarks",{rawMarks:e}),e.reduce(((e,t)=>{switch(t.action){case a.v.Change.ActionType.create:e.created.set(t.id,d.ij(new Error("Cannot create mark"))(this._doMarkAction(t)));break;case a.v.Change.ActionType.update:e.updated.set(t.id,d.ij(new Error("Cannot update mark"))(this._doMarkAction(t)));break;case a.v.Change.ActionType.remove:this._doMarkAction(t),e.removed.set(t.id,d.F2(void 0))}return e}),a.v.Change.Result.getEmpty()))}scrollToMark(e,t){var i;const s=null!==(i=this._marks.get(e))&&void 0!==i?i:null;return this._log.trace("scrollToMark",{markId:e,mark:s,opts:t}),s?this._scroller.scrollToMark(s,t):(this._log.warn(`Tried to scroll to nonexistent mark with id: ${e}`),l.EMPTY)}_subscribeToContentUpdates(){return this._updateContentsBuffer.pipe(l.bufferWhen((()=>l.mergeStatic(l.timer((0,T.Xd)(20)),this._flushUpdater).pipe(l.first()))),l.filter((e=>e.length>0)),l.map((e=>e.reduce(((e,t)=>e.compose(t)),new r.i)))).subscribe((e=>{const t=this._replacementService.performBatchReplacements((0,m.g)(e)).then((()=>{const t=(0,m.B)(e);this._formattingService&&t.length&&(this._log.trace("Have formattings, applying",t),t.forEach((e=>{this._formattingService&&this._formattingService.apply(e.range,e.formatting)})))}),(()=>{this._log.warn("Failed to apply batch replacements")}));this._requestAwaitService&&this._requestAwaitService.addRequest(t)}))}_subscribeToSelectedHighlight(){return this._selectedHighlightsTracker.pipe(l.map((0,s.ls)(u.UI((e=>{var t;return(0,s.zG)(g.ij(null===(t=this._highlightsDataStore.get(e))||void 0===t?void 0:t.mark),g.hX((e=>(0,s.zG)(e.range(),d.g_(s.W8,(0,s.ff)(o.x.isEnclosingView))))))})),u.oA))).subscribe((e=>this.activeMarks.next(g.G(e))))}_updateContents(e,t){this._updateContentsBuffer.next((0,B.AQ)(e))}getSelectionRect(){throw this._log.trace("getSelectionRect"),Error("not implemented")}setContents(e){this._log.trace("setContents",{_value:e})}getHTML(){return this._log.trace("getHTML"),""}getPossibleCursorPosition(e,t){return this._log.trace("getPossibleCursorPosition",{_x:e,_y:t}),p.vM((()=>{throw new Error("Not implemented")}))}dispose(){this._highlightUpdater.clearAll(),this._subs.dispose(),this._log.info(`${H.name} disposed`),this._disposed=!0}}},4550:(e,t,i)=>{i.d(t,{r:()=>$});var s=i(18117),r=i(24332),n=i(90023),a=i(39953),o=i(42868),h=i(95102),l=i(54729),c=i(17690),d=i(28942),g=i(97244),u=i(78171),p=i(70017),_=i(77063),m=i(34611),v=i(61230),b=i(82051),S=i(50887),C=i(47311),y=i(94032),f=i(69465),w=i(26308),x=i(12518),A=i(17572),k=i(58303),E=i(84358),I=i(59833),B=i(49445),T=i(20302),H=i(6655),R=i(78592),U=i(73995),D=i(97168),G=i(13391),M=i(69413);var O=i(68818),P=i(23792),F=i(20182),z=i(38437),L=i(78542),j=i(76187);const $=(e,t,i,c,v,w,$,N,W,q,Y,X)=>{const K=L.Y.create("createEngine"),Q=new S.w.Keeper,J=function(e,t,i){const s=G.h.create(k.YP),r=G.h.create(k.YP);return{score:G.h.create(k.YP),scoreStatus:G.h.create(k.YP),title:G.h.create(void 0),textInfo:G.h.create(k.YP),checkingState:G.h.create(e.checkingState),asyncChecksState:G.h.create(e.asyncChecksState),context:i,contextCompleteness:i.view(D.j.calculateCompleteness),updateContext:e=>{const t=!f.R$.eq.equals(i.get(),e);return i.set(e),t},defaultContext:s,updateDefaultContext:e=>{const t=!(0,a.zG)((0,n.bc)([s.get(),e],E.vB(f.R$.eq.equals)));return s.set(e),t},documentText:t.getText(),documentLength:G.h.create({full:t.getTextLength(),trimmed:t.getTextLength()}),counters:G.h.create(D.dM.group.empty),calculateStats:()=>M.Vi(e.requestDocStats).then((e=>(r.set(k.G(e)),e))),recentDocumentStats:r}}(e,t,i),Z=t.changes.pipe(C.scan(((e,i)=>B.RI.isReset(i)?(0,a.zG)(i.text,x.g_((()=>t.getText()),n.yR)):B.RI.isDelta(i)?(0,a.zG)(B.RI.resFromText(e).compose(i),A.VS((e=>e.text)),x.g_((()=>t.getText()),n.yR)):e),""));Q.push(e.events.pipe(C.withLatestFrom(Z),C.tap((([e,t])=>{if("alert_received"===e.kind){const i=(0,P.IM)(e.alert,z.Q.fromString("fake"));O.$.isConsistentWithText(i,t)||(q.alerts.inconsistentAlertWithText("assistant",null==i?void 0:i._tag),(0,U.N)(K,i,t,"logging"))}}))).subscribe(),e.events.pipe(C.tap((t=>{J.checkingState.set(e.checkingState),T.hX.is("text_info")(t)?J.textInfo.set(k.G(t.data)):T.hX.is("finish")(t)?(J.score.set(t.score),J.scoreStatus.set(t.scoreStatus)):T.hX.is("feedback_ack")(t)?((0,a.zG)(t,k.DT(T.hX.isUserFeedbackWithGeneralScore),k.UI((e=>e.outcomeScores.GeneralScore)),k.UI((e=>Math.trunc(100*e))),E.bw((e=>J.score.modify((0,n.ls)(k.UI((t=>({...t,rank:e}))),E.vx(k.G({errorRateScore:0,rank:e}))))))),(0,a.zG)(t,k.DT(T.hX.isUserFeedbackWithScoreStatus),k.UI((e=>e.scoreStatus)),E.bw((e=>J.scoreStatus.set(k.G(e)))))):T.hX.is("session_started")(t)&&J.updateDefaultContext(t.defaultDocumentContext)}))).subscribe(),...Y.isGateEnabled(F.K.CheetahClearSDUIBufferOnReconnect)?[]:[(0,j.o)((()=>k.WG(N)),e.events)],v.contentChanges.async.pipe(C.debounceTime(300),C.map((e=>e.newText)),C.map((e=>({full:e.length-1,trimmed:e.trim().length}))),C.tap(y.wW(J.documentLength))).subscribe()),(0,a.zG)(w(),k.UI((e=>{J.updateDefaultContext(f.R$.parseDefault(e.defaultDocumentContext))})));const ee=new b.Xr,te=new g.Ek,ie=(0,r.g_)((0,r.Zm)())(I.oA([k.G((e=>(0,a.zG)($.get(),k.g_((()=>e),(t=>t.addSnippetsTriggerToAlert(e))))))])),se=new o.a,re=new d.SC(ee,te,(()=>t.getContents().delta),e.events,e,J.counters,ie,void 0,se),ne=h.e.create(re.state),ae=new l.k(ne,re._ops);Q.push(p.R.init(p.R.UserTextChangesSync.create(t),e.events,u.nR.ignoreTEResult(e),u.nR.ignoreResult(ee),te,u.Av.merge([re])).subscribe()),e.loadAlerts(c()),re.flushAlerts(),Y.isGateEnabled(F.K.DontSyncAlertApplicationsWithInlineMode)||Q.push(V(re.state,X));const oe=k.G(_.J.CategoriesModel.create(e.events,e,re.state,ae,H.JW.ScopeType.GLOBAL)),he=k.G(m.k.create(ne)),le=(0,a.zG)((0,s.gz)(k.Kw)(N,W),k.UI((([t,i])=>({sduiBufferService:t,sduiFeedbackService:new R.Q(e),sduiPopoverManager:i})))),ce={enablePlagiarismSearch:e.enablePlagiarismSearch,disablePlagiarismSearch:e.disablePlagiarismSearch},de={requestWritingExpert:e.requestWritingExpert,enableWritingExpert:e.enableWritingExpert,disableWritingExpert:e.disableWritingExpert};return{alertsList:re,alertsReader:ne,alertsService:ae,positionManager:ee,getByRawAlertId:se.getByRawAlertId.bind(se),sessionModel:J,mutedAlertsCategoriesModel:oe,mutingAlertsReader:he,shutdown:()=>{re.dispose(),Q.dispose()},sduiEngine:le,plagiarismClient:ce,writingExpertClient:de}},V=(e,t)=>e.pipe(C.startWith(v.p.empty),C.pairwise(),C.map((([e,t])=>v.p.diff(e,t))),C.map((e=>(0,a.zG)(e,w.vh.reduce([],((e,t)=>(0,a.zG)(t.alert,k.DT((e=>c.bZ.isApplied(e))),k.UI((e=>e.rawId)),k.fS((()=>k.YP)),k.g_((()=>e),(t=>[...e,t])))),n.yR,n.yR))))).subscribe((e=>{e.length&&t(e)}))},51285:(e,t,i)=>{i.d(t,{c:()=>r});var s=i(33380);class r{constructor(e){this._highlights=e}addHighlight(e,t,i){return this._highlights.addHighlight(e,t,i)}updateHighlight(e,t,i){return this._highlights.updateHighlight(e,t,i)}removeHighlights(e){return this._highlights.removeHighlights(e)}recalculateHighlight(e){return this._highlights.recalculateHighlight(e)}recalculateAllHighlights(){return this._highlights.recalculateAllHighlights()}maintainConsistency(e,t=(e=>e),i=!1){return this._highlights.maintainConsistency(e,t,i)}hasHighlight(e){return this._highlights.hasHighlight(e)}getSelectedHighlightsTracker(e){return(0,s.H)({...e,highlights:this._highlights})}getGeometryByHighlightId(e){return this._highlights.geometry.get().get(e)}}},21533:(e,t,i)=>{i.r(t),i.d(t,{createSideBarController:()=>Ue});var s,r=i(84308),n=i(74822),a=i(59179),o=i(31491),h=i(94032),l=i(58303),c=i(8405),d=i(92379),g=i(84714),u=i(63532),p=i(29479),_=i(43940),m=i(80471),v=i(28896),b=i(78542),S=i(85844),C=i(95295);!function(e){var t;e.div=(t="div",function({children:e,...i}){const s=d.useRef(null),[r,n]=d.useState(null);return d.useEffect((()=>{s.current&&("function"==typeof s.current.attachShadow?n(s.current.attachShadow({mode:"open"})):n(s.current))}),[s]),d.createElement(t,{ref:s,...i},r?(0,C.createPortal)(d.createElement(y.Provider,{value:r},e),r):null)})}(s||(s={}));const y=d.createContext(null);var f=i(41580),w=i(57065);function x(e,t,i,s){const r=(s-90)*Math.PI/180;return{x:e+i*Math.cos(r),y:t+i*Math.sin(r)}}function A(e,t,i,s,r){const n=x(e,t,i,r),a=x(e,t,i,s),o=r-s<=180?"0":"1";return["M",n.x,n.y,"A",i,i,0,o,0,a.x,a.y].join(" ")}var k=i(55849),E=i(24909);const I=({children:e,position:t,className:i})=>d.createElement(E.F.div,{className:i,style:t.view((e=>({position:"fixed",right:e.right,top:e.top,bottom:"0px",width:e.width,zIndex:e.zIndex,background:"white",display:"flex",flexDirection:"column",justifyContent:"space-between",height:e.height}))),"data-grammarly-part":"legacy-sidebar-container"},e);var B=i(89066),T=i.n(B);const H=({onClose:e,position:t})=>d.createElement(s.div,{"data-grammarly-part":"sidebar-splash"},d.createElement(f.b,null,T().__css),d.createElement(I,{className:T().sidebar,position:t},d.createElement("div",{className:T().header},d.createElement("div",{className:T().headerGroup},d.createElement(k.T,{type:"full",className:T().logoIcon})),d.createElement("div",{className:T().headerGroup},d.createElement("div",{className:T().closeButton,onClick:e,role:"button",tabIndex:0},d.createElement("svg",{width:"11",height:"11",viewBox:"0 0 12 13",fill:"none"},d.createElement("path",{d:"M0.5 1L6 6.5M11.5 12L6 6.5M6 6.5L11.5 1M6 6.5L0.5 12",strokeLinecap:"round",strokeWidth:"1.5"}))))),d.createElement("div",{className:T().splashContainer},d.createElement("svg",{viewBox:"0 0 100 100",className:T().splash},d.createElement("circle",{cx:"50",cy:"50",r:"50",stroke:"none",fill:w.Z.green50}))),d.createElement("div",{className:T().spinnerContainer},d.createElement("svg",{width:"64",height:"64",viewBox:"0 0 100 100",fill:"none",className:T().spinner},d.createElement("path",{d:A(50,50,45,0,240),stroke:w.Z.green50,strokeWidth:5})))));var R,U=i(36344),D=i(90572),G=i(21070),M=i(20161),O=i(66878),P=i(13391),F=i(66160),z=i(23031);class L{constructor(e,t,i,s,a,o,h,l,c,d,g,u,p,_=b.Y.create("GDocsSidebarBaseAssistantController")){this._doc=e,this._telemetry=t,this._gnar=i,this._actions=s,this._isGDocOwner=a,this._alertCounts=o,this._state=h,this._csActions=l,this._experimentClient=c,this._config=d,this._gnarTrackingEnabled=u,this._log=_,this._subscriptions=[],this._sidebarVisible=P.h.create(!1),this._commands=new n.x,this._iterableController=new F.k(F.k.shouldCreate(this._config.bundleInfo.browser,this._state.get().dynamicConfig,this._experimentClient),this._state,this._actions.iterableNextFetchSettings,this._csActions,this._experimentClient,this._doc.location.host,void 0,void 0,void 0),this.sidebarVisible=this._sidebarVisible,this.toggle=e=>{this._commands.next({action:S.$.Action.toggle,source:e})},this.show=(e,t)=>{this._commands.next({action:S.$.Action.show,source:e,alertId:t})},this.hide=e=>{this._commands.next({action:S.$.Action.hideAll,source:e})},this.dispose=()=>{let e;this._subscriptions.forEach((e=>e.unsubscribe())),this._subscriptions=[],e=this._hideSidebar().subscribe((t=>{t&&(this._gnarTrackingEnabled&&this._gnar.gdocsSidebarGdocsSidebarClose(this._isGDocOwner,S.$.Source.api,this._alertCounts.expandedViewAlertsCount,this._alertCounts.wordsCount,this._alertCounts.inlineAlertCount,this._alertCounts.nonHiddenClarityAlertCount,this._alertCounts.nonInlineAlertCount),null==e||e.unsubscribe())}))},this._nativeSidebarController=g(this._doc,(()=>{this._commands.next({action:S.$.Action.hideGrammarlyOnly,source:S.$.Source.user})}),t,this._experimentClient,p),this._subscriptions=[this._nativeSidebarController.visibility.pipe((0,D.h)(z.X0)).subscribe((()=>this._commands.next({action:S.$.Action.hideGrammarlyOnly,source:S.$.Source.user}))),(0,r.a)([this._sidebarVisible,this._nativeSidebarController.visibility]).pipe((0,D.h)((([e,t])=>e&&t))).subscribe((()=>this._nativeSidebarController.focusEditor())),this._commands.pipe((0,G.z)((e=>this._nativeSidebarController.ready.pipe((0,M.w)((t=>this._executeCommand(e))))))).subscribe()]}get position(){return this._nativeSidebarController.position}_executeCommand(e){const t=this._sidebarVisible.get(),i=[S.$.Action.toggle,S.$.Action.hideAll,S.$.Action.hideGrammarlyOnly],s=[S.$.Action.toggle,S.$.Action.show];return i.includes(e.action)&&t?this._hideSidebar(e.action===S.$.Action.hideGrammarlyOnly).pipe((0,u.b)((()=>{this._actions.onHide(),this._gnarTrackingEnabled&&this._gnar.gdocsSidebarGdocsSidebarClose(this._isGDocOwner,e.source,this._alertCounts.expandedViewAlertsCount,this._alertCounts.wordsCount,this._alertCounts.inlineAlertCount,this._alertCounts.nonHiddenClarityAlertCount,this._alertCounts.nonInlineAlertCount)})),(0,O.K)((e=>(this._log.warn("Error injecting gdocs sidebar",e),this._telemetry.sidebarFail(e,"inject"),U.E)))):s.includes(e.action)&&!t?this._showSidebar(e.source===S.$.Source.yellowUnderline).pipe((0,u.b)((()=>{this._actions.onShow(e.alertId),this._gnarTrackingEnabled&&this._gnar.gdocsSidebarGdocsSidebarShow(this._isGDocOwner,e.source,this._alertCounts.expandedViewAlertsCount,this._alertCounts.wordsCount,this._alertCounts.inlineAlertCount,this._alertCounts.nonHiddenClarityAlertCount,this._alertCounts.nonInlineAlertCount)})),(0,O.K)((e=>(this._log.warn("Error restoring gdocs sidebar",e),this._telemetry.sidebarFail(e,"restore"),U.E)))):U.E}}class j extends L{constructor(e,t,i,s,r,n,a,o,h,l,c,g,u=b.Y.create("GDocsCheetahSidebarController")){super(e,t,i,s,r,n,a,o,h,l,c,!1,(e=>m.V.get({monitorAs:"gdocs-sidebar-splash"}).inject(v.EM.fromDocument(document,"grammarly-extension"),v.zs.appendChild(document.documentElement),(()=>d.createElement(H,{onClose:()=>{this.hide(S.$.Source.user),this._nativeSidebarController.hideSplashScreen()},position:e})))),u),this._subscriptions.push(g.subscribe((()=>{this._nativeSidebarController.hideSplashScreen()})))}_showSidebar(e){return this._nativeSidebarController.open().pipe((0,u.b)((e=>{this._nativeSidebarController.showCompanionAboutButton(!1),this._nativeSidebarController.unselectActiveSwitcherButton(),this._nativeSidebarController.showSplashScreen(),this._sidebarVisible.set(!0),this._iterableController.onTrigger(_.xz.GDocsSidebarInitialized)})))}_hideSidebar(e){return(!e?this._nativeSidebarController.close():(0,g.of)(!0)).pipe((0,p.h)(!0),(0,u.b)((()=>{this._nativeSidebarController.showCompanionAboutButton(!0),this._nativeSidebarController.removeSwitcherButtonOverlay(),this._sidebarVisible.set(!1)})))}}!function(e){e.create=function(e,t,i,s,r,n,a,o,h,l,c,d){return new j(e,t,i,s,r,n,a,o,h,l,c,d)}}(R||(R={}));var $=i(33487),V=i(22002),N=i(90328),W=i(45917),q=i(4550),Y=i(51285),X=i(21018),K=i(31607),Q=i(91065),J=i(10883),Z=i(27853);var ee=i(7221),te=i(53533);class ie{constructor(e,t,i,s,r,n,o,h,c,d,g,u,p,_,m,v,b,S,C,y,f,w,x,A=new V.t(new Y.c(i),n,X.L.create((()=>o.get()),n,(0,te.Cg)(),t,_,w,(0,ee.n_)(),C,f,new K.M,y).create(Q.P.sidebar),e,S,function(e,t){return e.offsetPosition.pipe((0,J.M)(t.geometry),(0,a.U)((([e,t])=>null==e?[]:Array.from(t.keys()).filter((i=>{const s=t.get(i);return s&&s.rects&&s.rects.some((t=>Z.UL.contains(e,t)))})))))}(s,i)),k=W.p.create(d.get(),g,b,h,c,x),E=(0,q.r)(k,A,v.settings.lens("context"),(()=>(0,N.q)(h)),n,(()=>g.value.lastStart),P.h.create(l.YP),l.YP,l.YP,_,C,(e=>e.forEach((e=>h.removeAlert(e,{_tag:$.i.alertAccepted})))))){this._hoverProvider=r,this.connectionState=u,this.gnar=p,this._felog=_,this.user=m,this.document=v,this.alertsTransformer=b,this.experimentClient=C,this.productMetricsCSClient=y,this.customEventsFilter=x,this.denaliViewAdapter=A,this.capiProxy=k,this.engine=E,r.setAssistantHover(A.highlightHoverProvider)}dispose(){this._hoverProvider.removeAssistantHover(),this.capiProxy.dispose(),this.denaliViewAdapter.dispose(),this.engine.shutdown()}}var se,re=i(23792),ne=i(81356),ae=i(94454);!function(e){e.Close="Close"}(se||(se={}));var oe=i(90023),he=i(84178),le=i(89408),ce=i(24666),de=i(14969),ge=i(20182),ue=i(60774),pe=i(73953),_e=i(22036),me=i(69135),ve=i(12796),be=i(954),Se=i(5681),Ce=i(56546);const ye=(e,t)=>(0,ue.Re)(e)?Se.x.observeAttribute(e,"class").pipe((0,be.O)(null),(0,a.U)((i=>!e.classList.contains(t))),(0,D.h)(z.fQ)):U.E,fe=e=>(0,ue.Re)(e)?Ce.N.observeSizeChanges([e]).pipe((0,be.O)(null),(0,a.U)((t=>"none"!==e.style.display&&"hidden"!==e.style.visibility)),(0,ce.x)()):U.E;class we{constructor(e,t,i,s,r,n=ue.IG,o=ye,h=fe){this._doc=e,this._onClick=t,this._telemetry=i,this._experimentClient=s,this._renderSplashScreen=r,this._resolveElements=n,this._observeClassRemoved=o,this._observeVisibility=h,this._position=P.h.create(ve.xK.legacy),this.position=this._position.view(),this._activeSwitcherButton=null,this._switcherButtons=[],this._subscriptions=[],this._onRemoveSwitcherButtonOverlay=null,this._switcherButtonClick=e=>{if(null===e.target)return;const t=e.target.closest(ve.H2.selector);t===this._activeSwitcherButton?this._activeSwitcherButton=null:(this._activeSwitcherButton=t,this._onClick())},this.dispose=()=>{this._subscriptions.forEach((e=>e.unsubscribe())),this._subscriptions=[],this._switcherButtons.forEach((e=>e.removeEventListener("click",this._switcherButtonClick)))};const l=this._resolveElements(this._doc,{sidebar:()=>this._doc.querySelector(ve.iB),switcherButtons:()=>(0,oe.zG)(Array.from(this._doc.querySelectorAll(ve.H2.selector)),(e=>0===e.length?null:e))}).pipe((0,he.q)(1),(0,le.d)(1));this._ready=l.pipe((0,a.U)((({switcherButtons:e})=>e[0])),(0,M.w)((e=>this._observeClassRemoved(e,ve.H2.disabledClass))),(0,he.q)(1),(0,le.d)(1)),this._visibility=l.pipe((0,ce.x)(),(0,M.w)((({sidebar:e})=>this._observeVisibility(e))),(0,le.d)(1));const c=this._experimentClient.isGateEnabled(ge.K.GDocsDetectSidebarTypeDynamically);this._subscriptions=[l.subscribe((({switcherButtons:e})=>{this._switcherButtons=e,this._switcherButtons.forEach((e=>e.addEventListener("click",this._switcherButtonClick)))})),l.subscribe((({sidebar:e})=>{const t=ve.uT(e),i=c?t:me.X.legacy;this._telemetry.trackSidebarType({detectedSidebarType:t,displayedSidebarType:i}),this._position.set(ve._X(i))}))]}get visibility(){return this._visibility}get ready(){return this._ready}_clickOnFirstSwitcherButton(){const e=this._doc.querySelector(ve.H2.selector);if(!e)throw new Error("There is no button on native sidebar panel");(0,_e.Nk)(e)}clickActiveSwitcherButton(){this._activeSwitcherButton&&((0,_e.Nk)(this._activeSwitcherButton),this._activeSwitcherButton=null)}unselectActiveSwitcherButton(){this._activeSwitcherButton=this._doc.querySelector(ve.H2.selectedSelector),this._activeSwitcherButton&&(0,ue.Re)(this._activeSwitcherButton)&&this._createSwitcherButtonOverlay(this._activeSwitcherButton)}open(){return this._visibility.pipe((0,u.b)((e=>!e&&this._clickOnFirstSwitcherButton())),(0,de.P)(z.fQ))}close(){return this._visibility.pipe((0,u.b)((e=>e&&this.clickActiveSwitcherButton())),(0,de.P)(z.X0))}showCompanionAboutButton(e=!0){const t=this._doc.querySelector(ve.kl);t&&(0,ue.Re)(t)&&(t.style.display=e?"block":"none")}focusEditor(){const e=(0,pe.Nd)(this._doc);e&&e.dispatchEvent(new MouseEvent("click"))}removeSwitcherButtonOverlay(){this._onRemoveSwitcherButtonOverlay&&(this._onRemoveSwitcherButtonOverlay(),this._onRemoveSwitcherButtonOverlay=null)}showSplashScreen(){var e;this._splashScreenInjection=null===(e=this._renderSplashScreen)||void 0===e?void 0:e.call(this,this.position)}hideSplashScreen(){var e;null===(e=this._splashScreenInjection)||void 0===e||e.dispose()}_createSwitcherButtonOverlay(e){const t=this._doc.createElement("div"),i=getComputedStyle(e);t.style.width=i.width,t.style.height=i.height,t.style.position=i.position,t.style.zIndex=i.zIndex,t.style.cursor="pointer",t.style.background="transparent",t.style.marginTop=`-${i.height}`;const s=()=>e.classList.add(ve.H2.hoverClass),r=()=>{e.classList.remove(ve.H2.hoverClass),e.classList.remove(ve.H2.activeClass)},n=()=>e.classList.add(ve.H2.activeClass),a=()=>e.classList.add(ve.H2.selectedClass),o=()=>{this._onClick(),e.style.pointerEvents="unset"};this._onRemoveSwitcherButtonOverlay=()=>{t.removeEventListener("mouseenter",s),t.removeEventListener("mouseout",r),t.removeEventListener("mousedown",n),t.removeEventListener("mouseup",a),t.removeEventListener("click",o),t.remove()},t.addEventListener("mouseenter",s),t.addEventListener("mouseout",r),t.addEventListener("mousedown",n),t.addEventListener("mouseup",a),t.addEventListener("click",o),e.classList.remove(ve.H2.selectedClass),e.style.pointerEvents="none",e.insertAdjacentElement("afterend",t)}}var xe;!function(e){e.create=(e,t,i,s,r,n,a,o)=>new we(e,t,i,s,r,n,a,o)}(xe||(xe={}));var Ae=i(8086),ke=i(91785),Ee=i(50750),Ie=i(12518),Be=i(42008),Te=i(54760),He=i(20545),Re=i(97992);function Ue(e){const{docId:t,docOwnedByCurrentUser:i}=e.initArgs,{_ctx:s,_unloadables:d,_observableState:g,_plagiarismClient:p,_plagiarismCheckingState:_,_subs:m,fieldContext:v,sidebarOpened:b,expandedViewAlertsAtom:C,inlineAlertAtom:y,nonInlineAlertAtom:f,nonHiddenClarityAlertAtom:w,wordsCount:x,lazyCheckingService:A,cheetahAssistantDidOpen:k,delayService:E,cheetahAssistantDidClose:I,hoverProviderSubject:B,alertProcessorSubject:T,textRevisionManagerSubject:H,highlightsGeometrySubject:U,layout:G,integrationName:O,cursorTracker:P,textObserver:F,lazyReplacementService:z,checkingServiceState:L,documentSettingsStorage:j,canvasTelemetry:$,textEventsTarget:V,sessionStatsManager:N}=e,W=(0,r.a)([B,H,T,U]).pipe((0,a.U)((([e,t,i,r])=>()=>new ie(G,O,r,P,e,F,z,i,t,A,L,g.view("connection"),v.gnar,v.felog,{isPremium:v.state.user.premium,isAnonymous:v.state.user.anonymous,isGrammarlyEmployee:ne.n.isGrammarlyEmployee(v.state.user),isTestUser:ne.n.isTestUser(v.state.user),isFreeTrial:ne.n.isFreeTrial(v.state.user)},j.document,re.F4,function({layout:e,textObserver:t,userInputShutOff:i,timeoutMs:s,telemetry:r}){const n=(0,Re.z)(t,e.textField,i,s);return{scrollToMark(t,i){const s=Te.Fd.getMarkRect(t);if(Ie.tO(s))return(0,Ee.D)([0]).pipe((0,u.b)((t=>{const i=e.textField.visibleRect.getApproximate();n.scrollToRect(s.right,i.client.top)})));const a=(0,Be.mp)(t.range);return n.scrollToRange(a.start).pipe((0,M.w)((i=>He.S.hz30.pipe((0,he.q)(9),(0,D.h)((i=>{const s=Te.Fd.getMarkRect(t);if(Ie.tO(s)){const t=e.textField.visibleRect.getApproximate();return n.scrollToRect(s.right,t.client.top),!0}return!1})),(0,u.b)({complete:()=>{r.error("scroller","Mark has not been found after retries.")}}),(0,he.q)(1)))))},dispose(){n.dispose()}}}({layout:G,textObserver:F,telemetry:$,userInputShutOff:(0,Ae.I)(V)}),s.experimentClient,v.productMetricsCSClient,v.state.dynamicConfig,N,(0,o.ff)(c.r4)))));W.pipe(a.U((e=>e())),a.U((e=>l.G({enablePlagiarismSearch:e.capiProxy.enablePlagiarismSearch,disablePlagiarismSearch:e.capiProxy.disablePlagiarismSearch})))).subscribe(h.wW(p));const q=new n.x,Y=R.create(s.doc,v.felog.gdocs,v.gnar,{onShow:e=>{v.actions.gdocsSaveDocumentSetting({docIdHash:(0,ae.Of)(t),documentState:{sidebarVisible:!0}}),b.next({kind:"opened",alertId:e})},onHide:()=>{v.actions.gdocsSaveDocumentSetting({docIdHash:(0,ae.Of)(t),documentState:{sidebarVisible:!1}}),b.next({kind:"closed"})},iterableNextFetchSettings:e=>{v.actions.iterableNextFetchSettings(e)}},i,{expandedViewAlertsCount:C.get(),inlineAlertCount:y&&y.get(),nonInlineAlertCount:f&&f.get(),nonHiddenClarityAlertCount:w&&w.get(),wordsCount:x},g,v.actions,s.experimentClient,s.config,xe.create,k);return d.push(function(e,t){const i=e.pipe((0,D.h)((e=>e.kind===se.Close))).subscribe((()=>t.hide(S.$.Source.user)));return{dispose(){i.unsubscribe()}}}(q,Y)),m.push(Y.sidebarVisible.subscribe((e=>{e?(E.showDelayMs.next(0),E.hideDelayMs.next(0)):(E.showDelayMs.reset(),E.hideDelayMs.reset())}))),m.push((0,ke.G_)(I).subscribe((()=>{Y.hide(S.$.Source.user)}))),Y}},14788:(e,t,i)=>{var s=i(45101),r=i(30997)(s);r.push([e.id,"._UUx2a-sidebar{align-items:center;justify-content:center;overflow:hidden;position:relative;}._UUx2a-sidebar ._rjT4p-header{position:absolute;top:0;right:0;width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-top:.25rem;height:32px;}._UUx2a-sidebar ._rjT4p-header ._FnbRU-headerGroup{display:flex;flex-direction:row;align-items:center;}._UUx2a-sidebar ._rjT4p-header ._FnbRU-headerGroup ._tAUEh-logoIcon{margin:0 .25rem 0 .8rem}._UUx2a-sidebar ._rjT4p-header ._FnbRU-headerGroup ._A2vNJ-closeButton{margin-right:3.5px;width:25px;height:25px;display:flex;justify-content:center;align-items:center;border-radius:4px;stroke:#6d758d;}._UUx2a-sidebar ._rjT4p-header ._FnbRU-headerGroup ._A2vNJ-closeButton:hover{background-color:#f0f2fc;cursor:pointer;stroke:#4a6ee0}._UUx2a-sidebar ._iAhBE-splashContainer{position:absolute;right:0;top:0;transform:translate(0,calc(50vh - 50%));}._UUx2a-sidebar ._iAhBE-splashContainer ._UCK9k-splash{width:100%;height:100%;animation:_mIR7B-splash-opacity 1s cubic-bezier(.08,.8,.67,1) 400ms 1 normal both,_WG_5I-splash-scale 1s cubic-bezier(.05,.69,.67,1) 400ms 1 normal both}._UUx2a-sidebar ._LQT5h-spinnerContainer{position:absolute;transform:translate(0,calc(50vh - 50%));animation:_WdqUz-spinner-scale 330ms cubic-bezier(.05,.62,.51,1.26) 333ms 1 normal backwards;}._UUx2a-sidebar ._LQT5h-spinnerContainer ._BC8p8-spinner{animation:_BC8p8-spinner 1.2s infinite linear}@keyframes _BC8p8-spinner{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes _mIR7B-splash-opacity{0%{opacity:1}100%{opacity:0}}@keyframes _WG_5I-splash-scale{0%{transform:scale(0)}100%{transform:scale(2)}}@keyframes _WdqUz-spinner-scale{0%{transform:translate(0,calc(50vh - 50%)) scale(0)}100%{transform:translate(0,calc(50vh - 50%)) scale(1)}}",""]),r.locals={sidebar:"_UUx2a-sidebar",header:"_rjT4p-header",headerGroup:"_FnbRU-headerGroup",logoIcon:"_tAUEh-logoIcon",closeButton:"_A2vNJ-closeButton",splashContainer:"_iAhBE-splashContainer",splash:"_UCK9k-splash","splash-opacity":"_mIR7B-splash-opacity","splash-scale":"_WG_5I-splash-scale",spinnerContainer:"_LQT5h-spinnerContainer","spinner-scale":"_WdqUz-spinner-scale",spinner:"_BC8p8-spinner"},e.exports=r}}]);