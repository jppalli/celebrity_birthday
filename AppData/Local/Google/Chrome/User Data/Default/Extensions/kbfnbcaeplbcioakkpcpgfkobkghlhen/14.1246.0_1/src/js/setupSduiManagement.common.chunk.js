(self.webpackChunk=self.webpackChunk||[]).push([[1196],{54778:(e,t,i)=>{i.d(t,{r:()=>a});var a,s=i(47311);!function(e){e.createBuilder=function(){return{build:(e,i)=>{const a=t();return{make:(t,r)=>({metadata:e,data:i,args:r,id:a,type:t,actions:new s.Subject})}}}};const t=(()=>{let e=1;return()=>e++})()}(a||(a={}))},89402:(e,t,i)=>{i.d(t,{_:()=>a});var a,s=i(31006);!function(e){e.isHighPriority=function(e){return e.metadata.priority>s.P.Priority.average},e.isCloseAction=function(e){return"timeout"===e||"closedByUser"===e||"closedByNotificationWithMorePriority"===e||"closedByMaxNotificationOnScreen"===e}}(a||(a={}))},94960:(e,t,i)=>{i.d(t,{y:()=>c});var a=i(32490),s=i(31491),r=i(72111),n=i(47311),o=i(89402),l=i(31006);class c{enqueue(e,t){const i=this._factory[e].make(e,t);return n.defer((()=>{const t=i.metadata.timeout!==l.P.TimeoutDisabled?n.timer(i.metadata.timeout===l.P.DefaultTimeout?this._defaultTimeout:i.metadata.timeout).pipe(n.map((()=>"timeout"))):n.EMPTY;this.state.modify((e=>{const t=e.filter(((t,a)=>t.metadata.priority<i.metadata.priority?(this._log.debug(`closing ${t.type} notification, ${i.type} have higher priority`),t.actions.next("closedByNotificationWithMorePriority"),!1):t.id!==i.id&&(!(0===a&&e.length>=this._maxNotificationsOnScreen)||(this._log.debug(`closing ${t.type} notification, more than ${this._maxNotificationsOnScreen} notification on the screen`),t.actions.next("closedByMaxNotificationOnScreen"),!1))));return t.push(i),t}));return n.mergeStatic(i.actions,t.pipe(n.takeUntil(i.actions.pipe(n.filter(o._.isCloseAction))))).pipe(n.takeWhile((0,s.ff)(o._.isCloseAction),!0),n.tap((t=>{this._log.log(o._.isHighPriority(i)?r.zW.i.WARN:r.zW.i.DEBUG,`Notification ${String(e)} is ${t}`)})),n.finalize((()=>{this.state.modify((e=>e.filter((e=>e.id!==i.id))))})),n.share())}))}constructor(e,t,i,s){(0,a._)(this,"state",void 0),(0,a._)(this,"_factory",void 0),(0,a._)(this,"_maxNotificationsOnScreen",void 0),(0,a._)(this,"_defaultTimeout",void 0),(0,a._)(this,"_log",void 0),this.state=e,this._factory=t,this._maxNotificationsOnScreen=i,this._defaultTimeout=s,this._log=r.C8.Logging.getLogger("notificationsManager")}}},89778:(e,t,i)=>{i.r(t),i.d(t,{PlagiarismViewModelImpl:()=>g,createPlagiarismEntities:()=>m,createPlagiarismViewModels:()=>ve,setupSduiManagement:()=>Me});var a=i(95922),s=i(90023),r=i(59179),n=i(58303),o=i(29677),l=i(79620),c=i(414),d=i(39953),u=i(13391),p=i(84358);class g{constructor(e,t){this._plagiarismViewModelsFactory=e,this._wrapNotifyPayload=t,this.isShouldShowPlagiarismButton=u.h.create(!1),this.plagiarismButtonActions=u.h.create(n.YP),this.plagiarismEngine=u.h.create(n.YP)}setShowPlagiarismButton(e){this.isShouldShowPlagiarismButton.set(e)}setPlagiarismButtonActions(e){this.plagiarismButtonActions.set(n.G(e))}setPlagiarismEngine(e){this.plagiarismEngine.set(n.G(e))}openPlagiarismPage(){const e=this._plagiarismViewModelsFactory();this.setPlagiarismEngine(e),n.pC(this.plagiarismButtonActions.get())&&(0,d.zG)(this.plagiarismButtonActions.get(),p.MH,e.handleSduiAction)}closePlagiarismPage(){(0,d.zG)(this.plagiarismEngine.get(),p.bw((e=>e.handleSduiAction(this._wrapNotifyPayload([{type:"disablePlagiarismCheck"}],"")))))}}function m(e,t,i){const d=(e,t,i,a)=>a.forEach((a=>{switch(a.type){case"notify":return void t.sduiFeedbackService.sendUserAction(a.sourceId||i.sourceId,a.userAction);case"enablePlagiarismCheck":return void e.openPlagiarism();case"closePopover":return void t.sduiManager.popoverManager.removePopover(a.rootPopoverId);case"interactPopover":switch((0,s.zG)(t.sduiManager.popoverManager.getInteractionActions(a.rootPopoverId,a.popoverViewId,a.interaction),(a=>d(e,t,i,a))),a.interaction){case o.fP.Fulfill:case o.fP.Dismiss:t.sduiManager.popoverManager.removePopover(a.rootPopoverId)}return;default:return}})),u=t=>({handleGButtonPopoverAction:i=>{n.pC(e)&&d(t,e.value,i,i.actions)}});return(0,s.zG)(e,n.g_((()=>n.YP),(e=>{const s=t({sduiEngine:e,...i});return n.G({plagiarismVM:new g((0,a.of)(s),c.Zq),plagiarismButtonSub:e.sduiManager.state.pipe(r.U((e=>l.D1.GButton.getPlagiarismContent(e)))),popover:(o=e.sduiManager,o.popoverManager.activePopoverView.view(n.tS((e=>"component"===e.anchor.kind&&"gButton:plagiarism"===e.anchor.id?n.G(e):n.YP)))),popoverActionsHandler:u,trackPlagiarismAlertsEditing:s.trackPlagiarismAlertsEditing});var o})))}var h=i(5412),f=i(17690),v=i(48640),A=i(83042),b=i(91167),P=i(60152),I=i(61736),S=i(64996),y=i(87517),C=i(14677),w=i(74075),M=i(84825),E=i(88367),k=i(57576),B=i(525),R=i(99817),F=i(73926),U=i(54632),D=i(58690),L=i(31491),_=i(50887),G=i(84714),T=i(84178),z=i(90517),x=i(63532),q=i(74822),O=i(36344),W=i(84308),H=i(954),V=i(78129),j=i(23841),N=i(55341),Q=i(10883),Y=i(26308),$=i(72111),Z=i(12518),K=i(59833),X=i(17572),J=i(88347),ee=i(54490),te=i(12995),ie=i(45806),ae=i(3058),se=i(39845),re=i(87856),ne=i(41262),oe=i(11928),le=i(7221),ce=i(62330),de=i(30705),ue=i(31006),pe=i(54778),ge=i(94960);const me={priority:ue.P.Priority.low,timeout:ue.P.DefaultTimeout,position:ue.P.Position.bottomRight,viewType:ue.P.ViewType.standard};var he;!function(e){e.createFactory=function(){return{referenceCopied:pe.r.createBuilder().build(me)}}}(he||(he={}));const fe=new ge.y(u.h.create([]),he.createFactory(),1,5e3),ve=({sduiEngine:e,engine:t,capiProxy:i,ded:a,showPlagiarismAlerts:o,environment:l})=>{const c=$.C8.Logging.getLogger("gDocs.PlagiarismEngine"),d=new _.w.Keeper,g=new ee._(e.sduiManager.state),m={features:new Set([y.IG.Features.showCardLabelInOutcomes]),cardLayoutDensityMode:E.j.Density.minimal,shouldAnimateAlertApply:y.IG.Default.shouldAnimateAlertApply,cardVisualMode:u.h.create(E.j.CardVisualMode.RegularLightMode)},M=(0,y.Ls)((()=>Z.t$({kind:"default",error:new Error("should not use hydration to render sdui cards")})),t.alertsReader,m,(()=>G.of(n.YP)),n.YP),L=de.p.getCapabilities(M,t.alertsReader),Q=(0,s.a9)(s.yR),J=e=>Q,ce=b.t.create(b.t.defaultLensFilters,{...b.t.defaultTextFilters,[h.R.SpecialId.Closed]:s.jv,[h.R.SpecialId.AllAlerts]:f.bZ.belongsToAllAlerts}),ue=u.h.create(v.A.defaultState),pe=new ne.t(ue.view("lenses"),ce,t.sessionModel.scoreStatus),ge={create:(e,t)=>B.v.WithSuccess.create(e,t,de.p.equatable.structEq,de.p.defaultOrd(L))},me=R.v.createWithExternalItems(ge,L),he=new P.F.Impl(t.alertsList.state,t.positionManager,t.alertsReader,ce.alertCanBeDisplayed),ve=new U.oq(t.alertsList.state,t.alertsReader,ue.view("lenses"),he,pe,((e,t,i,a,r)=>((e=>{(0,s.zG)(e,p.bw((e=>{d.push(g.feed.pipe(T.q(1),z.j("cards"),x.b((0,s.ls)(Y.vh.filter(s.jv,s.jv,(t=>t.alertIds.includes((0,s.MZ)(e.alert.id)))),Y.vh.foldMap(K.uZ())((0,s.a9)(K.cS),(0,s.a9)(K.cS),K.of),K.YM,p.bw((e=>{requestAnimationFrame((()=>{(0,s.zG)(g.focusCard(e.id),Z.g_((e=>c.warn("Error on focusing SDUI item in a new lens",e)),s.Q1))}))}))))).subscribe())})))})(a),me(e,t,i,a,(0,s.zG)(r,n.hX((e=>h.R.isWithAlertsId(e.id))))))),J,L,ce),Ie=u.h.create(ve.emptyState(h.R.SpecialId.Plagiarism).patch({alertSource:f.l$.sidebar})),Se=B.v.Items.getRemoveDisposedItemsTransformer(L),ye=te.i.DisablePrevNextButtons.create(L),Ce=B.v.Items.getItemsPositionsUpdateTransformer(L),we=S.Py.getDefaultBehavior(de.p.getActiveFocusableItem,L),Me=u.h.create(!0),Ee=u.h.create(h.R.SpecialId.AllAlerts),ke=(0,S.u0)((()=>a.getCursor().index),ve),Be=(0,S.VC)(ve,ke,Ee,L,(()=>!1),(()=>!1)),Re=S.sR.getStateTransformer(we,Be,L,S.sR.getShouldAutoFocus(Me,t.alertsReader,de.p.getActiveItemWithAlert),s.Q1,Ee),Fe=(0,s.ls)(Se,X.L9(Re),X.L9(ye),X.L9(Ce)),Ue=new I.Xx({flush:()=>a.flushChanges()},new q.x,M,t.alertsService,t.alertsReader,(()=>Promise.resolve()),(()=>Promise.resolve()),(0,s.zG)(t.mutedAlertsCategoriesModel,n.UI((e=>({model:e,openSuggestionsManagement:()=>self.open((0,le.Um)().suggestionsSettings)})))),n.YP,s.jv,de.p.getActiveFocusableItem,L,l,{bufferTransitions:!0,showGbPrompt:!1}),De=new ie.q(e.sduiFeedbackService,L,Ie,e.sduiManager,g,t.alertsReader,{...e.capiClient,...t.writingExpertClient},Ue,l),Le=(0,s.zG)(S.sR.focusFirstCardAfterBigCheck(Ie,u.h.create(i.checkingState),u.h.create(!0),{bigPaste:O.E}),(e=>S.sR.getSideEffect(e,L))),_e=(0,oe.xl)(Ie,ce,G.of(),u.h.create(!1),u.h.create(!0)),Ge=W.a([_e,o]).pipe(r.U((([e,t])=>t?e:s.jv))),Te=new oe.o$(t.alertsList,t.alertsReader,t.positionManager,t.alertsService,a,Ie,Ge,de.p.getActiveFocusableItem,u.h.create(!1),G.of(void 0),!1),ze=new C.o((()=>Z.F2(void 0))),xe=(0,se.hp)(Ie,Te,ze,a,c),qe=t.alertsReader,Oe=Ie.view(k.nL.getActiveAlertHighlight(de.p.getActiveFocusableItem)),We=new A.mN(a,Te,t.alertsReader,Oe,Ie.view((e=>e.currentLens.meta.filter))),He=[Le,ae.P.SideEffects.createSDUIFeedSideEffect({...L,findNextAlert:(0,s.a9)(n.YP),selectItemByAlert:()=>s.yR},g.feed.pipe(r.U(n.G),H.O(n.YP),V.G(),r.U((([e,t])=>(0,s.zG)(p.gz(e,t),n.hX((([e,t])=>e.feedId===t.feedId)),n.UI((([,e])=>({...e,cards:(0,s.zG)(e.cards,Y.vh.filter(s.jv,s.W8,s.W8))}))),n.wp((()=>t))))),j.oA),de.p.sduiToChecksFeedOrd(L),t.alertsReader),Ae(g,L),...De.getApplicatorEffects(),...Ue.getApplicatorEffects(),I.dv.changeAlertEffect(Ie,Ue,M,de.p.getActiveFocusableItem,t.alertsReader,n.G(xe),ke,c.getLogger("CardsViewModelEffects.changeAlertEffect")),w.R7(Ie,ze,L,(0,s.MZ)(Ue.actionEvents)),be(De.sduiActionEvents,G.of(!0),L),(0,re.A7)(We,Ie,!0),D.EQ.focusMarkByActiveAlert(Ie,Te,qe,de.p.getActiveFocusableItem,c.getLogger("MarksEffects.focusMarkByActiveAlert")),D.EQ.highlightMarkByHighlightedCard(Ue,Ie,Te,qe,L,c.getLogger("MarksEffects.highlightMarkByHighlightedCard")),Pe(De.sduiActionEvents,fe)],Ve=new F.l(Ie,ve,t.alertsReader,t.alertsService,He,de.p.getActiveFocusableItem,Fe),je=new N.t;return{...e,checksFeedFlow:()=>de.p.createCardListFlow(Ue)(Ue,Ie.lens(k.nL.Prism.getLens()),je,G.of(!1),L,de.p.listItemOrd),sduiFeedManager:g,handleSduiAction:e=>{De.sduiActionEvents.next(e)},capabilities:L,lensState:Ie,trackPlagiarismAlertsEditing:Te.getPlagiarismAlertsEditingTracker(),dispose:()=>{Ve.dispose(),Ue.dispose(),De.dispose(),d.dispose()}}};function Ae(e,t){return{id:"SDUIItemRemoveSideEffect",when:h.R.isWithAlertsId,what:k.nL.Effect.Applicator.create(e.feed.pipe(r.U((e=>i=>{const a=(0,s.zG)(e.cards,Y.vh.reduce([],((e,a)=>(0,s.zG)(i.currentLens.items.get(a.id),n.UI((0,J.ei)("value")),n.hX((0,L.Kg)((0,s.ff)(M.o.isAnimatable),(0,s.ff)(M.o.isAnimatingRemoval))),n.UI(t.remove(s.W8,s.W8)),n.g_((()=>e),(t=>(e.push(t),e))))),s.yR,s.yR));if(a.length>0){const e=i.currentLens.items.add(a);return k.nL.Prism.getLens().compose(B.v.Prism.items).set(e,i)}return i}))))}}function be(e,t,i){return{id:"sduiFocusEffect",when:h.R.isWithAlertsId,what:k.nL.Effect.Applicator.create(e.pipe(Q.M(t),r.U((([{actions:e,cardId:t},a])=>r=>a&&Boolean(e.find((e=>"notify"===e.type&&"focus"===e.userAction)))&&k.nL.hasItems(r)?(0,s.zG)(k.In.getActiveItemOfType(de.p.isAlertRefSDUI)(r.currentLens),n.hX((e=>!["focused","removed"].includes(e.visualState.transition.type))),n.UI((()=>k.nL.Prism.getLensWithItems().modify(i.selectItemById((0,s.MZ)(t)),r))),n.fS((0,s.a9)(r))):r))))}}function Pe(e,t){return{id:"sduiCopyToClipboardEffect",when:h.R.isWithAlertsId,what:k.nL.Effect.Applicator.create(e.pipe(r.U((e=>i=>(e.actions.forEach((e=>{"copyToClipboard"===e.type&&(0,ce.vQ)(e.text).then((()=>t.enqueue("referenceCopied")))})),i)))))}}var Ie=i(47311),Se=i(20302),ye=i(70544),Ce=i(40255),we=i(15648);function Me(e,t,i){const a=e.view((e=>(0,d.zG)(e,n.UI((e=>e.sduiBufferService.capiEvents.pipe(Ie.filter(Se.hX.is("sdui_add","sdui_remove","sdui_update")),Ie.filter(ye.e.isSduiEvent),Ie.map(Ce.al.fromSource(Ce.i5.CAPI))))),p.MH))).get(),s=new we.A(i,a,t),{sduiFeedbackService:r,capiClient:o}=e.view((e=>(0,d.zG)(e,n.UI((e=>({sduiFeedbackService:e.sduiFeedbackService,capiClient:e.capiClient}))),p.MH))).get();return{sduiFeedbackService:r,capiClient:o,sduiManager:s}}},30705:(e,t,i)=>{i.d(t,{p:()=>a});var a,s=i(24332),r=i(90023),n=i(39953),o=i(17690),l=i(90277),c=i(65810),d=i(84825),u=i(57576),p=i(525),g=i(64297),m=i(31491),h=i(58303),f=i(14944),v=i(54553),A=i(3058),b=i(39491),P=i(85262),I=i(93259),S=i(79620);!function(e){const t=e=>(0,n.zG)(u.In.getActiveItemOfType(a)(e),h.tS(A.P.Capabilities.toAlertItem));function i(e){return u.nL.Items.mapper((e=>e.kind),{[A.P.Kind]:e})}function a(e){return e.kind===A.P.Kind}function y(){return{viewState:()=>e=>e.kind===A.P.Kind?{view:e,kind:"alertRefSDUI"}:{}}}e.isSelectableItem=a,e.getActiveItemWithAlert=t,e.getActiveFocusableItem=e=>t(e),e.checksFeedItemsMapper=i,e.isAlertRefSDUI=a,e.defaultOrd=t=>(0,s.g_)(f.iP())([(0,n.zG)(f.C2,f.Uz((0,m.ff)(A.P.Item.isBulkAcceptSDUI))),(0,n.zG)(f.C2,f.Uz(A.P.Item.isBulkDismissSDUI)),e.getByActiveAlertPositionOrd(t)]),e.sduiToChecksFeedOrd=function(t){return i=>f.Zt(((a,s)=>b.e.isSDUIItem(a)&&b.e.isSDUIItem(s)?b.e.getOrd(i).compare(a,s):e.getByActiveAlertPositionOrd(t).compare(a,s)))},e.getByActiveAlertPositionOrd=e=>(0,s.g_)(f.iP())([(0,n.zG)(o.h$.ordHRange,f.Uz((t=>(0,n.zG)(e.hasActiveAlert(t),h.UI((e=>e.alert)),h.fS((()=>({getHighlightRanges:()=>[{start:0,end:0}]})))))))]),e.item=()=>v.UI.Union.make("kind",{alertRefSDUI:P.p.SquashedListCard(),empty:I.Q.Empty}),e.viewState=y,e.createCardListFlow=e=>(0,l.sJ)((t=>{switch(t.key){case"empty":break;case"alertRefSDUI":e.actionEvents.next(t.action);break;default:(0,g.L0)(t)}})),e.listItemOrd=e=>f.Uz((e=>e.cell.item.view))(e).compare;const C={equals:(e,t)=>e.kind===t.kind&&c.s.eqById.equals(e,t)},w=e=>({equals:(t,i)=>{const a={[A.P.Kind]:e};return C.equals(t,i)&&(s=e=>e.kind,r=a,(e,t)=>r[s(e)].equals(e,t))(t,i);var s,r}});function M(){return{changePosition:e=>i(A.P.Capabilities.changePosition(e))}}function E(){return{completeTransition:e=>i(A.P.Capabilities.animatable.completeTransition(e)),transitionTo:e=>i(A.P.Capabilities.animatable.transitionTo(e)),changeVisualState:e=>i(A.P.Capabilities.animatable.changeVisualState(e))}}function k(){return{select:(e,t)=>i(A.P.Capabilities.select.select(e,t)),selectByAlert:(e,t,a)=>i(A.P.Capabilities.select.selectByAlert(e,t,a)),unselect:(e,t)=>i(A.P.Capabilities.select.unselect((0,r.MZ)(e),t))}}function B(){return{removeAlertFromItem:(e,t)=>i((i=>i.id===S.D1.SuccessReport.ID?i:A.P.Capabilities.removeAlert.removeAlertFromItem(e,t)(i)))}}function R(){return{remove:(e,t)=>i(A.P.Capabilities.remove.remove(e,t))}}function F(){return{updateWithAlerts:e=>i(r.yR)}}function U(){return{nextAlert:i((()=>h.YP)),prevAlert:i((()=>h.YP))}}function D(){return{updateUserInput:e=>i(r.yR)}}e.equatable={structEq:w(A.P.eq),idEq:w(C),visualStateEq:w(A.P.eq)},e.changePosition=M,e.disposable={isScheduledToDispose:i(A.P.Capabilities.disposable.isScheduledToDispose)},e.hidable={isHidden:i(d.o.isHidden)},e.animatableItem=E,e.hasAlertsQueries={isSelectableByAlert:e=>i(A.P.Capabilities.hasAlerts.isSelectableByAlert(e)),hasAlert:e=>i(A.P.Capabilities.hasAlerts.hasAlert(e)),hasActiveAlert:i(A.P.Capabilities.hasAlerts.hasActiveAlert)},e.changePositionStrategyQueries={useReferenceHeightOnRemove:i(r.jv)},e.select=k,e.removeAlert=B,e.remove=R,e.updateWithAlert=F,e.releaseAlert=()=>p.v.Capabilities.getAlertReleaser({...B(),...e.disposable}),e.unselectable=()=>p.v.Capabilities.getUnselectable(u.In.getActiveItem,{...k(),isScheduledToDispose:r.jv}),e.selectableByAlert=()=>p.v.Capabilities.getSelectableByAlert(u.In.getActiveItem,{...e.hasAlertsQueries,...k(),...p.v.Capabilities.getHasChecksFeed(),...e.disposable}),e.selectableById=()=>p.v.Capabilities.getSelectableById(u.In.getActiveItem,{...k(),isScheduledToDispose:r.jv}),e.updateMeta=()=>({updateMeta:p.v.Capabilities.getMetaUpdatable().updateMeta}),e.animatableFeed=e=>p.v.Capabilities.getAnimatable(e,{...B(),...E(),...p.v.Capabilities.getHasChecksFeed()}),e.alignable={isValidToAlign:i((t=>!e.disposable.isScheduledToDispose(t)))},e.alertIterator=U,e.itemReleaser=()=>p.v.Capabilities.getItemReleaser(),e.hasAlerts=p.v.Capabilities.getHasAlerts,e.hasUserInput=D,e.verifiable=()=>p.v.Capabilities.getVerifiable(e.disposable),e.cloneable=()=>({clone:i(c.s.Capabilities.getPojoCloneable().clone)});const L={getFeatures:i((e=>A.P.Item.isBulkDismissSDUI(e)?[A.P.Features.BulkDismiss]:A.P.Item.isBulkAcceptSDUI(e)?[A.P.Features.BulkAccept]:[]))};e.getCapabilities=function(t,i){return{...y(),...e.disposable,...e.hidable,...e.equatable,...D(),...e.cloneable(),...M(),...E(),...k(),...R(),...B(),...F(),...e.hasAlertsQueries,...e.changePositionStrategyQueries,...e.alignable,...e.releaseAlert(t),...e.unselectable(t),...e.selectableByAlert(t),...e.selectableById(t),...e.updateMeta(t),...e.animatableFeed(t),...e.itemReleaser(),...L,shouldAnimatePositionChange:()=>()=>!1,...e.verifiable(),...e.cloneable(),...e.hasAlerts(U(),i,(()=>e.isSelectableItem),{...e.hasAlertsQueries,...e.disposable})}}}(a||(a={}))},62330:(e,t,i)=>{if(i.d(t,{Sz:()=>r,vQ:()=>s}),6168!=i.j)var a=i(12518);async function s(e,t=self){if(function(e=self){var t,i;return!!(null===(i=null===(t=e.navigator)||void 0===t?void 0:t.clipboard)||void 0===i?void 0:i.writeText)}(t))return t.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported")}function r(e,t=self){return s(e,t).then((()=>a.F2(void 0))).catch((e=>a.t$(e instanceof Error?e:new Error(String(e)))))}}}]);