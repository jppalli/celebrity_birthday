"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,s)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.JSAssetDepthScript=void 0;const JSAssetScriptBase_1=require("./JSAssetScriptBase"),APJS=require('amazingpro.js'),DepthNodeName="depth_0";class JSAssetDepthScript extends JSAssetScriptBase_1.JSAssetScriptBase{constructor(){super(...arguments),this._graphName="",this._tex=APJS.TextureUtils.createTexture2D()}set mainObject(e){this._mainObject=e}get mainObject(){return this._mainObject}get graphName(){return this._graphName}set graphName(e){var t;this._graphName=e,this.isRunTime&&(null===(t=this.scene)||void 0===t||t.assetManager.setCustomAssetsProperty(this.uuid,"graphName",e))}get flipYMaterial(){return this._flipYMaterial}set flipYMaterial(e){this._flipYMaterial=e}getDepthAlgoResult(){const e=APJS.AlgorithmManager.getResult();if(!e)return console.log("Depth Algo Result is invalid"),!1;const t=e.getDepthEstimationInfo("","",0);return t?(APJS.TextureUtils.refreshTextureWithImage(this._tex,t.image),!0):(console.log("Depth Estimation Info is invalid"),!1)}onStart(){var e;if(this.mainObject&&this.isRunTime){this._flipYMaterialInstance=null===(e=this._flipYMaterial)||void 0===e?void 0:e.instantiate();const t=this.mainObject.getControl();t.setDepth(1),t.filterMag=APJS.FilterMode.Linear,t.filterMin=APJS.FilterMode.Linear,t.filterMipmap=APJS.FilterMipmapMode.None,t.setAttachment(APJS.RenderTextureAttachment.NONE),this._tex.filterMin=APJS.FilterMode.Linear,this._tex.filterMag=APJS.FilterMode.Linear}}onUpdate(e){var t;if(this.mainObject&&this.isRunTime){if(!this.getDepthAlgoResult())return;void 0!==this._flipYMaterialInstance&&(null===(t=this.cmdBufferHelper)||void 0===t||t.blitWithMaterial(this._tex,this.mainObject,this._flipYMaterialInstance,0,!1))}}}exports.JSAssetDepthScript=JSAssetDepthScript;