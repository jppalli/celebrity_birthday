"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var a=Object.getOwnPropertyDescriptor(t,i);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,a)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.JSAssetSceneNormalScript=void 0;const JSAssetScriptBase_1=require("./JSAssetScriptBase"),APJS=require('amazingpro.js'),normalNode="nh_script_0";class JSAssetSceneNormalScript extends JSAssetScriptBase_1.JSAssetScriptBase{constructor(){super(...arguments),this._graphName="",this._tex=APJS.TextureUtils.createTexture2D()}set mainObject(e){this._mainObject=e}get mainObject(){return this._mainObject}get graphName(){return this._graphName}set graphName(e){var t;this._graphName=e,this.isRunTime&&(null===(t=this.scene)||void 0===t||t.assetManager.setCustomAssetsProperty(this.uuid,"graphName",e))}get flipYMaterial(){return this._flipYMaterial}set flipYMaterial(e){this._flipYMaterial=e}getNormalAlgoResult(){const e=APJS.AlgorithmManager.getResult().getScriptInfo(this.graphName,normalNode);if(!e)return console.log("SceneNormal scriptInfo null"),!1;const t=e.outputMap;if(!t)return console.log("SceneNormal scriptInfo outputMap null"),!1;const i=t.get("image");return i&&(console.log("SceneNormal normal image valid"),APJS.TextureUtils.refreshTextureWithImage(this._tex,i)),!0}onStart(){var e;if(this.mainObject&&this.isRunTime){this._flipYMaterialInstance=null===(e=this._flipYMaterial)||void 0===e?void 0:e.instantiate();const t=this.mainObject.getControl();t.setDepth(1),t.filterMag=APJS.FilterMode.Linear,t.filterMin=APJS.FilterMode.Linear,t.filterMipmap=APJS.FilterMipmapMode.None,t.setAttachment(APJS.RenderTextureAttachment.NONE),this._tex.filterMin=APJS.FilterMode.Linear,this._tex.filterMag=APJS.FilterMode.Linear}}onUpdate(e){var t;if(this.mainObject&&this.isRunTime){if(!this.getNormalAlgoResult())return;void 0!==this._flipYMaterialInstance&&(null===(t=this.cmdBufferHelper)||void 0===t||t.blitWithMaterial(this._tex,this.mainObject,this._flipYMaterialInstance,0,!1))}}}exports.JSAssetSceneNormalScript=JSAssetSceneNormalScript;