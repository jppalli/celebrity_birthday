<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-146876309-1', 'auto');
      ga('set', 'checkProtocolTask', null);
      ga('send', 'pageview');
    </script>
    <!-- End Google Analytics -->

    <!-- Google Analytics Debug -->
    <!-- <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics_debug.js','ga');

      ga('create', 'UA-146876309-1', 'auto');
      ga('set', 'checkProtocolTask', null);
      ga('send', 'exception', { exDescription: 'test', exFatal: false });
    </script> -->
    <!-- End Google Analytics Debug -->
    <title>Launcher Events Provider - by Overwolf</title>

    <script>
        // (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        //             (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        //         m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        // })(window,document,'script','https://ssl.google-analytics.com/analytics.js','ga');

        // ga('create', 'UA-132870778-1', 'auto');
        // ga('set', 'checkProtocolTask', null);
        // ga('send', 'pageview', '/');
    </script>

    <script>
      function reportToGA(message) {
        overwolf.extensions.current.getManifest((manifest) => {
          let userId = localStorage.getItem("userId");
          if(!userId) {
            userId = null;
          }
          let version = manifest.meta.version;
          // Send to GA
          const payload = {
            hitType: 'event',
            eventCategory: version,
            eventAction: message,
            eventLabel: userId,
          }
          console.log(`[GA] reporting to GA: ${JSON.stringify(payload)}`);
          ga('send', payload);
        });
      }
    </script>

    <script>
      reportToGA('LEP Launched');
    </script>

    <script>
      // Our range is: 60000-60100
      const kErrorGlobal = 60000;
      const kUrlTracking = 
        "http://tracking.overwolf.com/tracking/InsertStats?Stats=true";

      const safeSendTrack = (id, extra) => {
        let payload = {
          Kind: id
        };

        if (extra) {
          payload.Extra = extra;
        }

        let xmlhttp = new XMLHttpRequest();
        xmlhttp.open("POST", kUrlTracking);
        xmlhttp.setRequestHeader("Content-Type", 
                                 "application/json;charset=UTF-8");
        xmlhttp.send(JSON.stringify(payload));
      }

      window.addEventListener('error', function(e) {
        console.log(`[ERROR] reporting error ${e.message} ${e.filename} ${e.lineno}`);
        let message = `${e.filename} ${e.lineno} ${e.colno} ${e.message}`;
        safeSendTrack(kErrorGlobal);
        reportToGA('Global Error:' + e.message + e.stack);
      });
    </script>

    <script src="libs/require.min.js"></script>

    <script>
      require.config({
        waitSeconds: 30
      })
    </script>

    <script>
      require(["./dist/app"], ({App}) => {
          App.run();
        }, function (error) {
          console.log(`[INIT] failed to load main module ${error}`);

          const kErrorMainModuleLoadFailed = 60001;
          safeSendTrack(kErrorMainModuleLoadFailed);
          reportToGA(error.stack);
        });
    </script>
  </head>
  <body>
  </body>
</html>

