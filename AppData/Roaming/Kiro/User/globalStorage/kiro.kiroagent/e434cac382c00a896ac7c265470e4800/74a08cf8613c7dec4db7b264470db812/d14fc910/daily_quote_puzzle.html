<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Quote Puzzle</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- PixiJS for smooth animations and transitions -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.3.2/pixi.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Times New Roman', Times, serif;
        }

        body {
            background: #f0f0f0;
            color: #222;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            background-image: linear-gradient(#f9f9f9 1px, transparent 1px),
                linear-gradient(90deg, #f9f9f9 1px, transparent 1px);
            background-size: 20px 20px;
            background-color: #fafafa;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .newspaper-container {
            max-width: 800px;
            width: 100%;
            background: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            border-top: 4px solid #333;
            position: relative;
            padding: 30px 40px;
            min-height: 600px; /* Maintain consistent height */
        }

        .header {
            position: relative;
            padding-bottom: 15px;
            border-bottom: 2px solid #222;
            margin-bottom: 25px;
            text-align: center;
        }

        .newspaper-title {
            font-size: 42px;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 15px;
            font-family: 'Playfair Display', serif;
            color: #222;
        }

        .date-line {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .header-icons {
            position: absolute;
            top: 5px;
            right: 0;
            display: flex;
            gap: 8px;
        }

        .header-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .help-icon {
            background: #222;
            color: white;
        }

        .calendar-icon {
            background: #444;
            color: white;
        }

        .stats-icon {
            background: #666;
            color: white;
        }

        .header-icon:hover {
            transform: scale(1.1);
        }

        .congrats {
            margin-bottom: 25px;
            padding: 20px;
            background: #f9f9f9;
            border: 2px solid #222;
            text-align: center;
            display: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            font-style: italic;
        }

        .congrats.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .congrats h2 {
            font-size: 26px;
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .congrats p {
            font-size: 18px;
            color: #444;
        }

        .quote-container {
            padding: 30px 0;
            margin-bottom: 30px;
            position: relative;
        }



        .quote-container:before,
        .quote-container:after {
            content: "" ";
 position: absolute;
            font-size: 80px;
            color: #ddd;
            font-family: Georgia, serif;
        }

        .quote-container:before {
            top: 0;
            left: -25px;
        }

        .quote-container:after {
            bottom: -10px;
            right: -25px;
            transform: rotate(180deg);
        }

        .quote-text {
            font-size: 24px;
            line-height: 1.8;
            text-align: center;
            margin-bottom: 30px;
            padding: 0 20px;
            font-weight: 400;
            letter-spacing: 0.3px;
            font-style: italic;
        }

        .quote-word {
            margin: 0 2px;
            padding: 3px 8px;
            display: inline-block;
            transition: all 0.2s;
            border-radius: 2px;
        }

        .quote-word.scrambled {
            background: #f0f0f0;
            border: 1px solid #ddd;
            text-decoration: underline;
            text-decoration-style: wavy;
            text-decoration-color: #999;
            text-underline-offset: 3px;
            cursor: pointer;
        }

        .quote-word.scrambled.active {
            background: #e0e0e0;
            border: 1px solid #222;
        }

        .quote-word.scrambled:hover {
            background: #e5e5e5;
        }

        .author {
            text-align: center;
            font-size: 20px;
            font-weight: 500;
            font-style: italic;
            padding-top: 15px;
        }

        .author.scrambled {
            background: #f0f0f0;
            border: 1px solid #ddd;
            padding: 5px 15px;
            display: inline-block;
            text-decoration: underline;
            text-decoration-style: wavy;
            text-decoration-color: #999;
            text-underline-offset: 3px;
            cursor: pointer;
        }

        .author.scrambled.active {
            background: #e0e0e0;
            border: 1px solid #222;
        }

        .author.scrambled:hover {
            background: #e5e5e5;
        }

        .input-area {
            padding: 25px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            margin-bottom: 30px;
            max-width: 600px;
            margin: 0 auto;
            min-height: 200px;
            /* Always reserve space - use visibility instead of display */
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }

        .input-area.show {
            visibility: visible;
            opacity: 1;
        }

        .input-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 1px;
        }

        .letter-cells {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .letter-cell {
            width: 50px;
            height: 50px;
            border: 2px solid #222;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
            position: relative;
        }

        .letter-cell:after {
            content: "";
            position: absolute;
            bottom: 5px;
            width: 80%;
            height: 2px;
            background: #222;
        }

        .available-letters {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .letter-btn {
            width: 50px;
            height: 50px;
            border: 1px solid #222;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .letter-btn:not(.used):hover {
            background: #e0e0e0;
        }

        .letter-btn.used {
            background: #ddd;
            color: #888;
            cursor: default;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            background: #fff;
            border: 1px solid #222;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #222;
            color: white;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            padding: 30px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .modal-header h2 {
            font-size: 24px;
            font-weight: 600;
            color: #222;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #222;
        }

        /* Calendar Specific Styles */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }

        .calendar-day {
            text-align: center;
            padding: 5px 0;
            font-weight: bold;
            color: #444;
        }

        .calendar-dates {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-date {
            text-align: center;
            padding: 10px 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .calendar-date:hover {
            background: #f0f0f0;
        }

        .calendar-date.active {
            background: #222;
            color: white;
        }

        .calendar-date.past {
            background: #f5f5f5;
            color: #333;
        }

        .calendar-date.today {
            background: #e0e0e0;
            font-weight: bold;
        }

        .calendar-date.future {
            background: #f9f9f9;
            color: #999;
            cursor: not-allowed;
        }

        .calendar-date.solved:after {
            content: "✓";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 12px;
            color: #2e7d32;
            font-weight: bold;
        }

        .calendar-status {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-top: 15px;
        }

        /* Help Modal Specific Styles */
        .help-content {
            font-size: 16px;
            line-height: 1.6;
            color: #333;
        }

        .help-content h3 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #222;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .help-content ul {
            list-style-type: none;
            padding-left: 20px;
            margin-bottom: 20px;
        }

        .help-content li {
            margin-bottom: 12px;
            position: relative;
            padding-left: 25px;
        }

        .help-content li:before {
            content: "•";
            position: absolute;
            left: 10px;
            font-size: 20px;
            color: #222;
        }

        .help-content p {
            margin-bottom: 15px;
            font-size: 16px;
        }

        .help-content .highlight {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }

        /* Stats Modal Styles */
        .stats-content {
            text-align: center;
            padding: 15px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 25px 0;
        }

        .stat-card {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #222;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 16px;
            color: #666;
        }

        .progress-container {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #4caf50;
            border-radius: 10px;
            transition: width 0.5s;
        }

        .streak-container {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 20px 0;
        }

        .streak-day {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            background: #e0e0e0;
            color: #666;
        }

        .streak-day.active {
            background: #4caf50;
            color: white;
            font-weight: bold;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .stats-table th,
        .stats-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .stats-table th {
            background: #f5f5f5;
            font-weight: 600;
        }

        .stats-table tr:last-child td {
            border-bottom: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Word completion animation */
        @keyframes wordComplete {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
                background: #e8e8e8;
            }

            100% {
                transform: scale(1);
                background: #f5f5f5;
            }
        }

        /* Author completion animation */
        @keyframes authorComplete {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
                background: #e8e8e8;
            }

            100% {
                transform: scale(1);
                background: #f5f5f5;
            }
        }

        /* Puzzle completion animation */
        @keyframes puzzleComplete {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            25% {
                transform: scale(1.02);
                opacity: 0.9;
            }

            50% {
                transform: scale(1.04);
                opacity: 0.8;
            }

            75% {
                transform: scale(1.02);
                opacity: 0.9;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Small celebration animation */
        @keyframes smallCelebration {
            0% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }

            25% {
                transform: scale(1.2) rotate(-2deg);
                opacity: 0.8;
            }

            50% {
                transform: scale(1.3) rotate(2deg);
                opacity: 0.6;
            }

            75% {
                transform: scale(1.1) rotate(-1deg);
                opacity: 0.8;
            }

            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        /* Smooth word reveal */
        @keyframes wordReveal {
            0% {
                opacity: 0;
                transform: translateY(-5px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Animation classes */
        .word-completed {
            animation: wordComplete 0.6s ease-out;
        }

        .author-completed {
            animation: authorComplete 0.6s ease-out;
        }

        .puzzle-completed {
            animation: puzzleComplete 1s ease-out;
        }

        .quote-complete {
            font-weight: bold;
        }

        .quote-complete .quote-text {
            font-weight: 700;
        }

        .quote-complete .author {
            font-weight: 600;
        }

        .small-celebration {
            animation: smallCelebration 0.8s ease-out;
        }

        .word-reveal {
            animation: wordReveal 0.4s ease-out;
        }

        /* Enhanced transitions for PixiJS integration */
        .quote-word, .author {
            transition: all 0.3s ease-out;
        }

        .input-area {
            transition: opacity 0.3s ease-out;
        }

        .letter-cell, .letter-btn {
            transition: all 0.2s ease-out;
        }

        /* Smooth input area content transitions */
        .input-title {
            transition: opacity 0.2s ease-out;
        }

        .letter-cells {
            transition: opacity 0.2s ease-out;
        }

        .available-letters {
            transition: opacity 0.2s ease-out;
        }

        /* Prevent flashing during transitions */
        .input-area * {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        /* Ensure content is only visible when properly positioned */
        .input-area.transitioning .input-title,
        .input-area.transitioning .letter-cells,
        .input-area.transitioning .available-letters {
            visibility: hidden !important;
            opacity: 0 !important;
        }

        /* Smooth transitions for all input elements */
        .input-title, .letter-cells, .available-letters {
            transition: opacity 0.2s ease-out, visibility 0.2s ease-out;
        }

        @media (max-width: 650px) {
            .newspaper-container {
                padding: 20px;
            }

            .newspaper-title {
                font-size: 32px;
            }

            .quote-text {
                font-size: 20px;
                padding: 0 10px;
            }

            .letter-btn,
            .letter-cell {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .help-content li {
                padding-left: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="newspaper-container">
        <div class="header">
            <div class="newspaper-title">Daily Quote Puzzle</div>
            <div class="date-line" id="dateLine">Thursday, July 24, 2025</div>

            <div class="header-icons">
                <div class="header-icon stats-icon" id="statsIcon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <div class="header-icon calendar-icon" id="calendarIcon">
                    <i class="fas fa-calendar"></i>
                </div>
                <div class="header-icon help-icon" id="helpIcon">
                    <i class="fas fa-question"></i>
                </div>
            </div>
        </div>

        <div class="quote-container">
            <div class="quote-text" id="quoteText"></div>
            <div class="author" id="quoteAuthor"></div>
        </div>

        <div class="congrats" id="congrats">
            <h2>Puzzle Complete!</h2>
            <p>You've successfully solved today's quote puzzle!</p>
        </div>

        <div class="input-area" id="inputArea">
            <div class="input-title" id="inputTitle">Unscramble Word</div>
            <div class="letter-cells" id="letterCells"></div>
            <div class="available-letters" id="availableLetters"></div>

            <div class="controls">
                <button class="btn" id="resetBtn">
                    <i class="fas fa-redo"></i> Reset
                </button>
                <button class="btn" id="backspaceBtn">
                    <i class="fas fa-backspace"></i> Backspace
                </button>
            </div>
        </div>
    </div>

    <!-- Calendar Modal -->
    <div class="modal" id="calendarModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Past Challenges</h2>
                <button class="close-modal" id="closeCalendar">&times;</button>
            </div>
            <div class="calendar-grid">
                <div class="calendar-day">Sun</div>
                <div class="calendar-day">Mon</div>
                <div class="calendar-day">Tue</div>
                <div class="calendar-day">Wed</div>
                <div class="calendar-day">Thu</div>
                <div class="calendar-day">Fri</div>
                <div class="calendar-day">Sat</div>
            </div>
            <div class="calendar-dates" id="calendarDates">
                <!-- Dates will be populated by JavaScript -->
            </div>
            <div class="calendar-status" id="calendarStatus">
                Select a date to play that day's challenge
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>How to Play</h2>
                <button class="close-modal" id="closeHelp">&times;</button>
            </div>
            <div class="help-content">
                <p>Unscramble the words in the daily quote to reveal the inspirational message!</p>

                <ul>
                    <li><span class="highlight">Click on scrambled words</span> to start unscrambling them</li>
                    <li><span class="highlight">Click letters</span> or <span class="highlight">type on keyboard</span>
                        to spell the word</li>
                    <li>Use <span class="highlight">Backspace</span> to remove letters and <span
                            class="highlight">Reset</span> to clear</li>
                    <li>Don't forget to <span class="highlight">unscramble the author's name</span> at the bottom</li>
                </ul>

                <p>Come back daily for a new challenging quote to unscramble!</p>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Your Puzzle Stats</h2>
                <button class="close-modal" id="closeStats">&times;</button>
            </div>
            <div class="stats-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalSolved">0</div>
                        <div class="stat-label">Puzzles Solved</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="currentStreak">0</div>
                        <div class="stat-label">Current Streak</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="successRate">0%</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgTime">0s</div>
                        <div class="stat-label">Average Time</div>
                    </div>
                </div>


            </div>
        </div>
    </div>

    <!-- Load quotes from external file -->
    <script src="quotes_calendar.js"></script>

    <script>
        // Load quotes from external calendar file
        const quotes = quotesCalendar;

        // Simple animation system
        let animationQueue = [];

        // Smooth word completion animation with CSS
        function animateWordCompletion(wordElement, newText) {
            // Add celebration animation
            wordElement.classList.add('small-celebration');
            
            // After celebration, smoothly reveal the correct word
            setTimeout(() => {
                wordElement.textContent = newText;
                wordElement.className = 'quote-word word-reveal';
                wordElement.removeAttribute('data-word-index');
                
                // Clean up animation class
                setTimeout(() => {
                    wordElement.classList.remove('word-reveal');
                }, 400);
            }, 400);
            
            // Clean up celebration class
            setTimeout(() => {
                wordElement.classList.remove('small-celebration');
            }, 800);
        }

        // Smooth author completion animation with CSS
        function animateAuthorCompletion(authorElement, newText) {
            // Add celebration animation
            authorElement.classList.add('small-celebration');
            
            // After celebration, smoothly reveal the correct author
            setTimeout(() => {
                authorElement.textContent = newText;
                authorElement.className = 'author word-reveal';
                
                // Clean up animation class
                setTimeout(() => {
                    authorElement.classList.remove('word-reveal');
                }, 400);
            }, 400);
            
            // Clean up celebration class
            setTimeout(() => {
                authorElement.classList.remove('small-celebration');
            }, 800);
        }



        // Smooth input area transition without DOM rebuilding
        function smoothInputTransition() {
            // Ensure input area is visible without rebuilding
            if (!inputAreaEl.classList.contains('show')) {
                inputAreaEl.classList.add('show');
            }

            // Update title smoothly
            inputTitleEl.textContent = activeWord.isAuthor ? 'Unscramble Author' : 'Unscramble Word';
            
            // Update letter cells without rebuilding if possible
            const targetLength = activeWord.original.length;
            const currentCells = letterCellsEl.children.length;
            
            if (currentCells !== targetLength) {
                // Only rebuild if absolutely necessary
                letterCellsEl.innerHTML = '';
                for (let i = 0; i < targetLength; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'letter-cell';
                    letterCellsEl.appendChild(cell);
                }
            } else {
                // Just clear existing cells without rebuilding
                Array.from(letterCellsEl.children).forEach(cell => {
                    cell.textContent = '';
                });
            }

            // Update available letters without innerHTML clearing
            const currentButtons = availableLettersEl.children.length;
            const neededButtons = availableLetters.length;
            
            if (currentButtons !== neededButtons) {
                // Only rebuild if different number of letters
                availableLettersEl.innerHTML = '';
                availableLetters.forEach((letter, index) => {
                    const btn = document.createElement('div');
                    btn.className = 'letter-btn';
                    btn.textContent = letter;
                    btn.dataset.index = index;
                    btn.addEventListener('click', () => handleLetterClick(letter, index));
                    availableLettersEl.appendChild(btn);
                });
            } else {
                // Just update existing buttons
                Array.from(availableLettersEl.children).forEach((btn, index) => {
                    btn.textContent = availableLetters[index];
                    btn.className = 'letter-btn';
                    btn.dataset.index = index;
                    // Remove old event listeners and add new ones
                    const newBtn = btn.cloneNode(true);
                    newBtn.addEventListener('click', () => handleLetterClick(availableLetters[index], index));
                    btn.parentNode.replaceChild(newBtn, btn);
                });
            }
        }

        // Game state
        let currentQuote = quotes[0];
        let activeWord = null;
        let solvedWords = new Set();
        let authorSolved = false;
        let userInput = '';
        let availableLetters = [];
        let usedLetters = [];
        let gameComplete = false;
        let startTime = null;
        let endTime = null;
        let gameTime = 0;

        // DOM Elements
        const quoteTextEl = document.getElementById('quoteText');
        const quoteAuthorEl = document.getElementById('quoteAuthor');
        const congratsEl = document.getElementById('congrats');
        const inputAreaEl = document.getElementById('inputArea');
        const inputTitleEl = document.getElementById('inputTitle');
        const letterCellsEl = document.getElementById('letterCells');
        const availableLettersEl = document.getElementById('availableLetters');
        const resetBtnEl = document.getElementById('resetBtn');
        const backspaceBtnEl = document.getElementById('backspaceBtn');
        const helpIconEl = document.getElementById('helpIcon');
        const calendarIconEl = document.getElementById('calendarIcon');
        const statsIconEl = document.getElementById('statsIcon');
        const calendarModalEl = document.getElementById('calendarModal');
        const closeCalendarEl = document.getElementById('closeCalendar');
        const calendarDatesEl = document.getElementById('calendarDates');
        const dateLineEl = document.getElementById('dateLine');
        const calendarStatusEl = document.getElementById('calendarStatus');
        const helpModalEl = document.getElementById('helpModal');
        const closeHelpEl = document.getElementById('closeHelp');
        const statsModalEl = document.getElementById('statsModal');
        const closeStatsEl = document.getElementById('closeStats');
        const totalSolvedEl = document.getElementById('totalSolved');
        const currentStreakEl = document.getElementById('currentStreak');
        const successRateEl = document.getElementById('successRate');
        const avgTimeEl = document.getElementById('avgTime');

        // Initialize game
        function initGame() {
            startTime = new Date();
            loadUserData();
            renderQuote();
            updateDateDisplay();
            
            // Initialize input area to maintain container size
            renderInputArea();

            // Add event listeners
            resetBtnEl.addEventListener('click', resetInput);
            backspaceBtnEl.addEventListener('click', handleBackspace);
            window.addEventListener('keydown', handleKeyDown);

            // Calendar functionality
            calendarIconEl.addEventListener('click', () => {
                calendarModalEl.style.display = 'flex';
                renderCalendar();
            });

            closeCalendarEl.addEventListener('click', () => {
                calendarModalEl.style.display = 'none';
            });

            // Help functionality
            helpIconEl.addEventListener('click', () => {
                helpModalEl.style.display = 'flex';
            });

            closeHelpEl.addEventListener('click', () => {
                helpModalEl.style.display = 'none';
            });

            // Stats functionality
            statsIconEl.addEventListener('click', () => {
                updateStatsDisplay();
                statsModalEl.style.display = 'flex';
            });

            closeStatsEl.addEventListener('click', () => {
                statsModalEl.style.display = 'none';
            });

            // Close modals when clicking outside
            document.addEventListener('click', (e) => {
                if (e.target === calendarModalEl) {
                    calendarModalEl.style.display = 'none';
                }
                if (e.target === helpModalEl) {
                    helpModalEl.style.display = 'none';
                }
                if (e.target === statsModalEl) {
                    statsModalEl.style.display = 'none';
                }
            });

            // Activate the first word automatically
            if (currentQuote.scrambledWords.length > 0) {
                setTimeout(() => {
                    handleWordClick(currentQuote.scrambledWords[0]);
                }, 500);
            }
        }

        // User data management
        function loadUserData() {
            const userData = JSON.parse(localStorage.getItem('quotePuzzleUserData')) || {
                puzzles: {},
                stats: {
                    totalSolved: 0,
                    currentStreak: 0,
                    maxStreak: 0,
                    totalTime: 0,
                    lastPlayed: null
                }
            };
            return userData;
        }

        function saveUserData(userData) {
            localStorage.setItem('quotePuzzleUserData', JSON.stringify(userData));
        }

        function recordPuzzleCompletion() {
            const userData = loadUserData();
            const dateStr = currentQuote.date;
            endTime = new Date();
            gameTime = Math.floor((endTime - startTime) / 1000); // in seconds

            // Update puzzle completion
            userData.puzzles[dateStr] = {
                solved: true,
                time: gameTime,
                date: dateStr
            };

            // Update stats
            userData.stats.totalSolved = Object.values(userData.puzzles).filter(p => p.solved).length;

            // Update streak
            const today = new Date(dateStr);
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = formatDate(yesterday);

            if (userData.puzzles[yesterdayStr]?.solved) {
                userData.stats.currentStreak++;
            } else {
                // Reset streak if not consecutive
                userData.stats.currentStreak = 1;
            }

            // Update max streak
            if (userData.stats.currentStreak > userData.stats.maxStreak) {
                userData.stats.maxStreak = userData.stats.currentStreak;
            }

            // Update total time
            userData.stats.totalTime += gameTime;

            // Update last played
            userData.stats.lastPlayed = dateStr;

            saveUserData(userData);
        }

        function updateStatsDisplay() {
            const userData = loadUserData();
            const stats = userData.stats;
            const puzzles = Object.values(userData.puzzles);

            // Update stats values
            totalSolvedEl.textContent = stats.totalSolved;
            currentStreakEl.textContent = stats.currentStreak;

            // Calculate success rate
            const totalPlayed = Object.keys(userData.puzzles).length;
            const successRate = totalPlayed > 0 ? Math.round((stats.totalSolved / totalPlayed) * 100) : 0;
            successRateEl.textContent = `${successRate}%`;

            // Calculate average time
            const avgTime = stats.totalSolved > 0 ? Math.round(stats.totalTime / stats.totalSolved) : 0;
            avgTimeEl.textContent = `${avgTime}s`;


        }

        // Update date display
        function updateDateDisplay() {
            const date = new Date(currentQuote.date);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            dateLineEl.textContent = date.toLocaleDateString('en-US', options);
        }

        // Render calendar
        function renderCalendar() {
            calendarDatesEl.innerHTML = '';

            // Get current date
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const userData = loadUserData();

            // Generate past week (7 days including today)
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(today.getDate() - i);
                const dateStr = formatDate(date);

                // Find if there's a quote for this date
                const quoteForDate = quotes.find(q => q.date === dateStr);
                const isSolved = userData.puzzles[dateStr]?.solved;

                const dateEl = document.createElement('div');
                dateEl.className = `calendar-date ${isSolved ? 'solved' : ''}`;
                dateEl.textContent = date.getDate();
                dateEl.dataset.date = dateStr;

                // Add classes based on date
                if (i === 0) {
                    dateEl.classList.add('today');
                    dateEl.classList.add('active');
                } else {
                    dateEl.classList.add('past');
                }

                // Add click event
                if (quoteForDate && !isSolved) {
                    dateEl.addEventListener('click', () => {
                        loadChallengeForDate(dateStr);
                        calendarModalEl.style.display = 'none';
                    });
                } else if (isSolved) {
                    dateEl.style.cursor = 'default';
                    dateEl.title = "You've already solved this puzzle";
                }

                calendarDatesEl.appendChild(dateEl);
            }
        }

        // Format date as YYYY-MM-DD
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Load challenge for a specific date
        function loadChallengeForDate(dateStr) {
            const quote = quotes.find(q => q.date === dateStr);
            if (quote) {
                currentQuote = quote;
                solvedWords = new Set();
                authorSolved = false;
                activeWord = null;
                userInput = '';
                availableLetters = [];
                usedLetters = [];
                gameComplete = false;
                startTime = new Date();

                congratsEl.classList.remove('show');
                renderQuote();
                updateDateDisplay();
                renderInputArea();

                // Activate the first word
                if (currentQuote.scrambledWords.length > 0) {
                    setTimeout(() => {
                        handleWordClick(currentQuote.scrambledWords[0]);
                    }, 300);
                }
            }
        }

        // Render the quote with scrambled words
        function renderQuote() {
            const words = currentQuote.text.split(' ');
            let html = '';

            words.forEach((word, index) => {
                const scrambledWord = currentQuote.scrambledWords.find(sw => sw.index === index);
                const isSolved = scrambledWord && solvedWords.has(scrambledWord.original);

                if (scrambledWord && !isSolved) {
                    const isActive = activeWord && activeWord.original === scrambledWord.original;
                    html += `<span class="quote-word scrambled ${isActive ? 'active' : ''}" 
                                data-word-index="${index}">${scrambledWord.scrambled}</span> `;
                } else {
                    html += `<span class="quote-word">${isSolved ? scrambledWord.original : word}</span> `;
                }
            });

            quoteTextEl.innerHTML = html;

            // Add click listeners to scrambled words
            document.querySelectorAll('.quote-word.scrambled').forEach(el => {
                el.addEventListener('click', () => handleWordClick(
                    currentQuote.scrambledWords.find(sw => sw.index === parseInt(el.dataset.wordIndex))
                ));
            });

            // Render author
            if (authorSolved) {
                quoteAuthorEl.textContent = `- ${currentQuote.author}`;
                quoteAuthorEl.className = 'author';
            } else {
                const isActive = activeWord && activeWord.isAuthor;
                quoteAuthorEl.innerHTML = `<span class="author scrambled ${isActive ? 'active' : ''}" 
                                                id="authorScrambled">${currentQuote.scrambledAuthor}</span>`;
                document.getElementById('authorScrambled').addEventListener('click', handleAuthorClick);
            }
        }

        // Handle word click
        function handleWordClick(wordData) {
            if (solvedWords.has(wordData.original)) return;

            // Remove active class from previously active word
            document.querySelectorAll('.quote-word.active').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.author.active').forEach(el => {
                el.classList.remove('active');
            });

            // Add active class to clicked word
            const wordElements = document.querySelectorAll('.quote-word');
            const targetWordEl = Array.from(wordElements).find(el =>
                el.dataset.wordIndex == wordData.index
            );
            if (targetWordEl) {
                targetWordEl.classList.add('active');
            }

            activeWord = wordData;
            userInput = '';
            availableLetters = wordData.scrambled.split('');
            usedLetters = [];

            renderInputArea();
        }

        // Handle author click
        function handleAuthorClick() {
            if (authorSolved) return;

            // Remove active class from previously active elements
            document.querySelectorAll('.quote-word.active').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.author.active').forEach(el => {
                el.classList.remove('active');
            });

            // Add active class to author
            const authorEl = document.querySelector('.author.scrambled');
            if (authorEl) {
                authorEl.classList.add('active');
            }

            activeWord = {
                original: currentQuote.author.toLowerCase(),
                scrambled: currentQuote.scrambledAuthor,
                isAuthor: true
            };

            userInput = '';
            availableLetters = currentQuote.scrambledAuthor.split('');
            usedLetters = [];

            renderInputArea();
        }

        // Render input area
        function renderInputArea() {
            // Always show input area to maintain container size
            inputAreaEl.classList.add('show');
            
            if (!activeWord) {
                // Auto-select first available word if none is active
                const firstWord = currentQuote.scrambledWords.find(word => !solvedWords.has(word.original));
                if (firstWord) {
                    setTimeout(() => handleWordClick(firstWord), 100);
                } else if (!authorSolved) {
                    setTimeout(() => handleAuthorClick(), 100);
                }
                return;
            }
            inputTitleEl.textContent = activeWord.isAuthor
                ? 'Unscramble Author'
                : 'Unscramble Word';

            // Render letter cells
            const targetLength = activeWord.original.length;
            letterCellsEl.innerHTML = '';

            for (let i = 0; i < targetLength; i++) {
                const cell = document.createElement('div');
                cell.className = 'letter-cell';
                cell.textContent = userInput[i] || '';
                letterCellsEl.appendChild(cell);
            }

            // Render available letters
            availableLettersEl.innerHTML = '';

            availableLetters.forEach((letter, index) => {
                const btn = document.createElement('div');
                btn.className = `letter-btn ${usedLetters.includes(index) ? 'used' : ''}`;
                btn.textContent = letter;
                btn.dataset.index = index;

                if (!usedLetters.includes(index)) {
                    btn.addEventListener('click', () => handleLetterClick(letter, index));
                }

                availableLettersEl.appendChild(btn);
            });
        }

        // Handle letter click
        function handleLetterClick(letter, index) {
            if (usedLetters.includes(index)) return;

            userInput += letter;
            usedLetters = [...usedLetters, index];

            renderInputArea();

            // Check if word is complete
            if (userInput.length === activeWord.original.length) {
                const inputWord = userInput.toLowerCase();
                const targetWord = activeWord.original.toLowerCase();

                if (inputWord === targetWord) {
                    // Correct!
                    if (activeWord.isAuthor) {
                        authorSolved = true;
                        updateAuthorDisplay();
                    } else {
                        solvedWords.add(activeWord.original);
                        updateWordDisplay(activeWord);
                    }

                    // Auto-activate next word smoothly after celebration
                    setTimeout(() => {
                        activateNextWordSmoothly();
                    }, 1200);
                } else {
                    // Wrong - reset after delay
                    setTimeout(() => {
                        resetInput();
                    }, 1000);
                }
            }
        }

        // Update individual word display smoothly with PixiJS
        function updateWordDisplay(wordData) {
            const wordElements = document.querySelectorAll('.quote-word');
            const targetWordEl = Array.from(wordElements).find(el =>
                el.dataset.wordIndex == wordData.index
            );

            if (targetWordEl) {
                // Use PixiJS for smooth animation
                animateWordCompletion(targetWordEl, wordData.original);
            }
        }

        // Update author display smoothly with PixiJS
        function updateAuthorDisplay() {
            const authorEl = document.getElementById('quoteAuthor');
            
            // Use PixiJS for smooth animation
            animateAuthorCompletion(authorEl, `- ${currentQuote.author}`);
        }

        // Smooth activation of next word without full refresh
        function activateNextWordSmooth() {
            // Clear current input
            activeWord = null;
            userInput = '';
            availableLetters = [];
            usedLetters = [];
            renderInputArea();

            // Check if game is complete
            if (solvedWords.size === currentQuote.scrambledWords.length && authorSolved) {
                gameComplete = true;
                congratsEl.classList.add('show');

                // Trigger puzzle completion animation and add bolding effect
                const quoteContainer = document.querySelector('.quote-container');
                quoteContainer.classList.add('puzzle-completed', 'quote-complete');
                setTimeout(() => {
                    quoteContainer.classList.remove('puzzle-completed');
                }, 1000);

                recordPuzzleCompletion();
                return;
            }

            // Try to find next unsolved word smoothly
            if (!authorSolved && solvedWords.size === currentQuote.scrambledWords.length) {
                // Activate author smoothly without DOM refresh
                setTimeout(() => {
                    activateAuthorSmoothly();
                }, 300);
            } else {
                // Find next unsolved word and activate smoothly
                for (const word of currentQuote.scrambledWords) {
                    if (!solvedWords.has(word.original)) {
                        setTimeout(() => {
                            activateWordSmoothly(word);
                        }, 300);
                        return;
                    }
                }
            }
        }

        // Clear input area after word completion without auto-activating next word
        function clearInputAfterCompletion() {
            // Remove active class from completed word
            document.querySelectorAll('.quote-word.active, .author.active').forEach(el => {
                el.classList.remove('active');
            });

            // Clear current input
            activeWord = null;
            userInput = '';
            availableLetters = [];
            usedLetters = [];
            renderInputArea();

            // Check if game is complete
            if (solvedWords.size === currentQuote.scrambledWords.length && authorSolved) {
                gameComplete = true;
                congratsEl.classList.add('show');

                // Trigger puzzle completion animation and add bolding effect
                const quoteContainer = document.querySelector('.quote-container');
                quoteContainer.classList.add('puzzle-completed', 'quote-complete');
                setTimeout(() => {
                    quoteContainer.classList.remove('puzzle-completed');
                }, 1000);

                recordPuzzleCompletion();
            }
        }

        // Activate next word smoothly with auto-progression
        function activateNextWordSmoothly() {
            // Remove active class from completed word
            document.querySelectorAll('.quote-word.active, .author.active').forEach(el => {
                el.classList.remove('active');
            });

            // Clear current input
            activeWord = null;
            userInput = '';
            availableLetters = [];
            usedLetters = [];
            renderInputArea();

            // Check if game is complete
            if (solvedWords.size === currentQuote.scrambledWords.length && authorSolved) {
                gameComplete = true;
                congratsEl.classList.add('show');

                // Trigger puzzle completion animation and add bolding effect
                const quoteContainer = document.querySelector('.quote-container');
                quoteContainer.classList.add('puzzle-completed', 'quote-complete');
                setTimeout(() => {
                    quoteContainer.classList.remove('puzzle-completed');
                }, 1000);

                recordPuzzleCompletion();
                return;
            }

            // Auto-activate next unsolved word smoothly
            if (!authorSolved && solvedWords.size === currentQuote.scrambledWords.length) {
                // Activate author smoothly without DOM refresh
                setTimeout(() => {
                    activateAuthorSmoothly();
                }, 300);
            } else {
                // Find next unsolved word and activate smoothly
                for (const word of currentQuote.scrambledWords) {
                    if (!solvedWords.has(word.original)) {
                        setTimeout(() => {
                            activateWordSmoothly(word);
                        }, 300);
                        return;
                    }
                }
            }
        }

        // Keep original function for compatibility
        function activateNextWord() {
            activateNextWordSmooth();
        }

        // Handle keyboard input
        function handleKeyDown(event) {
            if (!activeWord || availableLetters.length === 0) return;

            // Backspace handling
            if (event.key === 'Backspace') {
                handleBackspace();
                return;
            }

            // Only process letter keys
            if (event.key.length !== 1) return;

            const key = event.key.toLowerCase();
            const availableIndex = availableLetters.findIndex((letter, index) =>
                letter.toLowerCase() === key && !usedLetters.includes(index)
            );

            if (availableIndex !== -1) {
                handleLetterClick(availableLetters[availableIndex], availableIndex);
            }
        }

        // Handle backspace
        function handleBackspace() {
            if (!activeWord || userInput.length === 0) return;

            // Remove last character from user input
            userInput = userInput.slice(0, -1);

            // Remove last index from usedLetters
            usedLetters = usedLetters.slice(0, -1);

            renderInputArea();
        }

        // Reset input
        function resetInput() {
            userInput = '';
            usedLetters = [];
            renderInputArea();
        }

        // Update input area with minimal DOM changes
        function updateInputAreaSmoothly() {
            if (!activeWord) {
                inputAreaEl.classList.remove('show');
                return;
            }

            // Show input area if hidden
            if (!inputAreaEl.classList.contains('show')) {
                inputAreaEl.classList.add('show');
            }

            // Update title only if different
            const newTitle = activeWord.isAuthor ? 'Unscramble Author' : 'Unscramble Word';
            if (inputTitleEl.textContent !== newTitle) {
                inputTitleEl.textContent = newTitle;
            }

            // Update letter cells with minimal changes
            const targetLength = activeWord.original.length;
            const currentCells = letterCellsEl.children.length;

            if (currentCells !== targetLength) {
                // Only rebuild if absolutely necessary
                const fragment = document.createDocumentFragment();
                for (let i = 0; i < targetLength; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'letter-cell';
                    fragment.appendChild(cell);
                }
                letterCellsEl.innerHTML = '';
                letterCellsEl.appendChild(fragment);
            } else {
                // Just clear existing cells
                Array.from(letterCellsEl.children).forEach(cell => {
                    cell.textContent = '';
                });
            }

            // Update available letters with minimal DOM manipulation
            const fragment = document.createDocumentFragment();
            availableLetters.forEach((letter, index) => {
                const btn = document.createElement('div');
                btn.className = 'letter-btn';
                btn.textContent = letter;
                btn.dataset.index = index;
                btn.addEventListener('click', () => handleLetterClick(letter, index));
                fragment.appendChild(btn);
            });

            // Replace all at once to minimize reflow
            availableLettersEl.innerHTML = '';
            availableLettersEl.appendChild(fragment);
        }

        // Smooth word activation without container resizing
        function activateWordSmoothly(wordData) {
            if (solvedWords.has(wordData.original)) return;

            // Set game state
            activeWord = wordData;
            userInput = '';
            availableLetters = wordData.scrambled.split('');
            usedLetters = [];

            // Use simple renderInputArea
            renderInputArea();

            // Find and activate only the specific word element
            const wordElements = document.querySelectorAll('.quote-word.scrambled');
            const targetWordEl = Array.from(wordElements).find(el =>
                el.dataset.wordIndex == wordData.index
            );

            // Remove active from all elements first
            document.querySelectorAll('.quote-word.active, .author.active').forEach(el => {
                el.classList.remove('active');
            });

            // Add active to target word
            if (targetWordEl) {
                targetWordEl.classList.add('active');
            }
        }

        // Smooth author activation without container resizing
        function activateAuthorSmoothly() {
            if (authorSolved) return;

            // Set game state
            activeWord = {
                original: currentQuote.author.toLowerCase(),
                scrambled: currentQuote.scrambledAuthor,
                isAuthor: true
            };

            userInput = '';
            availableLetters = currentQuote.scrambledAuthor.split('');
            usedLetters = [];

            // Use simple renderInputArea
            renderInputArea();

            // Remove active from all elements first
            document.querySelectorAll('.quote-word.active, .author.active').forEach(el => {
                el.classList.remove('active');
            });

            // Add active to author element
            const authorEl = document.querySelector('.author.scrambled');
            if (authorEl) {
                authorEl.classList.add('active');
            }
        }

        // Initialize the game when page loads
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>

</html>