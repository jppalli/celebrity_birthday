<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Morph Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            padding: 20px;
            width: 100%;
            max-width: 800px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2.5rem;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .subtitle {
            text-align: center;
            margin-bottom: 20px;
            opacity: 0.8;
        }
        
        .status {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .game-area {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
        }
        
        .word-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .word-box {
            background: #4a90e2;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 24px;
            font-weight: bold;
        }
        
        .grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .row {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .cell {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .cell.filled {
            background: #4a90e2;
        }
        
        .cell.correct {
            background: #4CAF50;
        }
        
        .cell.incorrect {
            background: #f44336;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .keyboard {
            margin-top: 20px;
        }
        
        .keyboard-row {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 5px;
        }
        
        .key {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 5px;
            padding: 10px;
            min-width: 30px;
            text-align: center;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
        }
        
        .key:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .key:active {
            transform: translateY(1px);
        }
        
        .key.enter {
            background: #4CAF50;
            min-width: 70px;
        }
        
        .key.delete {
            background: #f44336;
            min-width: 70px;
        }
        
        .counter-dots {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .counter-dot {
            width: 15px;
            height: 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
        }
        
        .counter-dot.active {
            background: #4CAF50;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        button:hover {
            background: #357abD;
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .hint-panel {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .hint-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .game-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1.1rem;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .win-message {
            background: rgba(76, 175, 80, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            z-index: 100;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            animation: fall 3s linear forwards;
            z-index: 1000;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-sync-alt"></i> WORD MORPH</h1>
        <div class="subtitle">Transform one word into another, changing one letter at a time</div>
        
        <div class="status" id="status">Initializing game...</div>
        <div class="status" id="sdk-status"></div>
        
        <div class="game-area" id="game-area">
            <div class="word-display">
                <div class="word-box" id="start-word">ROCK</div>
                <div class="arrow">â†’</div>
                <div class="word-box" id="target-word">SAND</div>
            </div>
            
            <div class="counter-dots" id="counter-dots">
                <div class="counter-dot"></div>
                <div class="counter-dot"></div>
                <div class="counter-dot"></div>
            </div>
            
            <div class="grid" id="game-grid">
                <!-- Grid will be generated by JavaScript -->
            </div>
            
            <div class="keyboard" id="keyboard">
                <!-- Keyboard will be generated by JavaScript -->
            </div>
            
            <div class="controls">
                <button id="reset-btn"><i class="fas fa-redo"></i> RESET</button>
                <button id="letter-hint-btn"><i class="fas fa-search"></i> LETTER HINT</button>
                <button id="definition-hint-btn"><i class="fas fa-book"></i> DEFINITION</button>
            </div>
            
            <div class="hint-panel" id="hint-panel">
                <div class="hint-title">Hint:</div>
                <div id="hint-text">Change one letter at a time.</div>
            </div>
        </div>
    </div>

    <script src="https://developers.arkadium.com/cdn/sdk/v2/sdk.js"></script>
    <script>
        (async function() {
            // DOM Elements
            const statusEl = document.getElementById('status');
            const sdkStatusEl = document.getElementById('sdk-status');
            const startWordEl = document.getElementById('start-word');
            const targetWordEl = document.getElementById('target-word');
            const gameGridEl = document.getElementById('game-grid');
            const keyboardEl = document.getElementById('keyboard');
            const counterDotsEl = document.getElementById('counter-dots');
            const resetBtn = document.getElementById('reset-btn');
            const letterHintBtn = document.getElementById('letter-hint-btn');
            const definitionHintBtn = document.getElementById('definition-hint-btn');
            const hintPanel = document.getElementById('hint-panel');
            const hintText = document.getElementById('hint-text');
            
            // Helper functions
            function updateStatus(message) {
                statusEl.textContent = message;
                console.log(message);
            }
            
            function updateSDKStatus(message) {
                sdkStatusEl.textContent = message;
                console.log('SDK: ' + message);
            }
            
            // Game data
            const challenge = {
                start: 'ROCK',
                target: 'SAND',
                optimal: 3,
                validWords: ['ROCK', 'SOCK', 'SACK', 'SAND'],
                solution: ['ROCK', 'SOCK', 'SACK', 'SAND']
            };
            
            // Word definitions
            const wordDefinitions = {
                'ROCK': 'A solid mineral material',
                'SOCK': 'A garment worn on the foot',
                'SACK': 'A large bag made of strong material',
                'SAND': 'Loose granular substance found on beaches'
            };
            
            // Game state
            let gameState = {
                currentRow: 2, // Start from row 2 (row 1 has the start word)
                currentCell: 0,
                gameWon: false,
                gameOver: false,
                grid: []
            };
            
            // Initialize Arkadium SDK
            updateStatus('Initializing game...');
            let sdk = null;
            
            try {
                updateStatus('Checking for Arkadium SDK...');
                
                // Wait for SDK to be available
                let attempts = 0;
                while (!window.ArkadiumGameSDK && attempts < 10) {
                    updateStatus(`Waiting for SDK (${attempts + 1}/10)...`);
                    await new Promise(resolve => setTimeout(resolve, 500));
                    attempts++;
                }
                
                if (!window.ArkadiumGameSDK) {
                    throw new Error('Arkadium SDK not available');
                }
                
                updateStatus('SDK found, initializing...');
                sdk = await window.ArkadiumGameSDK.getInstance();
                updateSDKStatus(`SDK initialized (env: ${sdk.env || 'unknown'})`);
                
                // Enable debug mode
                if (sdk.debugMode) {
                    sdk.debugMode(true);
                    updateSDKStatus('Debug mode enabled');
                }
                
                // CRITICAL: Signal game is loading first
                updateSDKStatus('Sending onLoading signal...');
                if (sdk.lifecycle && sdk.lifecycle.onLoading) {
                    sdk.lifecycle.onLoading();
                }
                
                // Store SDK reference globally
                window.gameSDK = sdk;
                
            } catch (e) {
                updateStatus(`Error: ${e.message}`);
                console.error('SDK initialization error:', e);
            }
            
            // Create game grid
            function createGrid() {
                gameGridEl.innerHTML = '';
                gameState.grid = [];
                
                const maxAttempts = 4; // Start word + 3 attempts
                
                for (let row = 0; row < maxAttempts; row++) {
                    const rowElement = document.createElement('div');
                    rowElement.className = 'row';
                    rowElement.id = `row-${row + 1}`;
                    
                    const rowData = [];
                    
                    for (let col = 0; col < 4; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'cell';
                        cell.id = `cell-${row + 1}-${col + 1}`;
                        cell.addEventListener('click', () => selectCell(row + 1, col + 1));
                        rowElement.appendChild(cell);
                        rowData.push('');
                    }
                    
                    gameGridEl.appendChild(rowElement);
                    gameState.grid.push(rowData);
                }
                
                // Set first row as the start word
                const startWordLetters = challenge.start.split('');
                startWordLetters.forEach((letter, index) => {
                    const cell = document.getElementById(`cell-1-${index + 1}`);
                    cell.textContent = letter;
                    cell.classList.add('filled', 'correct');
                    gameState.grid[0][index] = letter;
                });
            }
            
            // Create keyboard
            function createKeyboard() {
                keyboardEl.innerHTML = '';
                
                const rows = [
                    ['Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],
                    ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L'],
                    ['ENTER', 'Z', 'X', 'C', 'V', 'B', 'N', 'M', 'DELETE']
                ];
                
                rows.forEach(row => {
                    const rowElement = document.createElement('div');
                    rowElement.className = 'keyboard-row';
                    
                    row.forEach(key => {
                        const keyElement = document.createElement('div');
                        keyElement.className = 'key';
                        keyElement.textContent = key;
                        
                        if (key === 'ENTER') {
                            keyElement.classList.add('enter');
                        } else if (key === 'DELETE') {
                            keyElement.classList.add('delete');
                        }
                        
                        keyElement.addEventListener('click', () => handleKeyClick(key));
                        rowElement.appendChild(keyElement);
                    });
                    
                    keyboardEl.appendChild(rowElement);
                });
            }
            
            // Handle key clicks
            function handleKeyClick(key) {
                if (gameState.gameOver) return;
                
                if (key === 'ENTER') {
                    submitAttempt();
                } else if (key === 'DELETE') {
                    deleteLetter();
                } else {
                    addLetter(key);
                }
            }
            
            // Add letter to current cell
            function addLetter(letter) {
                if (gameState.currentCell >= 4) return;
                
                const cell = document.getElementById(`cell-${gameState.currentRow}-${gameState.currentCell + 1}`);
                cell.textContent = letter;
                cell.classList.add('filled');
                
                gameState.grid[gameState.currentRow - 1][gameState.currentCell] = letter;
                gameState.currentCell++;
            }
            
            // Delete letter from current cell
            function deleteLetter() {
                if (gameState.currentCell <= 0) return;
                
                gameState.currentCell--;
                const cell = document.getElementById(`cell-${gameState.currentRow}-${gameState.currentCell + 1}`);
                cell.textContent = '';
                cell.classList.remove('filled');
                
                gameState.grid[gameState.currentRow - 1][gameState.currentCell] = '';
            }
            
            // Select a specific cell
            function selectCell(row, col) {
                if (row !== gameState.currentRow || gameState.gameOver) return;
                gameState.currentCell = col - 1;
            }
            
            // Submit current attempt
            function submitAttempt() {
                if (gameState.gameOver) return;
                
                const currentWord = gameState.grid[gameState.currentRow - 1].join('');
                
                if (currentWord.length !== 4) {
                    showMessage('Word must be 4 letters long!');
                    return;
                }
                
                // Check if word is valid
                if (!challenge.validWords.includes(currentWord)) {
                    showMessage('Not a valid word!');
                    animateInvalidWord();
                    return;
                }
                
                // Check if it's only one letter different from previous word
                const previousWord = gameState.currentRow === 2 ?
                    challenge.start :
                    gameState.grid[gameState.currentRow - 2].join('');
                
                if (!isOneLetterDifferent(previousWord, currentWord)) {
                    showMessage('Word must differ by exactly one letter!');
                    animateInvalidWord();
                    return;
                }
                
                // Mark word as valid
                animateValidWord();
                
                // Check if target reached
                if (currentWord === challenge.target) {
                    gameState.gameWon = true;
                    gameState.gameOver = true;
                    showWinMessage();
                    updateCounterDots();
                    return;
                }
                
                // Move to next row
                gameState.currentRow++;
                gameState.currentCell = 0;
                updateCounterDots();
                
                // Check if game over
                if (gameState.currentRow > 4) {
                    gameState.gameOver = true;
                    showMessage(`Game Over! The solution was: ${challenge.solution.join(' â†’ ')}`);
                }
            }
            
            // Check if two words differ by exactly one letter
            function isOneLetterDifferent(word1, word2) {
                if (word1.length !== word2.length) return false;
                
                let differences = 0;
                for (let i = 0; i < word1.length; i++) {
                    if (word1[i] !== word2[i]) {
                        differences++;
                    }
                }
                
                return differences === 1;
            }
            
            // Animate valid word
            function animateValidWord() {
                for (let i = 0; i < 4; i++) {
                    const cell = document.getElementById(`cell-${gameState.currentRow}-${i + 1}`);
                    cell.classList.add('correct');
                    setTimeout(() => cell.classList.remove('correct'), 1000);
                }
            }
            
            // Animate invalid word
            function animateInvalidWord() {
                for (let i = 0; i < 4; i++) {
                    const cell = document.getElementById(`cell-${gameState.currentRow}-${i + 1}`);
                    cell.classList.add('incorrect');
                    setTimeout(() => cell.classList.remove('incorrect'), 500);
                }
            }
            
            // Update counter dots
            function updateCounterDots() {
                const dots = counterDotsEl.querySelectorAll('.counter-dot');
                dots.forEach((dot, index) => {
                    if (index < gameState.currentRow - 1) {
                        dot.classList.add('active');
                    } else {
                        dot.classList.remove('active');
                    }
                });
            }
            
            // Show win message
            function showWinMessage() {
                const message = document.createElement('div');
                message.className = 'win-message';
                message.textContent = `Congratulations! You solved it in ${gameState.currentRow - 1} steps!`;
                document.body.appendChild(message);
                
                // Add confetti effect
                createConfetti();
            }
            
            // Create confetti effect
            function createConfetti() {
                const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4'];
                
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        
                        // Random position
                        confetti.style.left = Math.random() * 100 + '%';
                        confetti.style.top = '-10px';
                        
                        // Random size
                        const size = Math.random() * 8 + 6;
                        confetti.style.width = size + 'px';
                        confetti.style.height = size + 'px';
                        
                        // Random color
                        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        
                        // Random rotation
                        const rotation = Math.random() * 360;
                        confetti.style.transform = `rotate(${rotation}deg)`;
                        
                        document.body.appendChild(confetti);
                        
                        setTimeout(() => confetti.remove(), 3000);
                    }, i * 50);
                }
            }
            
            // Show message
            function showMessage(text) {
                // Remove existing message
                const existingMessage = document.querySelector('.game-message');
                if (existingMessage) {
                    existingMessage.remove();
                }
                
                const message = document.createElement('div');
                message.className = 'game-message';
                message.textContent = text;
                
                document.body.appendChild(message);
                
                setTimeout(() => {
                    message.remove();
                }, 2000);
            }
            
            // Get the next word to guess
            function getNextWord() {
                if (gameState.gameOver) return null;
                
                const targetIndex = gameState.currentRow - 1;
                if (targetIndex >= challenge.solution.length) return null;
                
                return challenge.solution[targetIndex];
            }
            
            // Get the current word
            function getCurrentWord() {
                if (gameState.currentRow === 2) {
                    return challenge.start;
                } else {
                    return gameState.grid[gameState.currentRow - 2].join('');
                }
            }
            
            // Show letter hint
            function showLetterHint() {
                if (gameState.gameOver) return;
                
                const nextWord = getNextWord();
                const currentWord = getCurrentWord();
                
                if (!nextWord || !currentWord) {
                    showMessage('No more hints available!');
                    return;
                }
                
                // Find the position that's different
                for (let i = 0; i < currentWord.length; i++) {
                    if (currentWord[i] !== nextWord[i]) {
                        const cell = document.getElementById(`cell-${gameState.currentRow}-${i + 1}`);
                        if (cell) {
                            cell.classList.add('correct');
                            setTimeout(() => cell.classList.remove('correct'), 2000);
                        }
                        break;
                    }
                }
                
                hintText.textContent = 'The highlighted letter needs to change';
                hintPanel.style.display = 'block';
                
                setTimeout(() => {
                    hintPanel.style.display = 'none';
                }, 3000);
            }
            
            // Show definition hint
            function showDefinitionHint() {
                if (gameState.gameOver) return;
                
                const nextWord = getNextWord();
                
                if (!nextWord) {
                    showMessage('No more hints available!');
                    return;
                }
                
                const definition = wordDefinitions[nextWord] || 'A valid English word';
                hintText.textContent = `Definition: ${definition}`;
                hintPanel.style.display = 'block';
                
                setTimeout(() => {
                    hintPanel.style.display = 'none';
                }, 4000);
            }
            
            // Initialize game
            function initGame() {
                // Set challenge words
                startWordEl.textContent = challenge.start;
                targetWordEl.textContent = challenge.target;
                
                // Reset game state
                gameState = {
                    currentRow: 2, // Start from row 2 (row 1 has the start word)
                    currentCell: 0,
                    gameWon: false,
                    gameOver: false,
                    grid: []
                };
                
                createGrid();
                createKeyboard();
                updateCounterDots();
                
                // Hide hint panel
                hintPanel.style.display = 'none';
                
                // Remove any existing messages
                const existingMessage = document.querySelector('.win-message');
                if (existingMessage) {
                    existingMessage.remove();
                }
                
                updateStatus('Game ready to play!');
            }
            
            // Add event listeners
            resetBtn.addEventListener('click', initGame);
            letterHintBtn.addEventListener('click', showLetterHint);
            definitionHintBtn.addEventListener('click', showDefinitionHint);
            
            // Add keyboard event listener
            document.addEventListener('keydown', (event) => {
                if (gameState.gameOver) return;
                
                const key = event.key.toUpperCase();
                
                if (key === 'ENTER') {
                    submitAttempt();
                } else if (key === 'BACKSPACE') {
                    deleteLetter();
                } else if (key.match(/[A-Z]/) && key.length === 1) {
                    addLetter(key);
                }
            });
            
            // Initialize game
            initGame();
            
            // Wait for game to be fully loaded
            await new Promise(resolve => setTimeout(resolve, 1500));
            updateStatus('Game loaded successfully!');
            
            // CRITICAL: Call onTestReady() to remove the loading overlay
            if (window.gameSDK && window.gameSDK.lifecycle && window.gameSDK.lifecycle.onTestReady) {
                updateSDKStatus('Game ready - calling onTestReady()...');
                window.gameSDK.lifecycle.onTestReady();
                updateSDKStatus('onTestReady() called - loading overlay should be removed');
            }
        })();
    </script>
</body>
</html>