"use strict";(self.webpackChunkgame=self.webpackChunkgame||[]).push([[537],{7537:(t,e,r)=>{r.r(e),r.d(e,{default:()=>_});var n=r(9437),o=r(8064),i=r(435),c=r.n(i),f=r(5154);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p(t);if(e){var o=p(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===a(e)||"function"==typeof e))return e;return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}const y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(c,t);var e,r,o,i=s(c);function c(t,e){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(r=i.call(this)).dummy=new n.Object3D,r.dummyColor=new n.Color,r.view=new f.A(t,e,o),r}return e=c,(r=[{key:"onParticleCreated",value:function(t){void 0===t._iid&&(t._iid=this.view.addItem(this.dummy.matrix))}},{key:"onParticleUpdate",value:function(t){t&&t._iid&&(this.dummy.scale.setScalar(t.scale),this.dummy.position.copy(t.p),this.dummy.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),this.dummy.updateMatrix(),this.view.updateItem(t._iid,this.dummy.matrix),t.useColor&&(this.dummyColor.copy(t.color),this.view.setColor(t._iid,this.dummyColor)))}},{key:"onParticleDead",value:function(t){this.view.removeItem(t._iid),t._iid=void 0}}])&&u(e.prototype,r),o&&u(e,o),c}(c().BaseRender);function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function m(t,e){return m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},m(t,e)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=b(t);if(e){var o=b(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===h(e)||"function"==typeof e))return e;return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function b(t){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},b(t)}var w=new n.Vector3;const _={TrainSmokeVFX:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)}(c,t);var e,r,o,i=v(c);function c(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),i.apply(this,arguments)}return e=c,(r=[{key:"onCreate",value:function(){this.effect=this.query("effect"),this.effect.emitter.stopEmit(),this.effect.proton.autoDestroy=!1,this.started=!1,this.effect.proton.removeAllEventListeners();var t=this.effect.renderer;this.effect.proton.removeRender(t),this.effect.renderer=null;var e=new n.SphereGeometry(.5),r=new n.MeshStandardMaterial({color:13948116,transparent:!0});r.onBeforeCompile=function(t){t.vertexShader="\n                attribute float aAlpha;\n                varying float vAlpha;\n                ".concat(t.vertexShader,"\n                ").replace("void main() {","void main() {\n                    vAlpha = aAlpha;\n                "),t.fragmentShader="\n                varying float vAlpha;\n                ".concat(t.fragmentShader,"\n            ").replace("vec4 diffuseColor = vec4( diffuse, opacity );","vec4 diffuseColor = vec4( diffuse, vAlpha );")};var o=new y(e,r,200);this.effect.proton.addRender(o),this.effect.renderer=o,this.add(o.view),o.view.scale.setScalar(.1);var i=new Float32Array(200).fill(1);e.setAttribute("aAlpha",new n.InstancedBufferAttribute(i,1)),this.effect.proton.addEventListener("PARTICLE_UPDATE",(function(t){var r=o.view.indexBuffer.indexOf(t._iid),n=e.getAttribute("aAlpha");n.array[r]=t.alpha,n.needsUpdate=!0}))}},{key:"update",value:function(t,e){this.started||(this.effect.emitter.emit(1/0),this.started=!0),w.set(.32,1,0),e.localToWorld(w),e.parent.worldToLocal(w),this.effect.emitter.p.x=10*w.x,this.effect.emitter.p.y=10*w.y,this.effect.emitter.p.z=10*w.z}}])&&d(e.prototype,r),o&&d(e,o),c}(o.A.Component3D)}}}]);